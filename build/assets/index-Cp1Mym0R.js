function CF(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in t)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var Pe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function EF(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function A_(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var r=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return t[s]}})}),n}var kF={exports:{}},fv={},NF={exports:{}},Ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lm=Symbol.for("react.element"),pq=Symbol.for("react.portal"),mq=Symbol.for("react.fragment"),gq=Symbol.for("react.strict_mode"),yq=Symbol.for("react.profiler"),wq=Symbol.for("react.provider"),vq=Symbol.for("react.context"),xq=Symbol.for("react.forward_ref"),bq=Symbol.for("react.suspense"),Iq=Symbol.for("react.memo"),Tq=Symbol.for("react.lazy"),OA=Symbol.iterator;function Sq(t){return t===null||typeof t!="object"?null:(t=OA&&t[OA]||t["@@iterator"],typeof t=="function"?t:null)}var $F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},AF=Object.assign,RF={};function bh(t,e,n){this.props=t,this.context=e,this.refs=RF,this.updater=n||$F}bh.prototype.isReactComponent={};bh.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};bh.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function DF(){}DF.prototype=bh.prototype;function R_(t,e,n){this.props=t,this.context=e,this.refs=RF,this.updater=n||$F}var D_=R_.prototype=new DF;D_.constructor=R_;AF(D_,bh.prototype);D_.isPureReactComponent=!0;var PA=Array.isArray,OF=Object.prototype.hasOwnProperty,O_={current:null},PF={key:!0,ref:!0,__self:!0,__source:!0};function FF(t,e,n){var s,r={},i=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)OF.call(e,s)&&!PF.hasOwnProperty(s)&&(r[s]=e[s]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];r.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:lm,type:t,key:i,ref:o,props:r,_owner:O_.current}}function _q(t,e){return{$$typeof:lm,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function P_(t){return typeof t=="object"&&t!==null&&t.$$typeof===lm}function Cq(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var FA=/\/+/g;function Gb(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Cq(""+t.key):e.toString(36)}function f0(t,e,n,s,r){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case lm:case pq:o=!0}}if(o)return o=t,r=r(o),t=s===""?"."+Gb(o,0):s,PA(r)?(n="",t!=null&&(n=t.replace(FA,"$&/")+"/"),f0(r,e,n,"",function(u){return u})):r!=null&&(P_(r)&&(r=_q(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(FA,"$&/")+"/")+t)),e.push(r)),1;if(o=0,s=s===""?".":s+":",PA(t))for(var a=0;a<t.length;a++){i=t[a];var l=s+Gb(i,a);o+=f0(i,e,n,l,r)}else if(l=Sq(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=s+Gb(i,a++),o+=f0(i,e,n,l,r);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Sy(t,e,n){if(t==null)return t;var s=[],r=0;return f0(t,s,"","",function(i){return e.call(n,i,r++)}),s}function Eq(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var As={current:null},p0={transition:null},kq={ReactCurrentDispatcher:As,ReactCurrentBatchConfig:p0,ReactCurrentOwner:O_};Ke.Children={map:Sy,forEach:function(t,e,n){Sy(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Sy(t,function(){e++}),e},toArray:function(t){return Sy(t,function(e){return e})||[]},only:function(t){if(!P_(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ke.Component=bh;Ke.Fragment=mq;Ke.Profiler=yq;Ke.PureComponent=R_;Ke.StrictMode=gq;Ke.Suspense=bq;Ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kq;Ke.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=AF({},t.props),r=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=O_.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)OF.call(e,l)&&!PF.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];s.children=a}return{$$typeof:lm,type:t.type,key:r,ref:i,props:s,_owner:o}};Ke.createContext=function(t){return t={$$typeof:vq,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:wq,_context:t},t.Consumer=t};Ke.createElement=FF;Ke.createFactory=function(t){var e=FF.bind(null,t);return e.type=t,e};Ke.createRef=function(){return{current:null}};Ke.forwardRef=function(t){return{$$typeof:xq,render:t}};Ke.isValidElement=P_;Ke.lazy=function(t){return{$$typeof:Tq,_payload:{_status:-1,_result:t},_init:Eq}};Ke.memo=function(t,e){return{$$typeof:Iq,type:t,compare:e===void 0?null:e}};Ke.startTransition=function(t){var e=p0.transition;p0.transition={};try{t()}finally{p0.transition=e}};Ke.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Ke.useCallback=function(t,e){return As.current.useCallback(t,e)};Ke.useContext=function(t){return As.current.useContext(t)};Ke.useDebugValue=function(){};Ke.useDeferredValue=function(t){return As.current.useDeferredValue(t)};Ke.useEffect=function(t,e){return As.current.useEffect(t,e)};Ke.useId=function(){return As.current.useId()};Ke.useImperativeHandle=function(t,e,n){return As.current.useImperativeHandle(t,e,n)};Ke.useInsertionEffect=function(t,e){return As.current.useInsertionEffect(t,e)};Ke.useLayoutEffect=function(t,e){return As.current.useLayoutEffect(t,e)};Ke.useMemo=function(t,e){return As.current.useMemo(t,e)};Ke.useReducer=function(t,e,n){return As.current.useReducer(t,e,n)};Ke.useRef=function(t){return As.current.useRef(t)};Ke.useState=function(t){return As.current.useState(t)};Ke.useSyncExternalStore=function(t,e,n){return As.current.useSyncExternalStore(t,e,n)};Ke.useTransition=function(){return As.current.useTransition()};Ke.version="18.2.0";NF.exports=Ke;var oe=NF.exports;const Nq=EF(oe),$q=CF({__proto__:null,default:Nq},[oe]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Aq=oe,Rq=Symbol.for("react.element"),Dq=Symbol.for("react.fragment"),Oq=Object.prototype.hasOwnProperty,Pq=Aq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Fq={key:!0,ref:!0,__self:!0,__source:!0};function LF(t,e,n){var s,r={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)Oq.call(e,s)&&!Fq.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:Rq,type:t,key:i,ref:o,props:r,_owner:Pq.current}}fv.Fragment=Dq;fv.jsx=LF;fv.jsxs=LF;kF.exports=fv;var he=kF.exports,iT={},MF={exports:{}},br={},VF={exports:{}},zF={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(M,j){var K=M.length;M.push(j);e:for(;0<K;){var X=K-1>>>1,Z=M[X];if(0<r(Z,j))M[X]=j,M[K]=Z,K=X;else break e}}function n(M){return M.length===0?null:M[0]}function s(M){if(M.length===0)return null;var j=M[0],K=M.pop();if(K!==j){M[0]=K;e:for(var X=0,Z=M.length,te=Z>>>1;X<te;){var ie=2*(X+1)-1,se=M[ie],ce=ie+1,xe=M[ce];if(0>r(se,K))ce<Z&&0>r(xe,se)?(M[X]=xe,M[ce]=K,X=ce):(M[X]=se,M[ie]=K,X=ie);else if(ce<Z&&0>r(xe,K))M[X]=xe,M[ce]=K,X=ce;else break e}}return j}function r(M,j){var K=M.sortIndex-j.sortIndex;return K!==0?K:M.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,h=null,d=3,f=!1,p=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(M){for(var j=n(u);j!==null;){if(j.callback===null)s(u);else if(j.startTime<=M)s(u),j.sortIndex=j.expirationTime,e(l,j);else break;j=n(u)}}function v(M){if(m=!1,x(M),!p)if(n(l)!==null)p=!0,z(b);else{var j=n(u);j!==null&&H(v,j.startTime-M)}}function b(M,j){p=!1,m&&(m=!1,y(_),_=-1),f=!0;var K=d;try{for(x(j),h=n(l);h!==null&&(!(h.expirationTime>j)||M&&!$());){var X=h.callback;if(typeof X=="function"){h.callback=null,d=h.priorityLevel;var Z=X(h.expirationTime<=j);j=t.unstable_now(),typeof Z=="function"?h.callback=Z:h===n(l)&&s(l),x(j)}else s(l);h=n(l)}if(h!==null)var te=!0;else{var ie=n(u);ie!==null&&H(v,ie.startTime-j),te=!1}return te}finally{h=null,d=K,f=!1}}var S=!1,T=null,_=-1,E=5,N=-1;function $(){return!(t.unstable_now()-N<E)}function A(){if(T!==null){var M=t.unstable_now();N=M;var j=!0;try{j=T(!0,M)}finally{j?D():(S=!1,T=null)}}else S=!1}var D;if(typeof w=="function")D=function(){w(A)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,B=F.port2;F.port1.onmessage=A,D=function(){B.postMessage(null)}}else D=function(){g(A,0)};function z(M){T=M,S||(S=!0,D())}function H(M,j){_=g(function(){M(t.unstable_now())},j)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(M){M.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,z(b))},t.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<M?Math.floor(1e3/M):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(M){switch(d){case 1:case 2:case 3:var j=3;break;default:j=d}var K=d;d=j;try{return M()}finally{d=K}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(M,j){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var K=d;d=M;try{return j()}finally{d=K}},t.unstable_scheduleCallback=function(M,j,K){var X=t.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?X+K:X):K=X,M){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=K+Z,M={id:c++,callback:j,priorityLevel:M,startTime:K,expirationTime:Z,sortIndex:-1},K>X?(M.sortIndex=K,e(u,M),n(l)===null&&M===n(u)&&(m?(y(_),_=-1):m=!0,H(v,K-X))):(M.sortIndex=Z,e(l,M),p||f||(p=!0,z(b))),M},t.unstable_shouldYield=$,t.unstable_wrapCallback=function(M){var j=d;return function(){var K=d;d=j;try{return M.apply(this,arguments)}finally{d=K}}}})(zF);VF.exports=zF;var Lq=VF.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BF=oe,yr=Lq;function ne(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var UF=new Set,ep={};function Nu(t,e){Wc(t,e),Wc(t+"Capture",e)}function Wc(t,e){for(ep[t]=e,t=0;t<e.length;t++)UF.add(e[t])}var xo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),oT=Object.prototype.hasOwnProperty,Mq=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,LA={},MA={};function Vq(t){return oT.call(MA,t)?!0:oT.call(LA,t)?!1:Mq.test(t)?MA[t]=!0:(LA[t]=!0,!1)}function zq(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Bq(t,e,n,s){if(e===null||typeof e>"u"||zq(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Rs(t,e,n,s,r,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Yn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Yn[t]=new Rs(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Yn[e]=new Rs(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Yn[t]=new Rs(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Yn[t]=new Rs(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Yn[t]=new Rs(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Yn[t]=new Rs(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Yn[t]=new Rs(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Yn[t]=new Rs(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Yn[t]=new Rs(t,5,!1,t.toLowerCase(),null,!1,!1)});var F_=/[\-:]([a-z])/g;function L_(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(F_,L_);Yn[e]=new Rs(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(F_,L_);Yn[e]=new Rs(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(F_,L_);Yn[e]=new Rs(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Yn[t]=new Rs(t,1,!1,t.toLowerCase(),null,!1,!1)});Yn.xlinkHref=new Rs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Yn[t]=new Rs(t,1,!1,t.toLowerCase(),null,!0,!0)});function M_(t,e,n,s){var r=Yn.hasOwnProperty(e)?Yn[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Bq(e,n,r,s)&&(n=null),s||r===null?Vq(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,s=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var Po=BF.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_y=Symbol.for("react.element"),fc=Symbol.for("react.portal"),pc=Symbol.for("react.fragment"),V_=Symbol.for("react.strict_mode"),aT=Symbol.for("react.profiler"),WF=Symbol.for("react.provider"),jF=Symbol.for("react.context"),z_=Symbol.for("react.forward_ref"),lT=Symbol.for("react.suspense"),uT=Symbol.for("react.suspense_list"),B_=Symbol.for("react.memo"),ea=Symbol.for("react.lazy"),GF=Symbol.for("react.offscreen"),VA=Symbol.iterator;function Yd(t){return t===null||typeof t!="object"?null:(t=VA&&t[VA]||t["@@iterator"],typeof t=="function"?t:null)}var Mt=Object.assign,Hb;function mf(t){if(Hb===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Hb=e&&e[1]||""}return`
`+Hb+t}var qb=!1;function Kb(t,e){if(!t||qb)return"";qb=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var s=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){s=u}t.call(e.prototype)}else{try{throw Error()}catch(u){s=u}t()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),i=s.stack.split(`
`),o=r.length-1,a=i.length-1;1<=o&&0<=a&&r[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==i[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{qb=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?mf(t):""}function Uq(t){switch(t.tag){case 5:return mf(t.type);case 16:return mf("Lazy");case 13:return mf("Suspense");case 19:return mf("SuspenseList");case 0:case 2:case 15:return t=Kb(t.type,!1),t;case 11:return t=Kb(t.type.render,!1),t;case 1:return t=Kb(t.type,!0),t;default:return""}}function cT(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case pc:return"Fragment";case fc:return"Portal";case aT:return"Profiler";case V_:return"StrictMode";case lT:return"Suspense";case uT:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case jF:return(t.displayName||"Context")+".Consumer";case WF:return(t._context.displayName||"Context")+".Provider";case z_:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case B_:return e=t.displayName||null,e!==null?e:cT(t.type)||"Memo";case ea:e=t._payload,t=t._init;try{return cT(t(e))}catch{}}return null}function Wq(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cT(e);case 8:return e===V_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ra(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function HF(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function jq(t){var e=HF(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){s=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Cy(t){t._valueTracker||(t._valueTracker=jq(t))}function qF(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=HF(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function W0(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function hT(t,e){var n=e.checked;return Mt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function zA(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=Ra(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function KF(t,e){e=e.checked,e!=null&&M_(t,"checked",e,!1)}function dT(t,e){KF(t,e);var n=Ra(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?fT(t,e.type,n):e.hasOwnProperty("defaultValue")&&fT(t,e.type,Ra(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function BA(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function fT(t,e,n){(e!=="number"||W0(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var gf=Array.isArray;function Nc(t,e,n,s){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&s&&(t[n].defaultSelected=!0)}else{for(n=""+Ra(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,s&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function pT(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ne(91));return Mt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function UA(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ne(92));if(gf(n)){if(1<n.length)throw Error(ne(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ra(n)}}function XF(t,e){var n=Ra(e.value),s=Ra(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function WA(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function QF(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function mT(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?QF(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ey,YF=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ey=Ey||document.createElement("div"),Ey.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ey.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function tp(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ff={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Gq=["Webkit","ms","Moz","O"];Object.keys(Ff).forEach(function(t){Gq.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ff[e]=Ff[t]})});function JF(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ff.hasOwnProperty(t)&&Ff[t]?(""+e).trim():e+"px"}function ZF(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=JF(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,r):t[n]=r}}var Hq=Mt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function gT(t,e){if(e){if(Hq[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ne(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ne(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ne(62))}}function yT(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wT=null;function U_(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var vT=null,$c=null,Ac=null;function jA(t){if(t=hm(t)){if(typeof vT!="function")throw Error(ne(280));var e=t.stateNode;e&&(e=wv(e),vT(t.stateNode,t.type,e))}}function eL(t){$c?Ac?Ac.push(t):Ac=[t]:$c=t}function tL(){if($c){var t=$c,e=Ac;if(Ac=$c=null,jA(t),e)for(t=0;t<e.length;t++)jA(e[t])}}function nL(t,e){return t(e)}function sL(){}var Xb=!1;function rL(t,e,n){if(Xb)return t(e,n);Xb=!0;try{return nL(t,e,n)}finally{Xb=!1,($c!==null||Ac!==null)&&(sL(),tL())}}function np(t,e){var n=t.stateNode;if(n===null)return null;var s=wv(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ne(231,e,typeof n));return n}var xT=!1;if(xo)try{var Jd={};Object.defineProperty(Jd,"passive",{get:function(){xT=!0}}),window.addEventListener("test",Jd,Jd),window.removeEventListener("test",Jd,Jd)}catch{xT=!1}function qq(t,e,n,s,r,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var Lf=!1,j0=null,G0=!1,bT=null,Kq={onError:function(t){Lf=!0,j0=t}};function Xq(t,e,n,s,r,i,o,a,l){Lf=!1,j0=null,qq.apply(Kq,arguments)}function Qq(t,e,n,s,r,i,o,a,l){if(Xq.apply(this,arguments),Lf){if(Lf){var u=j0;Lf=!1,j0=null}else throw Error(ne(198));G0||(G0=!0,bT=u)}}function $u(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function iL(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function GA(t){if($u(t)!==t)throw Error(ne(188))}function Yq(t){var e=t.alternate;if(!e){if(e=$u(t),e===null)throw Error(ne(188));return e!==t?null:t}for(var n=t,s=e;;){var r=n.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===n)return GA(r),t;if(i===s)return GA(r),e;i=i.sibling}throw Error(ne(188))}if(n.return!==s.return)n=r,s=i;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,s=i;break}if(a===s){o=!0,s=r,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,s=r;break}if(a===s){o=!0,s=i,n=r;break}a=a.sibling}if(!o)throw Error(ne(189))}}if(n.alternate!==s)throw Error(ne(190))}if(n.tag!==3)throw Error(ne(188));return n.stateNode.current===n?t:e}function oL(t){return t=Yq(t),t!==null?aL(t):null}function aL(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=aL(t);if(e!==null)return e;t=t.sibling}return null}var lL=yr.unstable_scheduleCallback,HA=yr.unstable_cancelCallback,Jq=yr.unstable_shouldYield,Zq=yr.unstable_requestPaint,Xt=yr.unstable_now,e5=yr.unstable_getCurrentPriorityLevel,W_=yr.unstable_ImmediatePriority,uL=yr.unstable_UserBlockingPriority,H0=yr.unstable_NormalPriority,t5=yr.unstable_LowPriority,cL=yr.unstable_IdlePriority,pv=null,Oi=null;function n5(t){if(Oi&&typeof Oi.onCommitFiberRoot=="function")try{Oi.onCommitFiberRoot(pv,t,void 0,(t.current.flags&128)===128)}catch{}}var ni=Math.clz32?Math.clz32:i5,s5=Math.log,r5=Math.LN2;function i5(t){return t>>>=0,t===0?32:31-(s5(t)/r5|0)|0}var ky=64,Ny=4194304;function yf(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function q0(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,r=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?s=yf(a):(i&=o,i!==0&&(s=yf(i)))}else o=n&~r,o!==0?s=yf(o):i!==0&&(s=yf(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-ni(e),r=1<<n,s|=t[n],e&=~r;return s}function o5(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function a5(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,r=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-ni(i),a=1<<o,l=r[o];l===-1?(!(a&n)||a&s)&&(r[o]=o5(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function IT(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function hL(){var t=ky;return ky<<=1,!(ky&4194240)&&(ky=64),t}function Qb(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function um(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ni(e),t[e]=n}function l5(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-ni(n),i=1<<r;e[r]=0,s[r]=-1,t[r]=-1,n&=~i}}function j_(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-ni(n),r=1<<s;r&e|t[s]&e&&(t[s]|=e),n&=~r}}var at=0;function dL(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var fL,G_,pL,mL,gL,TT=!1,$y=[],ya=null,wa=null,va=null,sp=new Map,rp=new Map,sa=[],u5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function qA(t,e){switch(t){case"focusin":case"focusout":ya=null;break;case"dragenter":case"dragleave":wa=null;break;case"mouseover":case"mouseout":va=null;break;case"pointerover":case"pointerout":sp.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":rp.delete(e.pointerId)}}function Zd(t,e,n,s,r,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},e!==null&&(e=hm(e),e!==null&&G_(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function c5(t,e,n,s,r){switch(e){case"focusin":return ya=Zd(ya,t,e,n,s,r),!0;case"dragenter":return wa=Zd(wa,t,e,n,s,r),!0;case"mouseover":return va=Zd(va,t,e,n,s,r),!0;case"pointerover":var i=r.pointerId;return sp.set(i,Zd(sp.get(i)||null,t,e,n,s,r)),!0;case"gotpointercapture":return i=r.pointerId,rp.set(i,Zd(rp.get(i)||null,t,e,n,s,r)),!0}return!1}function yL(t){var e=Cl(t.target);if(e!==null){var n=$u(e);if(n!==null){if(e=n.tag,e===13){if(e=iL(n),e!==null){t.blockedOn=e,gL(t.priority,function(){pL(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function m0(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=ST(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);wT=s,n.target.dispatchEvent(s),wT=null}else return e=hm(n),e!==null&&G_(e),t.blockedOn=n,!1;e.shift()}return!0}function KA(t,e,n){m0(t)&&n.delete(e)}function h5(){TT=!1,ya!==null&&m0(ya)&&(ya=null),wa!==null&&m0(wa)&&(wa=null),va!==null&&m0(va)&&(va=null),sp.forEach(KA),rp.forEach(KA)}function ef(t,e){t.blockedOn===e&&(t.blockedOn=null,TT||(TT=!0,yr.unstable_scheduleCallback(yr.unstable_NormalPriority,h5)))}function ip(t){function e(r){return ef(r,t)}if(0<$y.length){ef($y[0],t);for(var n=1;n<$y.length;n++){var s=$y[n];s.blockedOn===t&&(s.blockedOn=null)}}for(ya!==null&&ef(ya,t),wa!==null&&ef(wa,t),va!==null&&ef(va,t),sp.forEach(e),rp.forEach(e),n=0;n<sa.length;n++)s=sa[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<sa.length&&(n=sa[0],n.blockedOn===null);)yL(n),n.blockedOn===null&&sa.shift()}var Rc=Po.ReactCurrentBatchConfig,K0=!0;function d5(t,e,n,s){var r=at,i=Rc.transition;Rc.transition=null;try{at=1,H_(t,e,n,s)}finally{at=r,Rc.transition=i}}function f5(t,e,n,s){var r=at,i=Rc.transition;Rc.transition=null;try{at=4,H_(t,e,n,s)}finally{at=r,Rc.transition=i}}function H_(t,e,n,s){if(K0){var r=ST(t,e,n,s);if(r===null)oI(t,e,s,X0,n),qA(t,s);else if(c5(r,t,e,n,s))s.stopPropagation();else if(qA(t,s),e&4&&-1<u5.indexOf(t)){for(;r!==null;){var i=hm(r);if(i!==null&&fL(i),i=ST(t,e,n,s),i===null&&oI(t,e,s,X0,n),i===r)break;r=i}r!==null&&s.stopPropagation()}else oI(t,e,s,null,n)}}var X0=null;function ST(t,e,n,s){if(X0=null,t=U_(s),t=Cl(t),t!==null)if(e=$u(t),e===null)t=null;else if(n=e.tag,n===13){if(t=iL(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return X0=t,null}function wL(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(e5()){case W_:return 1;case uL:return 4;case H0:case t5:return 16;case cL:return 536870912;default:return 16}default:return 16}}var ua=null,q_=null,g0=null;function vL(){if(g0)return g0;var t,e=q_,n=e.length,s,r="value"in ua?ua.value:ua.textContent,i=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(s=1;s<=o&&e[n-s]===r[i-s];s++);return g0=r.slice(t,1<s?1-s:void 0)}function y0(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ay(){return!0}function XA(){return!1}function Ir(t){function e(n,s,r,i,o){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ay:XA,this.isPropagationStopped=XA,this}return Mt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ay)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ay)},persist:function(){},isPersistent:Ay}),e}var Ih={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},K_=Ir(Ih),cm=Mt({},Ih,{view:0,detail:0}),p5=Ir(cm),Yb,Jb,tf,mv=Mt({},cm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:X_,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==tf&&(tf&&t.type==="mousemove"?(Yb=t.screenX-tf.screenX,Jb=t.screenY-tf.screenY):Jb=Yb=0,tf=t),Yb)},movementY:function(t){return"movementY"in t?t.movementY:Jb}}),QA=Ir(mv),m5=Mt({},mv,{dataTransfer:0}),g5=Ir(m5),y5=Mt({},cm,{relatedTarget:0}),Zb=Ir(y5),w5=Mt({},Ih,{animationName:0,elapsedTime:0,pseudoElement:0}),v5=Ir(w5),x5=Mt({},Ih,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),b5=Ir(x5),I5=Mt({},Ih,{data:0}),YA=Ir(I5),T5={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},S5={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_5={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function C5(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=_5[t])?!!e[t]:!1}function X_(){return C5}var E5=Mt({},cm,{key:function(t){if(t.key){var e=T5[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=y0(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?S5[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:X_,charCode:function(t){return t.type==="keypress"?y0(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?y0(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),k5=Ir(E5),N5=Mt({},mv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),JA=Ir(N5),$5=Mt({},cm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:X_}),A5=Ir($5),R5=Mt({},Ih,{propertyName:0,elapsedTime:0,pseudoElement:0}),D5=Ir(R5),O5=Mt({},mv,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),P5=Ir(O5),F5=[9,13,27,32],Q_=xo&&"CompositionEvent"in window,Mf=null;xo&&"documentMode"in document&&(Mf=document.documentMode);var L5=xo&&"TextEvent"in window&&!Mf,xL=xo&&(!Q_||Mf&&8<Mf&&11>=Mf),ZA=" ",eR=!1;function bL(t,e){switch(t){case"keyup":return F5.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function IL(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var mc=!1;function M5(t,e){switch(t){case"compositionend":return IL(e);case"keypress":return e.which!==32?null:(eR=!0,ZA);case"textInput":return t=e.data,t===ZA&&eR?null:t;default:return null}}function V5(t,e){if(mc)return t==="compositionend"||!Q_&&bL(t,e)?(t=vL(),g0=q_=ua=null,mc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return xL&&e.locale!=="ko"?null:e.data;default:return null}}var z5={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tR(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!z5[t.type]:e==="textarea"}function TL(t,e,n,s){eL(s),e=Q0(e,"onChange"),0<e.length&&(n=new K_("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var Vf=null,op=null;function B5(t){OL(t,0)}function gv(t){var e=wc(t);if(qF(e))return t}function U5(t,e){if(t==="change")return e}var SL=!1;if(xo){var eI;if(xo){var tI="oninput"in document;if(!tI){var nR=document.createElement("div");nR.setAttribute("oninput","return;"),tI=typeof nR.oninput=="function"}eI=tI}else eI=!1;SL=eI&&(!document.documentMode||9<document.documentMode)}function sR(){Vf&&(Vf.detachEvent("onpropertychange",_L),op=Vf=null)}function _L(t){if(t.propertyName==="value"&&gv(op)){var e=[];TL(e,op,t,U_(t)),rL(B5,e)}}function W5(t,e,n){t==="focusin"?(sR(),Vf=e,op=n,Vf.attachEvent("onpropertychange",_L)):t==="focusout"&&sR()}function j5(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return gv(op)}function G5(t,e){if(t==="click")return gv(e)}function H5(t,e){if(t==="input"||t==="change")return gv(e)}function q5(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ui=typeof Object.is=="function"?Object.is:q5;function ap(t,e){if(ui(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!oT.call(e,r)||!ui(t[r],e[r]))return!1}return!0}function rR(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function iR(t,e){var n=rR(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=rR(n)}}function CL(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?CL(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function EL(){for(var t=window,e=W0();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=W0(t.document)}return e}function Y_(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function K5(t){var e=EL(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&CL(n.ownerDocument.documentElement,n)){if(s!==null&&Y_(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!t.extend&&i>s&&(r=s,s=i,i=r),r=iR(n,i);var o=iR(n,s);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),i>s?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var X5=xo&&"documentMode"in document&&11>=document.documentMode,gc=null,_T=null,zf=null,CT=!1;function oR(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;CT||gc==null||gc!==W0(s)||(s=gc,"selectionStart"in s&&Y_(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),zf&&ap(zf,s)||(zf=s,s=Q0(_T,"onSelect"),0<s.length&&(e=new K_("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=gc)))}function Ry(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var yc={animationend:Ry("Animation","AnimationEnd"),animationiteration:Ry("Animation","AnimationIteration"),animationstart:Ry("Animation","AnimationStart"),transitionend:Ry("Transition","TransitionEnd")},nI={},kL={};xo&&(kL=document.createElement("div").style,"AnimationEvent"in window||(delete yc.animationend.animation,delete yc.animationiteration.animation,delete yc.animationstart.animation),"TransitionEvent"in window||delete yc.transitionend.transition);function yv(t){if(nI[t])return nI[t];if(!yc[t])return t;var e=yc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in kL)return nI[t]=e[n];return t}var NL=yv("animationend"),$L=yv("animationiteration"),AL=yv("animationstart"),RL=yv("transitionend"),DL=new Map,aR="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qa(t,e){DL.set(t,e),Nu(e,[t])}for(var sI=0;sI<aR.length;sI++){var rI=aR[sI],Q5=rI.toLowerCase(),Y5=rI[0].toUpperCase()+rI.slice(1);qa(Q5,"on"+Y5)}qa(NL,"onAnimationEnd");qa($L,"onAnimationIteration");qa(AL,"onAnimationStart");qa("dblclick","onDoubleClick");qa("focusin","onFocus");qa("focusout","onBlur");qa(RL,"onTransitionEnd");Wc("onMouseEnter",["mouseout","mouseover"]);Wc("onMouseLeave",["mouseout","mouseover"]);Wc("onPointerEnter",["pointerout","pointerover"]);Wc("onPointerLeave",["pointerout","pointerover"]);Nu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Nu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Nu("onBeforeInput",["compositionend","keypress","textInput","paste"]);Nu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Nu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Nu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),J5=new Set("cancel close invalid load scroll toggle".split(" ").concat(wf));function lR(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,Qq(s,e,void 0,t),t.currentTarget=null}function OL(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],r=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&r.isPropagationStopped())break e;lR(r,a,u),i=l}else for(o=0;o<s.length;o++){if(a=s[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&r.isPropagationStopped())break e;lR(r,a,u),i=l}}}if(G0)throw t=bT,G0=!1,bT=null,t}function bt(t,e){var n=e[AT];n===void 0&&(n=e[AT]=new Set);var s=t+"__bubble";n.has(s)||(PL(e,t,2,!1),n.add(s))}function iI(t,e,n){var s=0;e&&(s|=4),PL(n,t,s,e)}var Dy="_reactListening"+Math.random().toString(36).slice(2);function lp(t){if(!t[Dy]){t[Dy]=!0,UF.forEach(function(n){n!=="selectionchange"&&(J5.has(n)||iI(n,!1,t),iI(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Dy]||(e[Dy]=!0,iI("selectionchange",!1,e))}}function PL(t,e,n,s){switch(wL(e)){case 1:var r=d5;break;case 4:r=f5;break;default:r=H_}n=r.bind(null,e,n,t),r=void 0,!xT||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function oI(t,e,n,s,r){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=s.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Cl(a),o===null)return;if(l=o.tag,l===5||l===6){s=i=o;continue e}a=a.parentNode}}s=s.return}rL(function(){var u=i,c=U_(n),h=[];e:{var d=DL.get(t);if(d!==void 0){var f=K_,p=t;switch(t){case"keypress":if(y0(n)===0)break e;case"keydown":case"keyup":f=k5;break;case"focusin":p="focus",f=Zb;break;case"focusout":p="blur",f=Zb;break;case"beforeblur":case"afterblur":f=Zb;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=QA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=g5;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=A5;break;case NL:case $L:case AL:f=v5;break;case RL:f=D5;break;case"scroll":f=p5;break;case"wheel":f=P5;break;case"copy":case"cut":case"paste":f=b5;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=JA}var m=(e&4)!==0,g=!m&&t==="scroll",y=m?d!==null?d+"Capture":null:d;m=[];for(var w=u,x;w!==null;){x=w;var v=x.stateNode;if(x.tag===5&&v!==null&&(x=v,y!==null&&(v=np(w,y),v!=null&&m.push(up(w,v,x)))),g)break;w=w.return}0<m.length&&(d=new f(d,p,null,n,c),h.push({event:d,listeners:m}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",d&&n!==wT&&(p=n.relatedTarget||n.fromElement)&&(Cl(p)||p[bo]))break e;if((f||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=n.relatedTarget||n.toElement,f=u,p=p?Cl(p):null,p!==null&&(g=$u(p),p!==g||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=u),f!==p)){if(m=QA,v="onMouseLeave",y="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(m=JA,v="onPointerLeave",y="onPointerEnter",w="pointer"),g=f==null?d:wc(f),x=p==null?d:wc(p),d=new m(v,w+"leave",f,n,c),d.target=g,d.relatedTarget=x,v=null,Cl(c)===u&&(m=new m(y,w+"enter",p,n,c),m.target=x,m.relatedTarget=g,v=m),g=v,f&&p)t:{for(m=f,y=p,w=0,x=m;x;x=rc(x))w++;for(x=0,v=y;v;v=rc(v))x++;for(;0<w-x;)m=rc(m),w--;for(;0<x-w;)y=rc(y),x--;for(;w--;){if(m===y||y!==null&&m===y.alternate)break t;m=rc(m),y=rc(y)}m=null}else m=null;f!==null&&uR(h,d,f,m,!1),p!==null&&g!==null&&uR(h,g,p,m,!0)}}e:{if(d=u?wc(u):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var b=U5;else if(tR(d))if(SL)b=H5;else{b=j5;var S=W5}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(b=G5);if(b&&(b=b(t,u))){TL(h,b,n,c);break e}S&&S(t,d,u),t==="focusout"&&(S=d._wrapperState)&&S.controlled&&d.type==="number"&&fT(d,"number",d.value)}switch(S=u?wc(u):window,t){case"focusin":(tR(S)||S.contentEditable==="true")&&(gc=S,_T=u,zf=null);break;case"focusout":zf=_T=gc=null;break;case"mousedown":CT=!0;break;case"contextmenu":case"mouseup":case"dragend":CT=!1,oR(h,n,c);break;case"selectionchange":if(X5)break;case"keydown":case"keyup":oR(h,n,c)}var T;if(Q_)e:{switch(t){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else mc?bL(t,n)&&(_="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(_="onCompositionStart");_&&(xL&&n.locale!=="ko"&&(mc||_!=="onCompositionStart"?_==="onCompositionEnd"&&mc&&(T=vL()):(ua=c,q_="value"in ua?ua.value:ua.textContent,mc=!0)),S=Q0(u,_),0<S.length&&(_=new YA(_,t,null,n,c),h.push({event:_,listeners:S}),T?_.data=T:(T=IL(n),T!==null&&(_.data=T)))),(T=L5?M5(t,n):V5(t,n))&&(u=Q0(u,"onBeforeInput"),0<u.length&&(c=new YA("onBeforeInput","beforeinput",null,n,c),h.push({event:c,listeners:u}),c.data=T))}OL(h,e)})}function up(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Q0(t,e){for(var n=e+"Capture",s=[];t!==null;){var r=t,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=np(t,n),i!=null&&s.unshift(up(t,i,r)),i=np(t,e),i!=null&&s.push(up(t,i,r))),t=t.return}return s}function rc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function uR(t,e,n,s,r){for(var i=e._reactName,o=[];n!==null&&n!==s;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&u!==null&&(a=u,r?(l=np(n,i),l!=null&&o.unshift(up(n,l,a))):r||(l=np(n,i),l!=null&&o.push(up(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var Z5=/\r\n?/g,eK=/\u0000|\uFFFD/g;function cR(t){return(typeof t=="string"?t:""+t).replace(Z5,`
`).replace(eK,"")}function Oy(t,e,n){if(e=cR(e),cR(t)!==e&&n)throw Error(ne(425))}function Y0(){}var ET=null,kT=null;function NT(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var $T=typeof setTimeout=="function"?setTimeout:void 0,tK=typeof clearTimeout=="function"?clearTimeout:void 0,hR=typeof Promise=="function"?Promise:void 0,nK=typeof queueMicrotask=="function"?queueMicrotask:typeof hR<"u"?function(t){return hR.resolve(null).then(t).catch(sK)}:$T;function sK(t){setTimeout(function(){throw t})}function aI(t,e){var n=e,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){t.removeChild(r),ip(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);ip(e)}function xa(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function dR(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Th=Math.random().toString(36).slice(2),ki="__reactFiber$"+Th,cp="__reactProps$"+Th,bo="__reactContainer$"+Th,AT="__reactEvents$"+Th,rK="__reactListeners$"+Th,iK="__reactHandles$"+Th;function Cl(t){var e=t[ki];if(e)return e;for(var n=t.parentNode;n;){if(e=n[bo]||n[ki]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=dR(t);t!==null;){if(n=t[ki])return n;t=dR(t)}return e}t=n,n=t.parentNode}return null}function hm(t){return t=t[ki]||t[bo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function wc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ne(33))}function wv(t){return t[cp]||null}var RT=[],vc=-1;function Ka(t){return{current:t}}function St(t){0>vc||(t.current=RT[vc],RT[vc]=null,vc--)}function gt(t,e){vc++,RT[vc]=t.current,t.current=e}var Da={},hs=Ka(Da),Ws=Ka(!1),Xl=Da;function jc(t,e){var n=t.type.contextTypes;if(!n)return Da;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in n)r[i]=e[i];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function js(t){return t=t.childContextTypes,t!=null}function J0(){St(Ws),St(hs)}function fR(t,e,n){if(hs.current!==Da)throw Error(ne(168));gt(hs,e),gt(Ws,n)}function FL(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(ne(108,Wq(t)||"Unknown",r));return Mt({},n,s)}function Z0(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Da,Xl=hs.current,gt(hs,t),gt(Ws,Ws.current),!0}function pR(t,e,n){var s=t.stateNode;if(!s)throw Error(ne(169));n?(t=FL(t,e,Xl),s.__reactInternalMemoizedMergedChildContext=t,St(Ws),St(hs),gt(hs,t)):St(Ws),gt(Ws,n)}var io=null,vv=!1,lI=!1;function LL(t){io===null?io=[t]:io.push(t)}function oK(t){vv=!0,LL(t)}function Xa(){if(!lI&&io!==null){lI=!0;var t=0,e=at;try{var n=io;for(at=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}io=null,vv=!1}catch(r){throw io!==null&&(io=io.slice(t+1)),lL(W_,Xa),r}finally{at=e,lI=!1}}return null}var xc=[],bc=0,ew=null,tw=0,Er=[],kr=0,Ql=null,ho=1,fo="";function ml(t,e){xc[bc++]=tw,xc[bc++]=ew,ew=t,tw=e}function ML(t,e,n){Er[kr++]=ho,Er[kr++]=fo,Er[kr++]=Ql,Ql=t;var s=ho;t=fo;var r=32-ni(s)-1;s&=~(1<<r),n+=1;var i=32-ni(e)+r;if(30<i){var o=r-r%5;i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,ho=1<<32-ni(e)+r|n<<r|s,fo=i+t}else ho=1<<i|n<<r|s,fo=t}function J_(t){t.return!==null&&(ml(t,1),ML(t,1,0))}function Z_(t){for(;t===ew;)ew=xc[--bc],xc[bc]=null,tw=xc[--bc],xc[bc]=null;for(;t===Ql;)Ql=Er[--kr],Er[kr]=null,fo=Er[--kr],Er[kr]=null,ho=Er[--kr],Er[kr]=null}var fr=null,ar=null,Nt=!1,Jr=null;function VL(t,e){var n=$r(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function mR(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,fr=t,ar=xa(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,fr=t,ar=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ql!==null?{id:ho,overflow:fo}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=$r(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,fr=t,ar=null,!0):!1;default:return!1}}function DT(t){return(t.mode&1)!==0&&(t.flags&128)===0}function OT(t){if(Nt){var e=ar;if(e){var n=e;if(!mR(t,e)){if(DT(t))throw Error(ne(418));e=xa(n.nextSibling);var s=fr;e&&mR(t,e)?VL(s,n):(t.flags=t.flags&-4097|2,Nt=!1,fr=t)}}else{if(DT(t))throw Error(ne(418));t.flags=t.flags&-4097|2,Nt=!1,fr=t}}}function gR(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;fr=t}function Py(t){if(t!==fr)return!1;if(!Nt)return gR(t),Nt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!NT(t.type,t.memoizedProps)),e&&(e=ar)){if(DT(t))throw zL(),Error(ne(418));for(;e;)VL(t,e),e=xa(e.nextSibling)}if(gR(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ne(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ar=xa(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ar=null}}else ar=fr?xa(t.stateNode.nextSibling):null;return!0}function zL(){for(var t=ar;t;)t=xa(t.nextSibling)}function Gc(){ar=fr=null,Nt=!1}function eC(t){Jr===null?Jr=[t]:Jr.push(t)}var aK=Po.ReactCurrentBatchConfig;function Xr(t,e){if(t&&t.defaultProps){e=Mt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var nw=Ka(null),sw=null,Ic=null,tC=null;function nC(){tC=Ic=sw=null}function sC(t){var e=nw.current;St(nw),t._currentValue=e}function PT(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function Dc(t,e){sw=t,tC=Ic=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Bs=!0),t.firstContext=null)}function Lr(t){var e=t._currentValue;if(tC!==t)if(t={context:t,memoizedValue:e,next:null},Ic===null){if(sw===null)throw Error(ne(308));Ic=t,sw.dependencies={lanes:0,firstContext:t}}else Ic=Ic.next=t;return e}var El=null;function rC(t){El===null?El=[t]:El.push(t)}function BL(t,e,n,s){var r=e.interleaved;return r===null?(n.next=n,rC(e)):(n.next=r.next,r.next=n),e.interleaved=n,Io(t,s)}function Io(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ta=!1;function iC(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function UL(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function yo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ba(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,et&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,Io(t,n)}return r=s.interleaved,r===null?(e.next=e,rC(s)):(e.next=r.next,r.next=e),s.interleaved=e,Io(t,n)}function w0(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,j_(t,n)}}function yR(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?r=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?r=i=e:i=i.next=e}else r=i=e;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function rw(t,e,n,s){var r=t.updateQueue;ta=!1;var i=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(i!==null){var h=r.baseState;o=0,c=u=l=null,a=i;do{var d=a.lane,f=a.eventTime;if((s&d)===d){c!==null&&(c=c.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,m=a;switch(d=e,f=n,m.tag){case 1:if(p=m.payload,typeof p=="function"){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,d=typeof p=="function"?p.call(f,h,d):p,d==null)break e;h=Mt({},h,d);break e;case 2:ta=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,d=r.effects,d===null?r.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=f,l=h):c=c.next=f,o|=d;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;d=a,a=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(c===null&&(l=h),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);Jl|=o,t.lanes=o,t.memoizedState=h}}function wR(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(ne(191,r));r.call(s)}}}var WL=new BF.Component().refs;function FT(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:Mt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var xv={isMounted:function(t){return(t=t._reactInternals)?$u(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=Ts(),r=Ta(t),i=yo(s,r);i.payload=e,n!=null&&(i.callback=n),e=ba(t,i,r),e!==null&&(si(e,t,r,s),w0(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=Ts(),r=Ta(t),i=yo(s,r);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ba(t,i,r),e!==null&&(si(e,t,r,s),w0(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ts(),s=Ta(t),r=yo(n,s);r.tag=2,e!=null&&(r.callback=e),e=ba(t,r,s),e!==null&&(si(e,t,s,n),w0(e,t,s))}};function vR(t,e,n,s,r,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,i,o):e.prototype&&e.prototype.isPureReactComponent?!ap(n,s)||!ap(r,i):!0}function jL(t,e,n){var s=!1,r=Da,i=e.contextType;return typeof i=="object"&&i!==null?i=Lr(i):(r=js(e)?Xl:hs.current,s=e.contextTypes,i=(s=s!=null)?jc(t,r):Da),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=xv,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=i),e}function xR(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&xv.enqueueReplaceState(e,e.state,null)}function LT(t,e,n,s){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=WL,iC(t);var i=e.contextType;typeof i=="object"&&i!==null?r.context=Lr(i):(i=js(e)?Xl:hs.current,r.context=jc(t,i)),r.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(FT(t,e,i,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&xv.enqueueReplaceState(r,r.state,null),rw(t,n,r,s),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function nf(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ne(309));var s=n.stateNode}if(!s)throw Error(ne(147,t));var r=s,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=r.refs;a===WL&&(a=r.refs={}),o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(ne(284));if(!n._owner)throw Error(ne(290,t))}return t}function Fy(t,e){throw t=Object.prototype.toString.call(e),Error(ne(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function bR(t){var e=t._init;return e(t._payload)}function GL(t){function e(y,w){if(t){var x=y.deletions;x===null?(y.deletions=[w],y.flags|=16):x.push(w)}}function n(y,w){if(!t)return null;for(;w!==null;)e(y,w),w=w.sibling;return null}function s(y,w){for(y=new Map;w!==null;)w.key!==null?y.set(w.key,w):y.set(w.index,w),w=w.sibling;return y}function r(y,w){return y=Sa(y,w),y.index=0,y.sibling=null,y}function i(y,w,x){return y.index=x,t?(x=y.alternate,x!==null?(x=x.index,x<w?(y.flags|=2,w):x):(y.flags|=2,w)):(y.flags|=1048576,w)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,w,x,v){return w===null||w.tag!==6?(w=mI(x,y.mode,v),w.return=y,w):(w=r(w,x),w.return=y,w)}function l(y,w,x,v){var b=x.type;return b===pc?c(y,w,x.props.children,v,x.key):w!==null&&(w.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===ea&&bR(b)===w.type)?(v=r(w,x.props),v.ref=nf(y,w,x),v.return=y,v):(v=S0(x.type,x.key,x.props,null,y.mode,v),v.ref=nf(y,w,x),v.return=y,v)}function u(y,w,x,v){return w===null||w.tag!==4||w.stateNode.containerInfo!==x.containerInfo||w.stateNode.implementation!==x.implementation?(w=gI(x,y.mode,v),w.return=y,w):(w=r(w,x.children||[]),w.return=y,w)}function c(y,w,x,v,b){return w===null||w.tag!==7?(w=Vl(x,y.mode,v,b),w.return=y,w):(w=r(w,x),w.return=y,w)}function h(y,w,x){if(typeof w=="string"&&w!==""||typeof w=="number")return w=mI(""+w,y.mode,x),w.return=y,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case _y:return x=S0(w.type,w.key,w.props,null,y.mode,x),x.ref=nf(y,null,w),x.return=y,x;case fc:return w=gI(w,y.mode,x),w.return=y,w;case ea:var v=w._init;return h(y,v(w._payload),x)}if(gf(w)||Yd(w))return w=Vl(w,y.mode,x,null),w.return=y,w;Fy(y,w)}return null}function d(y,w,x,v){var b=w!==null?w.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return b!==null?null:a(y,w,""+x,v);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case _y:return x.key===b?l(y,w,x,v):null;case fc:return x.key===b?u(y,w,x,v):null;case ea:return b=x._init,d(y,w,b(x._payload),v)}if(gf(x)||Yd(x))return b!==null?null:c(y,w,x,v,null);Fy(y,x)}return null}function f(y,w,x,v,b){if(typeof v=="string"&&v!==""||typeof v=="number")return y=y.get(x)||null,a(w,y,""+v,b);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case _y:return y=y.get(v.key===null?x:v.key)||null,l(w,y,v,b);case fc:return y=y.get(v.key===null?x:v.key)||null,u(w,y,v,b);case ea:var S=v._init;return f(y,w,x,S(v._payload),b)}if(gf(v)||Yd(v))return y=y.get(x)||null,c(w,y,v,b,null);Fy(w,v)}return null}function p(y,w,x,v){for(var b=null,S=null,T=w,_=w=0,E=null;T!==null&&_<x.length;_++){T.index>_?(E=T,T=null):E=T.sibling;var N=d(y,T,x[_],v);if(N===null){T===null&&(T=E);break}t&&T&&N.alternate===null&&e(y,T),w=i(N,w,_),S===null?b=N:S.sibling=N,S=N,T=E}if(_===x.length)return n(y,T),Nt&&ml(y,_),b;if(T===null){for(;_<x.length;_++)T=h(y,x[_],v),T!==null&&(w=i(T,w,_),S===null?b=T:S.sibling=T,S=T);return Nt&&ml(y,_),b}for(T=s(y,T);_<x.length;_++)E=f(T,y,_,x[_],v),E!==null&&(t&&E.alternate!==null&&T.delete(E.key===null?_:E.key),w=i(E,w,_),S===null?b=E:S.sibling=E,S=E);return t&&T.forEach(function($){return e(y,$)}),Nt&&ml(y,_),b}function m(y,w,x,v){var b=Yd(x);if(typeof b!="function")throw Error(ne(150));if(x=b.call(x),x==null)throw Error(ne(151));for(var S=b=null,T=w,_=w=0,E=null,N=x.next();T!==null&&!N.done;_++,N=x.next()){T.index>_?(E=T,T=null):E=T.sibling;var $=d(y,T,N.value,v);if($===null){T===null&&(T=E);break}t&&T&&$.alternate===null&&e(y,T),w=i($,w,_),S===null?b=$:S.sibling=$,S=$,T=E}if(N.done)return n(y,T),Nt&&ml(y,_),b;if(T===null){for(;!N.done;_++,N=x.next())N=h(y,N.value,v),N!==null&&(w=i(N,w,_),S===null?b=N:S.sibling=N,S=N);return Nt&&ml(y,_),b}for(T=s(y,T);!N.done;_++,N=x.next())N=f(T,y,_,N.value,v),N!==null&&(t&&N.alternate!==null&&T.delete(N.key===null?_:N.key),w=i(N,w,_),S===null?b=N:S.sibling=N,S=N);return t&&T.forEach(function(A){return e(y,A)}),Nt&&ml(y,_),b}function g(y,w,x,v){if(typeof x=="object"&&x!==null&&x.type===pc&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case _y:e:{for(var b=x.key,S=w;S!==null;){if(S.key===b){if(b=x.type,b===pc){if(S.tag===7){n(y,S.sibling),w=r(S,x.props.children),w.return=y,y=w;break e}}else if(S.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===ea&&bR(b)===S.type){n(y,S.sibling),w=r(S,x.props),w.ref=nf(y,S,x),w.return=y,y=w;break e}n(y,S);break}else e(y,S);S=S.sibling}x.type===pc?(w=Vl(x.props.children,y.mode,v,x.key),w.return=y,y=w):(v=S0(x.type,x.key,x.props,null,y.mode,v),v.ref=nf(y,w,x),v.return=y,y=v)}return o(y);case fc:e:{for(S=x.key;w!==null;){if(w.key===S)if(w.tag===4&&w.stateNode.containerInfo===x.containerInfo&&w.stateNode.implementation===x.implementation){n(y,w.sibling),w=r(w,x.children||[]),w.return=y,y=w;break e}else{n(y,w);break}else e(y,w);w=w.sibling}w=gI(x,y.mode,v),w.return=y,y=w}return o(y);case ea:return S=x._init,g(y,w,S(x._payload),v)}if(gf(x))return p(y,w,x,v);if(Yd(x))return m(y,w,x,v);Fy(y,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,w!==null&&w.tag===6?(n(y,w.sibling),w=r(w,x),w.return=y,y=w):(n(y,w),w=mI(x,y.mode,v),w.return=y,y=w),o(y)):n(y,w)}return g}var Hc=GL(!0),HL=GL(!1),dm={},Pi=Ka(dm),hp=Ka(dm),dp=Ka(dm);function kl(t){if(t===dm)throw Error(ne(174));return t}function oC(t,e){switch(gt(dp,e),gt(hp,t),gt(Pi,dm),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:mT(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=mT(e,t)}St(Pi),gt(Pi,e)}function qc(){St(Pi),St(hp),St(dp)}function qL(t){kl(dp.current);var e=kl(Pi.current),n=mT(e,t.type);e!==n&&(gt(hp,t),gt(Pi,n))}function aC(t){hp.current===t&&(St(Pi),St(hp))}var Pt=Ka(0);function iw(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var uI=[];function lC(){for(var t=0;t<uI.length;t++)uI[t]._workInProgressVersionPrimary=null;uI.length=0}var v0=Po.ReactCurrentDispatcher,cI=Po.ReactCurrentBatchConfig,Yl=0,Lt=null,fn=null,_n=null,ow=!1,Bf=!1,fp=0,lK=0;function Zn(){throw Error(ne(321))}function uC(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ui(t[n],e[n]))return!1;return!0}function cC(t,e,n,s,r,i){if(Yl=i,Lt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,v0.current=t===null||t.memoizedState===null?dK:fK,t=n(s,r),Bf){i=0;do{if(Bf=!1,fp=0,25<=i)throw Error(ne(301));i+=1,_n=fn=null,e.updateQueue=null,v0.current=pK,t=n(s,r)}while(Bf)}if(v0.current=aw,e=fn!==null&&fn.next!==null,Yl=0,_n=fn=Lt=null,ow=!1,e)throw Error(ne(300));return t}function hC(){var t=fp!==0;return fp=0,t}function Si(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _n===null?Lt.memoizedState=_n=t:_n=_n.next=t,_n}function Mr(){if(fn===null){var t=Lt.alternate;t=t!==null?t.memoizedState:null}else t=fn.next;var e=_n===null?Lt.memoizedState:_n.next;if(e!==null)_n=e,fn=t;else{if(t===null)throw Error(ne(310));fn=t,t={memoizedState:fn.memoizedState,baseState:fn.baseState,baseQueue:fn.baseQueue,queue:fn.queue,next:null},_n===null?Lt.memoizedState=_n=t:_n=_n.next=t}return _n}function pp(t,e){return typeof e=="function"?e(t):e}function hI(t){var e=Mr(),n=e.queue;if(n===null)throw Error(ne(311));n.lastRenderedReducer=t;var s=fn,r=s.baseQueue,i=n.pending;if(i!==null){if(r!==null){var o=r.next;r.next=i.next,i.next=o}s.baseQueue=r=i,n.pending=null}if(r!==null){i=r.next,s=s.baseState;var a=o=null,l=null,u=i;do{var c=u.lane;if((Yl&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:t(s,u.action);else{var h={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=h,o=s):l=l.next=h,Lt.lanes|=c,Jl|=c}u=u.next}while(u!==null&&u!==i);l===null?o=s:l.next=a,ui(s,e.memoizedState)||(Bs=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=l,n.lastRenderedState=s}if(t=n.interleaved,t!==null){r=t;do i=r.lane,Lt.lanes|=i,Jl|=i,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function dI(t){var e=Mr(),n=e.queue;if(n===null)throw Error(ne(311));n.lastRenderedReducer=t;var s=n.dispatch,r=n.pending,i=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do i=t(i,o.action),o=o.next;while(o!==r);ui(i,e.memoizedState)||(Bs=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,s]}function KL(){}function XL(t,e){var n=Lt,s=Mr(),r=e(),i=!ui(s.memoizedState,r);if(i&&(s.memoizedState=r,Bs=!0),s=s.queue,dC(JL.bind(null,n,s,t),[t]),s.getSnapshot!==e||i||_n!==null&&_n.memoizedState.tag&1){if(n.flags|=2048,mp(9,YL.bind(null,n,s,r,e),void 0,null),An===null)throw Error(ne(349));Yl&30||QL(n,e,r)}return r}function QL(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Lt.updateQueue,e===null?(e={lastEffect:null,stores:null},Lt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function YL(t,e,n,s){e.value=n,e.getSnapshot=s,ZL(e)&&eM(t)}function JL(t,e,n){return n(function(){ZL(e)&&eM(t)})}function ZL(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ui(t,n)}catch{return!0}}function eM(t){var e=Io(t,1);e!==null&&si(e,t,1,-1)}function IR(t){var e=Si();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:pp,lastRenderedState:t},e.queue=t,t=t.dispatch=hK.bind(null,Lt,t),[e.memoizedState,t]}function mp(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=Lt.updateQueue,e===null?(e={lastEffect:null,stores:null},Lt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function tM(){return Mr().memoizedState}function x0(t,e,n,s){var r=Si();Lt.flags|=t,r.memoizedState=mp(1|e,n,void 0,s===void 0?null:s)}function bv(t,e,n,s){var r=Mr();s=s===void 0?null:s;var i=void 0;if(fn!==null){var o=fn.memoizedState;if(i=o.destroy,s!==null&&uC(s,o.deps)){r.memoizedState=mp(e,n,i,s);return}}Lt.flags|=t,r.memoizedState=mp(1|e,n,i,s)}function TR(t,e){return x0(8390656,8,t,e)}function dC(t,e){return bv(2048,8,t,e)}function nM(t,e){return bv(4,2,t,e)}function sM(t,e){return bv(4,4,t,e)}function rM(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function iM(t,e,n){return n=n!=null?n.concat([t]):null,bv(4,4,rM.bind(null,e,t),n)}function fC(){}function oM(t,e){var n=Mr();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&uC(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function aM(t,e){var n=Mr();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&uC(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function lM(t,e,n){return Yl&21?(ui(n,e)||(n=hL(),Lt.lanes|=n,Jl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Bs=!0),t.memoizedState=n)}function uK(t,e){var n=at;at=n!==0&&4>n?n:4,t(!0);var s=cI.transition;cI.transition={};try{t(!1),e()}finally{at=n,cI.transition=s}}function uM(){return Mr().memoizedState}function cK(t,e,n){var s=Ta(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},cM(t))hM(e,n);else if(n=BL(t,e,n,s),n!==null){var r=Ts();si(n,t,s,r),dM(n,e,s)}}function hK(t,e,n){var s=Ta(t),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(cM(t))hM(e,r);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(r.hasEagerState=!0,r.eagerState=a,ui(a,o)){var l=e.interleaved;l===null?(r.next=r,rC(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=BL(t,e,r,s),n!==null&&(r=Ts(),si(n,t,s,r),dM(n,e,s))}}function cM(t){var e=t.alternate;return t===Lt||e!==null&&e===Lt}function hM(t,e){Bf=ow=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function dM(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,j_(t,n)}}var aw={readContext:Lr,useCallback:Zn,useContext:Zn,useEffect:Zn,useImperativeHandle:Zn,useInsertionEffect:Zn,useLayoutEffect:Zn,useMemo:Zn,useReducer:Zn,useRef:Zn,useState:Zn,useDebugValue:Zn,useDeferredValue:Zn,useTransition:Zn,useMutableSource:Zn,useSyncExternalStore:Zn,useId:Zn,unstable_isNewReconciler:!1},dK={readContext:Lr,useCallback:function(t,e){return Si().memoizedState=[t,e===void 0?null:e],t},useContext:Lr,useEffect:TR,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,x0(4194308,4,rM.bind(null,e,t),n)},useLayoutEffect:function(t,e){return x0(4194308,4,t,e)},useInsertionEffect:function(t,e){return x0(4,2,t,e)},useMemo:function(t,e){var n=Si();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=Si();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=cK.bind(null,Lt,t),[s.memoizedState,t]},useRef:function(t){var e=Si();return t={current:t},e.memoizedState=t},useState:IR,useDebugValue:fC,useDeferredValue:function(t){return Si().memoizedState=t},useTransition:function(){var t=IR(!1),e=t[0];return t=uK.bind(null,t[1]),Si().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=Lt,r=Si();if(Nt){if(n===void 0)throw Error(ne(407));n=n()}else{if(n=e(),An===null)throw Error(ne(349));Yl&30||QL(s,e,n)}r.memoizedState=n;var i={value:n,getSnapshot:e};return r.queue=i,TR(JL.bind(null,s,i,t),[t]),s.flags|=2048,mp(9,YL.bind(null,s,i,n,e),void 0,null),n},useId:function(){var t=Si(),e=An.identifierPrefix;if(Nt){var n=fo,s=ho;n=(s&~(1<<32-ni(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=fp++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=lK++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},fK={readContext:Lr,useCallback:oM,useContext:Lr,useEffect:dC,useImperativeHandle:iM,useInsertionEffect:nM,useLayoutEffect:sM,useMemo:aM,useReducer:hI,useRef:tM,useState:function(){return hI(pp)},useDebugValue:fC,useDeferredValue:function(t){var e=Mr();return lM(e,fn.memoizedState,t)},useTransition:function(){var t=hI(pp)[0],e=Mr().memoizedState;return[t,e]},useMutableSource:KL,useSyncExternalStore:XL,useId:uM,unstable_isNewReconciler:!1},pK={readContext:Lr,useCallback:oM,useContext:Lr,useEffect:dC,useImperativeHandle:iM,useInsertionEffect:nM,useLayoutEffect:sM,useMemo:aM,useReducer:dI,useRef:tM,useState:function(){return dI(pp)},useDebugValue:fC,useDeferredValue:function(t){var e=Mr();return fn===null?e.memoizedState=t:lM(e,fn.memoizedState,t)},useTransition:function(){var t=dI(pp)[0],e=Mr().memoizedState;return[t,e]},useMutableSource:KL,useSyncExternalStore:XL,useId:uM,unstable_isNewReconciler:!1};function Kc(t,e){try{var n="",s=e;do n+=Uq(s),s=s.return;while(s);var r=n}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:r,digest:null}}function fI(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function MT(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var mK=typeof WeakMap=="function"?WeakMap:Map;function fM(t,e,n){n=yo(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){uw||(uw=!0,KT=s),MT(t,e)},n}function pM(t,e,n){n=yo(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;n.payload=function(){return s(r)},n.callback=function(){MT(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){MT(t,e),typeof s!="function"&&(Ia===null?Ia=new Set([this]):Ia.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function SR(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new mK;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(n)||(r.add(n),t=NK.bind(null,t,e,n),e.then(t,t))}function _R(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function CR(t,e,n,s,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=yo(-1,1),e.tag=2,ba(n,e,1))),n.lanes|=1),t)}var gK=Po.ReactCurrentOwner,Bs=!1;function vs(t,e,n,s){e.child=t===null?HL(e,null,n,s):Hc(e,t.child,n,s)}function ER(t,e,n,s,r){n=n.render;var i=e.ref;return Dc(e,r),s=cC(t,e,n,s,i,r),n=hC(),t!==null&&!Bs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,To(t,e,r)):(Nt&&n&&J_(e),e.flags|=1,vs(t,e,s,r),e.child)}function kR(t,e,n,s,r){if(t===null){var i=n.type;return typeof i=="function"&&!bC(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,mM(t,e,i,s,r)):(t=S0(n.type,null,s,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&r)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:ap,n(o,s)&&t.ref===e.ref)return To(t,e,r)}return e.flags|=1,t=Sa(i,s),t.ref=e.ref,t.return=e,e.child=t}function mM(t,e,n,s,r){if(t!==null){var i=t.memoizedProps;if(ap(i,s)&&t.ref===e.ref)if(Bs=!1,e.pendingProps=s=i,(t.lanes&r)!==0)t.flags&131072&&(Bs=!0);else return e.lanes=t.lanes,To(t,e,r)}return VT(t,e,n,s,r)}function gM(t,e,n){var s=e.pendingProps,r=s.children,i=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},gt(Sc,rr),rr|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,gt(Sc,rr),rr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,gt(Sc,rr),rr|=s}else i!==null?(s=i.baseLanes|n,e.memoizedState=null):s=n,gt(Sc,rr),rr|=s;return vs(t,e,r,n),e.child}function yM(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function VT(t,e,n,s,r){var i=js(n)?Xl:hs.current;return i=jc(e,i),Dc(e,r),n=cC(t,e,n,s,i,r),s=hC(),t!==null&&!Bs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,To(t,e,r)):(Nt&&s&&J_(e),e.flags|=1,vs(t,e,n,r),e.child)}function NR(t,e,n,s,r){if(js(n)){var i=!0;Z0(e)}else i=!1;if(Dc(e,r),e.stateNode===null)b0(t,e),jL(e,n,s),LT(e,n,s,r),s=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Lr(u):(u=js(n)?Xl:hs.current,u=jc(e,u));var c=n.getDerivedStateFromProps,h=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||l!==u)&&xR(e,o,s,u),ta=!1;var d=e.memoizedState;o.state=d,rw(e,s,o,r),l=e.memoizedState,a!==s||d!==l||Ws.current||ta?(typeof c=="function"&&(FT(e,n,c,s),l=e.memoizedState),(a=ta||vR(e,n,a,s,d,l,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),o.props=s,o.state=l,o.context=u,s=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,UL(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:Xr(e.type,a),o.props=u,h=e.pendingProps,d=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Lr(l):(l=js(n)?Xl:hs.current,l=jc(e,l));var f=n.getDerivedStateFromProps;(c=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==l)&&xR(e,o,s,l),ta=!1,d=e.memoizedState,o.state=d,rw(e,s,o,r);var p=e.memoizedState;a!==h||d!==p||Ws.current||ta?(typeof f=="function"&&(FT(e,n,f,s),p=e.memoizedState),(u=ta||vR(e,n,u,s,d,p,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=p),o.props=s,o.state=p,o.context=l,s=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),s=!1)}return zT(t,e,n,s,i,r)}function zT(t,e,n,s,r,i){yM(t,e);var o=(e.flags&128)!==0;if(!s&&!o)return r&&pR(e,n,!1),To(t,e,i);s=e.stateNode,gK.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&o?(e.child=Hc(e,t.child,null,i),e.child=Hc(e,null,a,i)):vs(t,e,a,i),e.memoizedState=s.state,r&&pR(e,n,!0),e.child}function wM(t){var e=t.stateNode;e.pendingContext?fR(t,e.pendingContext,e.pendingContext!==e.context):e.context&&fR(t,e.context,!1),oC(t,e.containerInfo)}function $R(t,e,n,s,r){return Gc(),eC(r),e.flags|=256,vs(t,e,n,s),e.child}var BT={dehydrated:null,treeContext:null,retryLane:0};function UT(t){return{baseLanes:t,cachePool:null,transitions:null}}function vM(t,e,n){var s=e.pendingProps,r=Pt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),gt(Pt,r&1),t===null)return OT(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,t=s.fallback,i?(s=e.mode,i=e.child,o={mode:"hidden",children:o},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Sv(o,s,0,null),t=Vl(t,s,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=UT(n),e.memoizedState=BT,t):pC(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return yK(t,e,o,s,a,r,n);if(i){i=s.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:s.children};return!(o&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=Sa(r,l),s.subtreeFlags=r.subtreeFlags&14680064),a!==null?i=Sa(a,i):(i=Vl(i,o,n,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,o=t.child.memoizedState,o=o===null?UT(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=BT,s}return i=t.child,t=i.sibling,s=Sa(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function pC(t,e){return e=Sv({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ly(t,e,n,s){return s!==null&&eC(s),Hc(e,t.child,null,n),t=pC(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function yK(t,e,n,s,r,i,o){if(n)return e.flags&256?(e.flags&=-257,s=fI(Error(ne(422))),Ly(t,e,o,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=s.fallback,r=e.mode,s=Sv({mode:"visible",children:s.children},r,0,null),i=Vl(i,r,o,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&Hc(e,t.child,null,o),e.child.memoizedState=UT(o),e.memoizedState=BT,i);if(!(e.mode&1))return Ly(t,e,o,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var a=s.dgst;return s=a,i=Error(ne(419)),s=fI(i,s,void 0),Ly(t,e,o,s)}if(a=(o&t.childLanes)!==0,Bs||a){if(s=An,s!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|o)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,Io(t,r),si(s,t,r,-1))}return xC(),s=fI(Error(ne(421))),Ly(t,e,o,s)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=$K.bind(null,t),r._reactRetry=e,null):(t=i.treeContext,ar=xa(r.nextSibling),fr=e,Nt=!0,Jr=null,t!==null&&(Er[kr++]=ho,Er[kr++]=fo,Er[kr++]=Ql,ho=t.id,fo=t.overflow,Ql=e),e=pC(e,s.children),e.flags|=4096,e)}function AR(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),PT(t.return,e,n)}function pI(t,e,n,s,r){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=r)}function xM(t,e,n){var s=e.pendingProps,r=s.revealOrder,i=s.tail;if(vs(t,e,s.children,n),s=Pt.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&AR(t,n,e);else if(t.tag===19)AR(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(gt(Pt,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&iw(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),pI(e,!1,r,n,i);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&iw(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}pI(e,!0,n,null,i);break;case"together":pI(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function b0(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function To(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Jl|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ne(153));if(e.child!==null){for(t=e.child,n=Sa(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Sa(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function wK(t,e,n){switch(e.tag){case 3:wM(e),Gc();break;case 5:qL(e);break;case 1:js(e.type)&&Z0(e);break;case 4:oC(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;gt(nw,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(gt(Pt,Pt.current&1),e.flags|=128,null):n&e.child.childLanes?vM(t,e,n):(gt(Pt,Pt.current&1),t=To(t,e,n),t!==null?t.sibling:null);gt(Pt,Pt.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return xM(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),gt(Pt,Pt.current),s)break;return null;case 22:case 23:return e.lanes=0,gM(t,e,n)}return To(t,e,n)}var bM,WT,IM,TM;bM=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};WT=function(){};IM=function(t,e,n,s){var r=t.memoizedProps;if(r!==s){t=e.stateNode,kl(Pi.current);var i=null;switch(n){case"input":r=hT(t,r),s=hT(t,s),i=[];break;case"select":r=Mt({},r,{value:void 0}),s=Mt({},s,{value:void 0}),i=[];break;case"textarea":r=pT(t,r),s=pT(t,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=Y0)}gT(n,s);var o;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var a=r[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(ep.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in s){var l=s[u];if(a=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(ep.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&bt("scroll",t),i||a===l||(i=[])):(i=i||[]).push(u,l))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};TM=function(t,e,n,s){n!==s&&(e.flags|=4)};function sf(t,e){if(!Nt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function es(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function vK(t,e,n){var s=e.pendingProps;switch(Z_(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return es(e),null;case 1:return js(e.type)&&J0(),es(e),null;case 3:return s=e.stateNode,qc(),St(Ws),St(hs),lC(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(Py(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Jr!==null&&(YT(Jr),Jr=null))),WT(t,e),es(e),null;case 5:aC(e);var r=kl(dp.current);if(n=e.type,t!==null&&e.stateNode!=null)IM(t,e,n,s,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(ne(166));return es(e),null}if(t=kl(Pi.current),Py(e)){s=e.stateNode,n=e.type;var i=e.memoizedProps;switch(s[ki]=e,s[cp]=i,t=(e.mode&1)!==0,n){case"dialog":bt("cancel",s),bt("close",s);break;case"iframe":case"object":case"embed":bt("load",s);break;case"video":case"audio":for(r=0;r<wf.length;r++)bt(wf[r],s);break;case"source":bt("error",s);break;case"img":case"image":case"link":bt("error",s),bt("load",s);break;case"details":bt("toggle",s);break;case"input":zA(s,i),bt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},bt("invalid",s);break;case"textarea":UA(s,i),bt("invalid",s)}gT(n,i),r=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?s.textContent!==a&&(i.suppressHydrationWarning!==!0&&Oy(s.textContent,a,t),r=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Oy(s.textContent,a,t),r=["children",""+a]):ep.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&bt("scroll",s)}switch(n){case"input":Cy(s),BA(s,i,!0);break;case"textarea":Cy(s),WA(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=Y0)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=QF(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=o.createElement(n,{is:s.is}):(t=o.createElement(n),n==="select"&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,n),t[ki]=e,t[cp]=s,bM(t,e,!1,!1),e.stateNode=t;e:{switch(o=yT(n,s),n){case"dialog":bt("cancel",t),bt("close",t),r=s;break;case"iframe":case"object":case"embed":bt("load",t),r=s;break;case"video":case"audio":for(r=0;r<wf.length;r++)bt(wf[r],t);r=s;break;case"source":bt("error",t),r=s;break;case"img":case"image":case"link":bt("error",t),bt("load",t),r=s;break;case"details":bt("toggle",t),r=s;break;case"input":zA(t,s),r=hT(t,s),bt("invalid",t);break;case"option":r=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},r=Mt({},s,{value:void 0}),bt("invalid",t);break;case"textarea":UA(t,s),r=pT(t,s),bt("invalid",t);break;default:r=s}gT(n,r),a=r;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?ZF(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&YF(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&tp(t,l):typeof l=="number"&&tp(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(ep.hasOwnProperty(i)?l!=null&&i==="onScroll"&&bt("scroll",t):l!=null&&M_(t,i,l,o))}switch(n){case"input":Cy(t),BA(t,s,!1);break;case"textarea":Cy(t),WA(t);break;case"option":s.value!=null&&t.setAttribute("value",""+Ra(s.value));break;case"select":t.multiple=!!s.multiple,i=s.value,i!=null?Nc(t,!!s.multiple,i,!1):s.defaultValue!=null&&Nc(t,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Y0)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return es(e),null;case 6:if(t&&e.stateNode!=null)TM(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(ne(166));if(n=kl(dp.current),kl(Pi.current),Py(e)){if(s=e.stateNode,n=e.memoizedProps,s[ki]=e,(i=s.nodeValue!==n)&&(t=fr,t!==null))switch(t.tag){case 3:Oy(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Oy(s.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[ki]=e,e.stateNode=s}return es(e),null;case 13:if(St(Pt),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Nt&&ar!==null&&e.mode&1&&!(e.flags&128))zL(),Gc(),e.flags|=98560,i=!1;else if(i=Py(e),s!==null&&s.dehydrated!==null){if(t===null){if(!i)throw Error(ne(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ne(317));i[ki]=e}else Gc(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;es(e),i=!1}else Jr!==null&&(YT(Jr),Jr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||Pt.current&1?mn===0&&(mn=3):xC())),e.updateQueue!==null&&(e.flags|=4),es(e),null);case 4:return qc(),WT(t,e),t===null&&lp(e.stateNode.containerInfo),es(e),null;case 10:return sC(e.type._context),es(e),null;case 17:return js(e.type)&&J0(),es(e),null;case 19:if(St(Pt),i=e.memoizedState,i===null)return es(e),null;if(s=(e.flags&128)!==0,o=i.rendering,o===null)if(s)sf(i,!1);else{if(mn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=iw(t),o!==null){for(e.flags|=128,sf(i,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)i=n,t=s,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return gt(Pt,Pt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Xt()>Xc&&(e.flags|=128,s=!0,sf(i,!1),e.lanes=4194304)}else{if(!s)if(t=iw(o),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),sf(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Nt)return es(e),null}else 2*Xt()-i.renderingStartTime>Xc&&n!==1073741824&&(e.flags|=128,s=!0,sf(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Xt(),e.sibling=null,n=Pt.current,gt(Pt,s?n&1|2:n&1),e):(es(e),null);case 22:case 23:return vC(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?rr&1073741824&&(es(e),e.subtreeFlags&6&&(e.flags|=8192)):es(e),null;case 24:return null;case 25:return null}throw Error(ne(156,e.tag))}function xK(t,e){switch(Z_(e),e.tag){case 1:return js(e.type)&&J0(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return qc(),St(Ws),St(hs),lC(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return aC(e),null;case 13:if(St(Pt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ne(340));Gc()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return St(Pt),null;case 4:return qc(),null;case 10:return sC(e.type._context),null;case 22:case 23:return vC(),null;case 24:return null;default:return null}}var My=!1,rs=!1,bK=typeof WeakSet=="function"?WeakSet:Set,ye=null;function Tc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){zt(t,e,s)}else n.current=null}function jT(t,e,n){try{n()}catch(s){zt(t,e,s)}}var RR=!1;function IK(t,e){if(ET=K0,t=EL(),Y_(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,c=0,h=t,d=null;t:for(;;){for(var f;h!==n||r!==0&&h.nodeType!==3||(a=o+r),h!==i||s!==0&&h.nodeType!==3||(l=o+s),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===t)break t;if(d===n&&++u===r&&(a=o),d===i&&++c===s&&(l=o),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(kT={focusedElem:t,selectionRange:n},K0=!1,ye=e;ye!==null;)if(e=ye,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ye=t;else for(;ye!==null;){e=ye;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,g=p.memoizedState,y=e.stateNode,w=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:Xr(e.type,m),g);y.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ne(163))}}catch(v){zt(e,e.return,v)}if(t=e.sibling,t!==null){t.return=e.return,ye=t;break}ye=e.return}return p=RR,RR=!1,p}function Uf(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var i=r.destroy;r.destroy=void 0,i!==void 0&&jT(e,n,i)}r=r.next}while(r!==s)}}function Iv(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function GT(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function SM(t){var e=t.alternate;e!==null&&(t.alternate=null,SM(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ki],delete e[cp],delete e[AT],delete e[rK],delete e[iK])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function _M(t){return t.tag===5||t.tag===3||t.tag===4}function DR(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||_M(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function HT(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Y0));else if(s!==4&&(t=t.child,t!==null))for(HT(t,e,n),t=t.sibling;t!==null;)HT(t,e,n),t=t.sibling}function qT(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(qT(t,e,n),t=t.sibling;t!==null;)qT(t,e,n),t=t.sibling}var jn=null,Yr=!1;function Xo(t,e,n){for(n=n.child;n!==null;)CM(t,e,n),n=n.sibling}function CM(t,e,n){if(Oi&&typeof Oi.onCommitFiberUnmount=="function")try{Oi.onCommitFiberUnmount(pv,n)}catch{}switch(n.tag){case 5:rs||Tc(n,e);case 6:var s=jn,r=Yr;jn=null,Xo(t,e,n),jn=s,Yr=r,jn!==null&&(Yr?(t=jn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):jn.removeChild(n.stateNode));break;case 18:jn!==null&&(Yr?(t=jn,n=n.stateNode,t.nodeType===8?aI(t.parentNode,n):t.nodeType===1&&aI(t,n),ip(t)):aI(jn,n.stateNode));break;case 4:s=jn,r=Yr,jn=n.stateNode.containerInfo,Yr=!0,Xo(t,e,n),jn=s,Yr=r;break;case 0:case 11:case 14:case 15:if(!rs&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&jT(n,e,o),r=r.next}while(r!==s)}Xo(t,e,n);break;case 1:if(!rs&&(Tc(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){zt(n,e,a)}Xo(t,e,n);break;case 21:Xo(t,e,n);break;case 22:n.mode&1?(rs=(s=rs)||n.memoizedState!==null,Xo(t,e,n),rs=s):Xo(t,e,n);break;default:Xo(t,e,n)}}function OR(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new bK),e.forEach(function(s){var r=AK.bind(null,t,s);n.has(s)||(n.add(s),s.then(r,r))})}}function Hr(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:jn=a.stateNode,Yr=!1;break e;case 3:jn=a.stateNode.containerInfo,Yr=!0;break e;case 4:jn=a.stateNode.containerInfo,Yr=!0;break e}a=a.return}if(jn===null)throw Error(ne(160));CM(i,o,r),jn=null,Yr=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){zt(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)EM(e,t),e=e.sibling}function EM(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Hr(e,t),Ti(t),s&4){try{Uf(3,t,t.return),Iv(3,t)}catch(m){zt(t,t.return,m)}try{Uf(5,t,t.return)}catch(m){zt(t,t.return,m)}}break;case 1:Hr(e,t),Ti(t),s&512&&n!==null&&Tc(n,n.return);break;case 5:if(Hr(e,t),Ti(t),s&512&&n!==null&&Tc(n,n.return),t.flags&32){var r=t.stateNode;try{tp(r,"")}catch(m){zt(t,t.return,m)}}if(s&4&&(r=t.stateNode,r!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&KF(r,i),yT(a,o);var u=yT(a,i);for(o=0;o<l.length;o+=2){var c=l[o],h=l[o+1];c==="style"?ZF(r,h):c==="dangerouslySetInnerHTML"?YF(r,h):c==="children"?tp(r,h):M_(r,c,h,u)}switch(a){case"input":dT(r,i);break;case"textarea":XF(r,i);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?Nc(r,!!i.multiple,f,!1):d!==!!i.multiple&&(i.defaultValue!=null?Nc(r,!!i.multiple,i.defaultValue,!0):Nc(r,!!i.multiple,i.multiple?[]:"",!1))}r[cp]=i}catch(m){zt(t,t.return,m)}}break;case 6:if(Hr(e,t),Ti(t),s&4){if(t.stateNode===null)throw Error(ne(162));r=t.stateNode,i=t.memoizedProps;try{r.nodeValue=i}catch(m){zt(t,t.return,m)}}break;case 3:if(Hr(e,t),Ti(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{ip(e.containerInfo)}catch(m){zt(t,t.return,m)}break;case 4:Hr(e,t),Ti(t);break;case 13:Hr(e,t),Ti(t),r=t.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(yC=Xt())),s&4&&OR(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(rs=(u=rs)||c,Hr(e,t),rs=u):Hr(e,t),Ti(t),s&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(ye=t,c=t.child;c!==null;){for(h=ye=c;ye!==null;){switch(d=ye,f=d.child,d.tag){case 0:case 11:case 14:case 15:Uf(4,d,d.return);break;case 1:Tc(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){s=d,n=d.return;try{e=s,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){zt(s,n,m)}}break;case 5:Tc(d,d.return);break;case 22:if(d.memoizedState!==null){FR(h);continue}}f!==null?(f.return=d,ye=f):FR(h)}c=c.sibling}e:for(c=null,h=t;;){if(h.tag===5){if(c===null){c=h;try{r=h.stateNode,u?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=JF("display",o))}catch(m){zt(t,t.return,m)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(m){zt(t,t.return,m)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Hr(e,t),Ti(t),s&4&&OR(t);break;case 21:break;default:Hr(e,t),Ti(t)}}function Ti(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(_M(n)){var s=n;break e}n=n.return}throw Error(ne(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(tp(r,""),s.flags&=-33);var i=DR(t);qT(t,i,r);break;case 3:case 4:var o=s.stateNode.containerInfo,a=DR(t);HT(t,a,o);break;default:throw Error(ne(161))}}catch(l){zt(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function TK(t,e,n){ye=t,kM(t)}function kM(t,e,n){for(var s=(t.mode&1)!==0;ye!==null;){var r=ye,i=r.child;if(r.tag===22&&s){var o=r.memoizedState!==null||My;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||rs;a=My;var u=rs;if(My=o,(rs=l)&&!u)for(ye=r;ye!==null;)o=ye,l=o.child,o.tag===22&&o.memoizedState!==null?LR(r):l!==null?(l.return=o,ye=l):LR(r);for(;i!==null;)ye=i,kM(i),i=i.sibling;ye=r,My=a,rs=u}PR(t)}else r.subtreeFlags&8772&&i!==null?(i.return=r,ye=i):PR(t)}}function PR(t){for(;ye!==null;){var e=ye;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:rs||Iv(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!rs)if(n===null)s.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Xr(e.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&wR(e,i,s);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}wR(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&ip(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ne(163))}rs||e.flags&512&&GT(e)}catch(d){zt(e,e.return,d)}}if(e===t){ye=null;break}if(n=e.sibling,n!==null){n.return=e.return,ye=n;break}ye=e.return}}function FR(t){for(;ye!==null;){var e=ye;if(e===t){ye=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ye=n;break}ye=e.return}}function LR(t){for(;ye!==null;){var e=ye;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Iv(4,e)}catch(l){zt(e,n,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(l){zt(e,r,l)}}var i=e.return;try{GT(e)}catch(l){zt(e,i,l)}break;case 5:var o=e.return;try{GT(e)}catch(l){zt(e,o,l)}}}catch(l){zt(e,e.return,l)}if(e===t){ye=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ye=a;break}ye=e.return}}var SK=Math.ceil,lw=Po.ReactCurrentDispatcher,mC=Po.ReactCurrentOwner,Fr=Po.ReactCurrentBatchConfig,et=0,An=null,sn=null,Kn=0,rr=0,Sc=Ka(0),mn=0,gp=null,Jl=0,Tv=0,gC=0,Wf=null,Ms=null,yC=0,Xc=1/0,ro=null,uw=!1,KT=null,Ia=null,Vy=!1,ca=null,cw=0,jf=0,XT=null,I0=-1,T0=0;function Ts(){return et&6?Xt():I0!==-1?I0:I0=Xt()}function Ta(t){return t.mode&1?et&2&&Kn!==0?Kn&-Kn:aK.transition!==null?(T0===0&&(T0=hL()),T0):(t=at,t!==0||(t=window.event,t=t===void 0?16:wL(t.type)),t):1}function si(t,e,n,s){if(50<jf)throw jf=0,XT=null,Error(ne(185));um(t,n,s),(!(et&2)||t!==An)&&(t===An&&(!(et&2)&&(Tv|=n),mn===4&&ra(t,Kn)),Gs(t,s),n===1&&et===0&&!(e.mode&1)&&(Xc=Xt()+500,vv&&Xa()))}function Gs(t,e){var n=t.callbackNode;a5(t,e);var s=q0(t,t===An?Kn:0);if(s===0)n!==null&&HA(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&HA(n),e===1)t.tag===0?oK(MR.bind(null,t)):LL(MR.bind(null,t)),nK(function(){!(et&6)&&Xa()}),n=null;else{switch(dL(s)){case 1:n=W_;break;case 4:n=uL;break;case 16:n=H0;break;case 536870912:n=cL;break;default:n=H0}n=FM(n,NM.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function NM(t,e){if(I0=-1,T0=0,et&6)throw Error(ne(327));var n=t.callbackNode;if(Oc()&&t.callbackNode!==n)return null;var s=q0(t,t===An?Kn:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=hw(t,s);else{e=s;var r=et;et|=2;var i=AM();(An!==t||Kn!==e)&&(ro=null,Xc=Xt()+500,Ml(t,e));do try{EK();break}catch(a){$M(t,a)}while(!0);nC(),lw.current=i,et=r,sn!==null?e=0:(An=null,Kn=0,e=mn)}if(e!==0){if(e===2&&(r=IT(t),r!==0&&(s=r,e=QT(t,r))),e===1)throw n=gp,Ml(t,0),ra(t,s),Gs(t,Xt()),n;if(e===6)ra(t,s);else{if(r=t.current.alternate,!(s&30)&&!_K(r)&&(e=hw(t,s),e===2&&(i=IT(t),i!==0&&(s=i,e=QT(t,i))),e===1))throw n=gp,Ml(t,0),ra(t,s),Gs(t,Xt()),n;switch(t.finishedWork=r,t.finishedLanes=s,e){case 0:case 1:throw Error(ne(345));case 2:gl(t,Ms,ro);break;case 3:if(ra(t,s),(s&130023424)===s&&(e=yC+500-Xt(),10<e)){if(q0(t,0)!==0)break;if(r=t.suspendedLanes,(r&s)!==s){Ts(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=$T(gl.bind(null,t,Ms,ro),e);break}gl(t,Ms,ro);break;case 4:if(ra(t,s),(s&4194240)===s)break;for(e=t.eventTimes,r=-1;0<s;){var o=31-ni(s);i=1<<o,o=e[o],o>r&&(r=o),s&=~i}if(s=r,s=Xt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*SK(s/1960))-s,10<s){t.timeoutHandle=$T(gl.bind(null,t,Ms,ro),s);break}gl(t,Ms,ro);break;case 5:gl(t,Ms,ro);break;default:throw Error(ne(329))}}}return Gs(t,Xt()),t.callbackNode===n?NM.bind(null,t):null}function QT(t,e){var n=Wf;return t.current.memoizedState.isDehydrated&&(Ml(t,e).flags|=256),t=hw(t,e),t!==2&&(e=Ms,Ms=n,e!==null&&YT(e)),t}function YT(t){Ms===null?Ms=t:Ms.push.apply(Ms,t)}function _K(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],i=r.getSnapshot;r=r.value;try{if(!ui(i(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ra(t,e){for(e&=~gC,e&=~Tv,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ni(e),s=1<<n;t[n]=-1,e&=~s}}function MR(t){if(et&6)throw Error(ne(327));Oc();var e=q0(t,0);if(!(e&1))return Gs(t,Xt()),null;var n=hw(t,e);if(t.tag!==0&&n===2){var s=IT(t);s!==0&&(e=s,n=QT(t,s))}if(n===1)throw n=gp,Ml(t,0),ra(t,e),Gs(t,Xt()),n;if(n===6)throw Error(ne(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,gl(t,Ms,ro),Gs(t,Xt()),null}function wC(t,e){var n=et;et|=1;try{return t(e)}finally{et=n,et===0&&(Xc=Xt()+500,vv&&Xa())}}function Zl(t){ca!==null&&ca.tag===0&&!(et&6)&&Oc();var e=et;et|=1;var n=Fr.transition,s=at;try{if(Fr.transition=null,at=1,t)return t()}finally{at=s,Fr.transition=n,et=e,!(et&6)&&Xa()}}function vC(){rr=Sc.current,St(Sc)}function Ml(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,tK(n)),sn!==null)for(n=sn.return;n!==null;){var s=n;switch(Z_(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&J0();break;case 3:qc(),St(Ws),St(hs),lC();break;case 5:aC(s);break;case 4:qc();break;case 13:St(Pt);break;case 19:St(Pt);break;case 10:sC(s.type._context);break;case 22:case 23:vC()}n=n.return}if(An=t,sn=t=Sa(t.current,null),Kn=rr=e,mn=0,gp=null,gC=Tv=Jl=0,Ms=Wf=null,El!==null){for(e=0;e<El.length;e++)if(n=El[e],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,i=n.pending;if(i!==null){var o=i.next;i.next=r,s.next=o}n.pending=s}El=null}return t}function $M(t,e){do{var n=sn;try{if(nC(),v0.current=aw,ow){for(var s=Lt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}ow=!1}if(Yl=0,_n=fn=Lt=null,Bf=!1,fp=0,mC.current=null,n===null||n.return===null){mn=1,gp=e,sn=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=Kn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=_R(o);if(f!==null){f.flags&=-257,CR(f,o,a,i,e),f.mode&1&&SR(i,u,e),e=f,l=u;var p=e.updateQueue;if(p===null){var m=new Set;m.add(l),e.updateQueue=m}else p.add(l);break e}else{if(!(e&1)){SR(i,u,e),xC();break e}l=Error(ne(426))}}else if(Nt&&a.mode&1){var g=_R(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),CR(g,o,a,i,e),eC(Kc(l,a));break e}}i=l=Kc(l,a),mn!==4&&(mn=2),Wf===null?Wf=[i]:Wf.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=fM(i,l,e);yR(i,y);break e;case 1:a=l;var w=i.type,x=i.stateNode;if(!(i.flags&128)&&(typeof w.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Ia===null||!Ia.has(x)))){i.flags|=65536,e&=-e,i.lanes|=e;var v=pM(i,a,e);yR(i,v);break e}}i=i.return}while(i!==null)}DM(n)}catch(b){e=b,sn===n&&n!==null&&(sn=n=n.return);continue}break}while(!0)}function AM(){var t=lw.current;return lw.current=aw,t===null?aw:t}function xC(){(mn===0||mn===3||mn===2)&&(mn=4),An===null||!(Jl&268435455)&&!(Tv&268435455)||ra(An,Kn)}function hw(t,e){var n=et;et|=2;var s=AM();(An!==t||Kn!==e)&&(ro=null,Ml(t,e));do try{CK();break}catch(r){$M(t,r)}while(!0);if(nC(),et=n,lw.current=s,sn!==null)throw Error(ne(261));return An=null,Kn=0,mn}function CK(){for(;sn!==null;)RM(sn)}function EK(){for(;sn!==null&&!Jq();)RM(sn)}function RM(t){var e=PM(t.alternate,t,rr);t.memoizedProps=t.pendingProps,e===null?DM(t):sn=e,mC.current=null}function DM(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=xK(n,e),n!==null){n.flags&=32767,sn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{mn=6,sn=null;return}}else if(n=vK(n,e,rr),n!==null){sn=n;return}if(e=e.sibling,e!==null){sn=e;return}sn=e=t}while(e!==null);mn===0&&(mn=5)}function gl(t,e,n){var s=at,r=Fr.transition;try{Fr.transition=null,at=1,kK(t,e,n,s)}finally{Fr.transition=r,at=s}return null}function kK(t,e,n,s){do Oc();while(ca!==null);if(et&6)throw Error(ne(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ne(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(l5(t,i),t===An&&(sn=An=null,Kn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Vy||(Vy=!0,FM(H0,function(){return Oc(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Fr.transition,Fr.transition=null;var o=at;at=1;var a=et;et|=4,mC.current=null,IK(t,n),EM(n,t),K5(kT),K0=!!ET,kT=ET=null,t.current=n,TK(n),Zq(),et=a,at=o,Fr.transition=i}else t.current=n;if(Vy&&(Vy=!1,ca=t,cw=r),i=t.pendingLanes,i===0&&(Ia=null),n5(n.stateNode),Gs(t,Xt()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(uw)throw uw=!1,t=KT,KT=null,t;return cw&1&&t.tag!==0&&Oc(),i=t.pendingLanes,i&1?t===XT?jf++:(jf=0,XT=t):jf=0,Xa(),null}function Oc(){if(ca!==null){var t=dL(cw),e=Fr.transition,n=at;try{if(Fr.transition=null,at=16>t?16:t,ca===null)var s=!1;else{if(t=ca,ca=null,cw=0,et&6)throw Error(ne(331));var r=et;for(et|=4,ye=t.current;ye!==null;){var i=ye,o=i.child;if(ye.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(ye=u;ye!==null;){var c=ye;switch(c.tag){case 0:case 11:case 15:Uf(8,c,i)}var h=c.child;if(h!==null)h.return=c,ye=h;else for(;ye!==null;){c=ye;var d=c.sibling,f=c.return;if(SM(c),c===u){ye=null;break}if(d!==null){d.return=f,ye=d;break}ye=f}}}var p=i.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(m!==null)}}ye=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ye=o;else e:for(;ye!==null;){if(i=ye,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Uf(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,ye=y;break e}ye=i.return}}var w=t.current;for(ye=w;ye!==null;){o=ye;var x=o.child;if(o.subtreeFlags&2064&&x!==null)x.return=o,ye=x;else e:for(o=w;ye!==null;){if(a=ye,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Iv(9,a)}}catch(b){zt(a,a.return,b)}if(a===o){ye=null;break e}var v=a.sibling;if(v!==null){v.return=a.return,ye=v;break e}ye=a.return}}if(et=r,Xa(),Oi&&typeof Oi.onPostCommitFiberRoot=="function")try{Oi.onPostCommitFiberRoot(pv,t)}catch{}s=!0}return s}finally{at=n,Fr.transition=e}}return!1}function VR(t,e,n){e=Kc(n,e),e=fM(t,e,1),t=ba(t,e,1),e=Ts(),t!==null&&(um(t,1,e),Gs(t,e))}function zt(t,e,n){if(t.tag===3)VR(t,t,n);else for(;e!==null;){if(e.tag===3){VR(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Ia===null||!Ia.has(s))){t=Kc(n,t),t=pM(e,t,1),e=ba(e,t,1),t=Ts(),e!==null&&(um(e,1,t),Gs(e,t));break}}e=e.return}}function NK(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=Ts(),t.pingedLanes|=t.suspendedLanes&n,An===t&&(Kn&n)===n&&(mn===4||mn===3&&(Kn&130023424)===Kn&&500>Xt()-yC?Ml(t,0):gC|=n),Gs(t,e)}function OM(t,e){e===0&&(t.mode&1?(e=Ny,Ny<<=1,!(Ny&130023424)&&(Ny=4194304)):e=1);var n=Ts();t=Io(t,e),t!==null&&(um(t,e,n),Gs(t,n))}function $K(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),OM(t,n)}function AK(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(ne(314))}s!==null&&s.delete(e),OM(t,n)}var PM;PM=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ws.current)Bs=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Bs=!1,wK(t,e,n);Bs=!!(t.flags&131072)}else Bs=!1,Nt&&e.flags&1048576&&ML(e,tw,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;b0(t,e),t=e.pendingProps;var r=jc(e,hs.current);Dc(e,n),r=cC(null,e,s,t,r,n);var i=hC();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,js(s)?(i=!0,Z0(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,iC(e),r.updater=xv,e.stateNode=r,r._reactInternals=e,LT(e,s,t,n),e=zT(null,e,s,!0,i,n)):(e.tag=0,Nt&&i&&J_(e),vs(null,e,r,n),e=e.child),e;case 16:s=e.elementType;e:{switch(b0(t,e),t=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=DK(s),t=Xr(s,t),r){case 0:e=VT(null,e,s,t,n);break e;case 1:e=NR(null,e,s,t,n);break e;case 11:e=ER(null,e,s,t,n);break e;case 14:e=kR(null,e,s,Xr(s.type,t),n);break e}throw Error(ne(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Xr(s,r),VT(t,e,s,r,n);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Xr(s,r),NR(t,e,s,r,n);case 3:e:{if(wM(e),t===null)throw Error(ne(387));s=e.pendingProps,i=e.memoizedState,r=i.element,UL(t,e),rw(e,s,null,n);var o=e.memoizedState;if(s=o.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=Kc(Error(ne(423)),e),e=$R(t,e,s,n,r);break e}else if(s!==r){r=Kc(Error(ne(424)),e),e=$R(t,e,s,n,r);break e}else for(ar=xa(e.stateNode.containerInfo.firstChild),fr=e,Nt=!0,Jr=null,n=HL(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Gc(),s===r){e=To(t,e,n);break e}vs(t,e,s,n)}e=e.child}return e;case 5:return qL(e),t===null&&OT(e),s=e.type,r=e.pendingProps,i=t!==null?t.memoizedProps:null,o=r.children,NT(s,r)?o=null:i!==null&&NT(s,i)&&(e.flags|=32),yM(t,e),vs(t,e,o,n),e.child;case 6:return t===null&&OT(e),null;case 13:return vM(t,e,n);case 4:return oC(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=Hc(e,null,s,n):vs(t,e,s,n),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Xr(s,r),ER(t,e,s,r,n);case 7:return vs(t,e,e.pendingProps,n),e.child;case 8:return vs(t,e,e.pendingProps.children,n),e.child;case 12:return vs(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,i=e.memoizedProps,o=r.value,gt(nw,s._currentValue),s._currentValue=o,i!==null)if(ui(i.value,o)){if(i.children===r.children&&!Ws.current){e=To(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(i.tag===1){l=yo(-1,n&-n),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),PT(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(ne(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),PT(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}vs(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,Dc(e,n),r=Lr(r),s=s(r),e.flags|=1,vs(t,e,s,n),e.child;case 14:return s=e.type,r=Xr(s,e.pendingProps),r=Xr(s.type,r),kR(t,e,s,r,n);case 15:return mM(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Xr(s,r),b0(t,e),e.tag=1,js(s)?(t=!0,Z0(e)):t=!1,Dc(e,n),jL(e,s,r),LT(e,s,r,n),zT(null,e,s,!0,t,n);case 19:return xM(t,e,n);case 22:return gM(t,e,n)}throw Error(ne(156,e.tag))};function FM(t,e){return lL(t,e)}function RK(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $r(t,e,n,s){return new RK(t,e,n,s)}function bC(t){return t=t.prototype,!(!t||!t.isReactComponent)}function DK(t){if(typeof t=="function")return bC(t)?1:0;if(t!=null){if(t=t.$$typeof,t===z_)return 11;if(t===B_)return 14}return 2}function Sa(t,e){var n=t.alternate;return n===null?(n=$r(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function S0(t,e,n,s,r,i){var o=2;if(s=t,typeof t=="function")bC(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case pc:return Vl(n.children,r,i,e);case V_:o=8,r|=8;break;case aT:return t=$r(12,n,e,r|2),t.elementType=aT,t.lanes=i,t;case lT:return t=$r(13,n,e,r),t.elementType=lT,t.lanes=i,t;case uT:return t=$r(19,n,e,r),t.elementType=uT,t.lanes=i,t;case GF:return Sv(n,r,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case WF:o=10;break e;case jF:o=9;break e;case z_:o=11;break e;case B_:o=14;break e;case ea:o=16,s=null;break e}throw Error(ne(130,t==null?t:typeof t,""))}return e=$r(o,n,e,r),e.elementType=t,e.type=s,e.lanes=i,e}function Vl(t,e,n,s){return t=$r(7,t,s,e),t.lanes=n,t}function Sv(t,e,n,s){return t=$r(22,t,s,e),t.elementType=GF,t.lanes=n,t.stateNode={isHidden:!1},t}function mI(t,e,n){return t=$r(6,t,null,e),t.lanes=n,t}function gI(t,e,n){return e=$r(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function OK(t,e,n,s,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Qb(0),this.expirationTimes=Qb(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qb(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function IC(t,e,n,s,r,i,o,a,l){return t=new OK(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=$r(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},iC(i),t}function PK(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fc,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function LM(t){if(!t)return Da;t=t._reactInternals;e:{if($u(t)!==t||t.tag!==1)throw Error(ne(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(js(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ne(171))}if(t.tag===1){var n=t.type;if(js(n))return FL(t,n,e)}return e}function MM(t,e,n,s,r,i,o,a,l){return t=IC(n,s,!0,t,r,i,o,a,l),t.context=LM(null),n=t.current,s=Ts(),r=Ta(n),i=yo(s,r),i.callback=e??null,ba(n,i,r),t.current.lanes=r,um(t,r,s),Gs(t,s),t}function _v(t,e,n,s){var r=e.current,i=Ts(),o=Ta(r);return n=LM(n),e.context===null?e.context=n:e.pendingContext=n,e=yo(i,o),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=ba(r,e,o),t!==null&&(si(t,r,o,i),w0(t,r,o)),o}function dw(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function zR(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function TC(t,e){zR(t,e),(t=t.alternate)&&zR(t,e)}function FK(){return null}var VM=typeof reportError=="function"?reportError:function(t){console.error(t)};function SC(t){this._internalRoot=t}Cv.prototype.render=SC.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ne(409));_v(t,e,null,null)};Cv.prototype.unmount=SC.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Zl(function(){_v(null,t,null,null)}),e[bo]=null}};function Cv(t){this._internalRoot=t}Cv.prototype.unstable_scheduleHydration=function(t){if(t){var e=mL();t={blockedOn:null,target:t,priority:e};for(var n=0;n<sa.length&&e!==0&&e<sa[n].priority;n++);sa.splice(n,0,t),n===0&&yL(t)}};function _C(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ev(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function BR(){}function LK(t,e,n,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var u=dw(o);i.call(u)}}var o=MM(e,s,t,0,null,!1,!1,"",BR);return t._reactRootContainer=o,t[bo]=o.current,lp(t.nodeType===8?t.parentNode:t),Zl(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof s=="function"){var a=s;s=function(){var u=dw(l);a.call(u)}}var l=IC(t,0,!1,null,null,!1,!1,"",BR);return t._reactRootContainer=l,t[bo]=l.current,lp(t.nodeType===8?t.parentNode:t),Zl(function(){_v(e,l,n,s)}),l}function kv(t,e,n,s,r){var i=n._reactRootContainer;if(i){var o=i;if(typeof r=="function"){var a=r;r=function(){var l=dw(o);a.call(l)}}_v(e,o,t,r)}else o=LK(n,e,t,r,s);return dw(o)}fL=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=yf(e.pendingLanes);n!==0&&(j_(e,n|1),Gs(e,Xt()),!(et&6)&&(Xc=Xt()+500,Xa()))}break;case 13:Zl(function(){var s=Io(t,1);if(s!==null){var r=Ts();si(s,t,1,r)}}),TC(t,1)}};G_=function(t){if(t.tag===13){var e=Io(t,134217728);if(e!==null){var n=Ts();si(e,t,134217728,n)}TC(t,134217728)}};pL=function(t){if(t.tag===13){var e=Ta(t),n=Io(t,e);if(n!==null){var s=Ts();si(n,t,e,s)}TC(t,e)}};mL=function(){return at};gL=function(t,e){var n=at;try{return at=t,e()}finally{at=n}};vT=function(t,e,n){switch(e){case"input":if(dT(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var r=wv(s);if(!r)throw Error(ne(90));qF(s),dT(s,r)}}}break;case"textarea":XF(t,n);break;case"select":e=n.value,e!=null&&Nc(t,!!n.multiple,e,!1)}};nL=wC;sL=Zl;var MK={usingClientEntryPoint:!1,Events:[hm,wc,wv,eL,tL,wC]},rf={findFiberByHostInstance:Cl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},VK={bundleType:rf.bundleType,version:rf.version,rendererPackageName:rf.rendererPackageName,rendererConfig:rf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Po.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=oL(t),t===null?null:t.stateNode},findFiberByHostInstance:rf.findFiberByHostInstance||FK,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zy.isDisabled&&zy.supportsFiber)try{pv=zy.inject(VK),Oi=zy}catch{}}br.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=MK;br.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_C(e))throw Error(ne(200));return PK(t,e,null,n)};br.createRoot=function(t,e){if(!_C(t))throw Error(ne(299));var n=!1,s="",r=VM;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=IC(t,1,!1,null,null,n,!1,s,r),t[bo]=e.current,lp(t.nodeType===8?t.parentNode:t),new SC(e)};br.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ne(188)):(t=Object.keys(t).join(","),Error(ne(268,t)));return t=oL(e),t=t===null?null:t.stateNode,t};br.flushSync=function(t){return Zl(t)};br.hydrate=function(t,e,n){if(!Ev(e))throw Error(ne(200));return kv(null,t,e,!0,n)};br.hydrateRoot=function(t,e,n){if(!_C(t))throw Error(ne(405));var s=n!=null&&n.hydratedSources||null,r=!1,i="",o=VM;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=MM(e,null,t,1,n??null,r,!1,i,o),t[bo]=e.current,lp(t),s)for(t=0;t<s.length;t++)n=s[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Cv(e)};br.render=function(t,e,n){if(!Ev(e))throw Error(ne(200));return kv(null,t,e,!1,n)};br.unmountComponentAtNode=function(t){if(!Ev(t))throw Error(ne(40));return t._reactRootContainer?(Zl(function(){kv(null,null,t,!1,function(){t._reactRootContainer=null,t[bo]=null})}),!0):!1};br.unstable_batchedUpdates=wC;br.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!Ev(n))throw Error(ne(200));if(t==null||t._reactInternals===void 0)throw Error(ne(38));return kv(t,e,n,!1,s)};br.version="18.2.0-next-9e3b772b8-20220608";function zM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(zM)}catch(t){console.error(t)}}zM(),MF.exports=br;var zK=MF.exports,UR=zK;iT.createRoot=UR.createRoot,iT.hydrateRoot=UR.hydrateRoot;var WR={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BM=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):(r&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++s)&1023),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},BK=function(t){const e=[];let n=0,s=0;for(;n<t.length;){const r=t[n++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=t[n++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=t[n++],o=t[n++],a=t[n++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=t[n++],o=t[n++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},UM={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<t.length;r+=3){const i=t[r],o=r+1<t.length,a=o?t[r+1]:0,l=r+2<t.length,u=l?t[r+2]:0,c=i>>2,h=(i&3)<<4|a>>4;let d=(a&15)<<2|u>>6,f=u&63;l||(f=64,o||(d=64)),s.push(n[c],n[h],n[d],n[f])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(BM(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):BK(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<t.length;){const i=n[t.charAt(r++)],a=r<t.length?n[t.charAt(r)]:0;++r;const u=r<t.length?n[t.charAt(r)]:64;++r;const h=r<t.length?n[t.charAt(r)]:64;if(++r,i==null||a==null||u==null||h==null)throw new UK;const d=i<<2|a>>4;if(s.push(d),u!==64){const f=a<<4&240|u>>2;if(s.push(f),h!==64){const p=u<<6&192|h;s.push(p)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class UK extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const WK=function(t){const e=BM(t);return UM.encodeByteArray(e,!0)},fw=function(t){return WK(t).replace(/\./g,"")},WM=function(t){try{return UM.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jK(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GK=()=>jK().__FIREBASE_DEFAULTS__,HK=()=>{if(typeof process>"u"||typeof WR>"u")return;const t=WR.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},qK=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&WM(t[1]);return e&&JSON.parse(e)},Nv=()=>{try{return GK()||HK()||qK()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},jM=t=>{var e,n;return(n=(e=Nv())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},GM=t=>{const e=jM(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),s]:[e.substring(0,n),s]},HM=()=>{var t;return(t=Nv())===null||t===void 0?void 0:t.config},qM=t=>{var e;return(e=Nv())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KK{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KM(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},s=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[fw(JSON.stringify(n)),fw(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function XK(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(hn())}function QK(){var t;const e=(t=Nv())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function XM(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function YK(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function JK(){const t=hn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function ZK(){return!QK()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function CC(){try{return typeof indexedDB=="object"}catch{return!1}}function QM(){return new Promise((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var i;e(((i=r.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}function e9(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t9="FirebaseError";class Br extends Error{constructor(e,n,s){super(n),this.code=e,this.customData=s,this.name=t9,Object.setPrototypeOf(this,Br.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Au.prototype.create)}}class Au{constructor(e,n,s){this.service=e,this.serviceName=n,this.errors=s}create(e,...n){const s=n[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?n9(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new Br(r,a,s)}}function n9(t,e){return t.replace(s9,(n,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const s9=/\{\$([^}]+)}/g;function r9(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function yp(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const r of n){if(!s.includes(r))return!1;const i=t[r],o=e[r];if(jR(i)&&jR(o)){if(!yp(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!n.includes(r))return!1;return!0}function jR(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fm(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function vf(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[r,i]=s.split("=");e[decodeURIComponent(r)]=decodeURIComponent(i)}}),e}function xf(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function i9(t,e){const n=new o9(t,e);return n.subscribe.bind(n)}class o9{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,s){let r;if(e===void 0&&n===void 0&&s===void 0)throw new Error("Missing Observer.");a9(e,["next","error","complete"])?r=e:r={next:e,error:n,complete:s},r.next===void 0&&(r.next=yI),r.error===void 0&&(r.error=yI),r.complete===void 0&&(r.complete=yI);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function a9(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function yI(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l9=1e3,u9=2,c9=4*60*60*1e3,h9=.5;function GR(t,e=l9,n=u9){const s=e*Math.pow(n,t),r=Math.round(h9*s*(Math.random()-.5)*2);return Math.min(c9,s+r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ut(t){return t&&t._delegate?t._delegate:t}class Vr{constructor(e,n,s){this.name=e,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yl="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d9{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const s=new KK;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:n});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(p9(e))try{this.getOrInitializeService({instanceIdentifier:yl})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=yl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=yl){return this.instances.has(e)}getOptions(e=yl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,n){var s;const r=this.normalizeInstanceIdentifier(n),i=(s=this.onInitCallbacks.get(r))!==null&&s!==void 0?s:new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const s=this.onInitCallbacks.get(n);if(s)for(const r of s)try{r(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:f9(e),options:n}),this.instances.set(e,s),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=yl){return this.component?this.component.multipleInstances?e:yl:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function f9(t){return t===yl?void 0:t}function p9(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m9{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new d9(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xe;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Xe||(Xe={}));const g9={debug:Xe.DEBUG,verbose:Xe.VERBOSE,info:Xe.INFO,warn:Xe.WARN,error:Xe.ERROR,silent:Xe.SILENT},y9=Xe.INFO,w9={[Xe.DEBUG]:"log",[Xe.VERBOSE]:"log",[Xe.INFO]:"info",[Xe.WARN]:"warn",[Xe.ERROR]:"error"},v9=(t,e,...n)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),r=w9[e];if(r)console[r](`[${s}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let $v=class{constructor(e){this.name=e,this._logLevel=y9,this._logHandler=v9,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Xe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?g9[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Xe.DEBUG,...e),this._logHandler(this,Xe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Xe.VERBOSE,...e),this._logHandler(this,Xe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Xe.INFO,...e),this._logHandler(this,Xe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Xe.WARN,...e),this._logHandler(this,Xe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Xe.ERROR,...e),this._logHandler(this,Xe.ERROR,...e)}};const x9=(t,e)=>e.some(n=>t instanceof n);let HR,qR;function b9(){return HR||(HR=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function I9(){return qR||(qR=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const YM=new WeakMap,JT=new WeakMap,JM=new WeakMap,wI=new WeakMap,EC=new WeakMap;function T9(t){const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(_a(t.result)),r()},o=()=>{s(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&YM.set(n,t)}).catch(()=>{}),EC.set(e,t),e}function S9(t){if(JT.has(t))return;const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),r()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});JT.set(t,e)}let ZT={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return JT.get(t);if(e==="objectStoreNames")return t.objectStoreNames||JM.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return _a(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function _9(t){ZT=t(ZT)}function C9(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const s=t.call(vI(this),e,...n);return JM.set(s,e.sort?e.sort():[e]),_a(s)}:I9().includes(t)?function(...e){return t.apply(vI(this),e),_a(YM.get(this))}:function(...e){return _a(t.apply(vI(this),e))}}function E9(t){return typeof t=="function"?C9(t):(t instanceof IDBTransaction&&S9(t),x9(t,b9())?new Proxy(t,ZT):t)}function _a(t){if(t instanceof IDBRequest)return T9(t);if(wI.has(t))return wI.get(t);const e=E9(t);return e!==t&&(wI.set(t,e),EC.set(e,t)),e}const vI=t=>EC.get(t);function ZM(t,e,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(t,e),a=_a(o);return s&&o.addEventListener("upgradeneeded",l=>{s(_a(o.result),l.oldVersion,l.newVersion,_a(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const k9=["get","getKey","getAll","getAllKeys","count"],N9=["put","add","delete","clear"],xI=new Map;function KR(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(xI.get(e))return xI.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=N9.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||k9.includes(n)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let u=l.store;return s&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),r&&l.done]))[0]};return xI.set(e,i),i}_9(t=>({...t,get:(e,n,s)=>KR(e,n)||t.get(e,n,s),has:(e,n)=>!!KR(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $9{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(A9(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function A9(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const eS="@firebase/app",XR="0.9.28";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eu=new $v("@firebase/app"),R9="@firebase/app-compat",D9="@firebase/analytics-compat",O9="@firebase/analytics",P9="@firebase/app-check-compat",F9="@firebase/app-check",L9="@firebase/auth",M9="@firebase/auth-compat",V9="@firebase/database",z9="@firebase/database-compat",B9="@firebase/functions",U9="@firebase/functions-compat",W9="@firebase/installations",j9="@firebase/installations-compat",G9="@firebase/messaging",H9="@firebase/messaging-compat",q9="@firebase/performance",K9="@firebase/performance-compat",X9="@firebase/remote-config",Q9="@firebase/remote-config-compat",Y9="@firebase/storage",J9="@firebase/storage-compat",Z9="@firebase/firestore",e8="@firebase/firestore-compat",t8="firebase",n8="10.8.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tS="[DEFAULT]",s8={[eS]:"fire-core",[R9]:"fire-core-compat",[O9]:"fire-analytics",[D9]:"fire-analytics-compat",[F9]:"fire-app-check",[P9]:"fire-app-check-compat",[L9]:"fire-auth",[M9]:"fire-auth-compat",[V9]:"fire-rtdb",[z9]:"fire-rtdb-compat",[B9]:"fire-fn",[U9]:"fire-fn-compat",[W9]:"fire-iid",[j9]:"fire-iid-compat",[G9]:"fire-fcm",[H9]:"fire-fcm-compat",[q9]:"fire-perf",[K9]:"fire-perf-compat",[X9]:"fire-rc",[Q9]:"fire-rc-compat",[Y9]:"fire-gcs",[J9]:"fire-gcs-compat",[Z9]:"fire-fst",[e8]:"fire-fst-compat","fire-js":"fire-js",[t8]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pw=new Map,nS=new Map;function r8(t,e){try{t.container.addComponent(e)}catch(n){eu.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ci(t){const e=t.name;if(nS.has(e))return eu.debug(`There were multiple attempts to register component ${e}.`),!1;nS.set(e,t);for(const n of pw.values())r8(n,t);return!0}function Qa(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i8={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Ca=new Au("app","Firebase",i8);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o8{constructor(e,n,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Vr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ca.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ru=n8;function eV(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:tS,automaticDataCollectionEnabled:!1},e),r=s.name;if(typeof r!="string"||!r)throw Ca.create("bad-app-name",{appName:String(r)});if(n||(n=HM()),!n)throw Ca.create("no-options");const i=pw.get(r);if(i){if(yp(n,i.options)&&yp(s,i.config))return i;throw Ca.create("duplicate-app",{appName:r})}const o=new m9(r);for(const l of nS.values())o.addComponent(l);const a=new o8(n,s,o);return pw.set(r,a),a}function Av(t=tS){const e=pw.get(t);if(!e&&t===tS&&HM())return eV();if(!e)throw Ca.create("no-app",{appName:t});return e}function Hs(t,e,n){var s;let r=(s=s8[t])!==null&&s!==void 0?s:t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),eu.warn(a.join(" "));return}ci(new Vr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a8="firebase-heartbeat-database",l8=1,wp="firebase-heartbeat-store";let bI=null;function tV(){return bI||(bI=ZM(a8,l8,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(wp)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ca.create("idb-open",{originalErrorMessage:t.message})})),bI}async function u8(t){try{const n=(await tV()).transaction(wp),s=await n.objectStore(wp).get(nV(t));return await n.done,s}catch(e){if(e instanceof Br)eu.warn(e.message);else{const n=Ca.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});eu.warn(n.message)}}}async function QR(t,e){try{const s=(await tV()).transaction(wp,"readwrite");await s.objectStore(wp).put(e,nV(t)),await s.done}catch(n){if(n instanceof Br)eu.warn(n.message);else{const s=Ca.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});eu.warn(s.message)}}}function nV(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c8=1024,h8=30*24*60*60*1e3;class d8{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new p8(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,n;const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=YR();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=h8}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=YR(),{heartbeatsToSend:s,unsentEntries:r}=f8(this._heartbeatsCache.heartbeats),i=fw(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=n,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function YR(){return new Date().toISOString().substring(0,10)}function f8(t,e=c8){const n=[];let s=t.slice();for(const r of t){const i=n.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),JR(n)>e){i.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),JR(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class p8{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return CC()?QM().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await u8(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return QR(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return QR(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function JR(t){return fw(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m8(t){ci(new Vr("platform-logger",e=>new $9(e),"PRIVATE")),ci(new Vr("heartbeat",e=>new d8(e),"PRIVATE")),Hs(eS,XR,t),Hs(eS,XR,"esm2017"),Hs("fire-js","")}m8("");function kC(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n}function sV(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const g8=sV,rV=new Au("auth","Firebase",sV());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mw=new $v("@firebase/auth");function y8(t,...e){mw.logLevel<=Xe.WARN&&mw.warn(`Auth (${Ru}): ${t}`,...e)}function _0(t,...e){mw.logLevel<=Xe.ERROR&&mw.error(`Auth (${Ru}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hi(t,...e){throw NC(t,...e)}function Fi(t,...e){return NC(t,...e)}function w8(t,e,n){const s=Object.assign(Object.assign({},g8()),{[e]:n});return new Au("auth","Firebase",s).create(e,{appName:t.name})}function NC(t,...e){if(typeof t!="string"){const n=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(n,...s)}return rV.create(t,...e)}function ke(t,e,...n){if(!t)throw NC(e,...n)}function po(t){const e="INTERNAL ASSERTION FAILED: "+t;throw _0(e),new Error(e)}function So(t,e){t||po(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sS(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function v8(){return ZR()==="http:"||ZR()==="https:"}function ZR(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x8(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(v8()||XM()||"connection"in navigator)?navigator.onLine:!0}function b8(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm{constructor(e,n){this.shortDelay=e,this.longDelay=n,So(n>e,"Short delay should be less than long delay!"),this.isMobile=XK()||YK()}get(){return x8()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $C(t,e){So(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iV{static initialize(e,n,s){this.fetchImpl=e,n&&(this.headersImpl=n),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;po("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;po("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;po("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I8={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T8=new pm(3e4,6e4);function Du(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Ya(t,e,n,s,r={}){return oV(t,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=fm(Object.assign({key:t.config.apiKey},o)).slice(1),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode),iV.fetch()(aV(t,t.config.apiHost,n,a),Object.assign({method:e,headers:l,referrerPolicy:"no-referrer"},i))})}async function oV(t,e,n){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},I8),e);try{const r=new _8(t),i=await Promise.race([n(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw By(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw By(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw By(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw By(t,"user-disabled",o);const c=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw w8(t,c,u);hi(t,c)}}catch(r){if(r instanceof Br)throw r;hi(t,"network-request-failed",{message:String(r)})}}async function Rv(t,e,n,s,r={}){const i=await Ya(t,e,n,s,r);return"mfaPendingCredential"in i&&hi(t,"multi-factor-auth-required",{_serverResponse:i}),i}function aV(t,e,n,s){const r=`${e}${n}?${s}`;return t.config.emulator?$C(t.config,r):`${t.config.apiScheme}://${r}`}function S8(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class _8{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,s)=>{this.timer=setTimeout(()=>s(Fi(this.auth,"network-request-failed")),T8.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function By(t,e,n){const s={appName:t.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const r=Fi(t,e,s);return r.customData._tokenResponse=n,r}function eD(t){return t!==void 0&&t.enterprise!==void 0}class C8{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return S8(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function E8(t,e){return Ya(t,"GET","/v2/recaptchaConfig",Du(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k8(t,e){return Ya(t,"POST","/v1/accounts:delete",e)}async function N8(t,e){return Ya(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gf(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function $8(t,e=!1){const n=Ut(t),s=await n.getIdToken(e),r=AC(s);ke(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:r,token:s,authTime:Gf(II(r.auth_time)),issuedAtTime:Gf(II(r.iat)),expirationTime:Gf(II(r.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function II(t){return Number(t)*1e3}function AC(t){const[e,n,s]=t.split(".");if(e===void 0||n===void 0||s===void 0)return _0("JWT malformed, contained fewer than 3 sections"),null;try{const r=WM(n);return r?JSON.parse(r):(_0("Failed to decode base64 JWT payload"),null)}catch(r){return _0("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function A8(t){const e=AC(t);return ke(e,"internal-error"),ke(typeof e.exp<"u","internal-error"),ke(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vp(t,e,n=!1){if(n)return e;try{return await e}catch(s){throw s instanceof Br&&R8(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function R8({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D8{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const r=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lV{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Gf(this.lastLoginAt),this.creationTime=Gf(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gw(t){var e;const n=t.auth,s=await t.getIdToken(),r=await vp(t,N8(n,{idToken:s}));ke(r==null?void 0:r.users.length,n,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?F8(i.providerUserInfo):[],a=P8(t.providerData,o),l=t.isAnonymous,u=!(t.email&&i.passwordHash)&&!(a!=null&&a.length),c=l?u:!1,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new lV(i.createdAt,i.lastLoginAt),isAnonymous:c};Object.assign(t,h)}async function O8(t){const e=Ut(t);await gw(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function P8(t,e){return[...t.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function F8(t){return t.map(e=>{var{providerId:n}=e,s=kC(e,["providerId"]);return{providerId:n,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L8(t,e){const n=await oV(t,{},async()=>{const s=fm({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=t.config,o=aV(t,r,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",iV.fetch()(o,{method:"POST",headers:a,body:s})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function M8(t,e){return Ya(t,"POST","/v2/accounts:revokeToken",Du(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xp{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ke(e.idToken,"internal-error"),ke(typeof e.idToken<"u","internal-error"),ke(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):A8(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,n=!1){return ke(!this.accessToken||this.refreshToken,e,"user-token-expired"),!n&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:s,refreshToken:r,expiresIn:i}=await L8(e,n);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,n,s){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,n){const{refreshToken:s,accessToken:r,expirationTime:i}=n,o=new xp;return s&&(ke(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(ke(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(ke(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xp,this.toJSON())}_performRefresh(){return po("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qo(t,e){ke(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class zl{constructor(e){var{uid:n,auth:s,stsTokenManager:r}=e,i=kC(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new D8(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=s,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new lV(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await vp(this,this.stsTokenManager.getToken(this.auth,e));return ke(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return $8(this,e)}reload(){return O8(this)}_assign(e){this!==e&&(ke(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new zl(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){ke(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),n&&await gw(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await vp(this,k8(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var s,r,i,o,a,l,u,c;const h=(s=n.displayName)!==null&&s!==void 0?s:void 0,d=(r=n.email)!==null&&r!==void 0?r:void 0,f=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,p=(o=n.photoURL)!==null&&o!==void 0?o:void 0,m=(a=n.tenantId)!==null&&a!==void 0?a:void 0,g=(l=n._redirectEventId)!==null&&l!==void 0?l:void 0,y=(u=n.createdAt)!==null&&u!==void 0?u:void 0,w=(c=n.lastLoginAt)!==null&&c!==void 0?c:void 0,{uid:x,emailVerified:v,isAnonymous:b,providerData:S,stsTokenManager:T}=n;ke(x&&T,e,"internal-error");const _=xp.fromJSON(this.name,T);ke(typeof x=="string",e,"internal-error"),Qo(h,e.name),Qo(d,e.name),ke(typeof v=="boolean",e,"internal-error"),ke(typeof b=="boolean",e,"internal-error"),Qo(f,e.name),Qo(p,e.name),Qo(m,e.name),Qo(g,e.name),Qo(y,e.name),Qo(w,e.name);const E=new zl({uid:x,auth:e,email:d,emailVerified:v,displayName:h,isAnonymous:b,photoURL:p,phoneNumber:f,tenantId:m,stsTokenManager:_,createdAt:y,lastLoginAt:w});return S&&Array.isArray(S)&&(E.providerData=S.map(N=>Object.assign({},N))),g&&(E._redirectEventId=g),E}static async _fromIdTokenResponse(e,n,s=!1){const r=new xp;r.updateFromServerResponse(n);const i=new zl({uid:n.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await gw(i),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tD=new Map;function mo(t){So(t instanceof Function,"Expected a class definition");let e=tD.get(t);return e?(So(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,tD.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uV{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}uV.type="NONE";const nD=uV;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C0(t,e,n){return`firebase:${t}:${e}:${n}`}class Pc{constructor(e,n,s){this.persistence=e,this.auth=n,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=C0(this.userKey,r.apiKey,i),this.fullPersistenceKey=C0("persistence",r.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?zl._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,s="authUser"){if(!n.length)return new Pc(mo(nD),e,s);const r=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=r[0]||mo(nD);const o=C0(s,e.config.apiKey,e.name);let a=null;for(const u of n)try{const c=await u._get(o);if(c){const h=zl._fromJSON(e,c);u!==i&&(a=h),i=u;break}}catch{}const l=r.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Pc(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(n.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Pc(i,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sD(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(dV(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(cV(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(pV(e))return"Blackberry";if(mV(e))return"Webos";if(RC(e))return"Safari";if((e.includes("chrome/")||hV(e))&&!e.includes("edge/"))return"Chrome";if(fV(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(n);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function cV(t=hn()){return/firefox\//i.test(t)}function RC(t=hn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function hV(t=hn()){return/crios\//i.test(t)}function dV(t=hn()){return/iemobile/i.test(t)}function fV(t=hn()){return/android/i.test(t)}function pV(t=hn()){return/blackberry/i.test(t)}function mV(t=hn()){return/webos/i.test(t)}function Dv(t=hn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function V8(t=hn()){var e;return Dv(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function z8(){return JK()&&document.documentMode===10}function gV(t=hn()){return Dv(t)||fV(t)||mV(t)||pV(t)||/windows phone/i.test(t)||dV(t)}function B8(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yV(t,e=[]){let n;switch(t){case"Browser":n=sD(hn());break;case"Worker":n=`${sD(hn())}-${t}`;break;default:n=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ru}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U8{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=n,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const s of this.queue)await s(e),s.onAbort&&n.push(s.onAbort)}catch(s){n.reverse();for(const r of n)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function W8(t,e={}){return Ya(t,"GET","/v2/passwordPolicy",Du(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j8=6;class G8{constructor(e){var n,s,r,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:j8,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,s,r,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(n=l.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(s=l.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(r=l.containsLowercaseLetter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,n){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(n.meetsMinPasswordLength=e.length>=s),r&&(n.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(n,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,n,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H8{constructor(e,n,s,r){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new rD(this),this.idTokenSubscription=new rD(this),this.beforeStateQueue=new U8(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=rV,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=mo(n)),this._initializationPromise=this.queue(async()=>{var s,r;if(!this._deleted&&(this.persistenceManager=await Pc.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var n;const s=await this.assertedPersistence.getCurrentUser();let r=s,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ke(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await gw(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=b8()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const n=e?Ut(e):null;return n&&ke(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ke(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(mo(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await W8(this),n=new G8(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Au("auth","Firebase",e())}onAuthStateChanged(e,n,s){return this.registerStateListener(this.authStateSubscription,e,n,s)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,s){return this.registerStateListener(this.idTokenSubscription,e,n,s)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(s.tenantId=this.tenantId),await M8(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const s=await this.getOrInitRedirectPersistenceManager(n);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&mo(e)||this._popupRedirectResolver;ke(n,this,"argument-error"),this.redirectPersistenceManager=await Pc.create(this,[mo(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,s;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,s,r){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ke(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(n);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ke(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=yV(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(n["X-Firebase-Client"]=s);const r=await this._getAppCheckToken();return r&&(n["X-Firebase-AppCheck"]=r),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&y8(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Sh(t){return Ut(t)}class rD{constructor(e){this.auth=e,this.observer=null,this.addObserver=i9(n=>this.observer=n)}get next(){return ke(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ov={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function q8(t){Ov=t}function wV(t){return Ov.loadJS(t)}function K8(){return Ov.recaptchaEnterpriseScript}function X8(){return Ov.gapiScript}function Q8(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const Y8="recaptcha-enterprise",J8="NO_RECAPTCHA";class Z8{constructor(e){this.type=Y8,this.auth=Sh(e)}async verify(e="verify",n=!1){async function s(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{E8(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new C8(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function r(i,o,a){const l=window.grecaptcha;eD(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(J8)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{s(this.auth).then(a=>{if(!n&&eD(window.grecaptcha))r(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=K8();l.length!==0&&(l+=a),wV(l).then(()=>{r(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function iD(t,e,n,s=!1){const r=new Z8(t);let i;try{i=await r.verify(n)}catch{i=await r.verify(n,!0)}const o=Object.assign({},e);return s?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function oD(t,e,n,s){var r;if(!((r=t._getRecaptchaConfig())===null||r===void 0)&&r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await iD(t,e,n,n==="getOobCode");return s(t,i)}else return s(t,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await iD(t,e,n,n==="getOobCode");return s(t,o)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e7(t,e){const n=Qa(t,"auth");if(n.isInitialized()){const r=n.getImmediate(),i=n.getOptions();if(yp(i,e??{}))return r;hi(r,"already-initialized")}return n.initialize({options:e})}function t7(t,e){const n=(e==null?void 0:e.persistence)||[],s=(Array.isArray(n)?n:[n]).map(mo);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function n7(t,e,n){const s=Sh(t);ke(s._canInitEmulator,s,"emulator-config-failed"),ke(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!!(n!=null&&n.disableWarnings),i=vV(e),{host:o,port:a}=s7(e),l=a===null?"":`:${a}`;s.config.emulator={url:`${i}//${o}${l}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||r7()}function vV(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function s7(t){const e=vV(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:aD(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:aD(o)}}}function aD(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function r7(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DC{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return po("not implemented")}_getIdTokenResponse(e){return po("not implemented")}_linkToIdToken(e,n){return po("not implemented")}_getReauthenticationResolver(e){return po("not implemented")}}async function i7(t,e){return Ya(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o7(t,e){return Rv(t,"POST","/v1/accounts:signInWithPassword",Du(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a7(t,e){return Rv(t,"POST","/v1/accounts:signInWithEmailLink",Du(t,e))}async function l7(t,e){return Rv(t,"POST","/v1/accounts:signInWithEmailLink",Du(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp extends DC{constructor(e,n,s,r=null){super("password",s),this._email=e,this._password=n,this._tenantId=r}static _fromEmailAndPassword(e,n){return new bp(e,n,"password")}static _fromEmailAndCode(e,n,s=null){return new bp(e,n,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return oD(e,n,"signInWithPassword",o7);case"emailLink":return a7(e,{email:this._email,oobCode:this._password});default:hi(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const s={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return oD(e,s,"signUpPassword",i7);case"emailLink":return l7(e,{idToken:n,email:this._email,oobCode:this._password});default:hi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fc(t,e){return Rv(t,"POST","/v1/accounts:signInWithIdp",Du(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u7="http://localhost";class tu extends DC{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new tu(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):hi("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r}=n,i=kC(n,["providerId","signInMethod"]);if(!s||!r)return null;const o=new tu(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Fc(e,n)}_linkToIdToken(e,n){const s=this.buildRequest();return s.idToken=n,Fc(e,s)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Fc(e,n)}buildRequest(){const e={requestUri:u7,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=fm(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c7(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function h7(t){const e=vf(xf(t)).link,n=e?vf(xf(e)).deep_link_id:null,s=vf(xf(t)).deep_link_id;return(s?vf(xf(s)).link:null)||s||n||e||t}class OC{constructor(e){var n,s,r,i,o,a;const l=vf(xf(e)),u=(n=l.apiKey)!==null&&n!==void 0?n:null,c=(s=l.oobCode)!==null&&s!==void 0?s:null,h=c7((r=l.mode)!==null&&r!==void 0?r:null);ke(u&&c&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=c,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const n=h7(e);try{return new OC(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _h{constructor(){this.providerId=_h.PROVIDER_ID}static credential(e,n){return bp._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const s=OC.parseLink(n);return ke(s,"argument-error"),bp._fromEmailAndCode(e,s.code,s.tenantId)}}_h.PROVIDER_ID="password";_h.EMAIL_PASSWORD_SIGN_IN_METHOD="password";_h.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm extends xV{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia extends mm{constructor(){super("facebook.com")}static credential(e){return tu._fromParams({providerId:ia.PROVIDER_ID,signInMethod:ia.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ia.credentialFromTaggedObject(e)}static credentialFromError(e){return ia.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ia.credential(e.oauthAccessToken)}catch{return null}}}ia.FACEBOOK_SIGN_IN_METHOD="facebook.com";ia.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa extends mm{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return tu._fromParams({providerId:oa.PROVIDER_ID,signInMethod:oa.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return oa.credentialFromTaggedObject(e)}static credentialFromError(e){return oa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:s}=e;if(!n&&!s)return null;try{return oa.credential(n,s)}catch{return null}}}oa.GOOGLE_SIGN_IN_METHOD="google.com";oa.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa extends mm{constructor(){super("github.com")}static credential(e){return tu._fromParams({providerId:aa.PROVIDER_ID,signInMethod:aa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return aa.credentialFromTaggedObject(e)}static credentialFromError(e){return aa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return aa.credential(e.oauthAccessToken)}catch{return null}}}aa.GITHUB_SIGN_IN_METHOD="github.com";aa.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la extends mm{constructor(){super("twitter.com")}static credential(e,n){return tu._fromParams({providerId:la.PROVIDER_ID,signInMethod:la.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return la.credentialFromTaggedObject(e)}static credentialFromError(e){return la.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=e;if(!n||!s)return null;try{return la.credential(n,s)}catch{return null}}}la.TWITTER_SIGN_IN_METHOD="twitter.com";la.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,s,r=!1){const i=await zl._fromIdTokenResponse(e,s,r),o=lD(s);return new Qc({user:i,providerId:o,_tokenResponse:s,operationType:n})}static async _forOperation(e,n,s){await e._updateTokensIfNecessary(s,!0);const r=lD(s);return new Qc({user:e,providerId:r,_tokenResponse:s,operationType:n})}}function lD(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yw extends Br{constructor(e,n,s,r){var i;super(n.code,n.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,yw.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,n,s,r){return new yw(e,n,s,r)}}function bV(t,e,n,s){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?yw._fromErrorAndOperation(t,i,e,s):i})}async function d7(t,e,n=!1){const s=await vp(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Qc._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f7(t,e,n=!1){const{auth:s}=t,r="reauthenticate";try{const i=await vp(t,bV(s,r,e,t),n);ke(i.idToken,s,"internal-error");const o=AC(i.idToken);ke(o,s,"internal-error");const{sub:a}=o;return ke(t.uid===a,s,"user-mismatch"),Qc._forOperation(t,r,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&hi(s,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IV(t,e,n=!1){const s="signIn",r=await bV(t,s,e),i=await Qc._fromIdTokenResponse(t,s,r);return n||await t._updateCurrentUser(i.user),i}async function p7(t,e){return IV(Sh(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m7(t){const e=Sh(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function g7(t,e,n){return p7(Ut(t),_h.credential(e,n)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&m7(t),s})}function y7(t,e,n,s){return Ut(t).onIdTokenChanged(e,n,s)}function w7(t,e,n){return Ut(t).beforeAuthStateChanged(e,n)}const ww="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(ww,"1"),this.storage.removeItem(ww),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v7(){const t=hn();return RC(t)||Dv(t)}const x7=1e3,b7=10;class SV extends TV{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=v7()&&B8(),this.fallbackToPolling=gV(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const s=this.storage.getItem(n),r=this.localCache[n];s!==r&&e(n,r,s)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;if(n?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(s);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(s,e.newValue):this.storage.removeItem(s);else if(this.localCache[s]===e.newValue&&!n)return}const r=()=>{const o=this.storage.getItem(s);!n&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);z8()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,b7):r()}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:s}),!0)})},x7)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}SV.type="LOCAL";const I7=SV;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _V extends TV{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}_V.type="SESSION";const CV=_V;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T7(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pv{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(r=>r.isListeningto(e));if(n)return n;const s=new Pv(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:s,eventType:r,data:i}=n.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async u=>u(n.origin,i)),l=await T7(a);n.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Pv.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PC(t="",e=10){let n="";for(let s=0;s<e;s++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S7{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=PC("",20);r.port1.start();const c=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(h){const d=h;if(d.data.eventId===u)switch(d.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(d.data.response);break;default:clearTimeout(c),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Li(){return window}function _7(t){Li().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EV(){return typeof Li().WorkerGlobalScope<"u"&&typeof Li().importScripts=="function"}async function C7(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function E7(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function k7(){return EV()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kV="firebaseLocalStorageDb",N7=1,vw="firebaseLocalStorage",NV="fbase_key";class gm{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Fv(t,e){return t.transaction([vw],e?"readwrite":"readonly").objectStore(vw)}function $7(){const t=indexedDB.deleteDatabase(kV);return new gm(t).toPromise()}function rS(){const t=indexedDB.open(kV,N7);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(vw,{keyPath:NV})}catch(r){n(r)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(vw)?e(s):(s.close(),await $7(),e(await rS()))})})}async function uD(t,e,n){const s=Fv(t,!0).put({[NV]:e,value:n});return new gm(s).toPromise()}async function A7(t,e){const n=Fv(t,!1).get(e),s=await new gm(n).toPromise();return s===void 0?null:s.value}function cD(t,e){const n=Fv(t,!0).delete(e);return new gm(n).toPromise()}const R7=800,D7=3;class $V{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await rS(),this.db)}async _withRetries(e){let n=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(n++>D7)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return EV()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Pv._getInstance(k7()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await C7(),!this.activeServiceWorker)return;this.sender=new S7(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((n=s[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||E7()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await rS();return await uD(e,ww,"1"),await cD(e,ww),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(s=>uD(s,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(s=>A7(s,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>cD(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=Fv(r,!1).getAll();return new gm(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),n.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),n.push(r));return n}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),R7)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}$V.type="LOCAL";const O7=$V;new pm(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P7(t,e){return e?mo(e):(ke(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC extends DC{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Fc(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Fc(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Fc(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function F7(t){return IV(t.auth,new FC(t),t.bypassAuthState)}function L7(t){const{auth:e,user:n}=t;return ke(n,e,"internal-error"),f7(n,new FC(t),t.bypassAuthState)}async function M7(t){const{auth:e,user:n}=t;return ke(n,e,"internal-error"),d7(n,new FC(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AV{constructor(e,n,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return F7;case"linkViaPopup":case"linkViaRedirect":return M7;case"reauthViaPopup":case"reauthViaRedirect":return L7;default:hi(this.auth,"internal-error")}}resolve(e){So(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){So(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V7=new pm(2e3,1e4);class _c extends AV{constructor(e,n,s,r,i){super(e,n,r,i),this.provider=s,this.authWindow=null,this.pollId=null,_c.currentPopupAction&&_c.currentPopupAction.cancel(),_c.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ke(e,this.auth,"internal-error"),e}async onExecution(){So(this.filter.length===1,"Popup operations only handle one event");const e=PC();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Fi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Fi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,_c.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,s;if(!((s=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Fi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,V7.get())};e()}}_c.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z7="pendingRedirect",E0=new Map;class B7 extends AV{constructor(e,n,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,s),this.eventId=null}async execute(){let e=E0.get(this.auth._key());if(!e){try{const s=await U7(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(n){e=()=>Promise.reject(n)}E0.set(this.auth._key(),e)}return this.bypassAuthState||E0.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function U7(t,e){const n=G7(e),s=j7(t);if(!await s._isAvailable())return!1;const r=await s._get(n)==="true";return await s._remove(n),r}function W7(t,e){E0.set(t._key(),e)}function j7(t){return mo(t._redirectPersistence)}function G7(t){return C0(z7,t.config.apiKey,t.name)}async function H7(t,e,n=!1){const s=Sh(t),r=P7(s,e),o=await new B7(s,r,n).execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q7=10*60*1e3;class K7{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(n=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!X7(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var s;if(e.error&&!RV(e)){const r=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";n.onError(Fi(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const s=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=q7&&this.cachedEventUids.clear(),this.cachedEventUids.has(hD(e))}saveEventToCache(e){this.cachedEventUids.add(hD(e)),this.lastProcessedEventTime=Date.now()}}function hD(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function RV({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function X7(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return RV(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q7(t,e={}){return Ya(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y7=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,J7=/^https?/;async function Z7(t){if(t.config.emulator)return;const{authorizedDomains:e}=await Q7(t);for(const n of e)try{if(eX(n))return}catch{}hi(t,"unauthorized-domain")}function eX(t){const e=sS(),{protocol:n,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&s===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===s}if(!J7.test(n))return!1;if(Y7.test(t))return s===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tX=new pm(3e4,6e4);function dD(){const t=Li().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function nX(t){return new Promise((e,n)=>{var s,r,i;function o(){dD(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{dD(),n(Fi(t,"network-request-failed"))},timeout:tX.get()})}if(!((r=(s=Li().gapi)===null||s===void 0?void 0:s.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((i=Li().gapi)===null||i===void 0)&&i.load)o();else{const a=Q8("iframefcb");return Li()[a]=()=>{gapi.load?o():n(Fi(t,"network-request-failed"))},wV(`${X8()}?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw k0=null,e})}let k0=null;function sX(t){return k0=k0||nX(t),k0}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rX=new pm(5e3,15e3),iX="__/auth/iframe",oX="emulator/auth/iframe",aX={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},lX=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function uX(t){const e=t.config;ke(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?$C(e,oX):`https://${t.config.authDomain}/${iX}`,s={apiKey:e.apiKey,appName:t.name,v:Ru},r=lX.get(t.config.apiHost);r&&(s.eid=r);const i=t._getFrameworks();return i.length&&(s.fw=i.join(",")),`${n}?${fm(s).slice(1)}`}async function cX(t){const e=await sX(t),n=Li().gapi;return ke(n,t,"internal-error"),e.open({where:document.body,url:uX(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:aX,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=Fi(t,"network-request-failed"),a=Li().setTimeout(()=>{i(o)},rX.get());function l(){Li().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hX={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},dX=500,fX=600,pX="_blank",mX="http://localhost";class fD{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function gX(t,e,n,s=dX,r=fX){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l=Object.assign(Object.assign({},hX),{width:s.toString(),height:r.toString(),top:i,left:o}),u=hn().toLowerCase();n&&(a=hV(u)?pX:n),cV(u)&&(e=e||mX,l.scrollbars="yes");const c=Object.entries(l).reduce((d,[f,p])=>`${d}${f}=${p},`,"");if(V8(u)&&a!=="_self")return yX(e||"",a),new fD(null);const h=window.open(e||"",a,c);ke(h,t,"popup-blocked");try{h.focus()}catch{}return new fD(h)}function yX(t,e){const n=document.createElement("a");n.href=t,n.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wX="__/auth/handler",vX="emulator/auth/handler",xX=encodeURIComponent("fac");async function pD(t,e,n,s,r,i){ke(t.config.authDomain,t,"auth-domain-config-required"),ke(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:s,v:Ru,eventId:r};if(e instanceof xV){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",r9(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,h]of Object.entries(i||{}))o[c]=h}if(e instanceof mm){const c=e.getScopes().filter(h=>h!=="");c.length>0&&(o.scopes=c.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const c of Object.keys(a))a[c]===void 0&&delete a[c];const l=await t._getAppCheckToken(),u=l?`#${xX}=${encodeURIComponent(l)}`:"";return`${bX(t)}?${fm(a).slice(1)}${u}`}function bX({config:t}){return t.emulator?$C(t,vX):`https://${t.authDomain}/${wX}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TI="webStorageSupport";class IX{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=CV,this._completeRedirectFn=H7,this._overrideRedirectResult=W7}async _openPopup(e,n,s,r){var i;So((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await pD(e,n,s,sS(),r);return gX(e,o,PC())}async _openRedirect(e,n,s,r){await this._originValidation(e);const i=await pD(e,n,s,sS(),r);return _7(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:r,promise:i}=this.eventManagers[n];return r?Promise.resolve(r):(So(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[n]={promise:s},s.catch(()=>{delete this.eventManagers[n]}),s}async initAndGetManager(e){const n=await cX(e),s=new K7(e);return n.register("authEvent",r=>(ke(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=n,s}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(TI,{type:TI},r=>{var i;const o=(i=r==null?void 0:r[0])===null||i===void 0?void 0:i[TI];o!==void 0&&n(!!o),hi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=Z7(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return gV()||RC()||Dv()}}const TX=IX;var mD="@firebase/auth",gD="1.6.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SX{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ke(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _X(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function CX(t){ci(new Vr("auth",(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;ke(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:yV(t)},u=new H8(s,r,i,l);return t7(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,s)=>{e.getProvider("auth-internal").initialize()})),ci(new Vr("auth-internal",e=>{const n=Sh(e.getProvider("auth").getImmediate());return(s=>new SX(s))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Hs(mD,gD,_X(t)),Hs(mD,gD,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EX=5*60,kX=qM("authIdTokenMaxAge")||EX;let yD=null;const NX=t=>async e=>{const n=e&&await e.getIdTokenResult(),s=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(s&&s>kX)return;const r=n==null?void 0:n.token;yD!==r&&(yD=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function $X(t=Av()){const e=Qa(t,"auth");if(e.isInitialized())return e.getImmediate();const n=e7(t,{popupRedirectResolver:TX,persistence:[O7,I7,CV]}),s=qM("authTokenSyncURL");if(s){const i=NX(s);w7(n,i,()=>i(n.currentUser)),y7(n,o=>i(o))}const r=jM("auth");return r&&n7(n,`http://${r}`),n}function AX(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}q8({loadJS(t){return new Promise((e,n)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=r=>{const i=Fi("internal-error");i.customData=r,n(i)},s.type="text/javascript",s.charset="UTF-8",AX().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});CX("Browser");var RX="firebase",DX="10.8.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Hs(RX,DX,"app");const DV="@firebase/installations",LC="0.6.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OV=1e4,PV=`w:${LC}`,FV="FIS_v2",OX="https://firebaseinstallations.googleapis.com/v1",PX=60*60*1e3,FX="installations",LX="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MX={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},nu=new Au(FX,LX,MX);function LV(t){return t instanceof Br&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MV({projectId:t}){return`${OX}/projects/${t}/installations`}function VV(t){return{token:t.token,requestStatus:2,expiresIn:zX(t.expiresIn),creationTime:Date.now()}}async function zV(t,e){const s=(await e.json()).error;return nu.create("request-failed",{requestName:t,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function BV({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function VX(t,{refreshToken:e}){const n=BV(t);return n.append("Authorization",BX(e)),n}async function UV(t){const e=await t();return e.status>=500&&e.status<600?t():e}function zX(t){return Number(t.replace("s","000"))}function BX(t){return`${FV} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UX({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const s=MV(t),r=BV(t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&r.append("x-firebase-client",u)}const o={fid:n,authVersion:FV,appId:t.appId,sdkVersion:PV},a={method:"POST",headers:r,body:JSON.stringify(o)},l=await UV(()=>fetch(s,a));if(l.ok){const u=await l.json();return{fid:u.fid||n,registrationStatus:2,refreshToken:u.refreshToken,authToken:VV(u.authToken)}}else throw await zV("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WV(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WX(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jX=/^[cdef][\w-]{21}$/,iS="";function GX(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=HX(t);return jX.test(n)?n:iS}catch{return iS}}function HX(t){return WX(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lv(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jV=new Map;function GV(t,e){const n=Lv(t);HV(n,e),qX(n,e)}function HV(t,e){const n=jV.get(t);if(n)for(const s of n)s(e)}function qX(t,e){const n=KX();n&&n.postMessage({key:t,fid:e}),XX()}let Nl=null;function KX(){return!Nl&&"BroadcastChannel"in self&&(Nl=new BroadcastChannel("[Firebase] FID Change"),Nl.onmessage=t=>{HV(t.data.key,t.data.fid)}),Nl}function XX(){jV.size===0&&Nl&&(Nl.close(),Nl=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QX="firebase-installations-database",YX=1,su="firebase-installations-store";let SI=null;function MC(){return SI||(SI=ZM(QX,YX,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(su)}}})),SI}async function xw(t,e){const n=Lv(t),r=(await MC()).transaction(su,"readwrite"),i=r.objectStore(su),o=await i.get(n);return await i.put(e,n),await r.done,(!o||o.fid!==e.fid)&&GV(t,e.fid),e}async function qV(t){const e=Lv(t),s=(await MC()).transaction(su,"readwrite");await s.objectStore(su).delete(e),await s.done}async function Mv(t,e){const n=Lv(t),r=(await MC()).transaction(su,"readwrite"),i=r.objectStore(su),o=await i.get(n),a=e(o);return a===void 0?await i.delete(n):await i.put(a,n),await r.done,a&&(!o||o.fid!==a.fid)&&GV(t,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VC(t){let e;const n=await Mv(t.appConfig,s=>{const r=JX(s),i=ZX(t,r);return e=i.registrationPromise,i.installationEntry});return n.fid===iS?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function JX(t){const e=t||{fid:GX(),registrationStatus:0};return KV(e)}function ZX(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const r=Promise.reject(nu.create("app-offline"));return{installationEntry:e,registrationPromise:r}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=eQ(t,n);return{installationEntry:n,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:tQ(t)}:{installationEntry:e}}async function eQ(t,e){try{const n=await UX(t,e);return xw(t.appConfig,n)}catch(n){throw LV(n)&&n.customData.serverCode===409?await qV(t.appConfig):await xw(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function tQ(t){let e=await wD(t.appConfig);for(;e.registrationStatus===1;)await WV(100),e=await wD(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:s}=await VC(t);return s||n}return e}function wD(t){return Mv(t,e=>{if(!e)throw nu.create("installation-not-found");return KV(e)})}function KV(t){return nQ(t)?{fid:t.fid,registrationStatus:0}:t}function nQ(t){return t.registrationStatus===1&&t.registrationTime+OV<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sQ({appConfig:t,heartbeatServiceProvider:e},n){const s=rQ(t,n),r=VX(t,n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&r.append("x-firebase-client",u)}const o={installation:{sdkVersion:PV,appId:t.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},l=await UV(()=>fetch(s,a));if(l.ok){const u=await l.json();return VV(u)}else throw await zV("Generate Auth Token",l)}function rQ(t,{fid:e}){return`${MV(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zC(t,e=!1){let n;const s=await Mv(t.appConfig,i=>{if(!XV(i))throw nu.create("not-registered");const o=i.authToken;if(!e&&aQ(o))return i;if(o.requestStatus===1)return n=iQ(t,e),i;{if(!navigator.onLine)throw nu.create("app-offline");const a=uQ(i);return n=oQ(t,a),a}});return n?await n:s.authToken}async function iQ(t,e){let n=await vD(t.appConfig);for(;n.authToken.requestStatus===1;)await WV(100),n=await vD(t.appConfig);const s=n.authToken;return s.requestStatus===0?zC(t,e):s}function vD(t){return Mv(t,e=>{if(!XV(e))throw nu.create("not-registered");const n=e.authToken;return cQ(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function oQ(t,e){try{const n=await sQ(t,e),s=Object.assign(Object.assign({},e),{authToken:n});return await xw(t.appConfig,s),n}catch(n){if(LV(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await qV(t.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await xw(t.appConfig,s)}throw n}}function XV(t){return t!==void 0&&t.registrationStatus===2}function aQ(t){return t.requestStatus===2&&!lQ(t)}function lQ(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+PX}function uQ(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function cQ(t){return t.requestStatus===1&&t.requestTime+OV<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hQ(t){const e=t,{installationEntry:n,registrationPromise:s}=await VC(e);return s?s.catch(console.error):zC(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dQ(t,e=!1){const n=t;return await fQ(n),(await zC(n,e)).token}async function fQ(t){const{registrationPromise:e}=await VC(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pQ(t){if(!t||!t.options)throw _I("App Configuration");if(!t.name)throw _I("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw _I(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function _I(t){return nu.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QV="installations",mQ="installations-internal",gQ=t=>{const e=t.getProvider("app").getImmediate(),n=pQ(e),s=Qa(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},yQ=t=>{const e=t.getProvider("app").getImmediate(),n=Qa(e,QV).getImmediate();return{getId:()=>hQ(n),getToken:r=>dQ(n,r)}};function wQ(){ci(new Vr(QV,gQ,"PUBLIC")),ci(new Vr(mQ,yQ,"PRIVATE"))}wQ();Hs(DV,LC);Hs(DV,LC,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bw="analytics",vQ="firebase_id",xQ="origin",bQ=60*1e3,IQ="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",BC="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qs=new $v("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TQ={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},pr=new Au("analytics","Analytics",TQ);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SQ(t){if(!t.startsWith(BC)){const e=pr.create("invalid-gtag-resource",{gtagURL:t});return qs.warn(e.message),""}return t}function YV(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function _Q(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function CQ(t,e){const n=_Q("firebase-js-sdk-policy",{createScriptURL:SQ}),s=document.createElement("script"),r=`${BC}?l=${t}&id=${e}`;s.src=n?n==null?void 0:n.createScriptURL(r):r,s.async=!0,document.head.appendChild(s)}function EQ(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function kQ(t,e,n,s,r,i){const o=s[r];try{if(o)await e[o];else{const l=(await YV(n)).find(u=>u.measurementId===r);l&&await e[l.appId]}}catch(a){qs.error(a)}t("config",r,i)}async function NQ(t,e,n,s,r){try{let i=[];if(r&&r.send_to){let o=r.send_to;Array.isArray(o)||(o=[o]);const a=await YV(n);for(const l of o){const u=a.find(h=>h.measurementId===l),c=u&&e[u.appId];if(c)i.push(c);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),t("event",s,r||{})}catch(i){qs.error(i)}}function $Q(t,e,n,s){async function r(i,...o){try{if(i==="event"){const[a,l]=o;await NQ(t,e,n,a,l)}else if(i==="config"){const[a,l]=o;await kQ(t,e,n,s,a,l)}else if(i==="consent"){const[a]=o;t("consent","update",a)}else if(i==="get"){const[a,l,u]=o;t("get",a,l,u)}else if(i==="set"){const[a]=o;t("set",a)}else t(i,...o)}catch(a){qs.error(a)}}return r}function AQ(t,e,n,s,r){let i=function(...o){window[s].push(arguments)};return window[r]&&typeof window[r]=="function"&&(i=window[r]),window[r]=$Q(i,t,e,n),{gtagCore:i,wrappedGtag:window[r]}}function RQ(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(BC)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DQ=30,OQ=1e3;class PQ{constructor(e={},n=OQ){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const JV=new PQ;function FQ(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function LQ(t){var e;const{appId:n,apiKey:s}=t,r={method:"GET",headers:FQ(s)},i=IQ.replace("{app-id}",n),o=await fetch(i,r);if(o.status!==200&&o.status!==304){let a="";try{const l=await o.json();!((e=l.error)===null||e===void 0)&&e.message&&(a=l.error.message)}catch{}throw pr.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function MQ(t,e=JV,n){const{appId:s,apiKey:r,measurementId:i}=t.options;if(!s)throw pr.create("no-app-id");if(!r){if(i)return{measurementId:i,appId:s};throw pr.create("no-api-key")}const o=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new BQ;return setTimeout(async()=>{a.abort()},n!==void 0?n:bQ),ZV({appId:s,apiKey:r,measurementId:i},o,a,e)}async function ZV(t,{throttleEndTimeMillis:e,backoffCount:n},s,r=JV){var i;const{appId:o,measurementId:a}=t;try{await VQ(s,e)}catch(l){if(a)return qs.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:o,measurementId:a};throw l}try{const l=await LQ(t);return r.deleteThrottleMetadata(o),l}catch(l){const u=l;if(!zQ(u)){if(r.deleteThrottleMetadata(o),a)return qs.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:o,measurementId:a};throw l}const c=Number((i=u==null?void 0:u.customData)===null||i===void 0?void 0:i.httpStatus)===503?GR(n,r.intervalMillis,DQ):GR(n,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+c,backoffCount:n+1};return r.setThrottleMetadata(o,h),qs.debug(`Calling attemptFetch again in ${c} millis`),ZV(t,h,s,r)}}function VQ(t,e){return new Promise((n,s)=>{const r=Math.max(e-Date.now(),0),i=setTimeout(n,r);t.addEventListener(()=>{clearTimeout(i),s(pr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function zQ(t){if(!(t instanceof Br)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class BQ{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function UQ(t,e,n,s,r){if(r&&r.global){t("event",n,s);return}else{const i=await e,o=Object.assign(Object.assign({},s),{send_to:i});t("event",n,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WQ(){if(CC())try{await QM()}catch(t){return qs.warn(pr.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return qs.warn(pr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function jQ(t,e,n,s,r,i,o){var a;const l=MQ(t);l.then(f=>{n[f.measurementId]=f.appId,t.options.measurementId&&f.measurementId!==t.options.measurementId&&qs.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${f.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(f=>qs.error(f)),e.push(l);const u=WQ().then(f=>{if(f)return s.getId()}),[c,h]=await Promise.all([l,u]);RQ(i)||CQ(i,c.measurementId),r("js",new Date);const d=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return d[xQ]="firebase",d.update=!0,h!=null&&(d[vQ]=h),r("config",c.measurementId,d),c.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GQ{constructor(e){this.app=e}_delete(){return delete Hf[this.app.options.appId],Promise.resolve()}}let Hf={},xD=[];const bD={};let CI="dataLayer",HQ="gtag",ID,e3,TD=!1;function qQ(){const t=[];if(XM()&&t.push("This is a browser extension environment."),e9()||t.push("Cookies are not available."),t.length>0){const e=t.map((s,r)=>`(${r+1}) ${s}`).join(" "),n=pr.create("invalid-analytics-context",{errorInfo:e});qs.warn(n.message)}}function KQ(t,e,n){qQ();const s=t.options.appId;if(!s)throw pr.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)qs.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw pr.create("no-api-key");if(Hf[s]!=null)throw pr.create("already-exists",{id:s});if(!TD){EQ(CI);const{wrappedGtag:i,gtagCore:o}=AQ(Hf,xD,bD,CI,HQ);e3=i,ID=o,TD=!0}return Hf[s]=jQ(t,xD,bD,e,ID,CI,n),new GQ(t)}function XQ(t=Av()){t=Ut(t);const e=Qa(t,bw);return e.isInitialized()?e.getImmediate():QQ(t)}function QQ(t,e={}){const n=Qa(t,bw);if(n.isInitialized()){const r=n.getImmediate();if(yp(e,n.getOptions()))return r;throw pr.create("already-initialized")}return n.initialize({options:e})}function YQ(t,e,n,s){t=Ut(t),UQ(e3,Hf[t.app.options.appId],e,n,s).catch(r=>qs.error(r))}const SD="@firebase/analytics",_D="0.10.1";function JQ(){ci(new Vr(bw,(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();return KQ(s,r,n)},"PUBLIC")),ci(new Vr("analytics-internal",t,"PRIVATE")),Hs(SD,_D),Hs(SD,_D,"esm2017");function t(e){try{const n=e.getProvider(bw).getImmediate();return{logEvent:(s,r,i)=>YQ(n,s,r,i)}}catch(n){throw pr.create("interop-component-reg-failed",{reason:n})}}}JQ();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t3="firebasestorage.googleapis.com",n3="storageBucket",ZQ=2*60*1e3,eY=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn extends Br{constructor(e,n,s=0){super(EI(e),`Firebase Storage: ${n} (${EI(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Fn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return EI(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Rn;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Rn||(Rn={}));function EI(t){return"storage/"+t}function s3(){const t="An unknown error occurred, please check the error payload for server response.";return new Fn(Rn.UNKNOWN,t)}function tY(t){return new Fn(Rn.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function nY(t){return new Fn(Rn.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function sY(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Fn(Rn.UNAUTHENTICATED,t)}function rY(){return new Fn(Rn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function iY(t){return new Fn(Rn.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function oY(){return new Fn(Rn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function aY(){return new Fn(Rn.CANCELED,"User canceled the upload/download.")}function lY(t){return new Fn(Rn.INVALID_URL,"Invalid URL '"+t+"'.")}function uY(t){return new Fn(Rn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function cY(){return new Fn(Rn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+n3+"' property when initializing the app?")}function hY(){return new Fn(Rn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function oS(t){return new Fn(Rn.INVALID_ARGUMENT,t)}function r3(){return new Fn(Rn.APP_DELETED,"The Firebase app was deleted.")}function dY(t){return new Fn(Rn.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function of(t){throw new Fn(Rn.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let s;try{s=lr.makeFromUrl(e,n)}catch{return new lr(e,"")}if(s.path==="")return s;throw uY(e)}static makeFromUrl(e,n){let s=null;const r="([A-Za-z0-9.\\-_]+)";function i(v){v.path.charAt(v.path.length-1)==="/"&&(v.path_=v.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+r+o,"i"),l={bucket:1,path:3};function u(v){v.path_=decodeURIComponent(v.path)}const c="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${c}/b/${r}/o${d}`,"i"),p={bucket:1,path:3},m=n===t3?"(?:storage.googleapis.com|storage.cloud.google.com)":n,g="([^?#]*)",y=new RegExp(`^https?://${m}/${r}/${g}`,"i"),x=[{regex:a,indices:l,postModify:i},{regex:f,indices:p,postModify:u},{regex:y,indices:{bucket:1,path:2},postModify:u}];for(let v=0;v<x.length;v++){const b=x[v],S=b.regex.exec(e);if(S){const T=S[b.indices.bucket];let _=S[b.indices.path];_||(_=""),s=new lr(T,_),b.postModify(s);break}}if(s==null)throw lY(e);return s}}class fY{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pY(t,e,n){let s=1,r=null,i=null,o=!1,a=0;function l(){return a===2}let u=!1;function c(...g){u||(u=!0,e.apply(null,g))}function h(g){r=setTimeout(()=>{r=null,t(f,l())},g)}function d(){i&&clearTimeout(i)}function f(g,...y){if(u){d();return}if(g){d(),c.call(null,g,...y);return}if(l()||o){d(),c.call(null,g,...y);return}s<64&&(s*=2);let x;a===1?(a=2,x=0):x=(s+Math.random())*1e3,h(x)}let p=!1;function m(g){p||(p=!0,d(),!u&&(r!==null?(g||(a=2),clearTimeout(r),h(0)):g||(a=1)))}return h(0),i=setTimeout(()=>{o=!0,m(!0)},n),m}function mY(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gY(t){return t!==void 0}function yY(t){return typeof t=="object"&&!Array.isArray(t)}function i3(t){return typeof t=="string"||t instanceof String}function CD(t,e,n,s){if(s<e)throw oS(`Invalid value for '${t}'. Expected ${e} or greater.`);if(s>n)throw oS(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o3(t,e,n){let s=e;return n==null&&(s=`https://${e}`),`${n}://${s}/v0${t}`}function a3(t){const e=encodeURIComponent;let n="?";for(const s in t)if(t.hasOwnProperty(s)){const r=e(s)+"="+e(t[s]);n=n+r+"&"}return n=n.slice(0,-1),n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bl;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Bl||(Bl={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wY(t,e){const n=t>=500&&t<600,r=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||r||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vY{constructor(e,n,s,r,i,o,a,l,u,c,h,d=!0){this.url_=e,this.method_=n,this.headers_=s,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=u,this.progressCallback_=c,this.connectionFactory_=h,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,p)=>{this.resolve_=f,this.reject_=p,this.start_()})}start_(){const e=(s,r)=>{if(r){s(!1,new Uy(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,u=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,u)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===Bl.NO_ERROR,l=i.getStatus();if(!a||wY(l,this.additionalRetryCodes_)&&this.retry){const c=i.getErrorCode()===Bl.ABORT;s(!1,new Uy(!1,null,c));return}const u=this.successCodes_.indexOf(l)!==-1;s(!0,new Uy(u,i))})},n=(s,r)=>{const i=this.resolve_,o=this.reject_,a=r.connection;if(r.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());gY(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=s3();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(r.canceled){const l=this.appDelete_?r3():aY();o(l)}else{const l=oY();o(l)}};this.canceled_?n(!1,new Uy(!1,null,!0)):this.backoffId_=pY(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&mY(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Uy{constructor(e,n,s){this.wasSuccessCode=e,this.connection=n,this.canceled=!!s}}function xY(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function bY(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function IY(t,e){e&&(t["X-Firebase-GMPID"]=e)}function TY(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function SY(t,e,n,s,r,i,o=!0){const a=a3(t.urlParams),l=t.url+a,u=Object.assign({},t.headers);return IY(u,e),xY(u,n),bY(u,i),TY(u,s),new vY(l,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,r,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l3(t){let e;try{e=JSON.parse(t)}catch{return null}return yY(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _Y(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function CY(t,e){const n=e.split("/").filter(s=>s.length>0).join("/");return t.length===0?n:t+"/"+n}function u3(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EY(t,e){return e}class ws{constructor(e,n,s,r){this.server=e,this.local=n||e,this.writable=!!s,this.xform=r||EY}}let Wy=null;function kY(t){return!i3(t)||t.length<2?t:u3(t)}function NY(){if(Wy)return Wy;const t=[];t.push(new ws("bucket")),t.push(new ws("generation")),t.push(new ws("metageneration")),t.push(new ws("name","fullPath",!0));function e(i,o){return kY(o)}const n=new ws("name");n.xform=e,t.push(n);function s(i,o){return o!==void 0?Number(o):o}const r=new ws("size");return r.xform=s,t.push(r),t.push(new ws("timeCreated")),t.push(new ws("updated")),t.push(new ws("md5Hash",null,!0)),t.push(new ws("cacheControl",null,!0)),t.push(new ws("contentDisposition",null,!0)),t.push(new ws("contentEncoding",null,!0)),t.push(new ws("contentLanguage",null,!0)),t.push(new ws("contentType",null,!0)),t.push(new ws("metadata","customMetadata",!0)),Wy=t,Wy}function $Y(t,e){function n(){const s=t.bucket,r=t.fullPath,i=new lr(s,r);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function AY(t,e,n){const s={};s.type="file";const r=n.length;for(let i=0;i<r;i++){const o=n[i];s[o.local]=o.xform(s,e[o.server])}return $Y(s,t),s}function RY(t,e,n){const s=l3(e);return s===null?null:AY(t,s,n)}function DY(t,e,n,s){const r=l3(e);if(r===null||!i3(r.downloadTokens))return null;const i=r.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(u=>{const c=t.bucket,h=t.fullPath,d="/b/"+o(c)+"/o/"+o(h),f=o3(d,n,s),p=a3({alt:"media",token:u});return f+p})[0]}class OY{constructor(e,n,s,r){this.url=e,this.method=n,this.handler=s,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PY(t){if(!t)throw s3()}function FY(t,e){function n(s,r){const i=RY(t,r,e);return PY(i!==null),DY(i,r,t.host,t._protocol)}return n}function LY(t){function e(n,s){let r;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?r=rY():r=sY():n.getStatus()===402?r=nY(t.bucket):n.getStatus()===403?r=iY(t.path):r=s,r.status=n.getStatus(),r.serverResponse=s.serverResponse,r}return e}function MY(t){const e=LY(t);function n(s,r){let i=e(s,r);return s.getStatus()===404&&(i=tY(t.path)),i.serverResponse=r.serverResponse,i}return n}function VY(t,e,n){const s=e.fullServerUrl(),r=o3(s,t.host,t._protocol),i="GET",o=t.maxOperationRetryTime,a=new OY(r,i,FY(t,n),o);return a.errorHandler=MY(e),a}class zY{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Bl.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Bl.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Bl.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,s,r){if(this.sent_)throw of("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(n,e,!0),r!==void 0)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw of("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw of("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw of("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw of("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class BY extends zY{initXhr(){this.xhr_.responseType="text"}}function UY(){return new BY}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru{constructor(e,n){this._service=e,n instanceof lr?this._location=n:this._location=lr.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new ru(e,n)}get root(){const e=new lr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return u3(this._location.path)}get storage(){return this._service}get parent(){const e=_Y(this._location.path);if(e===null)return null;const n=new lr(this._location.bucket,e);return new ru(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw dY(e)}}function WY(t){t._throwIfRoot("getDownloadURL");const e=VY(t.storage,t._location,NY());return t.storage.makeRequestWithTokens(e,UY).then(n=>{if(n===null)throw hY();return n})}function jY(t,e){const n=CY(t._location.path,e),s=new lr(t._location.bucket,n);return new ru(t.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GY(t){return/^[A-Za-z]+:\/\//.test(t)}function HY(t,e){return new ru(t,e)}function c3(t,e){if(t instanceof UC){const n=t;if(n._bucket==null)throw cY();const s=new ru(n,n._bucket);return e!=null?c3(s,e):s}else return e!==void 0?jY(t,e):t}function qY(t,e){if(e&&GY(e)){if(t instanceof UC)return HY(t,e);throw oS("To use ref(service, url), the first argument must be a Storage instance.")}else return c3(t,e)}function ED(t,e){const n=e==null?void 0:e[n3];return n==null?null:lr.makeFromBucketSpec(n,t)}function KY(t,e,n,s={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:r}=s;r&&(t._overrideAuthToken=typeof r=="string"?r:KM(r,t.app.options.projectId))}class UC{constructor(e,n,s,r,i){this.app=e,this._authProvider=n,this._appCheckProvider=s,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=t3,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=ZQ,this._maxUploadRetryTime=eY,this._requests=new Set,r!=null?this._bucket=lr.makeFromBucketSpec(r,this._host):this._bucket=ED(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=lr.makeFromBucketSpec(this._url,e):this._bucket=ED(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){CD("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){CD("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ru(this,e)}_makeRequest(e,n,s,r,i=!0){if(this._deleted)return new fY(r3());{const o=SY(e,this._appId,s,r,n,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[s,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,s,r).getPromise()}}const kD="@firebase/storage",ND="0.12.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h3="storage";function $D(t){return t=Ut(t),WY(t)}function AD(t,e){return t=Ut(t),qY(t,e)}function XY(t=Av(),e){t=Ut(t);const s=Qa(t,h3).getImmediate({identifier:e}),r=GM("storage");return r&&QY(s,...r),s}function QY(t,e,n,s={}){KY(t,e,n,s)}function YY(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),r=t.getProvider("app-check-internal");return new UC(n,s,r,e,Ru)}function JY(){ci(new Vr(h3,YY,"PUBLIC").setMultipleInstances(!0)),Hs(kD,ND,""),Hs(kD,ND,"esm2017")}JY();var ZY=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fe,WC=WC||{},Re=ZY||self;function Vv(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function ym(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function eJ(t){return Object.prototype.hasOwnProperty.call(t,kI)&&t[kI]||(t[kI]=++tJ)}var kI="closure_uid_"+(1e9*Math.random()>>>0),tJ=0;function nJ(t,e,n){return t.call.apply(t.bind,arguments)}function sJ(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,s),t.apply(e,r)}}return function(){return t.apply(e,arguments)}}function us(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?us=nJ:us=sJ,us.apply(null,arguments)}function jy(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var s=n.slice();return s.push.apply(s,arguments),t.apply(this,s)}}function Ln(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(s,r,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[r].apply(s,o)}}function Ja(){this.s=this.s,this.o=this.o}var rJ=0;Ja.prototype.s=!1;Ja.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),rJ!=0)&&eJ(this)};Ja.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const d3=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function jC(t){const e=t.length;if(0<e){const n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function RD(t,e){for(let n=1;n<arguments.length;n++){const s=arguments[n];if(Vv(s)){const r=t.length||0,i=s.length||0;t.length=r+i;for(let o=0;o<i;o++)t[r+o]=s[o]}else t.push(s)}}function cs(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}cs.prototype.h=function(){this.defaultPrevented=!0};var iJ=function(){if(!Re.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const n=()=>{};Re.addEventListener("test",n,e),Re.removeEventListener("test",n,e)}catch{}return t}();function Ip(t){return/^[\s\xa0]*$/.test(t)}function zv(){var t=Re.navigator;return t&&(t=t.userAgent)?t:""}function Ni(t){return zv().indexOf(t)!=-1}function GC(t){return GC[" "](t),t}GC[" "]=function(){};function oJ(t,e){var n=JJ;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}var aJ=Ni("Opera"),Yc=Ni("Trident")||Ni("MSIE"),f3=Ni("Edge"),aS=f3||Yc,p3=Ni("Gecko")&&!(zv().toLowerCase().indexOf("webkit")!=-1&&!Ni("Edge"))&&!(Ni("Trident")||Ni("MSIE"))&&!Ni("Edge"),lJ=zv().toLowerCase().indexOf("webkit")!=-1&&!Ni("Edge");function m3(){var t=Re.document;return t?t.documentMode:void 0}var lS;e:{var NI="",$I=function(){var t=zv();if(p3)return/rv:([^\);]+)(\)|;)/.exec(t);if(f3)return/Edge\/([\d\.]+)/.exec(t);if(Yc)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(lJ)return/WebKit\/(\S+)/.exec(t);if(aJ)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if($I&&(NI=$I?$I[1]:""),Yc){var AI=m3();if(AI!=null&&AI>parseFloat(NI)){lS=String(AI);break e}}lS=NI}var uS;if(Re.document&&Yc){var DD=m3();uS=DD||parseInt(lS,10)||void 0}else uS=void 0;var uJ=uS;function Tp(t,e){if(cs.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(p3){e:{try{GC(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:cJ[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Tp.$.h.call(this)}}Ln(Tp,cs);var cJ={2:"touch",3:"pen",4:"mouse"};Tp.prototype.h=function(){Tp.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var wm="closure_listenable_"+(1e6*Math.random()|0),hJ=0;function dJ(t,e,n,s,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.la=r,this.key=++hJ,this.fa=this.ia=!1}function Bv(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function HC(t,e,n){for(const s in t)e.call(n,t[s],s,t)}function fJ(t,e){for(const n in t)e.call(void 0,t[n],n,t)}function g3(t){const e={};for(const n in t)e[n]=t[n];return e}const OD="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function y3(t,e){let n,s;for(let r=1;r<arguments.length;r++){s=arguments[r];for(n in s)t[n]=s[n];for(let i=0;i<OD.length;i++)n=OD[i],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function Uv(t){this.src=t,this.g={},this.h=0}Uv.prototype.add=function(t,e,n,s,r){var i=t.toString();t=this.g[i],t||(t=this.g[i]=[],this.h++);var o=hS(t,e,s,r);return-1<o?(e=t[o],n||(e.ia=!1)):(e=new dJ(e,this.src,i,!!s,r),e.ia=n,t.push(e)),e};function cS(t,e){var n=e.type;if(n in t.g){var s=t.g[n],r=d3(s,e),i;(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(Bv(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function hS(t,e,n,s){for(var r=0;r<t.length;++r){var i=t[r];if(!i.fa&&i.listener==e&&i.capture==!!n&&i.la==s)return r}return-1}var qC="closure_lm_"+(1e6*Math.random()|0),RI={};function w3(t,e,n,s,r){if(s&&s.once)return x3(t,e,n,s,r);if(Array.isArray(e)){for(var i=0;i<e.length;i++)w3(t,e[i],n,s,r);return null}return n=QC(n),t&&t[wm]?t.O(e,n,ym(s)?!!s.capture:!!s,r):v3(t,e,n,!1,s,r)}function v3(t,e,n,s,r,i){if(!e)throw Error("Invalid event type");var o=ym(r)?!!r.capture:!!r,a=XC(t);if(a||(t[qC]=a=new Uv(t)),n=a.add(e,n,s,o,i),n.proxy)return n;if(s=pJ(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)iJ||(r=o),r===void 0&&(r=!1),t.addEventListener(e.toString(),s,r);else if(t.attachEvent)t.attachEvent(I3(e.toString()),s);else if(t.addListener&&t.removeListener)t.addListener(s);else throw Error("addEventListener and attachEvent are unavailable.");return n}function pJ(){function t(n){return e.call(t.src,t.listener,n)}const e=mJ;return t}function x3(t,e,n,s,r){if(Array.isArray(e)){for(var i=0;i<e.length;i++)x3(t,e[i],n,s,r);return null}return n=QC(n),t&&t[wm]?t.P(e,n,ym(s)?!!s.capture:!!s,r):v3(t,e,n,!0,s,r)}function b3(t,e,n,s,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)b3(t,e[i],n,s,r);else s=ym(s)?!!s.capture:!!s,n=QC(n),t&&t[wm]?(t=t.i,e=String(e).toString(),e in t.g&&(i=t.g[e],n=hS(i,n,s,r),-1<n&&(Bv(i[n]),Array.prototype.splice.call(i,n,1),i.length==0&&(delete t.g[e],t.h--)))):t&&(t=XC(t))&&(e=t.g[e.toString()],t=-1,e&&(t=hS(e,n,s,r)),(n=-1<t?e[t]:null)&&KC(n))}function KC(t){if(typeof t!="number"&&t&&!t.fa){var e=t.src;if(e&&e[wm])cS(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(I3(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=XC(e))?(cS(n,t),n.h==0&&(n.src=null,e[qC]=null)):Bv(t)}}}function I3(t){return t in RI?RI[t]:RI[t]="on"+t}function mJ(t,e){if(t.fa)t=!0;else{e=new Tp(e,this);var n=t.listener,s=t.la||t.src;t.ia&&KC(t),t=n.call(s,e)}return t}function XC(t){return t=t[qC],t instanceof Uv?t:null}var DI="__closure_events_fn_"+(1e9*Math.random()>>>0);function QC(t){return typeof t=="function"?t:(t[DI]||(t[DI]=function(e){return t.handleEvent(e)}),t[DI])}function Dn(){Ja.call(this),this.i=new Uv(this),this.S=this,this.J=null}Ln(Dn,Ja);Dn.prototype[wm]=!0;Dn.prototype.removeEventListener=function(t,e,n,s){b3(this,t,e,n,s)};function Xn(t,e){var n,s=t.J;if(s)for(n=[];s;s=s.J)n.push(s);if(t=t.S,s=e.type||e,typeof e=="string")e=new cs(e,t);else if(e instanceof cs)e.target=e.target||t;else{var r=e;e=new cs(s,t),y3(e,r)}if(r=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];r=Gy(o,s,!0,e)&&r}if(o=e.g=t,r=Gy(o,s,!0,e)&&r,r=Gy(o,s,!1,e)&&r,n)for(i=0;i<n.length;i++)o=e.g=n[i],r=Gy(o,s,!1,e)&&r}Dn.prototype.N=function(){if(Dn.$.N.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],s=0;s<n.length;s++)Bv(n[s]);delete t.g[e],t.h--}}this.J=null};Dn.prototype.O=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)};Dn.prototype.P=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};function Gy(t,e,n,s){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var r=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,l=o.la||o.src;o.ia&&cS(t.i,o),r=a.call(l,s)!==!1&&r}}return r&&!s.defaultPrevented}var YC=Re.JSON.stringify;class gJ{constructor(e,n){this.i=e,this.j=n,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function yJ(){var t=JC;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class wJ{constructor(){this.h=this.g=null}add(e,n){const s=T3.get();s.set(e,n),this.h?this.h.next=s:this.g=s,this.h=s}}var T3=new gJ(()=>new vJ,t=>t.reset());class vJ{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}}function xJ(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function bJ(t){Re.setTimeout(()=>{throw t},0)}let Sp,_p=!1,JC=new wJ,S3=()=>{const t=Re.Promise.resolve(void 0);Sp=()=>{t.then(IJ)}};var IJ=()=>{for(var t;t=yJ();){try{t.h.call(t.g)}catch(n){bJ(n)}var e=T3;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}_p=!1};function Wv(t,e){Dn.call(this),this.h=t||1,this.g=e||Re,this.j=us(this.qb,this),this.l=Date.now()}Ln(Wv,Dn);fe=Wv.prototype;fe.ga=!1;fe.T=null;fe.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Xn(this,"tick"),this.ga&&(ZC(this),this.start()))}};fe.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function ZC(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}fe.N=function(){Wv.$.N.call(this),ZC(this),delete this.g};function eE(t,e,n){if(typeof t=="function")n&&(t=us(t,n));else if(t&&typeof t.handleEvent=="function")t=us(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:Re.setTimeout(t,e||0)}function _3(t){t.g=eE(()=>{t.g=null,t.i&&(t.i=!1,_3(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class TJ extends Ja{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:_3(this)}N(){super.N(),this.g&&(Re.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Cp(t){Ja.call(this),this.h=t,this.g={}}Ln(Cp,Ja);var PD=[];function C3(t,e,n,s){Array.isArray(n)||(n&&(PD[0]=n.toString()),n=PD);for(var r=0;r<n.length;r++){var i=w3(e,n[r],s||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function E3(t){HC(t.g,function(e,n){this.g.hasOwnProperty(n)&&KC(e)},t),t.g={}}Cp.prototype.N=function(){Cp.$.N.call(this),E3(this)};Cp.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function jv(){this.g=!0}jv.prototype.Ea=function(){this.g=!1};function SJ(t,e,n,s,r,i){t.info(function(){if(t.g)if(i)for(var o="",a=i.split("&"),l=0;l<a.length;l++){var u=a[l].split("=");if(1<u.length){var c=u[0];u=u[1];var h=c.split("_");o=2<=h.length&&h[1]=="type"?o+(c+"="+u+"&"):o+(c+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+e+`
`+n+`
`+o})}function _J(t,e,n,s,r,i,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+e+`
`+n+`
`+i+" "+o})}function Cc(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+EJ(t,n)+(s?" "+s:"")})}function CJ(t,e){t.info(function(){return"TIMEOUT: "+e})}jv.prototype.info=function(){};function EJ(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var r=s[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if(i!="noop"&&i!="stop"&&i!="close")for(var o=1;o<r.length;o++)r[o]=""}}}}return YC(n)}catch{return e}}var Ou={},FD=null;function Gv(){return FD=FD||new Dn}Ou.Ta="serverreachability";function k3(t){cs.call(this,Ou.Ta,t)}Ln(k3,cs);function Ep(t){const e=Gv();Xn(e,new k3(e))}Ou.STAT_EVENT="statevent";function N3(t,e){cs.call(this,Ou.STAT_EVENT,t),this.stat=e}Ln(N3,cs);function bs(t){const e=Gv();Xn(e,new N3(e,t))}Ou.Ua="timingevent";function $3(t,e){cs.call(this,Ou.Ua,t),this.size=e}Ln($3,cs);function vm(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return Re.setTimeout(function(){t()},e)}var Hv={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},A3={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function tE(){}tE.prototype.h=null;function LD(t){return t.h||(t.h=t.i())}function R3(){}var xm={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function nE(){cs.call(this,"d")}Ln(nE,cs);function sE(){cs.call(this,"c")}Ln(sE,cs);var dS;function qv(){}Ln(qv,tE);qv.prototype.g=function(){return new XMLHttpRequest};qv.prototype.i=function(){return{}};dS=new qv;function bm(t,e,n,s){this.l=t,this.j=e,this.m=n,this.W=s||1,this.U=new Cp(this),this.P=kJ,t=aS?125:void 0,this.V=new Wv(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new D3}function D3(){this.i=null,this.g="",this.h=!1}var kJ=45e3,O3={},fS={};fe=bm.prototype;fe.setTimeout=function(t){this.P=t};function pS(t,e,n){t.L=1,t.A=Xv(_o(e)),t.u=n,t.S=!0,P3(t,null)}function P3(t,e){t.G=Date.now(),Im(t),t.B=_o(t.A);var n=t.B,s=t.W;Array.isArray(s)||(s=[String(s)]),W3(n.i,"t",s),t.o=0,n=t.l.J,t.h=new D3,t.g=cz(t.l,n?e:null,!t.u),0<t.O&&(t.M=new TJ(us(t.Pa,t,t.g),t.O)),C3(t.U,t.g,"readystatechange",t.nb),e=t.I?g3(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),Ep(),SJ(t.j,t.v,t.B,t.m,t.W,t.u)}fe.nb=function(t){t=t.target;const e=this.M;e&&$i(t)==3?e.l():this.Pa(t)};fe.Pa=function(t){try{if(t==this.g)e:{const c=$i(this.g);var e=this.g.Ia();const h=this.g.da();if(!(3>c)&&(c!=3||aS||this.g&&(this.h.h||this.g.ja()||BD(this.g)))){this.J||c!=4||e==7||(e==8||0>=h?Ep(3):Ep(2)),Kv(this);var n=this.g.da();this.ca=n;t:if(F3(this)){var s=BD(this.g);t="";var r=s.length,i=$i(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){$l(this),qf(this);var o="";break t}this.h.i=new Re.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:i&&e==r-1});s.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,_J(this.j,this.v,this.B,this.m,this.W,c,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ip(a)){var u=a;break t}}u=null}if(n=u)Cc(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,mS(this,n);else{this.i=!1,this.s=3,bs(12),$l(this),qf(this);break e}}this.S?(L3(this,c,o),aS&&this.i&&c==3&&(C3(this.U,this.V,"tick",this.mb),this.V.start())):(Cc(this.j,this.m,o,null),mS(this,o)),c==4&&$l(this),this.i&&!this.J&&(c==4?oz(this.l,this):(this.i=!1,Im(this)))}else XJ(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.s=3,bs(12)):(this.s=0,bs(13)),$l(this),qf(this)}}}catch{}finally{}};function F3(t){return t.g?t.v=="GET"&&t.L!=2&&t.l.Ha:!1}function L3(t,e,n){let s=!0,r;for(;!t.J&&t.o<n.length;)if(r=NJ(t,n),r==fS){e==4&&(t.s=4,bs(14),s=!1),Cc(t.j,t.m,null,"[Incomplete Response]");break}else if(r==O3){t.s=4,bs(15),Cc(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}else Cc(t.j,t.m,r,null),mS(t,r);F3(t)&&t.o!=0&&(t.h.g=t.h.g.slice(t.o),t.o=0),e!=4||n.length!=0||t.h.h||(t.s=1,bs(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,e=t.l,e.g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),uE(e),e.M=!0,bs(11))):(Cc(t.j,t.m,n,"[Invalid Chunked Response]"),$l(t),qf(t))}fe.mb=function(){if(this.g){var t=$i(this.g),e=this.g.ja();this.o<e.length&&(Kv(this),L3(this,t,e),this.i&&t!=4&&Im(this))}};function NJ(t,e){var n=t.o,s=e.indexOf(`
`,n);return s==-1?fS:(n=Number(e.substring(n,s)),isNaN(n)?O3:(s+=1,s+n>e.length?fS:(e=e.slice(s,s+n),t.o=s+n,e)))}fe.cancel=function(){this.J=!0,$l(this)};function Im(t){t.Y=Date.now()+t.P,M3(t,t.P)}function M3(t,e){if(t.C!=null)throw Error("WatchDog timer not null");t.C=vm(us(t.lb,t),e)}function Kv(t){t.C&&(Re.clearTimeout(t.C),t.C=null)}fe.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(CJ(this.j,this.B),this.L!=2&&(Ep(),bs(17)),$l(this),this.s=2,qf(this)):M3(this,this.Y-t)};function qf(t){t.l.H==0||t.J||oz(t.l,t)}function $l(t){Kv(t);var e=t.M;e&&typeof e.sa=="function"&&e.sa(),t.M=null,ZC(t.V),E3(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function mS(t,e){try{var n=t.l;if(n.H!=0&&(n.g==t||gS(n.i,t))){if(!t.K&&gS(n.i,t)&&n.H==3){try{var s=n.Ja.g.parse(e)}catch{s=null}if(Array.isArray(s)&&s.length==3){var r=s;if(r[0]==0){e:if(!n.u){if(n.g)if(n.g.G+3e3<t.G)Sw(n),Zv(n);else break e;lE(n),bs(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&n.A==0&&!n.v&&(n.v=vm(us(n.ib,n),6e3));if(1>=H3(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else Al(n,11)}else if((t.K||n.g==t)&&Sw(n),!Ip(e))for(r=n.Ja.g.parse(e),e=0;e<r.length;e++){let u=r[e];if(n.V=u[0],u=u[1],n.H==2)if(u[0]=="c"){n.K=u[1],n.pa=u[2];const c=u[3];c!=null&&(n.ra=c,n.l.info("VER="+n.ra));const h=u[4];h!=null&&(n.Ga=h,n.l.info("SVER="+n.Ga));const d=u[5];d!=null&&typeof d=="number"&&0<d&&(s=1.5*d,n.L=s,n.l.info("backChannelRequestTimeoutMs_="+s)),s=n;const f=t.g;if(f){const p=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var i=s.i;i.g||p.indexOf("spdy")==-1&&p.indexOf("quic")==-1&&p.indexOf("h2")==-1||(i.j=i.l,i.g=new Set,i.h&&(rE(i,i.h),i.h=null))}if(s.F){const m=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;m&&(s.Da=m,It(s.I,s.F,m))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms")),s=n;var o=t;if(s.wa=uz(s,s.J?s.pa:null,s.Y),o.K){q3(s.i,o);var a=o,l=s.L;l&&a.setTimeout(l),a.C&&(Kv(a),Im(a)),s.g=o}else rz(s);0<n.j.length&&ex(n)}else u[0]!="stop"&&u[0]!="close"||Al(n,7);else n.H==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?Al(n,7):aE(n):u[0]!="noop"&&n.h&&n.h.Aa(u),n.A=0)}}Ep(4)}catch{}}function $J(t){if(t.Z&&typeof t.Z=="function")return t.Z();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(Vv(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}e=[],n=0;for(s in t)e[n++]=t[s];return e}function AJ(t){if(t.ta&&typeof t.ta=="function")return t.ta();if(!t.Z||typeof t.Z!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(Vv(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const s in t)e[n++]=s;return e}}}function V3(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(Vv(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=AJ(t),s=$J(t),r=s.length,i=0;i<r;i++)e.call(void 0,s[i],n&&n[i],t)}var z3=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function RJ(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),r=null;if(0<=s){var i=t[n].substring(0,s);r=t[n].substring(s+1)}else i=t[n];e(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function Ul(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Ul){this.h=t.h,Iw(this,t.j),this.s=t.s,this.g=t.g,Tw(this,t.m),this.l=t.l;var e=t.i,n=new kp;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),MD(this,n),this.o=t.o}else t&&(e=String(t).match(z3))?(this.h=!1,Iw(this,e[1]||"",!0),this.s=bf(e[2]||""),this.g=bf(e[3]||"",!0),Tw(this,e[4]),this.l=bf(e[5]||"",!0),MD(this,e[6]||"",!0),this.o=bf(e[7]||"")):(this.h=!1,this.i=new kp(null,this.h))}Ul.prototype.toString=function(){var t=[],e=this.j;e&&t.push(If(e,VD,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(If(e,VD,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(If(n,n.charAt(0)=="/"?PJ:OJ,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",If(n,LJ)),t.join("")};function _o(t){return new Ul(t)}function Iw(t,e,n){t.j=n?bf(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Tw(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function MD(t,e,n){e instanceof kp?(t.i=e,MJ(t.i,t.h)):(n||(e=If(e,FJ)),t.i=new kp(e,t.h))}function It(t,e,n){t.i.set(e,n)}function Xv(t){return It(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function bf(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function If(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,DJ),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function DJ(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var VD=/[#\/\?@]/g,OJ=/[#\?:]/g,PJ=/[#\?]/g,FJ=/[#\?@]/g,LJ=/#/g;function kp(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Za(t){t.g||(t.g=new Map,t.h=0,t.i&&RJ(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}fe=kp.prototype;fe.add=function(t,e){Za(this),this.i=null,t=Ch(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function B3(t,e){Za(t),e=Ch(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function U3(t,e){return Za(t),e=Ch(t,e),t.g.has(e)}fe.forEach=function(t,e){Za(this),this.g.forEach(function(n,s){n.forEach(function(r){t.call(e,r,s,this)},this)},this)};fe.ta=function(){Za(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let s=0;s<e.length;s++){const r=t[s];for(let i=0;i<r.length;i++)n.push(e[s])}return n};fe.Z=function(t){Za(this);let e=[];if(typeof t=="string")U3(this,t)&&(e=e.concat(this.g.get(Ch(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};fe.set=function(t,e){return Za(this),this.i=null,t=Ch(this,t),U3(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};fe.get=function(t,e){return t?(t=this.Z(t),0<t.length?String(t[0]):e):e};function W3(t,e,n){B3(t,e),0<n.length&&(t.i=null,t.g.set(Ch(t,e),jC(n)),t.h+=n.length)}fe.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var s=e[n];const i=encodeURIComponent(String(s)),o=this.Z(s);for(s=0;s<o.length;s++){var r=i;o[s]!==""&&(r+="="+encodeURIComponent(String(o[s]))),t.push(r)}}return this.i=t.join("&")};function Ch(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function MJ(t,e){e&&!t.j&&(Za(t),t.i=null,t.g.forEach(function(n,s){var r=s.toLowerCase();s!=r&&(B3(this,s),W3(this,r,n))},t)),t.j=e}var VJ=class{constructor(t,e){this.g=t,this.map=e}};function j3(t){this.l=t||zJ,Re.PerformanceNavigationTiming?(t=Re.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(Re.g&&Re.g.Ka&&Re.g.Ka()&&Re.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var zJ=10;function G3(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function H3(t){return t.h?1:t.g?t.g.size:0}function gS(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function rE(t,e){t.g?t.g.add(e):t.h=e}function q3(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}j3.prototype.cancel=function(){if(this.i=K3(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function K3(t){if(t.h!=null)return t.i.concat(t.h.F);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return jC(t.i)}var BJ=class{stringify(t){return Re.JSON.stringify(t,void 0)}parse(t){return Re.JSON.parse(t,void 0)}};function UJ(){this.g=new BJ}function WJ(t,e,n){const s=n||"";try{V3(t,function(r,i){let o=r;ym(r)&&(o=YC(r)),e.push(s+i+"="+encodeURIComponent(o))})}catch(r){throw e.push(s+"type="+encodeURIComponent("_badmap")),r}}function jJ(t,e){const n=new jv;if(Re.Image){const s=new Image;s.onload=jy(Hy,n,s,"TestLoadImage: loaded",!0,e),s.onerror=jy(Hy,n,s,"TestLoadImage: error",!1,e),s.onabort=jy(Hy,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=jy(Hy,n,s,"TestLoadImage: timeout",!1,e),Re.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}function Hy(t,e,n,s,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(s)}catch{}}function Qv(t){this.l=t.ec||null,this.j=t.ob||!1}Ln(Qv,tE);Qv.prototype.g=function(){return new Yv(this.l,this.j)};Qv.prototype.i=function(t){return function(){return t}}({});function Yv(t,e){Dn.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=iE,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ln(Yv,Dn);var iE=0;fe=Yv.prototype;fe.open=function(t,e){if(this.readyState!=iE)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Np(this)};fe.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||Re).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};fe.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Tm(this)),this.readyState=iE};fe.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Np(this)),this.g&&(this.readyState=3,Np(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Re.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;X3(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))};function X3(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}fe.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Tm(this):Np(this),this.readyState==3&&X3(this)}};fe.Za=function(t){this.g&&(this.response=this.responseText=t,Tm(this))};fe.Ya=function(t){this.g&&(this.response=t,Tm(this))};fe.ka=function(){this.g&&Tm(this)};function Tm(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Np(t)}fe.setRequestHeader=function(t,e){this.v.append(t,e)};fe.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};fe.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function Np(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(Yv.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var GJ=Re.JSON.parse;function Wt(t){Dn.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Q3,this.L=this.M=!1}Ln(Wt,Dn);var Q3="",HJ=/^https?$/i,qJ=["POST","PUT"];fe=Wt.prototype;fe.Oa=function(t){this.M=t};fe.ha=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():dS.g(),this.C=this.u?LD(this.u):LD(dS),this.g.onreadystatechange=us(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(i){zD(this,i);return}if(t=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else if(typeof s.keys=="function"&&typeof s.get=="function")for(const i of s.keys())n.set(i,s.get(i));else throw Error("Unknown input type for opt_headers: "+String(s));s=Array.from(n.keys()).find(i=>i.toLowerCase()=="content-type"),r=Re.FormData&&t instanceof Re.FormData,!(0<=d3(qJ,e))||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of n)this.g.setRequestHeader(i,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Z3(this),0<this.B&&((this.L=KJ(this.g))?(this.g.timeout=this.B,this.g.ontimeout=us(this.ua,this)):this.A=eE(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(i){zD(this,i)}};function KJ(t){return Yc&&typeof t.timeout=="number"&&t.ontimeout!==void 0}fe.ua=function(){typeof WC<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Xn(this,"timeout"),this.abort(8))};function zD(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Y3(t),Jv(t)}function Y3(t){t.F||(t.F=!0,Xn(t,"complete"),Xn(t,"error"))}fe.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Xn(this,"complete"),Xn(this,"abort"),Jv(this))};fe.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Jv(this,!0)),Wt.$.N.call(this)};fe.La=function(){this.s||(this.G||this.v||this.l?J3(this):this.kb())};fe.kb=function(){J3(this)};function J3(t){if(t.h&&typeof WC<"u"&&(!t.C[1]||$i(t)!=4||t.da()!=2)){if(t.v&&$i(t)==4)eE(t.La,0,t);else if(Xn(t,"readystatechange"),$i(t)==4){t.h=!1;try{const o=t.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var s;if(s=o===0){var r=String(t.I).match(z3)[1]||null;!r&&Re.self&&Re.self.location&&(r=Re.self.location.protocol.slice(0,-1)),s=!HJ.test(r?r.toLowerCase():"")}n=s}if(n)Xn(t,"complete"),Xn(t,"success");else{t.m=6;try{var i=2<$i(t)?t.g.statusText:""}catch{i=""}t.j=i+" ["+t.da()+"]",Y3(t)}}finally{Jv(t)}}}}function Jv(t,e){if(t.g){Z3(t);const n=t.g,s=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Xn(t,"ready");try{n.onreadystatechange=s}catch{}}}function Z3(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(Re.clearTimeout(t.A),t.A=null)}fe.isActive=function(){return!!this.g};function $i(t){return t.g?t.g.readyState:0}fe.da=function(){try{return 2<$i(this)?this.g.status:-1}catch{return-1}};fe.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};fe.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),GJ(e)}};function BD(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Q3:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function XJ(t){const e={};t=(t.g&&2<=$i(t)&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let s=0;s<t.length;s++){if(Ip(t[s]))continue;var n=xJ(t[s]);const r=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();const i=e[r]||[];e[r]=i,i.push(n)}fJ(e,function(s){return s.join(", ")})}fe.Ia=function(){return this.m};fe.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function ez(t){let e="";return HC(t,function(n,s){e+=s,e+=":",e+=n,e+=`\r
`}),e}function oE(t,e,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=ez(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):It(t,e,n))}function af(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function tz(t){this.Ga=0,this.j=[],this.l=new jv,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=af("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=af("baseRetryDelayMs",5e3,t),this.hb=af("retryDelaySeedMs",1e4,t),this.eb=af("forwardChannelMaxRetries",2,t),this.xa=af("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new j3(t&&t.concurrentRequestLimit),this.Ja=new UJ,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}fe=tz.prototype;fe.ra=8;fe.H=1;function aE(t){if(nz(t),t.H==3){var e=t.W++,n=_o(t.I);if(It(n,"SID",t.K),It(n,"RID",e),It(n,"TYPE","terminate"),Sm(t,n),e=new bm(t,t.l,e),e.L=2,e.A=Xv(_o(n)),n=!1,Re.navigator&&Re.navigator.sendBeacon)try{n=Re.navigator.sendBeacon(e.A.toString(),"")}catch{}!n&&Re.Image&&(new Image().src=e.A,n=!0),n||(e.g=cz(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Im(e)}lz(t)}function Zv(t){t.g&&(uE(t),t.g.cancel(),t.g=null)}function nz(t){Zv(t),t.u&&(Re.clearTimeout(t.u),t.u=null),Sw(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&Re.clearTimeout(t.m),t.m=null)}function ex(t){if(!G3(t.i)&&!t.m){t.m=!0;var e=t.Na;Sp||S3(),_p||(Sp(),_p=!0),JC.add(e,t),t.C=0}}function QJ(t,e){return H3(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.j=e.F.concat(t.j),!0):t.H==1||t.H==2||t.C>=(t.cb?0:t.eb)?!1:(t.m=vm(us(t.Na,t,e),az(t,t.C)),t.C++,!0)}fe.Na=function(t){if(this.m)if(this.m=null,this.H==1){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const r=new bm(this,this.l,t);let i=this.s;if(this.U&&(i?(i=g3(i),y3(i,this.U)):i=this.U),this.o!==null||this.O||(r.I=i,i=null),this.P)e:{for(var e=0,n=0;n<this.j.length;n++){t:{var s=this.j[n];if("__data__"in s.map&&(s=s.map.__data__,typeof s=="string")){s=s.length;break t}s=void 0}if(s===void 0)break;if(e+=s,4096<e){e=n;break e}if(e===4096||n===this.j.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=sz(this,r,e),n=_o(this.I),It(n,"RID",t),It(n,"CVER",22),this.F&&It(n,"X-HTTP-Session-Id",this.F),Sm(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(ez(i)))+"&"+e:this.o&&oE(n,this.o,i)),rE(this.i,r),this.bb&&It(n,"TYPE","init"),this.P?(It(n,"$req",e),It(n,"SID","null"),r.aa=!0,pS(r,n,null)):pS(r,n,e),this.H=2}}else this.H==3&&(t?UD(this,t):this.j.length==0||G3(this.i)||UD(this))};function UD(t,e){var n;e?n=e.m:n=t.W++;const s=_o(t.I);It(s,"SID",t.K),It(s,"RID",n),It(s,"AID",t.V),Sm(t,s),t.o&&t.s&&oE(s,t.o,t.s),n=new bm(t,t.l,n,t.C+1),t.o===null&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=sz(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),rE(t.i,n),pS(n,s,e)}function Sm(t,e){t.na&&HC(t.na,function(n,s){It(e,s,n)}),t.h&&V3({},function(n,s){It(e,s,n)})}function sz(t,e,n){n=Math.min(t.j.length,n);var s=t.h?us(t.h.Va,t.h,t):null;e:{var r=t.j;let i=-1;for(;;){const o=["count="+n];i==-1?0<n?(i=r[0].g,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let l=0;l<n;l++){let u=r[l].g;const c=r[l].map;if(u-=i,0>u)i=Math.max(0,r[l].g-100),a=!1;else try{WJ(c,o,"req"+u+"_")}catch{s&&s(c)}}if(a){s=o.join("&");break e}}}return t=t.j.splice(0,n),e.F=t,s}function rz(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Sp||S3(),_p||(Sp(),_p=!0),JC.add(e,t),t.A=0}}function lE(t){return t.g||t.u||3<=t.A?!1:(t.ba++,t.u=vm(us(t.Ma,t),az(t,t.A)),t.A++,!0)}fe.Ma=function(){if(this.u=null,iz(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=vm(us(this.jb,this),t)}};fe.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,bs(10),Zv(this),iz(this))};function uE(t){t.B!=null&&(Re.clearTimeout(t.B),t.B=null)}function iz(t){t.g=new bm(t,t.l,"rpc",t.ba),t.o===null&&(t.g.I=t.s),t.g.O=0;var e=_o(t.wa);It(e,"RID","rpc"),It(e,"SID",t.K),It(e,"AID",t.V),It(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&It(e,"TO",t.qa),It(e,"TYPE","xmlhttp"),Sm(t,e),t.o&&t.s&&oE(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=Xv(_o(e)),n.u=null,n.S=!0,P3(n,t)}fe.ib=function(){this.v!=null&&(this.v=null,Zv(this),lE(this),bs(19))};function Sw(t){t.v!=null&&(Re.clearTimeout(t.v),t.v=null)}function oz(t,e){var n=null;if(t.g==e){Sw(t),uE(t),t.g=null;var s=2}else if(gS(t.i,e))n=e.F,q3(t.i,e),s=1;else return;if(t.H!=0){if(e.i)if(s==1){n=e.u?e.u.length:0,e=Date.now()-e.G;var r=t.C;s=Gv(),Xn(s,new $3(s,n)),ex(t)}else rz(t);else if(r=e.s,r==3||r==0&&0<e.ca||!(s==1&&QJ(t,e)||s==2&&lE(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),r){case 1:Al(t,5);break;case 4:Al(t,10);break;case 3:Al(t,6);break;default:Al(t,2)}}}function az(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Al(t,e){if(t.l.info("Error code "+e),e==2){var n=null;t.h&&(n=null);var s=us(t.pb,t);n||(n=new Ul("//www.google.com/images/cleardot.gif"),Re.location&&Re.location.protocol=="http"||Iw(n,"https"),Xv(n)),jJ(n.toString(),s)}else bs(2);t.H=0,t.h&&t.h.za(e),lz(t),nz(t)}fe.pb=function(t){t?(this.l.info("Successfully pinged google.com"),bs(2)):(this.l.info("Failed to ping google.com"),bs(1))};function lz(t){if(t.H=0,t.ma=[],t.h){const e=K3(t.i);(e.length!=0||t.j.length!=0)&&(RD(t.ma,e),RD(t.ma,t.j),t.i.i.length=0,jC(t.j),t.j.length=0),t.h.ya()}}function uz(t,e,n){var s=n instanceof Ul?_o(n):new Ul(n);if(s.g!="")e&&(s.g=e+"."+s.g),Tw(s,s.m);else{var r=Re.location;s=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var i=new Ul(null);s&&Iw(i,s),e&&(i.g=e),r&&Tw(i,r),n&&(i.l=n),s=i}return n=t.F,e=t.Da,n&&e&&It(s,n,e),It(s,"VER",t.ra),Sm(t,s),s}function cz(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=t.Ha&&!t.va?new Wt(new Qv({ob:n})):new Wt(t.va),e.Oa(t.J),e}fe.isActive=function(){return!!this.h&&this.h.isActive(this)};function hz(){}fe=hz.prototype;fe.Ba=function(){};fe.Aa=function(){};fe.za=function(){};fe.ya=function(){};fe.isActive=function(){return!0};fe.Va=function(){};function _w(){if(Yc&&!(10<=Number(uJ)))throw Error("Environmental error: no available transport.")}_w.prototype.g=function(t,e){return new wr(t,e)};function wr(t,e){Dn.call(this),this.g=new tz(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Ip(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ip(e)&&(this.g.F=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new Eh(this)}Ln(wr,Dn);wr.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;bs(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=uz(t,null,t.Y),ex(t)};wr.prototype.close=function(){aE(this.g)};wr.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=YC(t),t=n);e.j.push(new VJ(e.fb++,t)),e.H==3&&ex(e)};wr.prototype.N=function(){this.g.h=null,delete this.j,aE(this.g),delete this.g,wr.$.N.call(this)};function dz(t){nE.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){e:{for(const n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}Ln(dz,nE);function fz(){sE.call(this),this.status=1}Ln(fz,sE);function Eh(t){this.g=t}Ln(Eh,hz);Eh.prototype.Ba=function(){Xn(this.g,"a")};Eh.prototype.Aa=function(t){Xn(this.g,new dz(t))};Eh.prototype.za=function(t){Xn(this.g,new fz)};Eh.prototype.ya=function(){Xn(this.g,"b")};function YJ(){this.blockSize=-1}function di(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Ln(di,YJ);di.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function OI(t,e,n){n||(n=0);var s=Array(16);if(typeof e=="string")for(var r=0;16>r;++r)s[r]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(r=0;16>r;++r)s[r]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],r=t.g[2];var i=t.g[3],o=e+(i^n&(r^i))+s[0]+3614090360&4294967295;e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[1]+3905402710&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[2]+606105819&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[3]+3250441966&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(i^n&(r^i))+s[4]+4118548399&4294967295,e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[5]+1200080426&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[6]+2821735955&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[7]+4249261313&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(i^n&(r^i))+s[8]+1770035416&4294967295,e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[9]+2336552879&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[10]+4294925233&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[11]+2304563134&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(i^n&(r^i))+s[12]+1804603682&4294967295,e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[13]+4254626195&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[14]+2792965006&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[15]+1236535329&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(r^i&(n^r))+s[1]+4129170786&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[6]+3225465664&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[11]+643717713&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[0]+3921069994&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(r^i&(n^r))+s[5]+3593408605&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[10]+38016083&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[15]+3634488961&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[4]+3889429448&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(r^i&(n^r))+s[9]+568446438&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[14]+3275163606&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[3]+4107603335&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[8]+1163531501&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(r^i&(n^r))+s[13]+2850285829&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[2]+4243563512&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[7]+1735328473&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[12]+2368359562&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(n^r^i)+s[5]+4294588738&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[8]+2272392833&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[11]+1839030562&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[14]+4259657740&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(n^r^i)+s[1]+2763975236&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[4]+1272893353&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[7]+4139469664&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[10]+3200236656&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(n^r^i)+s[13]+681279174&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[0]+3936430074&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[3]+3572445317&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[6]+76029189&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(n^r^i)+s[9]+3654602809&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[12]+3873151461&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[15]+530742520&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[2]+3299628645&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(r^(n|~i))+s[0]+4096336452&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[7]+1126891415&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[14]+2878612391&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[5]+4237533241&4294967295,n=r+(o<<21&4294967295|o>>>11),o=e+(r^(n|~i))+s[12]+1700485571&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[3]+2399980690&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[10]+4293915773&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[1]+2240044497&4294967295,n=r+(o<<21&4294967295|o>>>11),o=e+(r^(n|~i))+s[8]+1873313359&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[15]+4264355552&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[6]+2734768916&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[13]+1309151649&4294967295,n=r+(o<<21&4294967295|o>>>11),o=e+(r^(n|~i))+s[4]+4149444226&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[11]+3174756917&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[2]+718787259&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+i&4294967295}di.prototype.j=function(t,e){e===void 0&&(e=t.length);for(var n=e-this.blockSize,s=this.m,r=this.h,i=0;i<e;){if(r==0)for(;i<=n;)OI(this,t,i),i+=this.blockSize;if(typeof t=="string"){for(;i<e;)if(s[r++]=t.charCodeAt(i++),r==this.blockSize){OI(this,s),r=0;break}}else for(;i<e;)if(s[r++]=t[i++],r==this.blockSize){OI(this,s),r=0;break}}this.h=r,this.i+=e};di.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=n&255,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var s=0;32>s;s+=8)t[n++]=this.g[e]>>>s&255;return t};function lt(t,e){this.h=e;for(var n=[],s=!0,r=t.length-1;0<=r;r--){var i=t[r]|0;s&&i==e||(n[r]=i,s=!1)}this.g=n}var JJ={};function cE(t){return-128<=t&&128>t?oJ(t,function(e){return new lt([e|0],0>e?-1:0)}):new lt([t|0],0>t?-1:0)}function Ai(t){if(isNaN(t)||!isFinite(t))return Lc;if(0>t)return Hn(Ai(-t));for(var e=[],n=1,s=0;t>=n;s++)e[s]=t/n|0,n*=yS;return new lt(e,0)}function pz(t,e){if(t.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(t.charAt(0)=="-")return Hn(pz(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=Ai(Math.pow(e,8)),s=Lc,r=0;r<t.length;r+=8){var i=Math.min(8,t.length-r),o=parseInt(t.substring(r,r+i),e);8>i?(i=Ai(Math.pow(e,i)),s=s.R(i).add(Ai(o))):(s=s.R(n),s=s.add(Ai(o)))}return s}var yS=4294967296,Lc=cE(0),wS=cE(1),WD=cE(16777216);fe=lt.prototype;fe.ea=function(){if(Nr(this))return-Hn(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var s=this.D(n);t+=(0<=s?s:yS+s)*e,e*=yS}return t};fe.toString=function(t){if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(go(this))return"0";if(Nr(this))return"-"+Hn(this).toString(t);for(var e=Ai(Math.pow(t,6)),n=this,s="";;){var r=Ew(n,e).g;n=Cw(n,r.R(e));var i=((0<n.g.length?n.g[0]:n.h)>>>0).toString(t);if(n=r,go(n))return i+s;for(;6>i.length;)i="0"+i;s=i+s}};fe.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h};function go(t){if(t.h!=0)return!1;for(var e=0;e<t.g.length;e++)if(t.g[e]!=0)return!1;return!0}function Nr(t){return t.h==-1}fe.X=function(t){return t=Cw(this,t),Nr(t)?-1:go(t)?0:1};function Hn(t){for(var e=t.g.length,n=[],s=0;s<e;s++)n[s]=~t.g[s];return new lt(n,~t.h).add(wS)}fe.abs=function(){return Nr(this)?Hn(this):this};fe.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0,r=0;r<=e;r++){var i=s+(this.D(r)&65535)+(t.D(r)&65535),o=(i>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);s=o>>>16,i&=65535,o&=65535,n[r]=o<<16|i}return new lt(n,n[n.length-1]&-2147483648?-1:0)};function Cw(t,e){return t.add(Hn(e))}fe.R=function(t){if(go(this)||go(t))return Lc;if(Nr(this))return Nr(t)?Hn(this).R(Hn(t)):Hn(Hn(this).R(t));if(Nr(t))return Hn(this.R(Hn(t)));if(0>this.X(WD)&&0>t.X(WD))return Ai(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],s=0;s<2*e;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var r=0;r<t.g.length;r++){var i=this.D(s)>>>16,o=this.D(s)&65535,a=t.D(r)>>>16,l=t.D(r)&65535;n[2*s+2*r]+=o*l,qy(n,2*s+2*r),n[2*s+2*r+1]+=i*l,qy(n,2*s+2*r+1),n[2*s+2*r+1]+=o*a,qy(n,2*s+2*r+1),n[2*s+2*r+2]+=i*a,qy(n,2*s+2*r+2)}for(s=0;s<e;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=e;s<2*e;s++)n[s]=0;return new lt(n,0)};function qy(t,e){for(;(t[e]&65535)!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function lf(t,e){this.g=t,this.h=e}function Ew(t,e){if(go(e))throw Error("division by zero");if(go(t))return new lf(Lc,Lc);if(Nr(t))return e=Ew(Hn(t),e),new lf(Hn(e.g),Hn(e.h));if(Nr(e))return e=Ew(t,Hn(e)),new lf(Hn(e.g),e.h);if(30<t.g.length){if(Nr(t)||Nr(e))throw Error("slowDivide_ only works with positive integers.");for(var n=wS,s=e;0>=s.X(t);)n=jD(n),s=jD(s);var r=ic(n,1),i=ic(s,1);for(s=ic(s,2),n=ic(n,2);!go(s);){var o=i.add(s);0>=o.X(t)&&(r=r.add(n),i=o),s=ic(s,1),n=ic(n,1)}return e=Cw(t,r.R(e)),new lf(r,e)}for(r=Lc;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),s=Math.ceil(Math.log(n)/Math.LN2),s=48>=s?1:Math.pow(2,s-48),i=Ai(n),o=i.R(e);Nr(o)||0<o.X(t);)n-=s,i=Ai(n),o=i.R(e);go(i)&&(i=wS),r=r.add(i),t=Cw(t,o)}return new lf(r,t)}fe.gb=function(t){return Ew(this,t).h};fe.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)&t.D(s);return new lt(n,this.h&t.h)};fe.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)|t.D(s);return new lt(n,this.h|t.h)};fe.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)^t.D(s);return new lt(n,this.h^t.h)};function jD(t){for(var e=t.g.length+1,n=[],s=0;s<e;s++)n[s]=t.D(s)<<1|t.D(s-1)>>>31;return new lt(n,t.h)}function ic(t,e){var n=e>>5;e%=32;for(var s=t.g.length-n,r=[],i=0;i<s;i++)r[i]=0<e?t.D(i+n)>>>e|t.D(i+n+1)<<32-e:t.D(i+n);return new lt(r,t.h)}_w.prototype.createWebChannel=_w.prototype.g;wr.prototype.send=wr.prototype.u;wr.prototype.open=wr.prototype.m;wr.prototype.close=wr.prototype.close;Hv.NO_ERROR=0;Hv.TIMEOUT=8;Hv.HTTP_ERROR=6;A3.COMPLETE="complete";R3.EventType=xm;xm.OPEN="a";xm.CLOSE="b";xm.ERROR="c";xm.MESSAGE="d";Dn.prototype.listen=Dn.prototype.O;Wt.prototype.listenOnce=Wt.prototype.P;Wt.prototype.getLastError=Wt.prototype.Sa;Wt.prototype.getLastErrorCode=Wt.prototype.Ia;Wt.prototype.getStatus=Wt.prototype.da;Wt.prototype.getResponseJson=Wt.prototype.Wa;Wt.prototype.getResponseText=Wt.prototype.ja;Wt.prototype.send=Wt.prototype.ha;Wt.prototype.setWithCredentials=Wt.prototype.Oa;di.prototype.digest=di.prototype.l;di.prototype.reset=di.prototype.reset;di.prototype.update=di.prototype.j;lt.prototype.add=lt.prototype.add;lt.prototype.multiply=lt.prototype.R;lt.prototype.modulo=lt.prototype.gb;lt.prototype.compare=lt.prototype.X;lt.prototype.toNumber=lt.prototype.ea;lt.prototype.toString=lt.prototype.toString;lt.prototype.getBits=lt.prototype.D;lt.fromNumber=Ai;lt.fromString=pz;var ZJ=function(){return new _w},eZ=function(){return Gv()},PI=Hv,tZ=A3,nZ=Ou,GD={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Ky=R3,sZ=Wt,rZ=di,Mc=lt;const HD="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ns{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ns.UNAUTHENTICATED=new ns(null),ns.GOOGLE_CREDENTIALS=new ns("google-credentials-uid"),ns.FIRST_PARTY=new ns("first-party-uid"),ns.MOCK_USER=new ns("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kh="10.8.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iu=new $v("@firebase/firestore");function uf(){return iu.logLevel}function de(t,...e){if(iu.logLevel<=Xe.DEBUG){const n=e.map(hE);iu.debug(`Firestore (${kh}): ${t}`,...n)}}function Hi(t,...e){if(iu.logLevel<=Xe.ERROR){const n=e.map(hE);iu.error(`Firestore (${kh}): ${t}`,...n)}}function Jc(t,...e){if(iu.logLevel<=Xe.WARN){const n=e.map(hE);iu.warn(`Firestore (${kh}): ${t}`,...n)}}function hE(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(t="Unexpected state"){const e=`FIRESTORE (${kh}) INTERNAL ASSERTION FAILED: `+t;throw Hi(e),new Error(e)}function yt(t,e){t||Ne()}function Me(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class me extends Br{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mz{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class iZ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(ns.UNAUTHENTICATED))}shutdown(){}}class oZ{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class aZ{constructor(e){this.t=e,this.currentUser=ns.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let s=this.i;const r=l=>this.i!==s?(s=this.i,n(l)):Promise.resolve();let i=new wo;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new wo,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},a=l=>{de("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(de("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new wo)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(s=>this.i!==e?(de("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(yt(typeof s.accessToken=="string"),new mz(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return yt(e===null||typeof e=="string"),new ns(e)}}class lZ{constructor(e,n,s){this.l=e,this.h=n,this.P=s,this.type="FirstParty",this.user=ns.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class uZ{constructor(e,n,s){this.l=e,this.h=n,this.P=s}getToken(){return Promise.resolve(new lZ(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(ns.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class cZ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class hZ{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){const s=i=>{i.error!=null&&de("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,de("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};const r=i=>{de("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?r(i):de("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(yt(typeof n.token=="string"),this.R=n.token,new cZ(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dZ(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let s=0;s<t;s++)n[s]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gz{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let s="";for(;s.length<20;){const r=dZ(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<n&&(s+=e.charAt(r[i]%e.length))}return s}}function tt(t,e){return t<e?-1:t>e?1:0}function Zc(t,e,n){return t.length===e.length&&t.every((s,r)=>n(s,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new me(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new me(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new me(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new me(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return yn.fromMillis(Date.now())}static fromDate(e){return yn.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*n));return new yn(n,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tt(this.nanoseconds,e.nanoseconds):tt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{constructor(e){this.timestamp=e}static fromTimestamp(e){return new De(e)}static min(){return new De(new yn(0,0))}static max(){return new De(new yn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(e,n,s){n===void 0?n=0:n>e.length&&Ne(),s===void 0?s=e.length-n:s>e.length-n&&Ne(),this.segments=e,this.offset=n,this.len=s}get length(){return this.len}isEqual(e){return $p.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof $p?e.forEach(s=>{n.push(s)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,s=this.limit();n<s;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const s=Math.min(e.length,n.length);for(let r=0;r<s;r++){const i=e.get(r),o=n.get(r);if(i<o)return-1;if(i>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class Tt extends $p{construct(e,n,s){return new Tt(e,n,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const s of e){if(s.indexOf("//")>=0)throw new me(Q.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);n.push(...s.split("/").filter(r=>r.length>0))}return new Tt(n)}static emptyPath(){return new Tt([])}}const fZ=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qn extends $p{construct(e,n,s){return new qn(e,n,s)}static isValidIdentifier(e){return fZ.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),qn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new qn(["__name__"])}static fromServerFormat(e){const n=[];let s="",r=0;const i=()=>{if(s.length===0)throw new me(Q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new me(Q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new me(Q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new me(Q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new qn(n)}static emptyPath(){return new qn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e){this.path=e}static fromPath(e){return new Se(Tt.fromString(e))}static fromName(e){return new Se(Tt.fromString(e).popFirst(5))}static empty(){return new Se(Tt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Tt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Tt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Se(new Tt(e.slice()))}}function pZ(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,r=De.fromTimestamp(s===1e9?new yn(n+1,0):new yn(n,s));return new Oa(r,Se.empty(),e)}function mZ(t){return new Oa(t.readTime,t.key,-1)}class Oa{constructor(e,n,s){this.readTime=e,this.documentKey=n,this.largestBatchId=s}static min(){return new Oa(De.min(),Se.empty(),-1)}static max(){return new Oa(De.max(),Se.empty(),-1)}}function gZ(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Se.comparator(t.documentKey,e.documentKey),n!==0?n:tt(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yZ="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class wZ{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _m(t){if(t.code!==Q.FAILED_PRECONDITION||t.message!==yZ)throw t;de("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ne(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new J((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(n,i).next(s,r)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof J?n:J.resolve(n)}catch(n){return J.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):J.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):J.reject(n)}static resolve(e){return new J((n,s)=>{n(e)})}static reject(e){return new J((n,s)=>{s(e)})}static waitFor(e){return new J((n,s)=>{let r=0,i=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++i,o&&i===r&&n()},l=>s(l))}),o=!0,i===r&&n()})}static or(e){let n=J.resolve(!1);for(const s of e)n=n.next(r=>r?J.resolve(r):s());return n}static forEach(e,n){const s=[];return e.forEach((r,i)=>{s.push(n.call(this,r,i))}),this.waitFor(s)}static mapArray(e,n){return new J((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;n(e[u]).next(c=>{o[u]=c,++a,a===i&&s(o)},c=>r(c))}})}static doWhile(e,n){return new J((s,r)=>{const i=()=>{e()===!0?n().next(()=>{i()},r):s()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.V=new wo,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{n.error?this.V.reject(new Kf(e,n.error)):this.V.resolve()},this.transaction.onerror=s=>{const r=fE(s.target.error);this.V.reject(new Kf(e,r))}}static open(e,n,s,r){try{return new dE(n,e.transaction(r,s))}catch(i){throw new Kf(n,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(de("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new xZ(n)}}class Rl{constructor(e,n,s){this.name=e,this.version=n,this.p=s,Rl.S(hn())===12.2&&Hi("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return de("SimpleDb","Removing database:",e),xl(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!CC())return!1;if(Rl.C())return!0;const e=hn(),n=Rl.S(e),s=0<n&&n<10,r=Rl.v(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||i)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,n){return e.store(n)}static S(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(s)}static v(e){const n=e.match(/Android ([\d.]+)/i),s=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(s)}async O(e){return this.db||(de("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,s)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=i=>{const o=i.target.result;n(o)},r.onblocked=()=>{s(new Kf(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=i=>{const o=i.target.error;o.name==="VersionError"?s(new me(Q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?s(new me(Q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):s(new Kf(e,o))},r.onupgradeneeded=i=>{de("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.N(o,r.transaction,i.oldVersion,this.version).next(()=>{de("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=n=>this.B(n)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,s,r){const i=n==="readonly";let o=0;for(;;){++o;try{this.db=await this.O(e);const a=dE.open(this.db,e,i?"readonly":"readwrite",s),l=r(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),J.reject(u))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(de("SimpleDb","Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}class vZ{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return xl(this.k.delete())}}class Kf extends me{constructor(e,n){super(Q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function Cm(t){return t.name==="IndexedDbTransactionError"}class xZ{constructor(e){this.store=e}put(e,n){let s;return n!==void 0?(de("SimpleDb","PUT",this.store.name,e,n),s=this.store.put(n,e)):(de("SimpleDb","PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),xl(s)}add(e){return de("SimpleDb","ADD",this.store.name,e,e),xl(this.store.add(e))}get(e){return xl(this.store.get(e)).next(n=>(n===void 0&&(n=null),de("SimpleDb","GET",this.store.name,e,n),n))}delete(e){return de("SimpleDb","DELETE",this.store.name,e),xl(this.store.delete(e))}count(){return de("SimpleDb","COUNT",this.store.name),xl(this.store.count())}W(e,n){const s=this.options(e,n),r=s.index?this.store.index(s.index):this.store;if(typeof r.getAll=="function"){const i=r.getAll(s.range);return new J((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(s),o=[];return this.G(i,(a,l)=>{o.push(l)}).next(()=>o)}}j(e,n){const s=this.store.getAll(e,n===null?void 0:n);return new J((r,i)=>{s.onerror=o=>{i(o.target.error)},s.onsuccess=o=>{r(o.target.result)}})}H(e,n){de("SimpleDb","DELETE ALL",this.store.name);const s=this.options(e,n);s.J=!1;const r=this.cursor(s);return this.G(r,(i,o,a)=>a.delete())}Y(e,n){let s;n?s=e:(s={},n=e);const r=this.cursor(s);return this.G(r,n)}Z(e){const n=this.cursor({});return new J((s,r)=>{n.onerror=i=>{const o=fE(i.target.error);r(o)},n.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():s()}):s()}})}G(e,n){const s=[];return new J((r,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void r();const l=new vZ(a),u=n(a.primaryKey,a.value,l);if(u instanceof J){const c=u.catch(h=>(l.done(),J.reject(h)));s.push(c)}l.isDone?r():l.$===null?a.continue():a.continue(l.$)}}).next(()=>J.waitFor(s))}options(e,n){let s;return e!==void 0&&(typeof e=="string"?s=e:n=e),{index:s,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const s=this.store.index(e.index);return e.J?s.openKeyCursor(e.range,n):s.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function xl(t){return new J((e,n)=>{t.onsuccess=s=>{const r=s.target.result;e(r)},t.onerror=s=>{const r=fE(s.target.error);n(r)}})}let qD=!1;function fE(t){const e=Rl.S(hn());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const s=new me("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return qD||(qD=!0,setTimeout(()=>{throw s},0)),s}}return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pE{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this.se(s),this.oe=s=>n.writeSequenceNumber(s))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}pE._e=-1;function tx(t){return t==null}function kw(t){return t===0&&1/t==-1/0}function bZ(t){return typeof t=="number"&&Number.isInteger(t)&&!kw(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KD(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Pu(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function yz(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e,n){this.comparator=e,this.root=n||Gn.EMPTY}insert(e,n){return new Vt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Gn.BLACK,null,null))}remove(e){return new Vt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Gn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(s===0)return n.value;s<0?n=n.left:s>0&&(n=n.right)}return null}indexOf(e){let n=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return n+s.left.size;r<0?s=s.left:(n+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,s)=>(e(n,s),!1))}toString(){const e=[];return this.inorderTraversal((n,s)=>(e.push(`${n}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Xy(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Xy(this.root,e,this.comparator,!1)}getReverseIterator(){return new Xy(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Xy(this.root,e,this.comparator,!0)}}class Xy{constructor(e,n,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?s(e.key,n):1,n&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Gn{constructor(e,n,s,r,i){this.key=e,this.value=n,this.color=s??Gn.RED,this.left=r??Gn.EMPTY,this.right=i??Gn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,s,r,i){return new Gn(e??this.key,n??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,n,s),null):i===0?r.copy(null,n,null,null,null):r.copy(null,null,null,null,r.right.insert(e,n,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Gn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let s,r=this;if(n(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),n(e,r.key)===0){if(r.right.isEmpty())return Gn.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Gn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Gn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ne();const e=this.left.check();if(e!==this.right.check())throw Ne();return e+(this.isRed()?0:1)}}Gn.EMPTY=null,Gn.RED=!0,Gn.BLACK=!1;Gn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ne()}get value(){throw Ne()}get color(){throw Ne()}get left(){throw Ne()}get right(){throw Ne()}copy(e,n,s,r,i){return this}insert(e,n,s){return new Gn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e){this.comparator=e,this.data=new Vt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,s)=>(e(n),!1))}forEachInRange(e,n){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;n(r.key)}}forEachWhile(e,n){let s;for(s=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new XD(this.data.getIterator())}getIteratorFrom(e){return new XD(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(s=>{n=n.add(s)}),n}isEqual(e){if(!(e instanceof Qn)||this.size!==e.size)return!1;const n=this.data.getIterator(),s=e.data.getIterator();for(;n.hasNext();){const r=n.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Qn(this.comparator);return n.data=e,n}}class XD{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(e){this.fields=e,e.sort(qn.comparator)}static empty(){return new ur([])}unionWith(e){let n=new Qn(qn.comparator);for(const s of this.fields)n=n.add(s);for(const s of e)n=n.add(s);return new ur(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Zc(this.fields,e.fields,(n,s)=>n.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wz extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ds{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new wz("Invalid base64 string: "+i):i}}(e);return new ds(n)}static fromUint8Array(e){const n=function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i}(e);return new ds(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const s=new Uint8Array(n.length);for(let r=0;r<n.length;r++)s[r]=n.charCodeAt(r);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ds.EMPTY_BYTE_STRING=new ds("");const IZ=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pa(t){if(yt(!!t),typeof t=="string"){let e=0;const n=IZ.exec(t);if(yt(!!n),n[1]){let r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:tn(t.seconds),nanos:tn(t.nanos)}}function tn(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ou(t){return typeof t=="string"?ds.fromBase64String(t):ds.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mE(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function gE(t){const e=t.mapValue.fields.__previous_value__;return mE(e)?gE(e):e}function Ap(t){const e=Pa(t.mapValue.fields.__local_write_time__.timestampValue);return new yn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TZ{constructor(e,n,s,r,i,o,a,l,u){this.databaseId=e,this.appId=n,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}}class Rp{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new Rp("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Rp&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function au(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?mE(t)?4:SZ(t)?9007199254740991:10:Ne()}function qi(t,e){if(t===e)return!0;const n=au(t);if(n!==au(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ap(t).isEqual(Ap(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=Pa(r.timestampValue),a=Pa(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(r,i){return ou(r.bytesValue).isEqual(ou(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(r,i){return tn(r.geoPointValue.latitude)===tn(i.geoPointValue.latitude)&&tn(r.geoPointValue.longitude)===tn(i.geoPointValue.longitude)}(t,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return tn(r.integerValue)===tn(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=tn(r.doubleValue),a=tn(i.doubleValue);return o===a?kw(o)===kw(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return Zc(t.arrayValue.values||[],e.arrayValue.values||[],qi);case 10:return function(r,i){const o=r.mapValue.fields||{},a=i.mapValue.fields||{};if(KD(o)!==KD(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!qi(o[l],a[l])))return!1;return!0}(t,e);default:return Ne()}}function Dp(t,e){return(t.values||[]).find(n=>qi(n,e))!==void 0}function eh(t,e){if(t===e)return 0;const n=au(t),s=au(e);if(n!==s)return tt(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return tt(t.booleanValue,e.booleanValue);case 2:return function(i,o){const a=tn(i.integerValue||i.doubleValue),l=tn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(t,e);case 3:return QD(t.timestampValue,e.timestampValue);case 4:return QD(Ap(t),Ap(e));case 5:return tt(t.stringValue,e.stringValue);case 6:return function(i,o){const a=ou(i),l=ou(o);return a.compareTo(l)}(t.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const c=tt(a[u],l[u]);if(c!==0)return c}return tt(a.length,l.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,o){const a=tt(tn(i.latitude),tn(o.latitude));return a!==0?a:tt(tn(i.longitude),tn(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(i,o){const a=i.values||[],l=o.values||[];for(let u=0;u<a.length&&u<l.length;++u){const c=eh(a[u],l[u]);if(c)return c}return tt(a.length,l.length)}(t.arrayValue,e.arrayValue);case 10:return function(i,o){if(i===Qy.mapValue&&o===Qy.mapValue)return 0;if(i===Qy.mapValue)return 1;if(o===Qy.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},c=Object.keys(u);l.sort(),c.sort();for(let h=0;h<l.length&&h<c.length;++h){const d=tt(l[h],c[h]);if(d!==0)return d;const f=eh(a[l[h]],u[c[h]]);if(f!==0)return f}return tt(l.length,c.length)}(t.mapValue,e.mapValue);default:throw Ne()}}function QD(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return tt(t,e);const n=Pa(t),s=Pa(e),r=tt(n.seconds,s.seconds);return r!==0?r:tt(n.nanos,s.nanos)}function th(t){return vS(t)}function vS(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const s=Pa(n);return`time(${s.seconds},${s.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return ou(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return Se.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let s="[",r=!0;for(const i of n.values||[])r?r=!1:s+=",",s+=vS(i);return s+"]"}(t.arrayValue):"mapValue"in t?function(n){const s=Object.keys(n.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${vS(n.fields[o])}`;return r+"}"}(t.mapValue):Ne()}function YD(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function xS(t){return!!t&&"integerValue"in t}function yE(t){return!!t&&"arrayValue"in t}function JD(t){return!!t&&"nullValue"in t}function ZD(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function N0(t){return!!t&&"mapValue"in t}function Xf(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Pu(t.mapValue.fields,(n,s)=>e.mapValue.fields[n]=Xf(s)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Xf(t.arrayValue.values[n]);return e}return Object.assign({},t)}function SZ(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs{constructor(e){this.value=e}static empty(){return new Vs({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let s=0;s<e.length-1;++s)if(n=(n.mapValue.fields||{})[e.get(s)],!N0(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xf(n)}setAll(e){let n=qn.emptyPath(),s={},r=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,s,r),s={},r=[],n=a.popLast()}o?s[a.lastSegment()]=Xf(o):r.push(a.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,s,r)}delete(e){const n=this.field(e.popLast());N0(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return qi(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=n.mapValue.fields[e.get(s)];N0(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},n.mapValue.fields[e.get(s)]=r),n=r}return n.mapValue.fields}applyChanges(e,n,s){Pu(n,(r,i)=>e[r]=i);for(const r of s)delete e[r]}clone(){return new Vs(Xf(this.value))}}function vz(t){const e=[];return Pu(t.fields,(n,s)=>{const r=new qn([n]);if(N0(s)){const i=vz(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)}),new ur(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e,n,s,r,i,o,a){this.key=e,this.documentType=n,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new is(e,0,De.min(),De.min(),De.min(),Vs.empty(),0)}static newFoundDocument(e,n,s,r){return new is(e,1,n,De.min(),s,r,0)}static newNoDocument(e,n){return new is(e,2,n,De.min(),De.min(),Vs.empty(),0)}static newUnknownDocument(e,n){return new is(e,3,n,De.min(),De.min(),Vs.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(De.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Vs.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Vs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=De.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof is&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new is(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{constructor(e,n){this.position=e,this.inclusive=n}}function eO(t,e,n){let s=0;for(let r=0;r<t.position.length;r++){const i=e[r],o=t.position[r];if(i.field.isKeyField()?s=Se.comparator(Se.fromName(o.referenceValue),n.key):s=eh(o,n.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function tO(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!qi(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Op{constructor(e,n="asc"){this.field=e,this.dir=n}}function _Z(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xz{}class rn extends xz{constructor(e,n,s){super(),this.field=e,this.op=n,this.value=s}static create(e,n,s){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,s):new EZ(e,n,s):n==="array-contains"?new $Z(e,s):n==="in"?new AZ(e,s):n==="not-in"?new RZ(e,s):n==="array-contains-any"?new DZ(e,s):new rn(e,n,s)}static createKeyFieldInFilter(e,n,s){return n==="in"?new kZ(e,s):new NZ(e,s)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(eh(n,this.value)):n!==null&&au(this.value)===au(n)&&this.matchesComparison(eh(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ne()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class fi extends xz{constructor(e,n){super(),this.filters=e,this.op=n,this.ue=null}static create(e,n){return new fi(e,n)}matches(e){return bz(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function bz(t){return t.op==="and"}function Iz(t){return CZ(t)&&bz(t)}function CZ(t){for(const e of t.filters)if(e instanceof fi)return!1;return!0}function bS(t){if(t instanceof rn)return t.field.canonicalString()+t.op.toString()+th(t.value);if(Iz(t))return t.filters.map(e=>bS(e)).join(",");{const e=t.filters.map(n=>bS(n)).join(",");return`${t.op}(${e})`}}function Tz(t,e){return t instanceof rn?function(s,r){return r instanceof rn&&s.op===r.op&&s.field.isEqual(r.field)&&qi(s.value,r.value)}(t,e):t instanceof fi?function(s,r){return r instanceof fi&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce((i,o,a)=>i&&Tz(o,r.filters[a]),!0):!1}(t,e):void Ne()}function Sz(t){return t instanceof rn?function(n){return`${n.field.canonicalString()} ${n.op} ${th(n.value)}`}(t):t instanceof fi?function(n){return n.op.toString()+" {"+n.getFilters().map(Sz).join(" ,")+"}"}(t):"Filter"}class EZ extends rn{constructor(e,n,s){super(e,n,s),this.key=Se.fromName(s.referenceValue)}matches(e){const n=Se.comparator(e.key,this.key);return this.matchesComparison(n)}}class kZ extends rn{constructor(e,n){super(e,"in",n),this.keys=_z("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class NZ extends rn{constructor(e,n){super(e,"not-in",n),this.keys=_z("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function _z(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(s=>Se.fromName(s.referenceValue))}class $Z extends rn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return yE(n)&&Dp(n.arrayValue,this.value)}}class AZ extends rn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Dp(this.value.arrayValue,n)}}class RZ extends rn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Dp(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Dp(this.value.arrayValue,n)}}class DZ extends rn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!yE(n)||!n.arrayValue.values)&&n.arrayValue.values.some(s=>Dp(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OZ{constructor(e,n=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.ce=null}}function nO(t,e=null,n=[],s=[],r=null,i=null,o=null){return new OZ(t,e,n,s,r,i,o)}function wE(t){const e=Me(t);if(e.ce===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(s=>bS(s)).join(","),n+="|ob:",n+=e.orderBy.map(s=>function(i){return i.field.canonicalString()+i.dir}(s)).join(","),tx(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>th(s)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>th(s)).join(",")),e.ce=n}return e.ce}function vE(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!_Z(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Tz(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!tO(t.startAt,e.startAt)&&tO(t.endAt,e.endAt)}function IS(t){return Se.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh{constructor(e,n=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function PZ(t,e,n,s,r,i,o,a){return new Nh(t,e,n,s,r,i,o,a)}function xE(t){return new Nh(t)}function sO(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Cz(t){return t.collectionGroup!==null}function Qf(t){const e=Me(t);if(e.le===null){e.le=[];const n=new Set;for(const i of e.explicitOrderBy)e.le.push(i),n.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Qn(qn.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.le.push(new Op(i,s))}),n.has(qn.keyField().canonicalString())||e.le.push(new Op(qn.keyField(),s))}return e.le}function Mi(t){const e=Me(t);return e.he||(e.he=FZ(e,Qf(t))),e.he}function FZ(t,e){if(t.limitType==="F")return nO(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(r=>{const i=r.dir==="desc"?"asc":"desc";return new Op(r.field,i)});const n=t.endAt?new Nw(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new Nw(t.startAt.position,t.startAt.inclusive):null;return nO(t.path,t.collectionGroup,e,t.filters,t.limit,n,s)}}function TS(t,e){const n=t.filters.concat([e]);return new Nh(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function SS(t,e,n){return new Nh(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function nx(t,e){return vE(Mi(t),Mi(e))&&t.limitType===e.limitType}function Ez(t){return`${wE(Mi(t))}|lt:${t.limitType}`}function lc(t){return`Query(target=${function(n){let s=n.path.canonicalString();return n.collectionGroup!==null&&(s+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(s+=`, filters: [${n.filters.map(r=>Sz(r)).join(", ")}]`),tx(n.limit)||(s+=", limit: "+n.limit),n.orderBy.length>0&&(s+=`, orderBy: [${n.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),n.startAt&&(s+=", startAt: ",s+=n.startAt.inclusive?"b:":"a:",s+=n.startAt.position.map(r=>th(r)).join(",")),n.endAt&&(s+=", endAt: ",s+=n.endAt.inclusive?"a:":"b:",s+=n.endAt.position.map(r=>th(r)).join(",")),`Target(${s})`}(Mi(t))}; limitType=${t.limitType})`}function sx(t,e){return e.isFoundDocument()&&function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):Se.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)}(t,e)&&function(s,r){for(const i of Qf(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(t,e)&&function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0}(t,e)&&function(s,r){return!(s.startAt&&!function(o,a,l){const u=eO(o,a,l);return o.inclusive?u<=0:u<0}(s.startAt,Qf(s),r)||s.endAt&&!function(o,a,l){const u=eO(o,a,l);return o.inclusive?u>=0:u>0}(s.endAt,Qf(s),r))}(t,e)}function LZ(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function kz(t){return(e,n)=>{let s=!1;for(const r of Qf(t)){const i=MZ(r,e,n);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function MZ(t,e,n){const s=t.field.isKeyField()?Se.comparator(e.key,n.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?eh(l,u):Ne()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return Ne()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,n]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,n]);r.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[n]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Pu(this.inner,(n,s)=>{for(const[r,i]of s)e(r,i)})}isEmpty(){return yz(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VZ=new Vt(Se.comparator);function Co(){return VZ}const Nz=new Vt(Se.comparator);function Tf(...t){let e=Nz;for(const n of t)e=e.insert(n.key,n);return e}function $z(t){let e=Nz;return t.forEach((n,s)=>e=e.insert(n,s.overlayedDocument)),e}function Dl(){return Yf()}function Az(){return Yf()}function Yf(){return new $h(t=>t.toString(),(t,e)=>t.isEqual(e))}const zZ=new Vt(Se.comparator),BZ=new Qn(Se.comparator);function qe(...t){let e=BZ;for(const n of t)e=e.add(n);return e}const UZ=new Qn(tt);function WZ(){return UZ}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rz(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:kw(e)?"-0":e}}function Dz(t){return{integerValue:""+t}}function jZ(t,e){return bZ(e)?Dz(e):Rz(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rx{constructor(){this._=void 0}}function GZ(t,e,n){return t instanceof Pp?function(r,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&mE(i)&&(i=gE(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(n,e):t instanceof Fp?Pz(t,e):t instanceof Lp?Fz(t,e):function(r,i){const o=Oz(r,i),a=rO(o)+rO(r.Ie);return xS(o)&&xS(r.Ie)?Dz(a):Rz(r.serializer,a)}(t,e)}function HZ(t,e,n){return t instanceof Fp?Pz(t,e):t instanceof Lp?Fz(t,e):n}function Oz(t,e){return t instanceof $w?function(s){return xS(s)||function(i){return!!i&&"doubleValue"in i}(s)}(e)?e:{integerValue:0}:null}class Pp extends rx{}class Fp extends rx{constructor(e){super(),this.elements=e}}function Pz(t,e){const n=Lz(e);for(const s of t.elements)n.some(r=>qi(r,s))||n.push(s);return{arrayValue:{values:n}}}class Lp extends rx{constructor(e){super(),this.elements=e}}function Fz(t,e){let n=Lz(e);for(const s of t.elements)n=n.filter(r=>!qi(r,s));return{arrayValue:{values:n}}}class $w extends rx{constructor(e,n){super(),this.serializer=e,this.Ie=n}}function rO(t){return tn(t.integerValue||t.doubleValue)}function Lz(t){return yE(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qZ{constructor(e,n){this.field=e,this.transform=n}}function KZ(t,e){return t.field.isEqual(e.field)&&function(s,r){return s instanceof Fp&&r instanceof Fp||s instanceof Lp&&r instanceof Lp?Zc(s.elements,r.elements,qi):s instanceof $w&&r instanceof $w?qi(s.Ie,r.Ie):s instanceof Pp&&r instanceof Pp}(t.transform,e.transform)}class XZ{constructor(e,n){this.version=e,this.transformResults=n}}class ri{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new ri}static exists(e){return new ri(void 0,e)}static updateTime(e){return new ri(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function $0(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class ix{}function Mz(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new bE(t.key,ri.none()):new Em(t.key,t.data,ri.none());{const n=t.data,s=Vs.empty();let r=new Qn(qn.comparator);for(let i of e.fields)if(!r.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new el(t.key,s,new ur(r.toArray()),ri.none())}}function QZ(t,e,n){t instanceof Em?function(r,i,o){const a=r.value.clone(),l=oO(r.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof el?function(r,i,o){if(!$0(r.precondition,i))return void i.convertToUnknownDocument(o.version);const a=oO(r.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(Vz(r)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function Jf(t,e,n,s){return t instanceof Em?function(i,o,a,l){if(!$0(i.precondition,o))return a;const u=i.value.clone(),c=aO(i.fieldTransforms,l,o);return u.setAll(c),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,n,s):t instanceof el?function(i,o,a,l){if(!$0(i.precondition,o))return a;const u=aO(i.fieldTransforms,l,o),c=o.data;return c.setAll(Vz(i)),c.setAll(u),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(t,e,n,s):function(i,o,a){return $0(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function YZ(t,e){let n=null;for(const s of t.fieldTransforms){const r=e.data.field(s.field),i=Oz(s.transform,r||null);i!=null&&(n===null&&(n=Vs.empty()),n.set(s.field,i))}return n||null}function iO(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&Zc(s,r,(i,o)=>KZ(i,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Em extends ix{constructor(e,n,s,r=[]){super(),this.key=e,this.value=n,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class el extends ix{constructor(e,n,s,r,i=[]){super(),this.key=e,this.data=n,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Vz(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}}),e}function oO(t,e,n){const s=new Map;yt(t.length===n.length);for(let r=0;r<n.length;r++){const i=t[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,HZ(o,a,n[r]))}return s}function aO(t,e,n){const s=new Map;for(const r of t){const i=r.transform,o=n.data.field(r.field);s.set(r.field,GZ(i,o,e))}return s}class bE extends ix{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class JZ extends ix{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZZ{constructor(e,n,s,r){this.batchId=e,this.localWriteTime=n,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,n){const s=n.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&QZ(i,e,s[r])}}applyToLocalView(e,n){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(n=Jf(s,e,n,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(n=Jf(s,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const s=Az();return this.mutations.forEach(r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=n.has(r.key)?null:a;const l=Mz(o,a);l!==null&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(De.min())}),s}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),qe())}isEqual(e){return this.batchId===e.batchId&&Zc(this.mutations,e.mutations,(n,s)=>iO(n,s))&&Zc(this.baseMutations,e.baseMutations,(n,s)=>iO(n,s))}}class IE{constructor(e,n,s,r){this.batch=e,this.commitVersion=n,this.mutationResults=s,this.docVersions=r}static from(e,n,s){yt(e.mutations.length===s.length);let r=function(){return zZ}();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new IE(e,n,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eee{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tee{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var en,Je;function nee(t){switch(t){default:return Ne();case Q.CANCELLED:case Q.UNKNOWN:case Q.DEADLINE_EXCEEDED:case Q.RESOURCE_EXHAUSTED:case Q.INTERNAL:case Q.UNAVAILABLE:case Q.UNAUTHENTICATED:return!1;case Q.INVALID_ARGUMENT:case Q.NOT_FOUND:case Q.ALREADY_EXISTS:case Q.PERMISSION_DENIED:case Q.FAILED_PRECONDITION:case Q.ABORTED:case Q.OUT_OF_RANGE:case Q.UNIMPLEMENTED:case Q.DATA_LOSS:return!0}}function zz(t){if(t===void 0)return Hi("GRPC error has no .code"),Q.UNKNOWN;switch(t){case en.OK:return Q.OK;case en.CANCELLED:return Q.CANCELLED;case en.UNKNOWN:return Q.UNKNOWN;case en.DEADLINE_EXCEEDED:return Q.DEADLINE_EXCEEDED;case en.RESOURCE_EXHAUSTED:return Q.RESOURCE_EXHAUSTED;case en.INTERNAL:return Q.INTERNAL;case en.UNAVAILABLE:return Q.UNAVAILABLE;case en.UNAUTHENTICATED:return Q.UNAUTHENTICATED;case en.INVALID_ARGUMENT:return Q.INVALID_ARGUMENT;case en.NOT_FOUND:return Q.NOT_FOUND;case en.ALREADY_EXISTS:return Q.ALREADY_EXISTS;case en.PERMISSION_DENIED:return Q.PERMISSION_DENIED;case en.FAILED_PRECONDITION:return Q.FAILED_PRECONDITION;case en.ABORTED:return Q.ABORTED;case en.OUT_OF_RANGE:return Q.OUT_OF_RANGE;case en.UNIMPLEMENTED:return Q.UNIMPLEMENTED;case en.DATA_LOSS:return Q.DATA_LOSS;default:return Ne()}}(Je=en||(en={}))[Je.OK=0]="OK",Je[Je.CANCELLED=1]="CANCELLED",Je[Je.UNKNOWN=2]="UNKNOWN",Je[Je.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Je[Je.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Je[Je.NOT_FOUND=5]="NOT_FOUND",Je[Je.ALREADY_EXISTS=6]="ALREADY_EXISTS",Je[Je.PERMISSION_DENIED=7]="PERMISSION_DENIED",Je[Je.UNAUTHENTICATED=16]="UNAUTHENTICATED",Je[Je.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Je[Je.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Je[Je.ABORTED=10]="ABORTED",Je[Je.OUT_OF_RANGE=11]="OUT_OF_RANGE",Je[Je.UNIMPLEMENTED=12]="UNIMPLEMENTED",Je[Je.INTERNAL=13]="INTERNAL",Je[Je.UNAVAILABLE=14]="UNAVAILABLE",Je[Je.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function see(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ree=new Mc([4294967295,4294967295],0);function lO(t){const e=see().encode(t),n=new rZ;return n.update(e),new Uint8Array(n.digest())}function uO(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Mc([n,s],0),new Mc([r,i],0)]}class TE{constructor(e,n,s){if(this.bitmap=e,this.padding=n,this.hashCount=s,n<0||n>=8)throw new Sf(`Invalid padding: ${n}`);if(s<0)throw new Sf(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Sf(`Invalid hash count: ${s}`);if(e.length===0&&n!==0)throw new Sf(`Invalid padding when bitmap length is 0: ${n}`);this.Te=8*e.length-n,this.Ee=Mc.fromNumber(this.Te)}de(e,n,s){let r=e.add(n.multiply(Mc.fromNumber(s)));return r.compare(ree)===1&&(r=new Mc([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const n=lO(e),[s,r]=uO(n);for(let i=0;i<this.hashCount;i++){const o=this.de(s,r,i);if(!this.Ae(o))return!1}return!0}static create(e,n,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new TE(i,r,n);return s.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;const n=lO(e),[s,r]=uO(n);for(let i=0;i<this.hashCount;i++){const o=this.de(s,r,i);this.Re(o)}}Re(e){const n=Math.floor(e/8),s=e%8;this.bitmap[n]|=1<<s}}class Sf extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ox{constructor(e,n,s,r,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,s){const r=new Map;return r.set(e,km.createSynthesizedTargetChangeForCurrentChange(e,n,s)),new ox(De.min(),r,new Vt(tt),Co(),qe())}}class km{constructor(e,n,s,r,i){this.resumeToken=e,this.current=n,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,s){return new km(s,n,qe(),qe(),qe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A0{constructor(e,n,s,r){this.Ve=e,this.removedTargetIds=n,this.key=s,this.me=r}}class Bz{constructor(e,n){this.targetId=e,this.fe=n}}class Uz{constructor(e,n,s=ds.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=n,this.resumeToken=s,this.cause=r}}class cO{constructor(){this.ge=0,this.pe=dO(),this.ye=ds.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=qe(),n=qe(),s=qe();return this.pe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:n=n.add(r);break;case 1:s=s.add(r);break;default:Ne()}}),new km(this.ye,this.we,e,n,s)}Fe(){this.Se=!1,this.pe=dO()}Me(e,n){this.Se=!0,this.pe=this.pe.insert(e,n)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,yt(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class iee{constructor(e){this.Le=e,this.ke=new Map,this.qe=Co(),this.Qe=hO(),this.Ke=new Vt(tt)}$e(e){for(const n of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(n,e.me):this.We(n,e.key,e.me);for(const n of e.removedTargetIds)this.We(n,e.key,e.me)}Ge(e){this.forEachTarget(e,n=>{const s=this.ze(n);switch(e.state){case 0:this.je(n)&&s.Ce(e.resumeToken);break;case 1:s.Ne(),s.be||s.Fe(),s.Ce(e.resumeToken);break;case 2:s.Ne(),s.be||this.removeTarget(n);break;case 3:this.je(n)&&(s.Be(),s.Ce(e.resumeToken));break;case 4:this.je(n)&&(this.He(n),s.Ce(e.resumeToken));break;default:Ne()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ke.forEach((s,r)=>{this.je(r)&&n(r)})}Je(e){const n=e.targetId,s=e.fe.count,r=this.Ye(n);if(r){const i=r.target;if(IS(i))if(s===0){const o=new Se(i.path);this.We(n,o,is.newNoDocument(o,De.min()))}else yt(s===1);else{const o=this.Ze(n);if(o!==s){const a=this.Xe(e),l=a?this.et(a,e,o):1;if(l!==0){this.He(n);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(n,u)}}}}}Xe(e){const n=e.fe.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=n;let o,a;try{o=ou(s).toUint8Array()}catch(l){if(l instanceof wz)return Jc("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new TE(o,r,i)}catch(l){return Jc(l instanceof Sf?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Te===0?null:a}et(e,n,s){return n.fe.count===s-this.rt(e,n.targetId)?0:2}rt(e,n){const s=this.Le.getRemoteKeysForTarget(n);let r=0;return s.forEach(i=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.We(n,i,null),r++)}),r}it(e){const n=new Map;this.ke.forEach((i,o)=>{const a=this.Ye(o);if(a){if(i.current&&IS(a.target)){const l=new Se(a.target.path);this.qe.get(l)!==null||this.st(o,l)||this.We(o,l,is.newNoDocument(l,e))}i.De&&(n.set(o,i.ve()),i.Fe())}});let s=qe();this.Qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.Ye(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(s=s.add(i))}),this.qe.forEach((i,o)=>o.setReadTime(e));const r=new ox(e,n,this.Ke,this.qe,s);return this.qe=Co(),this.Qe=hO(),this.Ke=new Vt(tt),r}Ue(e,n){if(!this.je(e))return;const s=this.st(e,n.key)?2:0;this.ze(e).Me(n.key,s),this.qe=this.qe.insert(n.key,n),this.Qe=this.Qe.insert(n.key,this.ot(n.key).add(e))}We(e,n,s){if(!this.je(e))return;const r=this.ze(e);this.st(e,n)?r.Me(n,1):r.xe(n),this.Qe=this.Qe.insert(n,this.ot(n).delete(e)),s&&(this.qe=this.qe.insert(n,s))}removeTarget(e){this.ke.delete(e)}Ze(e){const n=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let n=this.ke.get(e);return n||(n=new cO,this.ke.set(e,n)),n}ot(e){let n=this.Qe.get(e);return n||(n=new Qn(tt),this.Qe=this.Qe.insert(e,n)),n}je(e){const n=this.Ye(e)!==null;return n||de("WatchChangeAggregator","Detected inactive target",e),n}Ye(e){const n=this.ke.get(e);return n&&n.be?null:this.Le._t(e)}He(e){this.ke.set(e,new cO),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.We(e,n,null)})}st(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function hO(){return new Vt(Se.comparator)}function dO(){return new Vt(Se.comparator)}const oee={asc:"ASCENDING",desc:"DESCENDING"},aee={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},lee={and:"AND",or:"OR"};class uee{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function _S(t,e){return t.useProto3Json||tx(e)?e:{value:e}}function Aw(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Wz(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function cee(t,e){return Aw(t,e.toTimestamp())}function Vi(t){return yt(!!t),De.fromTimestamp(function(n){const s=Pa(n);return new yn(s.seconds,s.nanos)}(t))}function SE(t,e){return CS(t,e).canonicalString()}function CS(t,e){const n=function(r){return new Tt(["projects",r.projectId,"databases",r.database])}(t).child("documents");return e===void 0?n:n.child(e)}function jz(t){const e=Tt.fromString(t);return yt(Xz(e)),e}function ES(t,e){return SE(t.databaseId,e.path)}function FI(t,e){const n=jz(e);if(n.get(1)!==t.databaseId.projectId)throw new me(Q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new me(Q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Se(Hz(n))}function Gz(t,e){return SE(t.databaseId,e)}function hee(t){const e=jz(t);return e.length===4?Tt.emptyPath():Hz(e)}function kS(t){return new Tt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Hz(t){return yt(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function fO(t,e,n){return{name:ES(t,e),fields:n.value.mapValue.fields}}function dee(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Ne()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(u,c){return u.useProto3Json?(yt(c===void 0||typeof c=="string"),ds.fromBase64String(c||"")):(yt(c===void 0||c instanceof Uint8Array),ds.fromUint8Array(c||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const c=u.code===void 0?Q.UNKNOWN:zz(u.code);return new me(c,u.message||"")}(o);n=new Uz(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=FI(t,s.document.name),i=Vi(s.document.updateTime),o=s.document.createTime?Vi(s.document.createTime):De.min(),a=new Vs({mapValue:{fields:s.document.fields}}),l=is.newFoundDocument(r,i,o,a),u=s.targetIds||[],c=s.removedTargetIds||[];n=new A0(u,c,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=FI(t,s.document),i=s.readTime?Vi(s.readTime):De.min(),o=is.newNoDocument(r,i),a=s.removedTargetIds||[];n=new A0([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=FI(t,s.document),i=s.removedTargetIds||[];n=new A0([],i,r,null)}else{if(!("filter"in e))return Ne();{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new tee(r,i),a=s.targetId;n=new Bz(a,o)}}return n}function fee(t,e){let n;if(e instanceof Em)n={update:fO(t,e.key,e.value)};else if(e instanceof bE)n={delete:ES(t,e.key)};else if(e instanceof el)n={update:fO(t,e.key,e.data),updateMask:Iee(e.fieldMask)};else{if(!(e instanceof JZ))return Ne();n={verify:ES(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(s=>function(i,o){const a=o.transform;if(a instanceof Pp)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Fp)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Lp)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof $w)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw Ne()}(0,s))),e.precondition.isNone||(n.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:cee(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ne()}(t,e.precondition)),n}function pee(t,e){return t&&t.length>0?(yt(e!==void 0),t.map(n=>function(r,i){let o=r.updateTime?Vi(r.updateTime):Vi(i);return o.isEqual(De.min())&&(o=Vi(i)),new XZ(o,r.transformResults||[])}(n,e))):[]}function mee(t,e){return{documents:[Gz(t,e.path)]}}function gee(t,e){const n={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=Gz(t,r);const i=function(u){if(u.length!==0)return Kz(fi.create(u,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(c=>function(d){return{field:uc(d.field),direction:vee(d.dir)}}(c))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=_S(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ut:n,parent:r}}function yee(t){let e=hee(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){yt(s===1);const c=n.from[0];c.allDescendants?r=c.collectionId:e=e.child(c.collectionId)}let i=[];n.where&&(i=function(h){const d=qz(h);return d instanceof fi&&Iz(d)?d.getFilters():[d]}(n.where));let o=[];n.orderBy&&(o=function(h){return h.map(d=>function(p){return new Op(cc(p.field),function(g){switch(g){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(p.direction))}(d))}(n.orderBy));let a=null;n.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,tx(d)?null:d}(n.limit));let l=null;n.startAt&&(l=function(h){const d=!!h.before,f=h.values||[];return new Nw(f,d)}(n.startAt));let u=null;return n.endAt&&(u=function(h){const d=!h.before,f=h.values||[];return new Nw(f,d)}(n.endAt)),PZ(e,r,o,i,a,"F",l,u)}function wee(t,e){const n=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ne()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function qz(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const s=cc(n.unaryFilter.field);return rn.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=cc(n.unaryFilter.field);return rn.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=cc(n.unaryFilter.field);return rn.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=cc(n.unaryFilter.field);return rn.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ne()}}(t):t.fieldFilter!==void 0?function(n){return rn.create(cc(n.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ne()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return fi.create(n.compositeFilter.filters.map(s=>qz(s)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Ne()}}(n.compositeFilter.op))}(t):Ne()}function vee(t){return oee[t]}function xee(t){return aee[t]}function bee(t){return lee[t]}function uc(t){return{fieldPath:t.canonicalString()}}function cc(t){return qn.fromServerFormat(t.fieldPath)}function Kz(t){return t instanceof rn?function(n){if(n.op==="=="){if(ZD(n.value))return{unaryFilter:{field:uc(n.field),op:"IS_NAN"}};if(JD(n.value))return{unaryFilter:{field:uc(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(ZD(n.value))return{unaryFilter:{field:uc(n.field),op:"IS_NOT_NAN"}};if(JD(n.value))return{unaryFilter:{field:uc(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:uc(n.field),op:xee(n.op),value:n.value}}}(t):t instanceof fi?function(n){const s=n.getFilters().map(r=>Kz(r));return s.length===1?s[0]:{compositeFilter:{op:bee(n.op),filters:s}}}(t):Ne()}function Iee(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function Xz(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e,n,s,r,i=De.min(),o=De.min(),a=ds.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=n,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new ha(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ha(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ha(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ha(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tee{constructor(e){this.ct=e}}function See(t){const e=yee({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?SS(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ee{constructor(){this._n=new Cee}addToCollectionParentIndex(e,n){return this._n.add(n),J.resolve()}getCollectionParents(e,n){return J.resolve(this._n.getEntries(n))}addFieldIndex(e,n){return J.resolve()}deleteFieldIndex(e,n){return J.resolve()}deleteAllFieldIndexes(e){return J.resolve()}createTargetIndexes(e,n){return J.resolve()}getDocumentsMatchingTarget(e,n){return J.resolve(null)}getIndexType(e,n){return J.resolve(0)}getFieldIndexes(e,n){return J.resolve([])}getNextCollectionGroupToUpdate(e){return J.resolve(null)}getMinOffset(e,n){return J.resolve(Oa.min())}getMinOffsetFromCollectionGroup(e,n){return J.resolve(Oa.min())}updateCollectionGroup(e,n,s){return J.resolve()}updateIndexEntries(e,n){return J.resolve()}}class Cee{constructor(){this.index={}}add(e){const n=e.lastSegment(),s=e.popLast(),r=this.index[n]||new Qn(Tt.comparator),i=!r.has(s);return this.index[n]=r.add(s),i}has(e){const n=e.lastSegment(),s=e.popLast(),r=this.index[n];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Qn(Tt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new nh(0)}static Bn(){return new nh(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eee{constructor(){this.changes=new $h(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,is.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const s=this.changes.get(n);return s!==void 0?J.resolve(s):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kee{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nee{constructor(e,n,s,r){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,n){let s=null;return this.documentOverlayCache.getOverlay(e,n).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,n))).next(r=>(s!==null&&Jf(s.mutation,r,ur.empty(),yn.now()),r))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(s=>this.getLocalViewOfDocuments(e,s,qe()).next(()=>s))}getLocalViewOfDocuments(e,n,s=qe()){const r=Dl();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,s).next(i=>{let o=Tf();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const s=Dl();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,qe()))}populateOverlays(e,n,s){const r=[];return s.forEach(i=>{n.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,s,r){let i=Co();const o=Yf(),a=function(){return Yf()}();return n.forEach((l,u)=>{const c=s.get(u.key);r.has(u.key)&&(c===void 0||c.mutation instanceof el)?i=i.insert(u.key,u):c!==void 0?(o.set(u.key,c.mutation.getFieldMask()),Jf(c.mutation,u,c.mutation.getFieldMask(),yn.now())):o.set(u.key,ur.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,c)=>o.set(u,c)),n.forEach((u,c)=>{var h;return a.set(u,new kee(c,(h=o.get(u))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,n){const s=Yf();let r=new Vt((o,a)=>o-a),i=qe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=n.get(l);if(u===null)return;let c=s.get(l)||ur.empty();c=a.applyToLocalView(u,c),s.set(l,c);const h=(r.get(a.batchId)||qe()).add(l);r=r.insert(a.batchId,h)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,c=l.value,h=Az();c.forEach(d=>{if(!i.has(d)){const f=Mz(n.get(d),s.get(d));f!==null&&h.set(d,f),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,h))}return J.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,n,s,r){return function(o){return Se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):Cz(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,s,r):this.getDocumentsMatchingCollectionQuery(e,n,s,r)}getNextDocuments(e,n,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,s,r).next(i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,s.largestBatchId,r-i.size):J.resolve(Dl());let a=-1,l=i;return o.next(u=>J.forEach(u,(c,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(c)?J.resolve():this.remoteDocumentCache.getEntry(e,c).next(d=>{l=l.insert(c,d)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,qe())).next(c=>({batchId:a,changes:$z(c)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Se(n)).next(s=>{let r=Tf();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(e,n,s,r){const i=n.collectionGroup;let o=Tf();return this.indexManager.getCollectionParents(e,i).next(a=>J.forEach(a,l=>{const u=function(h,d){return new Nh(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,s,r).next(c=>{c.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,s.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,s,i,r))).next(o=>{i.forEach((l,u)=>{const c=u.getKey();o.get(c)===null&&(o=o.insert(c,is.newInvalidDocument(c)))});let a=Tf();return o.forEach((l,u)=>{const c=i.get(l);c!==void 0&&Jf(c.mutation,u,ur.empty(),yn.now()),sx(n,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $ee{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,n){return J.resolve(this.cr.get(n))}saveBundleMetadata(e,n){return this.cr.set(n.id,function(r){return{id:r.id,version:r.version,createTime:Vi(r.createTime)}}(n)),J.resolve()}getNamedQuery(e,n){return J.resolve(this.lr.get(n))}saveNamedQuery(e,n){return this.lr.set(n.name,function(r){return{name:r.name,query:See(r.bundledQuery),readTime:Vi(r.readTime)}}(n)),J.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aee{constructor(){this.overlays=new Vt(Se.comparator),this.hr=new Map}getOverlay(e,n){return J.resolve(this.overlays.get(n))}getOverlays(e,n){const s=Dl();return J.forEach(n,r=>this.getOverlay(e,r).next(i=>{i!==null&&s.set(r,i)})).next(()=>s)}saveOverlays(e,n,s){return s.forEach((r,i)=>{this.ht(e,n,i)}),J.resolve()}removeOverlaysForBatchId(e,n,s){const r=this.hr.get(s);return r!==void 0&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.hr.delete(s)),J.resolve()}getOverlaysForCollection(e,n,s){const r=Dl(),i=n.length+1,o=new Se(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return J.resolve(r)}getOverlaysForCollectionGroup(e,n,s,r){let i=new Vt((u,c)=>u-c);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>s){let c=i.get(u.largestBatchId);c===null&&(c=Dl(),i=i.insert(u.largestBatchId,c)),c.set(u.getKey(),u)}}const a=Dl(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,c)=>a.set(u,c)),!(a.size()>=r)););return J.resolve(a)}ht(e,n,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.hr.get(r.largestBatchId).delete(s.key);this.hr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new eee(n,s));let i=this.hr.get(n);i===void 0&&(i=qe(),this.hr.set(n,i)),this.hr.set(n,i.add(s.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _E{constructor(){this.Pr=new Qn(Sn.Ir),this.Tr=new Qn(Sn.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,n){const s=new Sn(e,n);this.Pr=this.Pr.add(s),this.Tr=this.Tr.add(s)}dr(e,n){e.forEach(s=>this.addReference(s,n))}removeReference(e,n){this.Ar(new Sn(e,n))}Rr(e,n){e.forEach(s=>this.removeReference(s,n))}Vr(e){const n=new Se(new Tt([])),s=new Sn(n,e),r=new Sn(n,e+1),i=[];return this.Tr.forEachInRange([s,r],o=>{this.Ar(o),i.push(o.key)}),i}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const n=new Se(new Tt([])),s=new Sn(n,e),r=new Sn(n,e+1);let i=qe();return this.Tr.forEachInRange([s,r],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new Sn(e,0),s=this.Pr.firstAfterOrEqual(n);return s!==null&&e.isEqual(s.key)}}class Sn{constructor(e,n){this.key=e,this.pr=n}static Ir(e,n){return Se.comparator(e.key,n.key)||tt(e.pr,n.pr)}static Er(e,n){return tt(e.pr,n.pr)||Se.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ree{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.yr=1,this.wr=new Qn(Sn.Ir)}checkEmpty(e){return J.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,s,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new ZZ(i,n,s,r);this.mutationQueue.push(o);for(const a of r)this.wr=this.wr.add(new Sn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return J.resolve(o)}lookupMutationBatch(e,n){return J.resolve(this.Sr(n))}getNextMutationBatchAfterBatchId(e,n){const s=n+1,r=this.br(s),i=r<0?0:r;return J.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return J.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return J.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const s=new Sn(n,0),r=new Sn(n,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([s,r],o=>{const a=this.Sr(o.pr);i.push(a)}),J.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let s=new Qn(tt);return n.forEach(r=>{const i=new Sn(r,0),o=new Sn(r,Number.POSITIVE_INFINITY);this.wr.forEachInRange([i,o],a=>{s=s.add(a.pr)})}),J.resolve(this.Dr(s))}getAllMutationBatchesAffectingQuery(e,n){const s=n.path,r=s.length+1;let i=s;Se.isDocumentKey(i)||(i=i.child(""));const o=new Sn(new Se(i),0);let a=new Qn(tt);return this.wr.forEachWhile(l=>{const u=l.key.path;return!!s.isPrefixOf(u)&&(u.length===r&&(a=a.add(l.pr)),!0)},o),J.resolve(this.Dr(a))}Dr(e){const n=[];return e.forEach(s=>{const r=this.Sr(s);r!==null&&n.push(r)}),n}removeMutationBatch(e,n){yt(this.Cr(n.batchId,"removed")===0),this.mutationQueue.shift();let s=this.wr;return J.forEach(n.mutations,r=>{const i=new Sn(r.key,n.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.wr=s})}Mn(e){}containsKey(e,n){const s=new Sn(n,0),r=this.wr.firstAfterOrEqual(s);return J.resolve(n.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,J.resolve()}Cr(e,n){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){const n=this.br(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dee{constructor(e){this.vr=e,this.docs=function(){return new Vt(Se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const s=n.key,r=this.docs.get(s),i=r?r.size:0,o=this.vr(n);return this.docs=this.docs.insert(s,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const s=this.docs.get(n);return J.resolve(s?s.document.mutableCopy():is.newInvalidDocument(n))}getEntries(e,n){let s=Co();return n.forEach(r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():is.newInvalidDocument(r))}),J.resolve(s)}getDocumentsMatchingQuery(e,n,s,r){let i=Co();const o=n.path,a=new Se(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:c}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||gZ(mZ(c),s)<=0||(r.has(c.key)||sx(n,c))&&(i=i.insert(c.key,c.mutableCopy()))}return J.resolve(i)}getAllFromCollectionGroup(e,n,s,r){Ne()}Fr(e,n){return J.forEach(this.docs,s=>n(s))}newChangeBuffer(e){return new Oee(this)}getSize(e){return J.resolve(this.size)}}class Oee extends Eee{constructor(e){super(),this.ar=e}applyChanges(e){const n=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?n.push(this.ar.addEntry(e,r)):this.ar.removeEntry(s)}),J.waitFor(n)}getFromCache(e,n){return this.ar.getEntry(e,n)}getAllFromCache(e,n){return this.ar.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pee{constructor(e){this.persistence=e,this.Mr=new $h(n=>wE(n),vE),this.lastRemoteSnapshotVersion=De.min(),this.highestTargetId=0,this.Or=0,this.Nr=new _E,this.targetCount=0,this.Br=nh.Nn()}forEachTarget(e,n){return this.Mr.forEach((s,r)=>n(r)),J.resolve()}getLastRemoteSnapshotVersion(e){return J.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return J.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),J.resolve(this.highestTargetId)}setTargetsMetadata(e,n,s){return s&&(this.lastRemoteSnapshotVersion=s),n>this.Or&&(this.Or=n),J.resolve()}qn(e){this.Mr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Br=new nh(n),this.highestTargetId=n),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,n){return this.qn(n),this.targetCount+=1,J.resolve()}updateTargetData(e,n){return this.qn(n),J.resolve()}removeTargetData(e,n){return this.Mr.delete(n.target),this.Nr.Vr(n.targetId),this.targetCount-=1,J.resolve()}removeTargets(e,n,s){let r=0;const i=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=n&&s.get(a.targetId)===null&&(this.Mr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),J.waitFor(i).next(()=>r)}getTargetCount(e){return J.resolve(this.targetCount)}getTargetData(e,n){const s=this.Mr.get(n)||null;return J.resolve(s)}addMatchingKeys(e,n,s){return this.Nr.dr(n,s),J.resolve()}removeMatchingKeys(e,n,s){this.Nr.Rr(n,s);const r=this.persistence.referenceDelegate,i=[];return r&&n.forEach(o=>{i.push(r.markPotentiallyOrphaned(e,o))}),J.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Nr.Vr(n),J.resolve()}getMatchingKeysForTargetId(e,n){const s=this.Nr.gr(n);return J.resolve(s)}containsKey(e,n){return J.resolve(this.Nr.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fee{constructor(e,n){this.Lr={},this.overlays={},this.kr=new pE(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Pee(this),this.indexManager=new _ee,this.remoteDocumentCache=function(r){return new Dee(r)}(s=>this.referenceDelegate.Kr(s)),this.serializer=new Tee(n),this.$r=new $ee(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Aee,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let s=this.Lr[e.toKey()];return s||(s=new Ree(n,this.referenceDelegate),this.Lr[e.toKey()]=s),s}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,n,s){de("MemoryPersistence","Starting transaction:",e);const r=new Lee(this.kr.next());return this.referenceDelegate.Ur(),s(r).next(i=>this.referenceDelegate.Wr(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}Gr(e,n){return J.or(Object.values(this.Lr).map(s=>()=>s.containsKey(e,n)))}}class Lee extends wZ{constructor(e){super(),this.currentSequenceNumber=e}}class CE{constructor(e){this.persistence=e,this.zr=new _E,this.jr=null}static Hr(e){return new CE(e)}get Jr(){if(this.jr)return this.jr;throw Ne()}addReference(e,n,s){return this.zr.addReference(s,n),this.Jr.delete(s.toString()),J.resolve()}removeReference(e,n,s){return this.zr.removeReference(s,n),this.Jr.add(s.toString()),J.resolve()}markPotentiallyOrphaned(e,n){return this.Jr.add(n.toString()),J.resolve()}removeTarget(e,n){this.zr.Vr(n.targetId).forEach(r=>this.Jr.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,n.targetId).next(r=>{r.forEach(i=>this.Jr.add(i.toString()))}).next(()=>s.removeTargetData(e,n))}Ur(){this.jr=new Set}Wr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return J.forEach(this.Jr,s=>{const r=Se.fromPath(s);return this.Yr(e,r).next(i=>{i||n.removeEntry(r,De.min())})}).next(()=>(this.jr=null,n.apply(e)))}updateLimboDocument(e,n){return this.Yr(e,n).next(s=>{s?this.Jr.delete(n.toString()):this.Jr.add(n.toString())})}Kr(e){return 0}Yr(e,n){return J.or([()=>J.resolve(this.zr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Gr(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EE{constructor(e,n,s,r){this.targetId=e,this.fromCache=n,this.qi=s,this.Qi=r}static Ki(e,n){let s=qe(),r=qe();for(const i of n.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new EE(e,n.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mee{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vee{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return ZK()?8:Rl.v(hn())>0?6:4}()}initialize(e,n){this.zi=e,this.indexManager=n,this.$i=!0}getDocumentsMatchingQuery(e,n,s,r){const i={result:null};return this.ji(e,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Hi(e,n,r,s).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Mee;return this.Ji(e,n,o).next(a=>{if(i.result=a,this.Ui)return this.Yi(e,n,o,a.size)})}).next(()=>i.result)}Yi(e,n,s,r){return s.documentReadCount<this.Wi?(uf()<=Xe.DEBUG&&de("QueryEngine","SDK will not create cache indexes for query:",lc(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),J.resolve()):(uf()<=Xe.DEBUG&&de("QueryEngine","Query:",lc(n),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.Gi*r?(uf()<=Xe.DEBUG&&de("QueryEngine","The SDK decides to create cache indexes for query:",lc(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Mi(n))):J.resolve())}ji(e,n){if(sO(n))return J.resolve(null);let s=Mi(n);return this.indexManager.getIndexType(e,s).next(r=>r===0?null:(n.limit!==null&&r===1&&(n=SS(n,null,"F"),s=Mi(n)),this.indexManager.getDocumentsMatchingTarget(e,s).next(i=>{const o=qe(...i);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,s).next(l=>{const u=this.Zi(n,a);return this.Xi(n,u,o,l.readTime)?this.ji(e,SS(n,null,"F")):this.es(e,u,n,l)}))})))}Hi(e,n,s,r){return sO(n)||r.isEqual(De.min())?J.resolve(null):this.zi.getDocuments(e,s).next(i=>{const o=this.Zi(n,i);return this.Xi(n,o,s,r)?J.resolve(null):(uf()<=Xe.DEBUG&&de("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),lc(n)),this.es(e,o,n,pZ(r,-1)).next(a=>a))})}Zi(e,n){let s=new Qn(kz(e));return n.forEach((r,i)=>{sx(e,i)&&(s=s.add(i))}),s}Xi(e,n,s,r){if(e.limit===null)return!1;if(s.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,n,s){return uf()<=Xe.DEBUG&&de("QueryEngine","Using full collection scan to execute query:",lc(n)),this.zi.getDocumentsMatchingQuery(e,n,Oa.min(),s)}es(e,n,s,r){return this.zi.getDocumentsMatchingQuery(e,s,r).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zee{constructor(e,n,s,r){this.persistence=e,this.ts=n,this.serializer=r,this.ns=new Vt(tt),this.rs=new $h(i=>wE(i),vE),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(s)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Nee(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.ns))}}function Bee(t,e,n,s){return new zee(t,e,n,s)}async function Qz(t,e){const n=Me(t);return await n.persistence.runTransaction("Handle user change","readonly",s=>{let r;return n.mutationQueue.getAllMutationBatches(s).next(i=>(r=i,n._s(e),n.mutationQueue.getAllMutationBatches(s))).next(i=>{const o=[],a=[];let l=qe();for(const u of r){o.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}for(const u of i){a.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}return n.localDocuments.getDocuments(s,l).next(u=>({us:u,removedBatchIds:o,addedBatchIds:a}))})})}function Uee(t,e){const n=Me(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=e.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(a,l,u,c){const h=u.batch,d=h.keys();let f=J.resolve();return d.forEach(p=>{f=f.next(()=>c.getEntry(l,p)).next(m=>{const g=u.docVersions.get(p);yt(g!==null),m.version.compareTo(g)<0&&(h.applyToRemoteDocument(m,u),m.isValidDocument()&&(m.setReadTime(u.commitVersion),c.addEntry(m)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(n,s,e,i).next(()=>i.apply(s)).next(()=>n.mutationQueue.performConsistencyCheck(s)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(a){let l=qe();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>n.localDocuments.getDocuments(s,r))})}function Yz(t){const e=Me(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Qr.getLastRemoteSnapshotVersion(n))}function Wee(t,e){const n=Me(t),s=e.snapshotVersion;let r=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=n.os.newChangeBuffer({trackRemovals:!0});r=n.ns;const a=[];e.targetChanges.forEach((c,h)=>{const d=r.get(h);if(!d)return;a.push(n.Qr.removeMatchingKeys(i,c.removedDocuments,h).next(()=>n.Qr.addMatchingKeys(i,c.addedDocuments,h)));let f=d.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(ds.EMPTY_BYTE_STRING,De.min()).withLastLimboFreeSnapshotVersion(De.min()):c.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(c.resumeToken,s)),r=r.insert(h,f),function(m,g,y){return m.resumeToken.approximateByteSize()===0||g.snapshotVersion.toMicroseconds()-m.snapshotVersion.toMicroseconds()>=3e8?!0:y.addedDocuments.size+y.modifiedDocuments.size+y.removedDocuments.size>0}(d,f,c)&&a.push(n.Qr.updateTargetData(i,f))});let l=Co(),u=qe();if(e.documentUpdates.forEach(c=>{e.resolvedLimboDocuments.has(c)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(i,c))}),a.push(jee(i,o,e.documentUpdates).next(c=>{l=c.cs,u=c.ls})),!s.isEqual(De.min())){const c=n.Qr.getLastRemoteSnapshotVersion(i).next(h=>n.Qr.setTargetsMetadata(i,i.currentSequenceNumber,s));a.push(c)}return J.waitFor(a).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(n.ns=r,i))}function jee(t,e,n){let s=qe(),r=qe();return n.forEach(i=>s=s.add(i)),e.getEntries(t,s).next(i=>{let o=Co();return n.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(De.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):de("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{cs:o,ls:r}})}function Gee(t,e){const n=Me(t);return n.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function Hee(t,e){const n=Me(t);return n.persistence.runTransaction("Allocate target","readwrite",s=>{let r;return n.Qr.getTargetData(s,e).next(i=>i?(r=i,J.resolve(r)):n.Qr.allocateTargetId(s).next(o=>(r=new ha(e,o,"TargetPurposeListen",s.currentSequenceNumber),n.Qr.addTargetData(s,r).next(()=>r))))}).then(s=>{const r=n.ns.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(s.targetId,s),n.rs.set(e,s.targetId)),s})}async function NS(t,e,n){const s=Me(t),r=s.ns.get(e),i=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",i,o=>s.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!Cm(o))throw o;de("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}s.ns=s.ns.remove(e),s.rs.delete(r.target)}function pO(t,e,n){const s=Me(t);let r=De.min(),i=qe();return s.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,c){const h=Me(l),d=h.rs.get(c);return d!==void 0?J.resolve(h.ns.get(d)):h.Qr.getTargetData(u,c)}(s,o,Mi(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Qr.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>s.ts.getDocumentsMatchingQuery(o,e,n?r:De.min(),n?i:qe())).next(a=>(qee(s,LZ(e),a),{documents:a,hs:i})))}function qee(t,e,n){let s=t.ss.get(e)||De.min();n.forEach((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)}),t.ss.set(e,s)}class mO{constructor(){this.activeTargetIds=WZ()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Kee{constructor(){this.no=new mO,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,s){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,n,s){this.ro[e]=n}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new mO,Promise.resolve()}handleUserChange(e,n,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xee{io(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gO{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){de("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){de("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yy=null;function LI(){return Yy===null?Yy=function(){return 268435456+Math.round(2147483648*Math.random())}():Yy++,"0x"+Yy.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qee={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yee{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ts="WebChannelConnection";class Jee extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const s=n.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.fo=s+"://"+n.host,this.po=`projects/${r}/databases/${i}`,this.yo=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${i}`}get wo(){return!1}So(n,s,r,i,o){const a=LI(),l=this.bo(n,s.toUriEncodedString());de("RestConnection",`Sending RPC '${n}' ${a}:`,l,r);const u={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(u,i,o),this.Co(n,l,u,r).then(c=>(de("RestConnection",`Received RPC '${n}' ${a}: `,c),c),c=>{throw Jc("RestConnection",`RPC '${n}' ${a} failed with error: `,c,"url: ",l,"request:",r),c})}vo(n,s,r,i,o,a){return this.So(n,s,r,i,o)}Do(n,s,r){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+kh}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((i,o)=>n[o]=i),r&&r.headers.forEach((i,o)=>n[o]=i)}bo(n,s){const r=Qee[n];return`${this.fo}/v1/${s}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,n,s,r){const i=LI();return new Promise((o,a)=>{const l=new sZ;l.setWithCredentials(!0),l.listenOnce(tZ.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case PI.NO_ERROR:const c=l.getResponseJson();de(ts,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(c)),o(c);break;case PI.TIMEOUT:de(ts,`RPC '${e}' ${i} timed out`),a(new me(Q.DEADLINE_EXCEEDED,"Request time out"));break;case PI.HTTP_ERROR:const h=l.getStatus();if(de(ts,`RPC '${e}' ${i} failed with status:`,h,"response text:",l.getResponseText()),h>0){let d=l.getResponseJson();Array.isArray(d)&&(d=d[0]);const f=d==null?void 0:d.error;if(f&&f.status&&f.message){const p=function(g){const y=g.toLowerCase().replace(/_/g,"-");return Object.values(Q).indexOf(y)>=0?y:Q.UNKNOWN}(f.status);a(new me(p,f.message))}else a(new me(Q.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new me(Q.UNAVAILABLE,"Connection failed."));break;default:Ne()}}finally{de(ts,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(r);de(ts,`RPC '${e}' ${i} sending request:`,r),l.send(n,"POST",u,s,15)})}Fo(e,n,s){const r=LI(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=ZJ(),a=eZ(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Do(l.initMessageHeaders,n,s),l.encodeInitMessageHeaders=!0;const c=i.join("");de(ts,`Creating RPC '${e}' stream ${r}: ${c}`,l);const h=o.createWebChannel(c,l);let d=!1,f=!1;const p=new Yee({lo:g=>{f?de(ts,`Not sending because RPC '${e}' stream ${r} is closed:`,g):(d||(de(ts,`Opening RPC '${e}' stream ${r} transport.`),h.open(),d=!0),de(ts,`RPC '${e}' stream ${r} sending:`,g),h.send(g))},ho:()=>h.close()}),m=(g,y,w)=>{g.listen(y,x=>{try{w(x)}catch(v){setTimeout(()=>{throw v},0)}})};return m(h,Ky.EventType.OPEN,()=>{f||de(ts,`RPC '${e}' stream ${r} transport opened.`)}),m(h,Ky.EventType.CLOSE,()=>{f||(f=!0,de(ts,`RPC '${e}' stream ${r} transport closed`),p.Vo())}),m(h,Ky.EventType.ERROR,g=>{f||(f=!0,Jc(ts,`RPC '${e}' stream ${r} transport errored:`,g),p.Vo(new me(Q.UNAVAILABLE,"The operation could not be completed")))}),m(h,Ky.EventType.MESSAGE,g=>{var y;if(!f){const w=g.data[0];yt(!!w);const x=w,v=x.error||((y=x[0])===null||y===void 0?void 0:y.error);if(v){de(ts,`RPC '${e}' stream ${r} received error:`,v);const b=v.status;let S=function(E){const N=en[E];if(N!==void 0)return zz(N)}(b),T=v.message;S===void 0&&(S=Q.INTERNAL,T="Unknown error status: "+b+" with message "+v.message),f=!0,p.Vo(new me(S,T)),h.close()}else de(ts,`RPC '${e}' stream ${r} received:`,w),p.mo(w)}}),m(a,nZ.STAT_EVENT,g=>{g.stat===GD.PROXY?de(ts,`RPC '${e}' stream ${r} detected buffering proxy`):g.stat===GD.NOPROXY&&de(ts,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{p.Ro()},0),p}}function MI(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ax(t){return new uee(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jz{constructor(e,n,s=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=n,this.Mo=s,this.xo=r,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const n=Math.floor(this.No+this.Qo()),s=Math.max(0,Date.now()-this.Lo),r=Math.max(0,n-s);r>0&&de("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${n} ms, last attempt: ${s} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,()=>(this.Lo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Bo!==null&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){this.Bo!==null&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zz{constructor(e,n,s,r,i,o,a,l){this.oi=e,this.$o=s,this.Uo=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Jz(e,n)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,n){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,e!==4?this.jo.reset():n&&n.code===Q.RESOURCE_EXHAUSTED?(Hi(n.toString()),Hi("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):n&&n.code===Q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(n)}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),n=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.Wo===n&&this.o_(s,r)},s=>{e(()=>{const r=new me(Q.UNKNOWN,"Fetching auth token failed: "+s.message);return this.__(r)})})}o_(e,n){const s=this.s_(this.Wo);this.stream=this.a_(e,n),this.stream.Po(()=>{s(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(r=>{s(()=>this.__(r))}),this.stream.onMessage(r=>{s(()=>this.onMessage(r))})}Yo(){this.state=5,this.jo.qo(async()=>{this.state=0,this.start()})}__(e){return de("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return n=>{this.oi.enqueueAndForget(()=>this.Wo===e?n():(de("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Zee extends Zz{constructor(e,n,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,s,r,o),this.serializer=i}a_(e,n){return this.connection.Fo("Listen",e,n)}onMessage(e){this.jo.reset();const n=dee(this.serializer,e),s=function(i){if(!("targetChange"in i))return De.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?De.min():o.readTime?Vi(o.readTime):De.min()}(e);return this.listener.u_(n,s)}c_(e){const n={};n.database=kS(this.serializer),n.addTarget=function(i,o){let a;const l=o.target;if(a=IS(l)?{documents:mee(i,l)}:{query:gee(i,l).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Wz(i,o.resumeToken);const u=_S(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(De.min())>0){a.readTime=Aw(i,o.snapshotVersion.toTimestamp());const u=_S(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const s=wee(this.serializer,e);s&&(n.labels=s),this.t_(n)}l_(e){const n={};n.database=kS(this.serializer),n.removeTarget=e,this.t_(n)}}class ete extends Zz{constructor(e,n,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,s,r,o),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,n){return this.connection.Fo("Write",e,n)}onMessage(e){if(yt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const n=pee(e.writeResults,e.commitTime),s=Vi(e.commitTime);return this.listener.T_(s,n)}return yt(!e.writeResults||e.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=kS(this.serializer),this.t_(e)}I_(e){const n={streamToken:this.lastStreamToken,writes:e.map(s=>fee(this.serializer,s))};this.t_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tte extends class{}{constructor(e,n,s,r){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=s,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new me(Q.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,n,s,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.So(e,CS(n,s),r,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new me(Q.UNKNOWN,i.toString())})}vo(e,n,s,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,CS(n,s),r,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new me(Q.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}}class nte{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,e==="Online"&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Hi(n),this.g_=!1):de("OnlineStateTracker",n)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ste{constructor(e,n,s,r,i){this.localStore=e,this.datastore=n,this.asyncQueue=s,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io(o=>{s.enqueueAndForget(async()=>{Fu(this)&&(de("RemoteStore","Restarting streams for network reachability change."),await async function(l){const u=Me(l);u.v_.add(4),await Nm(u),u.x_.set("Unknown"),u.v_.delete(4),await lx(u)}(this))})}),this.x_=new nte(s,r)}}async function lx(t){if(Fu(t))for(const e of t.F_)await e(!0)}async function Nm(t){for(const e of t.F_)await e(!1)}function eB(t,e){const n=Me(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),$E(n)?NE(n):Ah(n).Jo()&&kE(n,e))}function tB(t,e){const n=Me(t),s=Ah(n);n.C_.delete(e),s.Jo()&&nB(n,e),n.C_.size===0&&(s.Jo()?s.Xo():Fu(n)&&n.x_.set("Unknown"))}function kE(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(De.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ah(t).c_(e)}function nB(t,e){t.O_.Oe(e),Ah(t).l_(e)}function NE(t){t.O_=new iee({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Ah(t).start(),t.x_.p_()}function $E(t){return Fu(t)&&!Ah(t).Ho()&&t.C_.size>0}function Fu(t){return Me(t).v_.size===0}function sB(t){t.O_=void 0}async function rte(t){t.C_.forEach((e,n)=>{kE(t,e)})}async function ite(t,e){sB(t),$E(t)?(t.x_.S_(e),NE(t)):t.x_.set("Unknown")}async function ote(t,e,n){if(t.x_.set("Online"),e instanceof Uz&&e.state===2&&e.cause)try{await async function(r,i){const o=i.cause;for(const a of i.targetIds)r.C_.has(a)&&(await r.remoteSyncer.rejectListen(a,o),r.C_.delete(a),r.O_.removeTarget(a))}(t,e)}catch(s){de("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),s),await Rw(t,s)}else if(e instanceof A0?t.O_.$e(e):e instanceof Bz?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(De.min()))try{const s=await Yz(t.localStore);n.compareTo(s)>=0&&await function(i,o){const a=i.O_.it(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const c=i.C_.get(u);c&&i.C_.set(u,c.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const c=i.C_.get(l);if(!c)return;i.C_.set(l,c.withResumeToken(ds.EMPTY_BYTE_STRING,c.snapshotVersion)),nB(i,l);const h=new ha(c.target,l,u,c.sequenceNumber);kE(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(s){de("RemoteStore","Failed to raise snapshot:",s),await Rw(t,s)}}async function Rw(t,e,n){if(!Cm(e))throw e;t.v_.add(1),await Nm(t),t.x_.set("Offline"),n||(n=()=>Yz(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{de("RemoteStore","Retrying IndexedDB access"),await n(),t.v_.delete(1),await lx(t)})}function rB(t,e){return e().catch(n=>Rw(t,n,e))}async function ux(t){const e=Me(t),n=Fa(e);let s=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;ate(e);)try{const r=await Gee(e.localStore,s);if(r===null){e.D_.length===0&&n.Xo();break}s=r.batchId,lte(e,r)}catch(r){await Rw(e,r)}iB(e)&&oB(e)}function ate(t){return Fu(t)&&t.D_.length<10}function lte(t,e){t.D_.push(e);const n=Fa(t);n.Jo()&&n.P_&&n.I_(e.mutations)}function iB(t){return Fu(t)&&!Fa(t).Ho()&&t.D_.length>0}function oB(t){Fa(t).start()}async function ute(t){Fa(t).d_()}async function cte(t){const e=Fa(t);for(const n of t.D_)e.I_(n.mutations)}async function hte(t,e,n){const s=t.D_.shift(),r=IE.from(s,e,n);await rB(t,()=>t.remoteSyncer.applySuccessfulWrite(r)),await ux(t)}async function dte(t,e){e&&Fa(t).P_&&await async function(s,r){if(function(o){return nee(o)&&o!==Q.ABORTED}(r.code)){const i=s.D_.shift();Fa(s).Zo(),await rB(s,()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r)),await ux(s)}}(t,e),iB(t)&&oB(t)}async function yO(t,e){const n=Me(t);n.asyncQueue.verifyOperationInProgress(),de("RemoteStore","RemoteStore received new credentials");const s=Fu(n);n.v_.add(3),await Nm(n),s&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),await lx(n)}async function fte(t,e){const n=Me(t);e?(n.v_.delete(2),await lx(n)):e||(n.v_.add(2),await Nm(n),n.x_.set("Unknown"))}function Ah(t){return t.N_||(t.N_=function(n,s,r){const i=Me(n);return i.R_(),new Zee(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(t.datastore,t.asyncQueue,{Po:rte.bind(null,t),To:ite.bind(null,t),u_:ote.bind(null,t)}),t.F_.push(async e=>{e?(t.N_.Zo(),$E(t)?NE(t):t.x_.set("Unknown")):(await t.N_.stop(),sB(t))})),t.N_}function Fa(t){return t.B_||(t.B_=function(n,s,r){const i=Me(n);return i.R_(),new ete(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(t.datastore,t.asyncQueue,{Po:ute.bind(null,t),To:dte.bind(null,t),E_:cte.bind(null,t),T_:hte.bind(null,t)}),t.F_.push(async e=>{e?(t.B_.Zo(),await ux(t)):(await t.B_.stop(),t.D_.length>0&&(de("RemoteStore",`Stopping write stream with ${t.D_.length} pending writes`),t.D_=[]))})),t.B_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE{constructor(e,n,s,r,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new wo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,s,r,i){const o=Date.now()+s,a=new AE(e,n,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new me(Q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function RE(t,e){if(Hi("AsyncQueue",`${e}: ${t}`),Cm(t))return new me(Q.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vc{constructor(e){this.comparator=e?(n,s)=>e(n,s)||Se.comparator(n.key,s.key):(n,s)=>Se.comparator(n.key,s.key),this.keyedMap=Tf(),this.sortedSet=new Vt(this.comparator)}static emptySet(e){return new Vc(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,s)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Vc)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;n.hasNext();){const r=n.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const s=new Vc;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=n,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wO{constructor(){this.L_=new Vt(Se.comparator)}track(e){const n=e.doc.key,s=this.L_.get(n);s?e.type!==0&&s.type===3?this.L_=this.L_.insert(n,e):e.type===3&&s.type!==1?this.L_=this.L_.insert(n,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.L_=this.L_.insert(n,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.L_=this.L_.insert(n,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.L_=this.L_.remove(n):e.type===1&&s.type===2?this.L_=this.L_.insert(n,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.L_=this.L_.insert(n,{type:2,doc:e.doc}):Ne():this.L_=this.L_.insert(n,e)}k_(){const e=[];return this.L_.inorderTraversal((n,s)=>{e.push(s)}),e}}class sh{constructor(e,n,s,r,i,o,a,l,u){this.query=e,this.docs=n,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,n,s,r,i){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new sh(e,n,Vc.emptySet(n),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nx(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,s=e.docChanges;if(n.length!==s.length)return!1;for(let r=0;r<n.length;r++)if(n[r].type!==s[r].type||!n[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pte{constructor(){this.q_=void 0,this.Q_=[]}}class mte{constructor(){this.queries=new $h(e=>Ez(e),nx),this.onlineState="Unknown",this.K_=new Set}}async function aB(t,e){const n=Me(t),s=e.query;let r=!1,i=n.queries.get(s);if(i||(r=!0,i=new pte),r)try{i.q_=await n.onListen(s)}catch(o){const a=RE(o,`Initialization of query '${lc(e.query)}' failed`);return void e.onError(a)}n.queries.set(s,i),i.Q_.push(e),e.U_(n.onlineState),i.q_&&e.W_(i.q_)&&DE(n)}async function lB(t,e){const n=Me(t),s=e.query;let r=!1;const i=n.queries.get(s);if(i){const o=i.Q_.indexOf(e);o>=0&&(i.Q_.splice(o,1),r=i.Q_.length===0)}if(r)return n.queries.delete(s),n.onUnlisten(s)}function gte(t,e){const n=Me(t);let s=!1;for(const r of e){const i=r.query,o=n.queries.get(i);if(o){for(const a of o.Q_)a.W_(r)&&(s=!0);o.q_=r}}s&&DE(n)}function yte(t,e,n){const s=Me(t),r=s.queries.get(e);if(r)for(const i of r.Q_)i.onError(n);s.queries.delete(e)}function DE(t){t.K_.forEach(e=>{e.next()})}class uB{constructor(e,n,s){this.query=e,this.G_=n,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=s||{}}W_(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new sh(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.z_?this.H_(e)&&(this.G_.next(e),n=!0):this.J_(e,this.onlineState)&&(this.Y_(e),n=!0),this.j_=e,n}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let n=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),n=!0),n}J_(e,n){if(!e.fromCache)return!0;const s=n!=="Offline";return(!this.options.Z_||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}H_(e){if(e.docChanges.length>0)return!0;const n=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Y_(e){e=sh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cB{constructor(e){this.key=e}}class hB{constructor(e){this.key=e}}class wte{constructor(e,n){this.query=e,this.oa=n,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=qe(),this.mutatedKeys=qe(),this.ua=kz(e),this.ca=new Vc(this.ua)}get la(){return this.oa}ha(e,n){const s=n?n.Pa:new wO,r=n?n.ca:this.ca;let i=n?n.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((c,h)=>{const d=r.get(c),f=sx(this.query,h)?h:null,p=!!d&&this.mutatedKeys.has(d.key),m=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let g=!1;d&&f?d.data.isEqual(f.data)?p!==m&&(s.track({type:3,doc:f}),g=!0):this.Ia(d,f)||(s.track({type:2,doc:f}),g=!0,(l&&this.ua(f,l)>0||u&&this.ua(f,u)<0)&&(a=!0)):!d&&f?(s.track({type:0,doc:f}),g=!0):d&&!f&&(s.track({type:1,doc:d}),g=!0,(l||u)&&(a=!0)),g&&(f?(o=o.add(f),i=m?i.add(c):i.delete(c)):(o=o.delete(c),i=i.delete(c)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const c=this.query.limitType==="F"?o.last():o.first();o=o.delete(c.key),i=i.delete(c.key),s.track({type:1,doc:c})}return{ca:o,Pa:s,Xi:a,mutatedKeys:i}}Ia(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,s,r){const i=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;const o=e.Pa.k_();o.sort((c,h)=>function(f,p){const m=g=>{switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ne()}};return m(f)-m(p)}(c.type,h.type)||this.ua(c.doc,h.doc)),this.Ta(s),r=r!=null&&r;const a=n&&!r?this.Ea():[],l=this.aa.size===0&&this.current&&!r?1:0,u=l!==this._a;return this._a=l,o.length!==0||u?{snapshot:new sh(this.query,e.ca,i,o,e.mutatedKeys,l===0,u,!1,!!s&&s.resumeToken.approximateByteSize()>0),da:a}:{da:a}}U_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new wO,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach(n=>this.oa=this.oa.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.oa=this.oa.delete(n)),this.current=e.current)}Ea(){if(!this.current)return[];const e=this.aa;this.aa=qe(),this.ca.forEach(s=>{this.Aa(s.key)&&(this.aa=this.aa.add(s.key))});const n=[];return e.forEach(s=>{this.aa.has(s)||n.push(new hB(s))}),this.aa.forEach(s=>{e.has(s)||n.push(new cB(s))}),n}Ra(e){this.oa=e.hs,this.aa=qe();const n=this.ha(e.documents);return this.applyChanges(n,!0)}Va(){return sh.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,this._a===0,this.hasCachedResults)}}class vte{constructor(e,n,s){this.query=e,this.targetId=n,this.view=s}}class xte{constructor(e){this.key=e,this.ma=!1}}class bte{constructor(e,n,s,r,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new $h(a=>Ez(a),nx),this.pa=new Map,this.ya=new Set,this.wa=new Vt(Se.comparator),this.Sa=new Map,this.ba=new _E,this.Da={},this.Ca=new Map,this.va=nh.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return this.Fa===!0}}async function Ite(t,e){const n=Rte(t);let s,r;const i=n.ga.get(e);if(i)s=i.targetId,n.sharedClientState.addLocalQueryTarget(s),r=i.view.Va();else{const o=await Hee(n.localStore,Mi(e)),a=n.sharedClientState.addLocalQueryTarget(o.targetId);s=o.targetId,r=await Tte(n,e,s,a==="current",o.resumeToken),n.isPrimaryClient&&eB(n.remoteStore,o)}return r}async function Tte(t,e,n,s,r){t.Ma=(h,d,f)=>async function(m,g,y,w){let x=g.view.ha(y);x.Xi&&(x=await pO(m.localStore,g.query,!1).then(({documents:T})=>g.view.ha(T,x)));const v=w&&w.targetChanges.get(g.targetId),b=w&&w.targetMismatches.get(g.targetId)!=null,S=g.view.applyChanges(x,m.isPrimaryClient,v,b);return xO(m,g.targetId,S.da),S.snapshot}(t,h,d,f);const i=await pO(t.localStore,e,!0),o=new wte(e,i.hs),a=o.ha(i.documents),l=km.createSynthesizedTargetChangeForCurrentChange(n,s&&t.onlineState!=="Offline",r),u=o.applyChanges(a,t.isPrimaryClient,l);xO(t,n,u.da);const c=new vte(e,n,o);return t.ga.set(e,c),t.pa.has(n)?t.pa.get(n).push(e):t.pa.set(n,[e]),u.snapshot}async function Ste(t,e){const n=Me(t),s=n.ga.get(e),r=n.pa.get(s.targetId);if(r.length>1)return n.pa.set(s.targetId,r.filter(i=>!nx(i,e))),void n.ga.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await NS(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),tB(n.remoteStore,s.targetId),$S(n,s.targetId)}).catch(_m)):($S(n,s.targetId),await NS(n.localStore,s.targetId,!0))}async function _te(t,e,n){const s=Dte(t);try{const r=await function(o,a){const l=Me(o),u=yn.now(),c=a.reduce((f,p)=>f.add(p.key),qe());let h,d;return l.persistence.runTransaction("Locally write mutations","readwrite",f=>{let p=Co(),m=qe();return l.os.getEntries(f,c).next(g=>{p=g,p.forEach((y,w)=>{w.isValidDocument()||(m=m.add(y))})}).next(()=>l.localDocuments.getOverlayedDocuments(f,p)).next(g=>{h=g;const y=[];for(const w of a){const x=YZ(w,h.get(w.key).overlayedDocument);x!=null&&y.push(new el(w.key,x,vz(x.value.mapValue),ri.exists(!0)))}return l.mutationQueue.addMutationBatch(f,u,y,a)}).next(g=>{d=g;const y=g.applyToLocalDocumentSet(h,m);return l.documentOverlayCache.saveOverlays(f,g.batchId,y)})}).then(()=>({batchId:d.batchId,changes:$z(h)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),function(o,a,l){let u=o.Da[o.currentUser.toKey()];u||(u=new Vt(tt)),u=u.insert(a,l),o.Da[o.currentUser.toKey()]=u}(s,r.batchId,n),await $m(s,r.changes),await ux(s.remoteStore)}catch(r){const i=RE(r,"Failed to persist write");n.reject(i)}}async function dB(t,e){const n=Me(t);try{const s=await Wee(n.localStore,e);e.targetChanges.forEach((r,i)=>{const o=n.Sa.get(i);o&&(yt(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.ma=!0:r.modifiedDocuments.size>0?yt(o.ma):r.removedDocuments.size>0&&(yt(o.ma),o.ma=!1))}),await $m(n,s,e)}catch(s){await _m(s)}}function vO(t,e,n){const s=Me(t);if(s.isPrimaryClient&&n===0||!s.isPrimaryClient&&n===1){const r=[];s.ga.forEach((i,o)=>{const a=o.view.U_(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){const l=Me(o);l.onlineState=a;let u=!1;l.queries.forEach((c,h)=>{for(const d of h.Q_)d.U_(a)&&(u=!0)}),u&&DE(l)}(s.eventManager,e),r.length&&s.fa.u_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function Cte(t,e,n){const s=Me(t);s.sharedClientState.updateQueryState(e,"rejected",n);const r=s.Sa.get(e),i=r&&r.key;if(i){let o=new Vt(Se.comparator);o=o.insert(i,is.newNoDocument(i,De.min()));const a=qe().add(i),l=new ox(De.min(),new Map,new Vt(tt),o,a);await dB(s,l),s.wa=s.wa.remove(i),s.Sa.delete(e),OE(s)}else await NS(s.localStore,e,!1).then(()=>$S(s,e,n)).catch(_m)}async function Ete(t,e){const n=Me(t),s=e.batch.batchId;try{const r=await Uee(n.localStore,e);pB(n,s,null),fB(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await $m(n,r)}catch(r){await _m(r)}}async function kte(t,e,n){const s=Me(t);try{const r=await function(o,a){const l=Me(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return l.mutationQueue.lookupMutationBatch(u,a).next(h=>(yt(h!==null),c=h.keys(),l.mutationQueue.removeMutationBatch(u,h))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,c,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>l.localDocuments.getDocuments(u,c))})}(s.localStore,e);pB(s,e,n),fB(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await $m(s,r)}catch(r){await _m(r)}}function fB(t,e){(t.Ca.get(e)||[]).forEach(n=>{n.resolve()}),t.Ca.delete(e)}function pB(t,e,n){const s=Me(t);let r=s.Da[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(n?i.reject(n):i.resolve(),r=r.remove(e)),s.Da[s.currentUser.toKey()]=r}}function $S(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.pa.get(e))t.ga.delete(s),n&&t.fa.xa(s,n);t.pa.delete(e),t.isPrimaryClient&&t.ba.Vr(e).forEach(s=>{t.ba.containsKey(s)||mB(t,s)})}function mB(t,e){t.ya.delete(e.path.canonicalString());const n=t.wa.get(e);n!==null&&(tB(t.remoteStore,n),t.wa=t.wa.remove(e),t.Sa.delete(n),OE(t))}function xO(t,e,n){for(const s of n)s instanceof cB?(t.ba.addReference(s.key,e),Nte(t,s)):s instanceof hB?(de("SyncEngine","Document no longer in limbo: "+s.key),t.ba.removeReference(s.key,e),t.ba.containsKey(s.key)||mB(t,s.key)):Ne()}function Nte(t,e){const n=e.key,s=n.path.canonicalString();t.wa.get(n)||t.ya.has(s)||(de("SyncEngine","New document in limbo: "+n),t.ya.add(s),OE(t))}function OE(t){for(;t.ya.size>0&&t.wa.size<t.maxConcurrentLimboResolutions;){const e=t.ya.values().next().value;t.ya.delete(e);const n=new Se(Tt.fromString(e)),s=t.va.next();t.Sa.set(s,new xte(n)),t.wa=t.wa.insert(n,s),eB(t.remoteStore,new ha(Mi(xE(n.path)),s,"TargetPurposeLimboResolution",pE._e))}}async function $m(t,e,n){const s=Me(t),r=[],i=[],o=[];s.ga.isEmpty()||(s.ga.forEach((a,l)=>{o.push(s.Ma(l,e,n).then(u=>{if((u||n)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(l.targetId,u!=null&&u.fromCache?"not-current":"current"),u){r.push(u);const c=EE.Ki(l.targetId,u);i.push(c)}}))}),await Promise.all(o),s.fa.u_(r),await async function(l,u){const c=Me(l);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>J.forEach(u,d=>J.forEach(d.qi,f=>c.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>J.forEach(d.Qi,f=>c.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!Cm(h))throw h;de("LocalStore","Failed to update sequence numbers: "+h)}for(const h of u){const d=h.targetId;if(!h.fromCache){const f=c.ns.get(d),p=f.snapshotVersion,m=f.withLastLimboFreeSnapshotVersion(p);c.ns=c.ns.insert(d,m)}}}(s.localStore,i))}async function $te(t,e){const n=Me(t);if(!n.currentUser.isEqual(e)){de("SyncEngine","User change. New user:",e.toKey());const s=await Qz(n.localStore,e);n.currentUser=e,function(i,o){i.Ca.forEach(a=>{a.forEach(l=>{l.reject(new me(Q.CANCELLED,o))})}),i.Ca.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await $m(n,s.us)}}function Ate(t,e){const n=Me(t),s=n.Sa.get(e);if(s&&s.ma)return qe().add(s.key);{let r=qe();const i=n.pa.get(e);if(!i)return r;for(const o of i){const a=n.ga.get(o);r=r.unionWith(a.view.la)}return r}}function Rte(t){const e=Me(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=dB.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ate.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Cte.bind(null,e),e.fa.u_=gte.bind(null,e.eventManager),e.fa.xa=yte.bind(null,e.eventManager),e}function Dte(t){const e=Me(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ete.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=kte.bind(null,e),e}class bO{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=ax(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,n){return null}createIndexBackfillerScheduler(e,n){return null}createLocalStore(e){return Bee(this.persistence,new Vee,e.initialUser,this.serializer)}createPersistence(e){return new Fee(CE.Hr,this.serializer)}createSharedClientState(e){return new Kee}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Ote{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>vO(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=$te.bind(null,this.syncEngine),await fte(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new mte}()}createDatastore(e){const n=ax(e.databaseInfo.databaseId),s=function(i){return new Jee(i)}(e.databaseInfo);return function(i,o,a,l){return new tte(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return function(s,r,i,o,a){return new ste(s,r,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>vO(this.syncEngine,n,0),function(){return gO.D()?new gO:new Xee}())}createSyncEngine(e,n){return function(r,i,o,a,l,u,c){const h=new bte(r,i,o,a,l,u);return c&&(h.Fa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e;await async function(s){const r=Me(s);de("RemoteStore","RemoteStore shutting down."),r.v_.add(5),await Nm(r),r.M_.shutdown(),r.x_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gB{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):Hi("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pte{constructor(e,n,s,r){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=s,this.databaseInfo=r,this.user=ns.UNAUTHENTICATED,this.clientId=gz.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,async i=>{de("FirestoreClient","Received user=",i.uid),await this.authCredentialListener(i),this.user=i}),this.appCheckCredentials.start(s,i=>(de("FirestoreClient","Received new app check token=",i),this.appCheckCredentialListener(i,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new me(Q.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new wo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const s=RE(n,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function VI(t,e){t.asyncQueue.verifyOperationInProgress(),de("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener(async r=>{s.isEqual(r)||(await Qz(e.localStore,r),s=r)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function IO(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Lte(t);de("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(s=>yO(e.remoteStore,s)),t.setAppCheckTokenChangeListener((s,r)=>yO(e.remoteStore,r)),t._onlineComponents=e}function Fte(t){return t.name==="FirebaseError"?t.code===Q.FAILED_PRECONDITION||t.code===Q.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}async function Lte(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){de("FirestoreClient","Using user provided OfflineComponentProvider");try{await VI(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!Fte(n))throw n;Jc("Error using user provided cache. Falling back to memory cache: "+n),await VI(t,new bO)}}else de("FirestoreClient","Using default OfflineComponentProvider"),await VI(t,new bO);return t._offlineComponents}async function yB(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(de("FirestoreClient","Using user provided OnlineComponentProvider"),await IO(t,t._uninitializedComponentsProvider._online)):(de("FirestoreClient","Using default OnlineComponentProvider"),await IO(t,new Ote))),t._onlineComponents}function Mte(t){return yB(t).then(e=>e.syncEngine)}async function AS(t){const e=await yB(t),n=e.eventManager;return n.onListen=Ite.bind(null,e.syncEngine),n.onUnlisten=Ste.bind(null,e.syncEngine),n}function Vte(t,e,n={}){const s=new wo;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const c=new gB({next:d=>{o.enqueueAndForget(()=>lB(i,h)),d.fromCache&&l.source==="server"?u.reject(new me(Q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new uB(a,c,{includeMetadataChanges:!0,Z_:!0});return aB(i,h)}(await AS(t),t.asyncQueue,e,n,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wB(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TO=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vB(t,e,n){if(!n)throw new me(Q.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function zte(t,e,n,s){if(e===!0&&s===!0)throw new me(Q.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function SO(t){if(!Se.isDocumentKey(t))throw new me(Q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function _O(t){if(Se.isDocumentKey(t))throw new me(Q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function cx(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ne()}function zi(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new me(Q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=cx(t);throw new me(Q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CO{constructor(e){var n,s;if(e.host===void 0){if(e.ssl!==void 0)throw new me(Q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new me(Q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}zte("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=wB((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new me(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new me(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new me(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,r){return s.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hx{constructor(e,n,s,r){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new CO({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new me(Q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new me(Q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new CO(e),e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new iZ;switch(s.type){case"firstParty":return new uZ(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new me(Q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const s=TO.get(n);s&&(de("ComponentProvider","Removing Datastore"),TO.delete(n),s.terminate())}(this),Promise.resolve()}}function Bte(t,e,n,s={}){var r;const i=(t=zi(t,hx))._getSettings(),o=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Jc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),s.mockUserToken){let a,l;if(typeof s.mockUserToken=="string")a=s.mockUserToken,l=ns.MOCK_USER;else{a=KM(s.mockUserToken,(r=t._app)===null||r===void 0?void 0:r.options.projectId);const u=s.mockUserToken.sub||s.mockUserToken.user_id;if(!u)throw new me(Q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ns(u)}t._authCredentials=new oZ(new mz(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl{constructor(e,n,s){this.converter=n,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new tl(this.firestore,e,this._query)}}class Ks{constructor(e,n,s){this.converter=n,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ea(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ks(this.firestore,e,this._key)}}class Ea extends tl{constructor(e,n,s){super(e,n,xE(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ks(this.firestore,null,new Se(e))}withConverter(e){return new Ea(this.firestore,e,this._path)}}function EO(t,e,...n){if(t=Ut(t),vB("collection","path",e),t instanceof hx){const s=Tt.fromString(e,...n);return _O(s),new Ea(t,null,s)}{if(!(t instanceof Ks||t instanceof Ea))throw new me(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Tt.fromString(e,...n));return _O(s),new Ea(t.firestore,null,s)}}function Mp(t,e,...n){if(t=Ut(t),arguments.length===1&&(e=gz.newId()),vB("doc","path",e),t instanceof hx){const s=Tt.fromString(e,...n);return SO(s),new Ks(t,null,new Se(s))}{if(!(t instanceof Ks||t instanceof Ea))throw new me(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Tt.fromString(e,...n));return SO(s),new Ks(t.firestore,t instanceof Ea?t.converter:null,new Se(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ute{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new Jz(this,"async_queue_retry"),this._u=()=>{const n=MI();n&&de("AsyncQueue","Visibility state changed to "+n.visibilityState),this.jo.Ko()};const e=MI();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;const n=MI();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise(()=>{});const n=new wo;return this.uu(()=>this.tu&&this.su?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.eu.push(e),this.cu()))}async cu(){if(this.eu.length!==0){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(e){if(!Cm(e))throw e;de("AsyncQueue","Operation failed with retryable error: "+e)}this.eu.length>0&&this.jo.qo(()=>this.cu())}}uu(e){const n=this.Xa.then(()=>(this.iu=!0,e().catch(s=>{this.ru=s,this.iu=!1;const r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(s);throw Hi("INTERNAL UNHANDLED ERROR: ",r),s}).then(s=>(this.iu=!1,s))));return this.Xa=n,n}enqueueAfterDelay(e,n,s){this.au(),this.ou.indexOf(e)>-1&&(n=0);const r=AE.createAndSchedule(this,e,n,s,i=>this.lu(i));return this.nu.push(r),r}au(){this.ru&&Ne()}verifyOperationInProgress(){}async hu(){let e;do e=this.Xa,await e;while(e!==this.Xa)}Pu(e){for(const n of this.nu)if(n.timerId===e)return!0;return!1}Iu(e){return this.hu().then(()=>{this.nu.sort((n,s)=>n.targetTimeMs-s.targetTimeMs);for(const n of this.nu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.hu()})}Tu(e){this.ou.push(e)}lu(e){const n=this.nu.indexOf(e);this.nu.splice(n,1)}}function kO(t){return function(n,s){if(typeof n!="object"||n===null)return!1;const r=n;for(const i of s)if(i in r&&typeof r[i]=="function")return!0;return!1}(t,["next","error","complete"])}class lu extends hx{constructor(e,n,s,r){super(e,n,s,r),this.type="firestore",this._queue=function(){return new Ute}(),this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||bB(this),this._firestoreClient.terminate()}}function xB(t,e){const n=typeof t=="object"?t:Av(),s=typeof t=="string"?t:e||"(default)",r=Qa(n,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=GM("firestore");i&&Bte(r,...i)}return r}function PE(t){return t._firestoreClient||bB(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function bB(t){var e,n,s;const r=t._freezeSettings(),i=function(a,l,u,c){return new TZ(a,l,u,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,wB(c.experimentalLongPollingOptions),c.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,r);t._firestoreClient=new Pte(t._authCredentials,t._appCheckCredentials,t._queue,i),!((n=r.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((s=r.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new rh(ds.fromBase64String(e))}catch(n){throw new me(Q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new rh(ds.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dx{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new me(Q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fx{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FE{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new me(Q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new me(Q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return tt(this._lat,e._lat)||tt(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wte=/^__.*__$/;class jte{constructor(e,n,s){this.data=e,this.fieldMask=n,this.fieldTransforms=s}toMutation(e,n){return this.fieldMask!==null?new el(e,this.data,this.fieldMask,n,this.fieldTransforms):new Em(e,this.data,n,this.fieldTransforms)}}class IB{constructor(e,n,s){this.data=e,this.fieldMask=n,this.fieldTransforms=s}toMutation(e,n){return new el(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function TB(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ne()}}class LE{constructor(e,n,s,r,i,o){this.settings=e,this.databaseId=n,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Eu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new LE(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),r=this.Au({path:s,Vu:!1});return r.mu(e),r}fu(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),r=this.Au({path:s,Vu:!1});return r.Eu(),r}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return Dw(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(e.length===0)throw this.pu("Document fields must not be empty");if(TB(this.du)&&Wte.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}class Gte{constructor(e,n,s){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=s||ax(e)}Su(e,n,s,r=!1){return new LE({du:e,methodName:n,wu:s,path:qn.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ME(t){const e=t._freezeSettings(),n=ax(t._databaseId);return new Gte(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Hte(t,e,n,s,r,i={}){const o=t.Su(i.merge||i.mergeFields?2:0,e,n,r);zE("Data must be an object, but it was:",o,s);const a=SB(s,o);let l,u;if(i.merge)l=new ur(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const c=[];for(const h of i.mergeFields){const d=RS(e,h,n);if(!o.contains(d))throw new me(Q.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);CB(c,d)||c.push(d)}l=new ur(c),u=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,u=o.fieldTransforms;return new jte(new Vs(a),l,u)}class px extends fx{_toFieldTransform(e){if(e.du!==2)throw e.du===1?e.pu(`${this._methodName}() can only appear at the top level of your update data`):e.pu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof px}}class VE extends fx{_toFieldTransform(e){return new qZ(e.path,new Pp)}isEqual(e){return e instanceof VE}}function qte(t,e,n,s){const r=t.Su(1,e,n);zE("Data must be an object, but it was:",r,s);const i=[],o=Vs.empty();Pu(s,(l,u)=>{const c=BE(e,l,n);u=Ut(u);const h=r.fu(c);if(u instanceof px)i.push(c);else{const d=Am(u,h);d!=null&&(i.push(c),o.set(c,d))}});const a=new ur(i);return new IB(o,a,r.fieldTransforms)}function Kte(t,e,n,s,r,i){const o=t.Su(1,e,n),a=[RS(e,s,n)],l=[r];if(i.length%2!=0)throw new me(Q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)a.push(RS(e,i[d])),l.push(i[d+1]);const u=[],c=Vs.empty();for(let d=a.length-1;d>=0;--d)if(!CB(u,a[d])){const f=a[d];let p=l[d];p=Ut(p);const m=o.fu(f);if(p instanceof px)u.push(f);else{const g=Am(p,m);g!=null&&(u.push(f),c.set(f,g))}}const h=new ur(u);return new IB(c,h,o.fieldTransforms)}function Xte(t,e,n,s=!1){return Am(n,t.Su(s?4:3,e))}function Am(t,e){if(_B(t=Ut(t)))return zE("Unsupported field value:",e,t),SB(t,e);if(t instanceof fx)return function(s,r){if(!TB(r.du))throw r.pu(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.pu(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Vu&&e.du!==4)throw e.pu("Nested arrays are not supported");return function(s,r){const i=[];let o=0;for(const a of s){let l=Am(a,r.gu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(t,e)}return function(s,r){if((s=Ut(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return jZ(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=yn.fromDate(s);return{timestampValue:Aw(r.serializer,i)}}if(s instanceof yn){const i=new yn(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Aw(r.serializer,i)}}if(s instanceof FE)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof rh)return{bytesValue:Wz(r.serializer,s._byteString)};if(s instanceof Ks){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.pu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:SE(s.firestore._databaseId||r.databaseId,s._key.path)}}throw r.pu(`Unsupported field value: ${cx(s)}`)}(t,e)}function SB(t,e){const n={};return yz(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pu(t,(s,r)=>{const i=Am(r,e.Ru(s));i!=null&&(n[s]=i)}),{mapValue:{fields:n}}}function _B(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof yn||t instanceof FE||t instanceof rh||t instanceof Ks||t instanceof fx)}function zE(t,e,n){if(!_B(n)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(n)){const s=cx(n);throw s==="an object"?e.pu(t+" a custom object"):e.pu(t+" "+s)}}function RS(t,e,n){if((e=Ut(e))instanceof dx)return e._internalPath;if(typeof e=="string")return BE(t,e);throw Dw("Field path arguments must be of type string or ",t,!1,void 0,n)}const Qte=new RegExp("[~\\*/\\[\\]]");function BE(t,e,n){if(e.search(Qte)>=0)throw Dw(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new dx(...e.split("."))._internalPath}catch{throw Dw(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Dw(t,e,n,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new me(Q.INVALID_ARGUMENT,a+t+l)}function CB(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EB{constructor(e,n,s,r,i){this._firestore=e,this._userDataWriter=n,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ks(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Yte(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(UE("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Yte extends EB{data(){return super.data()}}function UE(t,e){return typeof e=="string"?BE(t,e):e instanceof dx?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kB(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new me(Q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class WE{}class NB extends WE{}function Jte(t,e,...n){let s=[];e instanceof WE&&s.push(e),s=s.concat(n),function(i){const o=i.filter(l=>l instanceof GE).length,a=i.filter(l=>l instanceof jE).length;if(o>1||o>0&&a>0)throw new me(Q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const r of s)t=r._apply(t);return t}class jE extends NB{constructor(e,n,s){super(),this._field=e,this._op=n,this._value=s,this.type="where"}static _create(e,n,s){return new jE(e,n,s)}_apply(e){const n=this._parse(e);return $B(e._query,n),new tl(e.firestore,e.converter,TS(e._query,n))}_parse(e){const n=ME(e.firestore);return function(i,o,a,l,u,c,h){let d;if(u.isKeyField()){if(c==="array-contains"||c==="array-contains-any")throw new me(Q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if(c==="in"||c==="not-in"){$O(h,c);const f=[];for(const p of h)f.push(NO(l,i,p));d={arrayValue:{values:f}}}else d=NO(l,i,h)}else c!=="in"&&c!=="not-in"&&c!=="array-contains-any"||$O(h,c),d=Xte(a,o,h,c==="in"||c==="not-in");return rn.create(u,c,d)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}class GE extends WE{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new GE(e,n)}_parse(e){const n=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return n.length===1?n[0]:fi.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(r,i){let o=r;const a=i.getFlattenedFilters();for(const l of a)$B(o,l),o=TS(o,l)}(e._query,n),new tl(e.firestore,e.converter,TS(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class HE extends NB{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new HE(e,n)}_apply(e){const n=function(r,i,o){if(r.startAt!==null)throw new me(Q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new me(Q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Op(i,o)}(e._query,this._field,this._direction);return new tl(e.firestore,e.converter,function(r,i){const o=r.explicitOrderBy.concat([i]);return new Nh(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,n))}}function Zte(t,e="asc"){const n=e,s=UE("orderBy",t);return HE._create(s,n)}function NO(t,e,n){if(typeof(n=Ut(n))=="string"){if(n==="")throw new me(Q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Cz(e)&&n.indexOf("/")!==-1)throw new me(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Tt.fromString(n));if(!Se.isDocumentKey(s))throw new me(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return YD(t,new Se(s))}if(n instanceof Ks)return YD(t,n._key);throw new me(Q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${cx(n)}.`)}function $O(t,e){if(!Array.isArray(t)||t.length===0)throw new me(Q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function $B(t,e){const n=function(r,i){for(const o of r)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new me(Q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new me(Q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class ene{convertValue(e,n="none"){switch(au(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ou(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw Ne()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const s={};return Pu(e,(r,i)=>{s[r]=this.convertValue(i,n)}),s}convertGeoPoint(e){return new FE(tn(e.latitude),tn(e.longitude))}convertArray(e,n){return(e.values||[]).map(s=>this.convertValue(s,n))}convertServerTimestamp(e,n){switch(n){case"previous":const s=gE(e);return s==null?null:this.convertValue(s,n);case"estimate":return this.convertTimestamp(Ap(e));default:return null}}convertTimestamp(e){const n=Pa(e);return new yn(n.seconds,n.nanos)}convertDocumentKey(e,n){const s=Tt.fromString(e);yt(Xz(s));const r=new Rp(s.get(1),s.get(3)),i=new Se(s.popFirst(5));return r.isEqual(n)||Hi(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tne(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class AB extends EB{constructor(e,n,s,r,i,o){super(e,n,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new R0(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const s=this._document.data.field(UE("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,n.serverTimestamps)}}}class R0 extends AB{data(e={}){return super.data(e)}}class RB{constructor(e,n,s,r){this._firestore=e,this._userDataWriter=n,this._snapshot=r,this.metadata=new _f(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(s=>{e.call(n,new R0(this._firestore,this._userDataWriter,s.key,s,new _f(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new me(Q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{const l=new R0(r._firestore,r._userDataWriter,a.doc.key,a.doc,new _f(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new R0(r._firestore,r._userDataWriter,a.doc.key,a.doc,new _f(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,c=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),c=o.indexOf(a.doc.key)),{type:nne(a.type),doc:l,oldIndex:u,newIndex:c}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function nne(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ne()}}class qE extends ene{constructor(e){super(),this.firestore=e}convertBytes(e){return new rh(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Ks(this.firestore,null,n)}}function sne(t){t=zi(t,tl);const e=zi(t.firestore,lu),n=PE(e),s=new qE(e);return kB(t._query),Vte(n,t._query).then(r=>new RB(e,s,t,r))}function DB(t,e,n,...s){t=zi(t,Ks);const r=zi(t.firestore,lu),i=ME(r);let o;return o=typeof(e=Ut(e))=="string"||e instanceof dx?Kte(i,"updateDoc",t._key,e,n,s):qte(i,"updateDoc",t._key,e),KE(r,[o.toMutation(t._key,ri.exists(!0))])}function rne(t){return KE(zi(t.firestore,lu),[new bE(t._key,ri.none())])}function ine(t,e){const n=zi(t.firestore,lu),s=Mp(t),r=tne(t.converter,e);return KE(n,[Hte(ME(t.firestore),"addDoc",s._key,r,t.converter!==null,{}).toMutation(s._key,ri.exists(!1))]).then(()=>s)}function one(t,...e){var n,s,r;t=Ut(t);let i={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||kO(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(kO(e[o])){const h=e[o];e[o]=(n=h.next)===null||n===void 0?void 0:n.bind(h),e[o+1]=(s=h.error)===null||s===void 0?void 0:s.bind(h),e[o+2]=(r=h.complete)===null||r===void 0?void 0:r.bind(h)}let l,u,c;if(t instanceof Ks)u=zi(t.firestore,lu),c=xE(t._key.path),l={next:h=>{e[o]&&e[o](ane(u,t,h))},error:e[o+1],complete:e[o+2]};else{const h=zi(t,tl);u=zi(h.firestore,lu),c=h._query;const d=new qE(u);l={next:f=>{e[o]&&e[o](new RB(u,d,h,f))},error:e[o+1],complete:e[o+2]},kB(t._query)}return function(d,f,p,m){const g=new gB(m),y=new uB(f,g,p);return d.asyncQueue.enqueueAndForget(async()=>aB(await AS(d),y)),()=>{g.La(),d.asyncQueue.enqueueAndForget(async()=>lB(await AS(d),y))}}(PE(u),c,a,l)}function KE(t,e){return function(s,r){const i=new wo;return s.asyncQueue.enqueueAndForget(async()=>_te(await Mte(s),r,i)),i.promise}(PE(t),e)}function ane(t,e,n){const s=n.docs.get(e._key),r=new qE(t);return new AB(t,r,e._key,s,new _f(n.hasPendingWrites,n.fromCache),e.converter)}function lne(){return new VE("serverTimestamp")}(function(e,n=!0){(function(r){kh=r})(Ru),ci(new Vr("firestore",(s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),a=new lu(new aZ(s.getProvider("auth-internal")),new hZ(s.getProvider("app-check-internal")),function(u,c){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new me(Q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Rp(u.options.projectId,c)}(o,r),o);return i=Object.assign({useFetchStreams:n},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Hs(HD,"4.4.3",e),Hs(HD,"4.4.3","esm2017")})();const une={apiKey:"AIzaSyD2MezLylbUWo9N8qqWhEETDlDf4GalISw",authDomain:"smart-bubble-top-server.firebaseapp.com",projectId:"smart-bubble-top-server",storageBucket:"smart-bubble-top-server.appspot.com",messagingSenderId:"1045500224068",appId:"1:1045500224068:web:d1946919ab242356c11211",measurementId:"G-KCSTCL2T1V"},OB=eV(une);XQ(OB);const cne=$X(),AO=XY(),Ec=xB();xB(OB);/**
 * @remix-run/router v1.15.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Vp(){return Vp=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Vp.apply(this,arguments)}var da;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(da||(da={}));const RO="popstate";function hne(t){t===void 0&&(t={});function e(s,r){let{pathname:i,search:o,hash:a}=s.location;return DS("",{pathname:i,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(s,r){return typeof r=="string"?r:FB(r)}return fne(e,n,null,t)}function ln(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function PB(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function dne(){return Math.random().toString(36).substr(2,8)}function DO(t,e){return{usr:t.state,key:t.key,idx:e}}function DS(t,e,n,s){return n===void 0&&(n=null),Vp({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Rh(e):e,{state:n,key:e&&e.key||s||dne()})}function FB(t){let{pathname:e="/",search:n="",hash:s=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function Rh(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let s=t.indexOf("?");s>=0&&(e.search=t.substr(s),t=t.substr(0,s)),t&&(e.pathname=t)}return e}function fne(t,e,n,s){s===void 0&&(s={});let{window:r=document.defaultView,v5Compat:i=!1}=s,o=r.history,a=da.Pop,l=null,u=c();u==null&&(u=0,o.replaceState(Vp({},o.state,{idx:u}),""));function c(){return(o.state||{idx:null}).idx}function h(){a=da.Pop;let g=c(),y=g==null?null:g-u;u=g,l&&l({action:a,location:m.location,delta:y})}function d(g,y){a=da.Push;let w=DS(m.location,g,y);n&&n(w,g),u=c()+1;let x=DO(w,u),v=m.createHref(w);try{o.pushState(x,"",v)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;r.location.assign(v)}i&&l&&l({action:a,location:m.location,delta:1})}function f(g,y){a=da.Replace;let w=DS(m.location,g,y);n&&n(w,g),u=c();let x=DO(w,u),v=m.createHref(w);o.replaceState(x,"",v),i&&l&&l({action:a,location:m.location,delta:0})}function p(g){let y=r.location.origin!=="null"?r.location.origin:r.location.href,w=typeof g=="string"?g:FB(g);return w=w.replace(/ $/,"%20"),ln(y,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,y)}let m={get action(){return a},get location(){return t(r,o)},listen(g){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(RO,h),l=g,()=>{r.removeEventListener(RO,h),l=null}},createHref(g){return e(r,g)},createURL:p,encodeLocation(g){let y=p(g);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:d,replace:f,go(g){return o.go(g)}};return m}var OO;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(OO||(OO={}));function pne(t,e,n){n===void 0&&(n="/");let s=typeof e=="string"?Rh(e):e,r=VB(s.pathname||"/",n);if(r==null)return null;let i=LB(t);mne(i);let o=null;for(let a=0;o==null&&a<i.length;++a){let l=Ene(r);o=Sne(i[a],l)}return o}function LB(t,e,n,s){e===void 0&&(e=[]),n===void 0&&(n=[]),s===void 0&&(s="");let r=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(ln(l.relativePath.startsWith(s),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(s.length));let u=Wl([s,l.relativePath]),c=n.concat(l);i.children&&i.children.length>0&&(ln(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),LB(i.children,e,c,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:Ine(u,i.index),routesMeta:c})};return t.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))r(i,o);else for(let l of MB(i.path))r(i,o,l)}),e}function MB(t){let e=t.split("/");if(e.length===0)return[];let[n,...s]=e,r=n.endsWith("?"),i=n.replace(/\?$/,"");if(s.length===0)return r?[i,""]:[i];let o=MB(s.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),r&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function mne(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:Tne(e.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}const gne=/^:[\w-]+$/,yne=3,wne=2,vne=1,xne=10,bne=-2,PO=t=>t==="*";function Ine(t,e){let n=t.split("/"),s=n.length;return n.some(PO)&&(s+=bne),e&&(s+=wne),n.filter(r=>!PO(r)).reduce((r,i)=>r+(gne.test(i)?yne:i===""?vne:xne),s)}function Tne(t,e){return t.length===e.length&&t.slice(0,-1).every((s,r)=>s===e[r])?t[t.length-1]-e[e.length-1]:0}function Sne(t,e){let{routesMeta:n}=t,s={},r="/",i=[];for(let o=0;o<n.length;++o){let a=n[o],l=o===n.length-1,u=r==="/"?e:e.slice(r.length)||"/",c=_ne({path:a.relativePath,caseSensitive:a.caseSensitive,end:l},u);if(!c)return null;Object.assign(s,c.params);let h=a.route;i.push({params:s,pathname:Wl([r,c.pathname]),pathnameBase:Ane(Wl([r,c.pathnameBase])),route:h}),c.pathnameBase!=="/"&&(r=Wl([r,c.pathnameBase]))}return i}function _ne(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,s]=Cne(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let i=r[0],o=i.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:s.reduce((u,c,h)=>{let{paramName:d,isOptional:f}=c;if(d==="*"){let m=a[h]||"";o=i.slice(0,i.length-m.length).replace(/(.)\/+$/,"$1")}const p=a[h];return f&&!p?u[d]=void 0:u[d]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:t}}function Cne(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),PB(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let s=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(s.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(s.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),s]}function Ene(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return PB(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function VB(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,s=t.charAt(n);return s&&s!=="/"?null:t.slice(n)||"/"}function kne(t,e){e===void 0&&(e="/");let{pathname:n,search:s="",hash:r=""}=typeof t=="string"?Rh(t):t;return{pathname:n?n.startsWith("/")?n:Nne(n,e):e,search:Rne(s),hash:Dne(r)}}function Nne(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function zI(t,e,n,s){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function $ne(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function zB(t,e){let n=$ne(t);return e?n.map((s,r)=>r===t.length-1?s.pathname:s.pathnameBase):n.map(s=>s.pathnameBase)}function BB(t,e,n,s){s===void 0&&(s=!1);let r;typeof t=="string"?r=Rh(t):(r=Vp({},t),ln(!r.pathname||!r.pathname.includes("?"),zI("?","pathname","search",r)),ln(!r.pathname||!r.pathname.includes("#"),zI("#","pathname","hash",r)),ln(!r.search||!r.search.includes("#"),zI("#","search","hash",r)));let i=t===""||r.pathname==="",o=i?"/":r.pathname,a;if(o==null)a=n;else{let h=e.length-1;if(!s&&o.startsWith("..")){let d=o.split("/");for(;d[0]==="..";)d.shift(),h-=1;r.pathname=d.join("/")}a=h>=0?e[h]:"/"}let l=kne(r,a),u=o&&o!=="/"&&o.endsWith("/"),c=(i||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const Wl=t=>t.join("/").replace(/\/\/+/g,"/"),Ane=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Rne=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Dne=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function One(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const UB=["post","put","patch","delete"];new Set(UB);const Pne=["get",...UB];new Set(Pne);/**
 * React Router v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zp(){return zp=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},zp.apply(this,arguments)}const XE=oe.createContext(null),Fne=oe.createContext(null),Rm=oe.createContext(null),mx=oe.createContext(null),Lu=oe.createContext({outlet:null,matches:[],isDataRoute:!1}),WB=oe.createContext(null);function Dm(){return oe.useContext(mx)!=null}function QE(){return Dm()||ln(!1),oe.useContext(mx).location}function jB(t){oe.useContext(Rm).static||oe.useLayoutEffect(t)}function GB(){let{isDataRoute:t}=oe.useContext(Lu);return t?Xne():Lne()}function Lne(){Dm()||ln(!1);let t=oe.useContext(XE),{basename:e,future:n,navigator:s}=oe.useContext(Rm),{matches:r}=oe.useContext(Lu),{pathname:i}=QE(),o=JSON.stringify(zB(r,n.v7_relativeSplatPath)),a=oe.useRef(!1);return jB(()=>{a.current=!0}),oe.useCallback(function(u,c){if(c===void 0&&(c={}),!a.current)return;if(typeof u=="number"){s.go(u);return}let h=BB(u,JSON.parse(o),i,c.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Wl([e,h.pathname])),(c.replace?s.replace:s.push)(h,c.state,c)},[e,s,o,i,t])}function Mne(t,e){return Vne(t,e)}function Vne(t,e,n,s){Dm()||ln(!1);let{navigator:r}=oe.useContext(Rm),{matches:i}=oe.useContext(Lu),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let u=QE(),c;if(e){var h;let g=typeof e=="string"?Rh(e):e;l==="/"||(h=g.pathname)!=null&&h.startsWith(l)||ln(!1),c=g}else c=u;let d=c.pathname||"/",f=d;if(l!=="/"){let g=l.replace(/^\//,"").split("/");f="/"+d.replace(/^\//,"").split("/").slice(g.length).join("/")}let p=pne(t,{pathname:f}),m=jne(p&&p.map(g=>Object.assign({},g,{params:Object.assign({},a,g.params),pathname:Wl([l,r.encodeLocation?r.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?l:Wl([l,r.encodeLocation?r.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),i,n,s);return e&&m?oe.createElement(mx.Provider,{value:{location:zp({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:da.Pop}},m):m}function zne(){let t=Kne(),e=One(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return oe.createElement(oe.Fragment,null,oe.createElement("h2",null,"Unexpected Application Error!"),oe.createElement("h3",{style:{fontStyle:"italic"}},e),n?oe.createElement("pre",{style:r},n):null,null)}const Bne=oe.createElement(zne,null);class Une extends oe.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?oe.createElement(Lu.Provider,{value:this.props.routeContext},oe.createElement(WB.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Wne(t){let{routeContext:e,match:n,children:s}=t,r=oe.useContext(XE);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),oe.createElement(Lu.Provider,{value:e},s)}function jne(t,e,n,s){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),s===void 0&&(s=null),t==null){var i;if((i=n)!=null&&i.errors)t=n.matches;else return null}let o=t,a=(r=n)==null?void 0:r.errors;if(a!=null){let c=o.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id]));c>=0||ln(!1),o=o.slice(0,Math.min(o.length,c+1))}let l=!1,u=-1;if(n&&s&&s.v7_partialHydration)for(let c=0;c<o.length;c++){let h=o[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=c),h.route.id){let{loaderData:d,errors:f}=n,p=h.route.loader&&d[h.route.id]===void 0&&(!f||f[h.route.id]===void 0);if(h.route.lazy||p){l=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((c,h,d)=>{let f,p=!1,m=null,g=null;n&&(f=a&&h.route.id?a[h.route.id]:void 0,m=h.route.errorElement||Bne,l&&(u<0&&d===0?(Qne("route-fallback",!1),p=!0,g=null):u===d&&(p=!0,g=h.route.hydrateFallbackElement||null)));let y=e.concat(o.slice(0,d+1)),w=()=>{let x;return f?x=m:p?x=g:h.route.Component?x=oe.createElement(h.route.Component,null):h.route.element?x=h.route.element:x=c,oe.createElement(Wne,{match:h,routeContext:{outlet:c,matches:y,isDataRoute:n!=null},children:x})};return n&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?oe.createElement(Une,{location:n.location,revalidation:n.revalidation,component:m,error:f,children:w(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):w()},null)}var HB=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(HB||{}),Ow=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Ow||{});function Gne(t){let e=oe.useContext(XE);return e||ln(!1),e}function Hne(t){let e=oe.useContext(Fne);return e||ln(!1),e}function qne(t){let e=oe.useContext(Lu);return e||ln(!1),e}function qB(t){let e=qne(),n=e.matches[e.matches.length-1];return n.route.id||ln(!1),n.route.id}function Kne(){var t;let e=oe.useContext(WB),n=Hne(Ow.UseRouteError),s=qB(Ow.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[s]}function Xne(){let{router:t}=Gne(HB.UseNavigateStable),e=qB(Ow.UseNavigateStable),n=oe.useRef(!1);return jB(()=>{n.current=!0}),oe.useCallback(function(r,i){i===void 0&&(i={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,zp({fromRouteId:e},i)))},[t,e])}const FO={};function Qne(t,e,n){!e&&!FO[t]&&(FO[t]=!0)}function BI(t){let{to:e,replace:n,state:s,relative:r}=t;Dm()||ln(!1);let{future:i,static:o}=oe.useContext(Rm),{matches:a}=oe.useContext(Lu),{pathname:l}=QE(),u=GB(),c=BB(e,zB(a,i.v7_relativeSplatPath),l,r==="path"),h=JSON.stringify(c);return oe.useEffect(()=>u(JSON.parse(h),{replace:n,state:s,relative:r}),[u,h,r,n,s]),null}function Cf(t){ln(!1)}function Yne(t){let{basename:e="/",children:n=null,location:s,navigationType:r=da.Pop,navigator:i,static:o=!1,future:a}=t;Dm()&&ln(!1);let l=e.replace(/^\/*/,"/"),u=oe.useMemo(()=>({basename:l,navigator:i,static:o,future:zp({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof s=="string"&&(s=Rh(s));let{pathname:c="/",search:h="",hash:d="",state:f=null,key:p="default"}=s,m=oe.useMemo(()=>{let g=VB(c,l);return g==null?null:{location:{pathname:g,search:h,hash:d,state:f,key:p},navigationType:r}},[l,c,h,d,f,p,r]);return m==null?null:oe.createElement(Rm.Provider,{value:u},oe.createElement(mx.Provider,{children:n,value:m}))}function Jne(t){let{children:e,location:n}=t;return Mne(OS(e),n)}new Promise(()=>{});function OS(t,e){e===void 0&&(e=[]);let n=[];return oe.Children.forEach(t,(s,r)=>{if(!oe.isValidElement(s))return;let i=[...e,r];if(s.type===oe.Fragment){n.push.apply(n,OS(s.props.children,i));return}s.type!==Cf&&ln(!1),!s.props.index||!s.props.children||ln(!1);let o={id:s.props.id||i.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=OS(s.props.children,i)),n.push(o)}),n}/**
 * React Router DOM v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Zne="6";try{window.__reactRouterVersion=Zne}catch{}const ese="startTransition",LO=$q[ese];function tse(t){let{basename:e,children:n,future:s,window:r}=t,i=oe.useRef();i.current==null&&(i.current=hne({window:r,v5Compat:!0}));let o=i.current,[a,l]=oe.useState({action:o.action,location:o.location}),{v7_startTransition:u}=s||{},c=oe.useCallback(h=>{u&&LO?LO(()=>l(h)):l(h)},[l,u]);return oe.useLayoutEffect(()=>o.listen(c),[o,c]),oe.createElement(Yne,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o,future:s})}var MO;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(MO||(MO={}));var VO;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(VO||(VO={}));const nse=(t,e)=>{switch(e.type){case"LOGIN":return{currentUser:e.payload};case"LOGOUT":return{currentUser:null};default:return t}},KB={currentUser:JSON.parse(localStorage.getItem("user"))||null},gx=oe.createContext(KB),sse=({children:t})=>{const[e,n]=oe.useReducer(nse,KB);return oe.useEffect(()=>{localStorage.setItem("user",JSON.stringify(e.currentUser))},[e.currentUser]),he.jsx(gx.Provider,{value:{currentUser:e.currentUser,dispatch:n},children:t})},zO=()=>{const[t,e]=oe.useState(!1),n=GB(),{dispatch:s}=oe.useContext(gx),r=i=>{i.preventDefault();const o=i.target.username.value,a=i.target.password.value;console.log(o,a),g7(cne,o,a).then(l=>{const u=l.user;s({type:"LOGIN",payload:u}),n("/dashboard")}).catch(l=>{e(!0)})};return he.jsx("div",{children:he.jsx("section",{className:"bg-gradient-to-b from-blue-500 to-blue-300 h-screen flex justify-center items-center",children:he.jsxs("div",{className:"auth bg-white rounded-lg p-8 w-96",children:[he.jsx("h1",{className:"text-2xl font-bold mb-4 text-center",children:"Login"}),he.jsxs("form",{action:"",onSubmit:r,children:[he.jsx("input",{type:"text",name:"username",id:"username",className:"w-full mt-4 h-16 text-lg border-b border-gray-400 focus:border-blue-500 outline-none",autoComplete:"off",placeholder:"Email",required:!0}),he.jsx("input",{type:"password",name:"password",id:"password",className:"w-full mt-4 h-16 text-lg border-b border-gray-400 focus:border-blue-500 outline-none",placeholder:"Password",required:!0}),he.jsx("p",{className:"text-gray-500 text-sm mt-12 text-right cursor-pointer",children:he.jsxs("span",{className:"hover:opacity-50",children:["Forgot Password?",he.jsx("span",{className:"text-sm",children:"?"})]})}),he.jsx("button",{type:"submit",className:"block bg-blue-500 text-white font-semibold rounded-lg w-full mt-8 py-3 hover:opacity-80 transition-all duration-300",children:"Login"})]}),t&&he.jsx("p",{className:"text-red-500 text-sm mt-4 text-center",children:"Incorrect password. Please try again."})]})})})},rse=({isOpen:t,onClose:e,onSave:n,can:s})=>{const[r,i]=oe.useState(s?s.title:""),[o,a]=oe.useState(s?s.location:""),[l,u]=oe.useState(s?s.phoneNumber:""),c=()=>{if(!r||!o||!l){alert("Please fill in all fields.");return}if(!/^\d{3}-?\d{3}-?\d{4}$/.test(l)){alert("Please enter a valid phone number (XXX-XXX-XXXX or XXXXXXXXXX).");return}const d={...s,title:r,location:o,phoneNumber:l};n(d)},h=()=>{i(s.title),a(s.location),u(s.phoneNumber),e()};return he.jsx("div",{className:`modal ${t?"block":"hidden"}`,children:he.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:he.jsxs("div",{className:"modal-content bg-gray-700 text-gray-200 w-96 p-4 rounded-lg shadow-lg",children:[he.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Edit Water Can"}),he.jsxs("form",{children:[he.jsxs("div",{className:"mb-4",children:[he.jsx("label",{htmlFor:"title",className:"block mb-1",children:"Title"}),he.jsx("input",{type:"text",id:"title",value:r,onChange:d=>i(d.target.value),className:"w-full border rounded-md px-3 py-2 bg-gray-800 text-gray-200 focus:outline-none focus:border-blue-500"})]}),he.jsxs("div",{className:"mb-4",children:[he.jsx("label",{htmlFor:"location",className:"block mb-1",children:"Location"}),he.jsx("input",{type:"text",id:"location",value:o,onChange:d=>a(d.target.value),className:"w-full border rounded-md px-3 py-2 bg-gray-800 text-gray-200 focus:outline-none focus:border-blue-500"})]}),he.jsxs("div",{className:"mb-4",children:[he.jsx("label",{htmlFor:"phoneNumber",className:"block mb-1",children:"Phone Number"}),he.jsx("input",{type:"text",id:"phoneNumber",value:l,onChange:d=>u(d.target.value),className:"w-full border rounded-md px-3 py-2 bg-gray-800 text-gray-200 focus:outline-none focus:border-blue-500"})]}),he.jsxs("div",{className:"flex justify-between",children:[he.jsx("button",{type:"button",onClick:h,className:"bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Cancel"}),he.jsx("button",{type:"button",onClick:c,className:"bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Save"})]})]})]})})})};var XB={},YE={};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ise=1e-7,ose=1e-4;class JE{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class yx{refCount(e){return Os("refCount")}incRef(e){return Os("incRef")}timerAvailable(){return!0}time(e){return Os("time")}read(e){return Os("read")}readSync(e){return Os("readSync")}readToGPU(e,n){return Os("readToGPU")}numDataIds(){return Os("numDataIds")}disposeData(e,n){return Os("disposeData")}write(e,n,s){return Os("write")}move(e,n,s,r,i){return Os("move")}createTensorFromGPUData(e,n,s){return Os("createTensorFromGPUData")}memory(){return Os("memory")}floatPrecision(){return Os("floatPrecision")}epsilon(){return this.floatPrecision()===32?ise:ose}dispose(){return Os("dispose")}}function Os(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZE(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,uo(t,e,n)}function ase(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,s=0;for(;n>0;)s=Math.random()*n|0,n--,uo(t,n,s),uo(e,n,s)}function La(t,e,n){return Math.max(t,Math.min(e,n))}function wx(t){return t%2===0?t:t+1}function uo(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function QB(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function lse(t,e){const n=Math.random();return e*n+(1-n)*t}function use(t,e){let n=0;for(let s=0;s<t.length;s++){const r=Number(t[s])-Number(e[s]);n+=r*r}return n}function C(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Mn(t,e,n=""){C(We(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function Mu(t){C(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function G(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function cse(t){return t.length===0}function YB(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==null&&e[n]!==null&&t[n]!==e[n])return!1;return!0}function We(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function uu(t){return t%1===0}function hse(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}}function Pw(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function dse(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return ZE(e),e}function jl(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function PS(t,e=r=>0,n,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(t()){r();return}o++;const l=e(o);if(n!=null&&o>=n){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function ek(t,e){let n=1,s=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(t[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[s]=e/n,r}function Be(t,e){const n=e.length;return t=t==null?e.map((s,r)=>r):[].concat(t),C(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),C(t.every(s=>uu(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function Fo(t,e){const n=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:Be(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[o]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[o]==null||i[o]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),i[o]<=a&&o++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function vn(t,e){return Ft(t,e)}function Ft(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function JB(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function ZB(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function tk(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function Bp(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function e4(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function Ri(t){return typeof t=="string"||t instanceof String}function t4(t){return typeof t=="boolean"}function Fw(t){return typeof t=="number"}function Vu(t){return Array.isArray(t)?Vu(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":Fw(t)?"float32":Ri(t)?"string":t4(t)?"bool":"float32"}function Ma(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Lw(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Ie(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function n4(t,e,n,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=n[t+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<i;l++)r[l]=n4(t+l*a,o,n,s)}return r}function mr(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((r,i)=>r*i)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return n4(0,t,e,n)}function s4(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function vx(t,e){const n=On(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function On(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function nk(t,e){const n=t.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return mr(t,new Float32Array(n));if(e==="int32")return mr(t,new Int32Array(n));if(e==="bool")return mr(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function er(t){t.forEach(e=>{C(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function ii(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=n[r]*t[r];return s}function zu(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(t/n[r]),t-=s[r]*n[r];return s[s.length-1]=t,s}function Eo(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BO="tfjsflags";class r4{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=fse,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(U().getBool("IS_TEST")||U().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];U().getBool("IS_TEST")||U().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(Eo(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);BO in e&&e[BO].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=mse(r,i)})}}function fse(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(pse(e,s[0],s[1]),s.join("="))),e}function pse(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function mse(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function U(){return sk}let sk=null;function gse(t){sk=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let UI;function i4(){if(UI==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");UI=t}return UI}function yse(){const t=i4();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function rk(t,e){const n=yse();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const Om="Abs",Dh="Acos",Oh="Acosh",Bu="Add",Pm="AddN",xx="All",bx="Any",Fm="ArgMax",Lm="ArgMin",Ph="Asin",Fh="Asinh",Lh="Atan",Mh="Atanh",Vh="Atan2",Mm="AvgPool",Ix="AvgPoolGrad",Vm="AvgPool3D",Tx="AvgPool3DGrad",zm="BatchMatMul",Bm="BatchToSpaceND",Sx="Bincount",Um="BitwiseAnd",o4="BroadcastTo",_x="BroadcastArgs",zh="Cast",Bh="Ceil",Uh="ClipByValue",Cx="Complex",Wm="ComplexAbs",jm="Concat",Gm="Conv2D",Ex="Conv2DBackpropFilter",Hm="Conv2DBackpropInput",qm="Conv3D",kx="Conv3DBackpropFilterV2",Nx="Conv3DBackpropInputV2",Wh="Cos",jh="Cosh",$x="Cumprod",Km="Cumsum",Ax="CropAndResize",Rx="DenseBincount",Dx="DepthToSpace",Xm="DepthwiseConv2dNative",Ox="DepthwiseConv2dNativeBackpropFilter",Px="DepthwiseConv2dNativeBackpropInput",Fx="Diag",Qm="Dilation2D",Mw="Dilation2DBackpropInput",Vw="Dilation2DBackpropFilter",Lx="Draw",Gh="RealDiv",Mx="Einsum",Hh="Elu",Vx="EluGrad",qh="Erf",Ym="Equal",Kh="Exp",Jm="ExpandDims",Xh="Expm1",zx="FFT",Bx="Fill",Ux="FlipLeftRight",Qh="Floor",Yh="FloorDiv",Zm="FusedBatchNorm",eg="GatherV2",Wx="GatherNd",tg="Greater",Jh="GreaterEqual",Zh="Identity",jx="IFFT",Gx="Imag",ed="IsFinite",td="IsInf",nd="IsNan",ng="LeakyRelu",sg="Less",rg="LessEqual",Hx="LinSpace",sd="Log",rd="Log1p",ig="LogicalAnd",og="LogicalNot",ag="LogicalOr",wse="LogicalXor",a4="LogSoftmax",vse="LowerBound",lg="LRN",qx="LRNGrad",xse="MatrixBandPart",ug="Max",id="Maximum",cg="MaxPool",Kx="MaxPoolGrad",hg="MaxPool3D",Xx="MaxPool3DGrad",Qx="MaxPoolWithArgmax",dg="Mean",fg="Min",od="Minimum",pg="MirrorPad",ad="Mod",Yx="Multinomial",ld="Multiply",mg="Neg",gg="NotEqual",Jx="NonMaxSuppressionV3",Zx="NonMaxSuppressionV4",e1="NonMaxSuppressionV5",yg="OnesLike",wg="OneHot",vg="Pack",xg="PadV2",bse="Pool",ud="Pow",bg="Prelu",Ig="Prod",t1="RaggedGather",n1="RaggedRange",s1="RaggedTensorToTensor",r1="Range",i1="Real",cd="Reciprocal",hd="Relu",Tg="Reshape",Sg="ResizeNearestNeighbor",o1="ResizeNearestNeighborGrad",_g="ResizeBilinear",a1="ResizeBilinearGrad",dd="Relu6",Cg="Reverse",fd="Round",pd="Rsqrt",l1="ScatterNd",u1="TensorScatterUpdate",c1="SearchSorted",Eg="Select",md="Selu",kg="Slice",gd="Sin",yd="Sinh",wd="Sign",vd="Sigmoid",xd="Softplus",bd="Sqrt",Ng="Sum",$g="SpaceToBatchND",Ag="SplitV",Rg="Softmax",h1="SparseFillEmptyRows",d1="SparseReshape",f1="SparseSegmentMean",p1="SparseSegmentSum",m1="SparseToDense",Id="SquaredDifference",g1="Square",Dg="StaticRegexReplace",y1="StridedSlice",w1="StringNGrams",v1="StringSplit",x1="StringToHashBucketFast",Td="Sub",Sd="Tan",_d="Tanh",Cd="Tile",b1="TopK",I1="Transform",Gl="Transpose",T1="Unique",Og="Unpack",Pg="UnsortedSegmentSum",Ise="UpperBound",Fg="ZerosLike",Ed="Step",zw="FromPixels",S1="RotateWithOffset",Up="_FusedMatMul",Wp="FusedConv2D",jp="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ir(...t){U().getBool("IS_TEST")||U().getBool("PROD")||console.warn(...t)}function Tse(...t){U().getBool("IS_TEST")||U().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ih=rk("kernelRegistry",()=>new Map),Gp=rk("gradRegistry",()=>new Map);function Hp(t,e){const n=ik(t,e);return ih.get(n)}function FS(t){return Gp.get(t)}function Bw(t){const e=ih.entries(),n=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===t&&n.push(o)}return n}function _1(t){const{kernelName:e,backendName:n}=t,s=ik(e,n);ih.has(s)&&ir(`The kernel '${e}' for backend '${n}' is already registered`),ih.set(s,t)}function l4(t){const{kernelName:e}=t;Gp.has(e)&&U().getBool("DEBUG")&&ir(`Overriding the gradient for '${e}'`),Gp.set(e,t)}function Sse(t,e){const n=ik(t,e);if(!ih.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);ih.delete(n)}function _se(t){if(!Gp.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);Gp.delete(t)}function Cse(t,e){Bw(t).forEach(s=>{const r=Object.assign({},s,{backendName:e});_1(r)})}function ik(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u4(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var c4=wt,Ar=null;try{Ar=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function wt(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}wt.prototype.__isLong__;Object.defineProperty(wt.prototype,"__isLong__",{value:!0});function tr(t){return(t&&t.__isLong__)===!0}wt.isLong=tr;var UO={},WO={};function Uu(t,e){var n,s,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(s=WO[t],s)?s:(n=vt(t,(t|0)<0?-1:0,!0),r&&(WO[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(s=UO[t],s)?s:(n=vt(t,t<0?-1:0,!1),r&&(UO[t]=n),n))}wt.fromInt=Uu;function Rr(t,e){if(isNaN(t))return e?Ol:Dr;if(e){if(t<0)return Ol;if(t>=h4)return p4}else{if(t<=-GO)return Us;if(t+1>=GO)return f4}return t<0?Rr(-t,e).neg():vt(t%oh|0,t/oh|0,e)}wt.fromNumber=Rr;function vt(t,e,n){return new wt(t,e,n)}wt.fromBits=vt;var Uw=Math.pow;function ok(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return Dr;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return ok(t.substring(1),e,n).neg();for(var r=Rr(Uw(n,8)),i=Dr,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var u=Rr(Uw(n,a));i=i.mul(u).add(Rr(l))}else i=i.mul(r),i=i.add(Rr(l))}return i.unsigned=e,i}wt.fromString=ok;function wi(t,e){return typeof t=="number"?Rr(t,e):typeof t=="string"?ok(t,e):vt(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}wt.fromValue=wi;var jO=65536,Ese=1<<24,oh=jO*jO,h4=oh*oh,GO=h4/2,HO=Uu(Ese),Dr=Uu(0);wt.ZERO=Dr;var Ol=Uu(0,!0);wt.UZERO=Ol;var kc=Uu(1);wt.ONE=kc;var d4=Uu(1,!0);wt.UONE=d4;var LS=Uu(-1);wt.NEG_ONE=LS;var f4=vt(-1,2147483647,!1);wt.MAX_VALUE=f4;var p4=vt(-1,-1,!0);wt.MAX_UNSIGNED_VALUE=p4;var Us=vt(0,-2147483648,!1);wt.MIN_VALUE=Us;var ue=wt.prototype;ue.toInt=function(){return this.unsigned?this.low>>>0:this.low};ue.toNumber=function(){return this.unsigned?(this.high>>>0)*oh+(this.low>>>0):this.high*oh+(this.low>>>0)};ue.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Us)){var n=Rr(e),s=this.div(n),r=s.mul(n).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Rr(Uw(e,6),this.unsigned),o=this,a="";;){var l=o.div(i),u=o.sub(l.mul(i)).toInt()>>>0,c=u.toString(e);if(o=l,o.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};ue.getHighBits=function(){return this.high};ue.getHighBitsUnsigned=function(){return this.high>>>0};ue.getLowBits=function(){return this.low};ue.getLowBitsUnsigned=function(){return this.low>>>0};ue.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Us)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};ue.isZero=function(){return this.high===0&&this.low===0};ue.eqz=ue.isZero;ue.isNegative=function(){return!this.unsigned&&this.high<0};ue.isPositive=function(){return this.unsigned||this.high>=0};ue.isOdd=function(){return(this.low&1)===1};ue.isEven=function(){return(this.low&1)===0};ue.equals=function(e){return tr(e)||(e=wi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ue.eq=ue.equals;ue.notEquals=function(e){return!this.eq(e)};ue.neq=ue.notEquals;ue.ne=ue.notEquals;ue.lessThan=function(e){return this.comp(e)<0};ue.lt=ue.lessThan;ue.lessThanOrEqual=function(e){return this.comp(e)<=0};ue.lte=ue.lessThanOrEqual;ue.le=ue.lessThanOrEqual;ue.greaterThan=function(e){return this.comp(e)>0};ue.gt=ue.greaterThan;ue.greaterThanOrEqual=function(e){return this.comp(e)>=0};ue.gte=ue.greaterThanOrEqual;ue.ge=ue.greaterThanOrEqual;ue.compare=function(e){if(tr(e)||(e=wi(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ue.comp=ue.compare;ue.negate=function(){return!this.unsigned&&this.eq(Us)?Us:this.not().add(kc)};ue.neg=ue.negate;ue.add=function(e){tr(e)||(e=wi(e));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,u=e.low&65535,c=0,h=0,d=0,f=0;return f+=i+u,d+=f>>>16,f&=65535,d+=r+l,h+=d>>>16,d&=65535,h+=s+a,c+=h>>>16,h&=65535,c+=n+o,c&=65535,vt(d<<16|f,c<<16|h,this.unsigned)};ue.subtract=function(e){return tr(e)||(e=wi(e)),this.add(e.neg())};ue.sub=ue.subtract;ue.multiply=function(e){if(this.isZero())return Dr;if(tr(e)||(e=wi(e)),Ar){var n=Ar.mul(this.low,this.high,e.low,e.high);return vt(n,Ar.get_high(),this.unsigned)}if(e.isZero())return Dr;if(this.eq(Us))return e.isOdd()?Us:Dr;if(e.eq(Us))return this.isOdd()?Us:Dr;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(HO)&&e.lt(HO))return Rr(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,u=e.low>>>16,c=e.low&65535,h=0,d=0,f=0,p=0;return p+=o*c,f+=p>>>16,p&=65535,f+=i*c,d+=f>>>16,f&=65535,f+=o*u,d+=f>>>16,f&=65535,d+=r*c,h+=d>>>16,d&=65535,d+=i*u,h+=d>>>16,d&=65535,d+=o*l,h+=d>>>16,d&=65535,h+=s*c+r*u+i*l+o*a,h&=65535,vt(f<<16|p,h<<16|d,this.unsigned)};ue.mul=ue.multiply;ue.divide=function(e){if(tr(e)||(e=wi(e)),e.isZero())throw Error("division by zero");if(Ar){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?Ar.div_u:Ar.div_s)(this.low,this.high,e.low,e.high);return vt(n,Ar.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ol:Dr;var s,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ol;if(e.gt(this.shru(1)))return d4;i=Ol}else{if(this.eq(Us)){if(e.eq(kc)||e.eq(LS))return Us;if(e.eq(Us))return kc;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(Dr)?e.isNegative()?kc:LS:(r=this.sub(e.mul(s)),i=s.add(r.div(e)),i)}else if(e.eq(Us))return this.unsigned?Ol:Dr;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Dr}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:Uw(2,a-48),u=Rr(s),c=u.mul(e);c.isNegative()||c.gt(r);)s-=l,u=Rr(s,this.unsigned),c=u.mul(e);u.isZero()&&(u=kc),i=i.add(u),r=r.sub(c)}return i};ue.div=ue.divide;ue.modulo=function(e){if(tr(e)||(e=wi(e)),Ar){var n=(this.unsigned?Ar.rem_u:Ar.rem_s)(this.low,this.high,e.low,e.high);return vt(n,Ar.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ue.mod=ue.modulo;ue.rem=ue.modulo;ue.not=function(){return vt(~this.low,~this.high,this.unsigned)};ue.and=function(e){return tr(e)||(e=wi(e)),vt(this.low&e.low,this.high&e.high,this.unsigned)};ue.or=function(e){return tr(e)||(e=wi(e)),vt(this.low|e.low,this.high|e.high,this.unsigned)};ue.xor=function(e){return tr(e)||(e=wi(e)),vt(this.low^e.low,this.high^e.high,this.unsigned)};ue.shiftLeft=function(e){return tr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?vt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):vt(0,this.low<<e-32,this.unsigned)};ue.shl=ue.shiftLeft;ue.shiftRight=function(e){return tr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?vt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):vt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ue.shr=ue.shiftRight;ue.shiftRightUnsigned=function(e){if(tr(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return vt(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?vt(n,0,this.unsigned):vt(n>>>e-32,0,this.unsigned)};ue.shru=ue.shiftRightUnsigned;ue.shr_u=ue.shiftRightUnsigned;ue.toSigned=function(){return this.unsigned?vt(this.low,this.high,!1):this};ue.toUnsigned=function(){return this.unsigned?this:vt(this.low,this.high,!0)};ue.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ue.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ue.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};wt.fromBytes=function(e,n,s){return s?wt.fromBytesLE(e,n):wt.fromBytesBE(e,n)};wt.fromBytesLE=function(e,n){return new wt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};wt.fromBytesBE=function(e,n){return new wt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const m4=EF(c4),kse=CF({__proto__:null,default:m4},[c4]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bl=m4||kse;function Lg(t){return bl.fromString(t,!0,16)}const g4=Lg("c3a5c85c97cb3127"),wl=Lg("b492b66fbe98f273"),os=Lg("9ae16a3b2f90404f");function MS(t){return t.xor(t.shru(47))}function y4(t,e,n){const s=t.slice(e,e+n);return bl.fromBytes(Array.from(s),!0,!0)}function ft(t,e){return y4(t,e,8)}function qO(t,e){return y4(t,e,4)}function pn(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function ka(t,e,n=Lg("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let r=e.xor(s).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function Nse(t,e,n,s,r,i){r=r.add(t),i=pn(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(n),i=i.add(pn(r,44)),[r.add(s),i.add(o)]}function Jy(t,e,n,s){return Nse(ft(t,e),ft(t,e+8),ft(t,e+16),ft(t,e+24),n,s)}function $se(t,e=t.length){if(e>=8){const n=os.add(e*2),s=ft(t,0).add(os),r=ft(t,e-8),i=pn(r,37).mul(n).add(s),o=pn(s,25).add(r).mul(n);return ka(i,o,n)}if(e>=4){const n=os.add(e*2),s=qO(t,0);return ka(s.shl(3).add(e),qO(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],r=t[e-1],i=n+(s<<8),o=e+(r<<2);return MS(os.mul(i).xor(g4.mul(o))).mul(os)}return os}function Ase(t,e=t.length){const n=os.add(e*2),s=ft(t,0).mul(wl),r=ft(t,8),i=ft(t,e-8).mul(n),o=ft(t,e-16).mul(os);return ka(pn(s.add(r),43).add(pn(i,30)).add(o),s.add(pn(r.add(os),18)).add(i),n)}function Rse(t,e=t.length){const n=os.add(e*2),s=ft(t,0).mul(os),r=ft(t,8),i=ft(t,e-8).mul(n),o=ft(t,e-16).mul(os),a=pn(s.add(r),43).add(pn(i,30)).add(o),l=ka(a,s.add(pn(r.add(os),18)).add(i),n),u=ft(t,16).mul(n),c=ft(t,24),h=a.add(ft(t,e-32)).mul(n),d=l.add(ft(t,e-24)).mul(n);return ka(pn(u.add(c),43).add(pn(h,30)).add(d),u.add(pn(c.add(s),18)).add(h),n)}function w4(t,e=t.length){const n=bl.fromNumber(81,!0);if(e<=32)return e<=16?$se(t,e):Ase(t,e);if(e<=64)return Rse(t,e);let s=n,r=n.mul(wl).add(113),i=MS(r.mul(os).add(113)).mul(os),o=[bl.UZERO,bl.UZERO],a=[bl.UZERO,bl.UZERO];s=s.mul(os).add(ft(t,0));let l=0;const u=(e-1>>6)*64,c=u+(e-1&63)-63;do s=pn(s.add(r).add(o[0]).add(ft(t,l+8)),37).mul(wl),r=pn(r.add(o[1]).add(ft(t,l+48)),42).mul(wl),s=s.xor(a[1]),r=r.add(o[0]).add(ft(t,l+40)),i=pn(i.add(a[0]),33).mul(wl),o=Jy(t,l,o[1].mul(wl),s.add(a[0])),a=Jy(t,l+32,i.add(a[1]),r.add(ft(t,l+16))),[i,s]=[s,i],l+=64;while(l!==u);const h=wl.add(i.and(255).shl(1));return l=c,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=pn(s.add(r).add(o[0]).add(ft(t,l+8)),37).mul(h),r=pn(r.add(o[1]).add(ft(t,l+48)),42).mul(h),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(ft(t,l+40))),i=pn(i.add(a[0]),33).mul(h),o=Jy(t,l,o[1].mul(h),s.add(a[0])),a=Jy(t,l+32,i.add(a[1]),r.add(ft(t,l+16))),[i,s]=[s,i],ka(ka(o[0],a[0],h).add(MS(r).mul(g4)).add(i),ka(o[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lo(t,e){return e==="string"?Bi(t):nl([t],e)}function Dse(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function nl(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ki(t)),U().getBool("DEBUG")&&JB(t,e),Dse(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function Cn(){return U().platform.now()}function v4(t,e){return U().platform.fetch(t,e)}function Bi(t,e="utf-8"){return e=e||"utf-8",U().platform.encode(t,e)}function ko(t,e="utf-8"){return e=e||"utf-8",U().platform.decode(t,e)}function nn(t){return U().platform.isTypedArray!=null?U().platform.isTypedArray(t):u4(t)}function Ki(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||Eo(t)||t==null||nn(t)&&n)e.push(t);else if(Array.isArray(t)||nn(t))for(let s=0;s<t.length;++s)Ki(t[s],e,n);else{let s=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Ki(t[r],e,n)}return e}const Ose=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:We,arraysEqualWithNull:YB,assert:C,assertNonNegativeIntegerDimensions:er,assertNonNull:Mu,assertShapesMatch:Mn,bytesFromStringArray:e4,bytesPerElement:Bp,checkConversionForErrors:JB,clamp:La,computeStrides:Ie,convertBackendValuesAndArrayBuffer:s4,createScalarValue:Lo,createShuffledIndices:dse,decodeString:ko,distSquared:use,encodeString:Bi,fetch:v4,fingerPrint64:w4,flatten:Ki,getArrayFromDType:Ft,getTypedArrayFromDType:vn,hasEncodingLoss:tk,hexToLong:Lg,indexToLoc:zu,inferDtype:Vu,inferFromImplicitShape:ek,isBoolean:t4,isFunction:Ma,isInt:uu,isNumber:Fw,isPromise:Eo,isScalarShape:cse,isString:Ri,isTypedArray:nn,isValidDtype:ZB,locToIndex:ii,makeOnesTypedArray:vx,makeZerosNestedTypedArray:nk,makeZerosTypedArray:On,nearestDivisor:Lw,nearestLargerEven:wx,now:Cn,parseAxisParam:Be,randUniform:lse,repeatedTry:PS,rightPad:jl,shuffle:ZE,shuffleCombo:ase,sizeFromShape:G,sizeToSquarishShape:Pw,squeezeShape:Fo,sum:QB,swap:uo,tanh:hse,toNestedArray:mr,toTypedArray:nl},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pse{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new Lse)}profileKernel(e,n,s){let r;const i=()=>{r=s()};let o;const a=Cn();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:Cn()-a})}if(U().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const c=r[u];c.data().then(h=>{Fse(h,c.dtype,e)})}return{kernelName:e,outputs:r,inputs:n,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],i,l[2])})})}}function Fse(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const r=t[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class Lse{logKernelProfile(e,n,s,r,i,o){const a=typeof r=="number"?jl(`${r}ms`,9):r.error,l=jl(e,25),u=n.rank,c=n.size,h=jl(n.shape.toString(),14);let d="";for(const f in i){const p=i[f];if(p!=null){const m=p.shape||n.shape,g=m.length;d+=`${f}: ${g}D ${g>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${h}	%c${c}	%c${d}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mse(t,e,n){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const u=t[l],c=u.inputs;for(const h in c){const d=c[h];let f=!1;for(let p=0;p<e.length;p++)if(s[d.id]){u.outputs.forEach(m=>s[m.id]=!0),f=!0,r[u.id]=!0;break}if(f)break}}const i={};i[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const u=t[l],c=u.inputs;for(let h=0;h<u.outputs.length;h++)if(i[u.outputs[h].id]){for(const d in c)i[c[d].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const u=t[l];if(r[u.id]&&o[u.id]){const c={};for(const d in u.inputs){const f=u.inputs[d];s[f.id]&&(c[d]=f)}const h=Object.assign({},u);h.inputs=c,h.outputs=u.outputs,a.push(h)}}return a}function Vse(t,e,n,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const u=t[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=n(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const c=i.inputs[l];if(!We(u.shape,c.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${c.shape}'`);if(t[c.id]==null)t[c.id]=u;else{const h=t[c.id];t[c.id]=s(h,u),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KO=20,cf=3,WI=7;function zse(t,e,n,s){const r=Ie(e),i=Bse(t,e,n,r),o=e.length,a=D0(t,e,n,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function Bse(t,e,n,s){const r=G(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=n==="complex64"?kf(t):t;if(a>1)for(let u=0;u<r/i;u++){const c=u*i;for(let h=0;h<i;h++)o[h]=Math.max(o[h],Ef(l[c+h],0,n).length)}return o}function Ef(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(WI))} + ${parseFloat(t[1].toFixed(WI))}j`:Ri(t)?s=`'${t}'`:n==="bool"?s=x4(t):s=parseFloat(t.toFixed(WI)).toString(),jl(s,e)}function x4(t){return t===0?"false":"true"}function D0(t,e,n,s,r,i=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const m=kf(t);return[Ef(m[0],0,n)]}return n==="bool"?[x4(t[0])]:[t[0].toString()]}if(l===1){if(a>KO){const g=cf*o;let y=Array.from(t.slice(0,g)),w=Array.from(t.slice((a-cf)*o,a*o));return n==="complex64"&&(y=kf(y),w=kf(w)),["["+y.map((x,v)=>Ef(x,r[v],n)).join(", ")+", ..., "+w.map((x,v)=>Ef(x,r[a-cf+v],n)).join(", ")+"]"]}return["["+(n==="complex64"?kf(t):Array.from(t)).map((g,y)=>Ef(g,r[y],n)).join(", ")+"]"]}const u=e.slice(1),c=s.slice(1),h=s[0]*o,d=[];if(a>KO){for(let m=0;m<cf;m++){const g=m*h,y=g+h;d.push(...D0(t.slice(g,y),u,n,c,r,!1))}d.push("...");for(let m=a-cf;m<a;m++){const g=m*h,y=g+h;d.push(...D0(t.slice(g,y),u,n,c,r,m===a-1))}}else for(let m=0;m<a;m++){const g=m*h,y=g+h;d.push(...D0(t.slice(g,y),u,n,c,r,m===a-1))}const f=l===2?",":"";d[0]="["+(a>0?d[0]+f:"");for(let m=1;m<d.length-1;m++)d[m]=" "+d[m]+f;let p=`,
`;for(let m=2;m<l;m++)p+=`
`;return d[d.length-1]=" "+d[d.length-1]+"]"+(i?"":p),d}function kf(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jt{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=G(e),s!=null){const r=s.length;C(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Ft(n,this.size),this.strides=Ie(e)}set(e,...n){n.length===0&&(n=[0]),C(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const r of e){if(r<0||r>=this.shape[n]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}n++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return Zr().makeTensor(this.values,this.shape,this.dtype)}}let Zr=null,hc=null;function Use(t){Zr=t}function Wse(t){hc=t}class Qe{constructor(e,n,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=G(e),this.strides=Ie(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return hc.buffer(this.shape,this.dtype,e)}bufferSync(){return hc.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return mr(this.shape,e,this.dtype==="complex64")}arraySync(){return mr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Zr().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>ko(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Zr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Zr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>ko(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Zr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Zr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return hc.print(this,e)}clone(){return this.throwIfDisposed(),hc.clone(this)}toString(e=!1){const n=this.dataSync();return zse(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),hc.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),Zr().makeVariable(this,e,n,s)}}Object.defineProperty(Qe,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function q(){return rk("Tensor",()=>Qe)}q();class qp extends Qe{constructor(e,n,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!We(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Zr().disposeTensor(this),this.dataId=e.dataId,Zr().incRef(this,null)}dispose(){Zr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(qp,Symbol.hasInstance,{value:t=>t instanceof Qe&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var VS;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(VS||(VS={}));var zS;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(zS||(zS={}));var BS;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(BS||(BS={}));var US;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(US||(US={}));var WS;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(WS||(WS={}));const jse={float32:US,int32:zS,bool:BS,complex64:WS};function _s(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return jse[t][e]}function C1(t){return _s(t,"int32")}function b4(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function I4(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rt(t,e){if(t.dtype===e.dtype)return[t,e];const n=_s(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function T4(t,e){C(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function E1(t,e){return e.some(n=>n.id===t.id)}function No(t){const e=[];return S4(t,e,new Set),e}function S4(t,e,n){if(t==null)return;if(t instanceof Qe){e.push(t);return}if(!Gse(t))return;const s=t;for(const r in s){const i=s[r];n.has(i)||(n.add(i),S4(i,e,n))}}function Gse(t){return Array.isArray(t)||typeof t=="object"}const Hse=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:T4,getTensorsInContainer:No,isTensorInList:E1,makeTypesMatch:Rt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jI(t){return t.kernelName!=null}class XO{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class ah{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new XO}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(ir(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Pse(this.backendInstance),!0}setupRegisteredKernels(){Bw(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Bw(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof yx)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,ir(`Initialization of backend ${e} failed`),ir(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return ir(`Initialization of backend ${e} failed`),ir(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),r=s.backend,i=this.readSync(n),o=r.refCount(n);r.disposeData(n,!0),s.backend=e,e.move(n,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,n,s){e();try{const r=s();return n(),r}catch(r){throw n(),r}}nextTensorId(){return ah.nextTensorId++}nextVariableId(){return ah.nextVariableId++}clone(e){const n=R.runKernel(Zh,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return R.runKernel(zh,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[n],r,i,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(Hp(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=jI(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(jI(e)){const{kernelName:p,inputs:m,attrs:g}=e;this.backendName==null&&this.backend;const y=Hp(p,this.backendName);C(y!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=y.kernelFunc({inputs:m,attrs:g,backend:this.backend});const x=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,w,x);const v=x.map(b=>b.rank!=null?b:this.makeTensorFromTensorInfo(b));if(r){const b=this.getTensorsForGradient(p,m,v);s=this.saveTensorsForBackwardMode(b)}return v}}else{const{forwardFunc:p}=e,m=g=>{r&&(s=g.map(y=>this.keep(this.clone(y))))};a=()=>{const g=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,m));const y=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,g,y),y}}const{inputs:c,attrs:h}=e,d=jI(e)?null:e.backwardsFunc;let f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(f=this.profiler.profileKernel(u,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),n=f.outputs)}),r&&this.addTapeNode(u,c,n,d,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(p=>c[p]!=null?c[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const r=FS(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(C(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(u=>n[u])):a=i.map(u=>n[u]);const l=s.filter((u,c)=>o[c]);return a.concat(l)}return[]}makeTensor(e,n,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&Ri(e[0])&&(i=e.map(l=>Bi(l)));const o=r.write(i,n,s),a=new Qe(n,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),u=e4(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,n,s,r){s=s||"float32";const i={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:r,dtype:i}=e,o=new Qe(r,i,s,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(e,n=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new qp(e,n,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Bp(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof qp||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Bp(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:i},l=FS(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((c,h)=>{if(c==null){const d=s[h],f=On(d.size,d.dtype);return this.makeTensor(f,d.shape,d.dtype)}return c}),r(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=No(e),s=new Set(n.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,n,s,r=!1){if(C(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));C(i instanceof Qe,()=>"The result y returned by f() must be a tensor.");const o=Mse(this.state.activeTape,n,i);if(!r&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??qse(i.shape),Vse(a,o,u=>this.tidy(u),Kse);const l=n.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const c of u.saved)c.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return C(Ma(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{C(n.every(a=>a instanceof Qe),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};n.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...n,l),C(s.value instanceof Qe,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),C(Ma(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const u=s.gradFunc(a,l),c=Array.isArray(u)?u:[u];C(c.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),C(c.every(d=>d instanceof Qe),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return c.forEach((d,f)=>{h[f]=()=>d}),h};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=Cn(),s=await this.backend.time(e);return s.wallMs=Cn()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new XO;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}ah.nextTensorId=0;ah.nextVariableId=0;function qse(t){const e=vx(G(t),"float32");return R.makeTensor(e,t,"float32")}function _4(){const t=i4();if(t._tfengine==null){const e=new r4(t);t._tfengine=new ah(e)}return gse(t._tfengine.ENV),Use(()=>t._tfengine),t._tfengine}const R=_4();function Kse(t,e){const n={a:t,b:e};return R.runKernel(Bu,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xse(){return typeof navigator<"u"&&navigator!=null}let jS;function Qse(t){jS=t}function ak(t){if(jS!==void 0)return jS;if(t||Xse()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function lk(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const Yse=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:lk,isMobile:ak,mockIsMobile:Qse},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cs=U();Cs.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Cs.registerFlag("IS_BROWSER",()=>lk());Cs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Cs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Cs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Cs.registerFlag("PROD",()=>!1);Cs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Cs.getBool("DEBUG"));Cs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Cs.registerFlag("IS_TEST",()=>!1);Cs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Cs.getBool("DEBUG"));Cs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Cs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Cs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xi(t,e){let n=t;if(nn(t))return e==="string"?[]:[t.length];if(b4(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(I4(t))return[t.buffer.size/(e==null?4:Bp(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||nn(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&U().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&C4(t,s,[]),s}function C4(t,e,n){if(n=n||[],!Array.isArray(t)&&!nn(t)){C(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}C(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),C(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let r=0;r<t.length;++r)C4(t[r],s,n.concat(r))}function QO(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function k(t,e,n,s="numeric"){if(t instanceof q())return QO(s,t.dtype,e,n),t;let r=Vu(t);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),QO(s,r,e,n),t==null||!nn(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const i=Xi(t,r);!nn(t)&&!Array.isArray(t)&&(t=[t]);const a=r!=="string"?nl(t,r):Ki(t,[],!0);return R.makeTensor(a,i,r)}function Kp(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,o)=>k(i,`${e}[${o}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uk="__op";function O(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+uk;const r=(...i)=>{R.startScope(n);try{const o=s(...i);return Eo(o)&&console.error("Cannot return a Promise inside of tidy."),R.endScope(o),o}catch(o){throw R.endScope(null),o}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jse(t,e){const n=k(t,"real","complex"),s=k(e,"imag","complex");Mn(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:n,imag:s};return R.runKernel(Cx,r)}const $o=O({complex_:Jse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sl(t,e,n,s){if(s==null)s=Vu(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(I4(t)||b4(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return R.backend.createTensorFromGPUData(t,e||n,s)}if(!nn(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){er(e);const r=G(e),i=G(n);C(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==G(e.slice(o)):!0;C(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!nn(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?nl(t,s):Ki(t,[],!0),R.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xs(t,e,n){const s=Xi(t,n);return sl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cu={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class vi{static join(e){return new vi(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>nn(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=n+r.byteLength;this.shards.push({buffer:r,start:n,end:i}),n=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=n-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],h=e+a-u.start,d=a,p=Math.min(n,u.end)-u.start,m=new Uint8Array(u.buffer,h,p-h);if(o.set(m,d),a+=m.length,n<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(r){return e<r.start?-1:e>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=Zse(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function Zse(t,e){let n=0,s=t.length;for(;n<=s;){const r=Math.floor((s-n)/2)+n,i=e(t[r]);if(i===0)return r;i<0?s=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ere(){U().set("PROD",!0)}function tre(){U().set("DEBUG",!0)}function nre(){U().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function sre(t){U().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function rre(){R.disposeVariables()}function Qr(){return R}function Ww(){return R.memory()}function ire(t){return R.profile(t)}function W(t,e){return R.tidy(t,e)}function $e(t){No(t).forEach(n=>n.dispose())}function on(t){return R.keep(t)}function ore(t){return R.time(t)}function are(t){return R.setBackend(t)}function lre(){return R.ready()}function E4(){return R.backendName}function ure(t){R.removeBackend(t)}function cre(t){return R.findBackend(t)}function hre(t){return R.findBackendFactory(t)}function ck(t,e,n=1){return R.registerBackend(t,e,n)}function hk(){return R.backend}function dre(t,e){U().setPlatform(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Va=4;async function GS(t,e){const n=[],s=[],r=Array.isArray(t)?t.map(o=>o.name):Object.keys(t);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(t)?t[o].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const c=new Promise(async h=>{const d=await l.bytes(),f=d.reduce((g,y)=>g+y.length,0)+Va*d.length,p=new Uint8Array(f);let m=0;for(let g=0;g<d.length;g++){const y=d[g],w=new Uint8Array(new Uint32Array([y.length]).buffer);p.set(w,m),m+=Va,p.set(y,m),m+=y.length}h(p)});s.push(c)}else s.push(l.data());e!=null&&(u.group=e),n.push(u)}const i=await Promise.all(s);return{data:mre(i),specs:n}}function dk(t,e){const n=new vi(t),s={};let r=0;for(const i of e){const o=fre(i,(a,l)=>n.slice(r+a,r+l));s[i.name]=k4(i,n.slice(r,r+o)),r+=o}return s}function fre(t,e){const n=G(t.shape);let s;if("quantization"in t){const r=t.quantization;s=cu[r.dtype]}else if(t.dtype==="string"){let r=0;for(let i=0;i<n;i++)r+=Va+new Uint32Array(e(r,r+Va))[0];return r}else s=cu[t.dtype];return n*s}async function pre(t,e){const n=G(t.shape);let s;if("quantization"in t){const r=t.quantization;s=cu[r.dtype]}else if(t.dtype==="string"){let r=0;for(let i=0;i<n;i++)r+=Va+new Uint32Array(await e(r,r+Va))[0];return r}else s=cu[t.dtype];return n*s}function k4(t,e){const n=t.name,s=t.dtype,r=t.shape,i=G(r);let o,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=cu[l.dtype],c=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(c.length);for(let h=0;h<c.length;h++){const d=c[h];o[h]=d*l.scale+l.min}}else if(l.dtype==="float16")o=bre()(c);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(c.length);for(let h=0;h<c.length;h++){const d=c[h];o[h]=Math.round(d*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=i*u}else if(s==="string"){const l=G(t.shape);o=[];for(let u=0;u<l;u++){const c=new Uint32Array(e.slice(a,a+Va))[0];a+=Va;const h=new Uint8Array(e.slice(a,a+c));o.push(h),a+=c}}else{const l=cu[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),c=new Float32Array(o.length/2);for(let p=0;p<u.length;p++)u[p]=o[p*2],c[p]=o[p*2+1];const h=Xs(u,r,"float32"),d=Xs(c,r,"float32"),f=$o(h,d);return h.dispose(),d.dispose(),f}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=i*l}return Xs(o,r,s)}async function YO(t,e,n){let s=new Uint8Array(e);for(;s.byteLength<n;){const{done:r,value:i}=await t.read();if(r&&i==null){const a=n-s.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}const o=new Uint8Array(s.length+i.byteLength);o.set(s,0),o.set(new Uint8Array(i),s.length),s=o}return s.buffer}async function N4(t,e){const n={},s=t.getReader();let r=new ArrayBuffer(0);for(const i of e){const o=await pre(i,async(u,c)=>(r=await YO(s,r,c),r.slice(u,c)));r=await YO(s,r,o);const a=r.slice(0,o);r=r.slice(o);const l=k4(i,a);if(n[i.name]=l,E4()==="webgpu"){const u=hk();"uploadToGPU"in u&&G(l.shape)>=U().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&u.uploadToGPU(l.dataId)}}return n}function mre(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(i=>{if(e+=i.byteLength,n.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return n.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const fk=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function JO(t){return fk?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function gre(t){if(fk)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,r=e.length;s<r;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function yre(t){if(fk){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function $4(t){return vi.join(t)}function ZO(t){const e="/";for(t=t.trim();t.endsWith(e);)t=t.slice(0,t.length-1);const n=t.split(e);return n[n.length-1]}function A4(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function pk(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),s}async function mk(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),pk(t,n,s)}function Mg(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:JO(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:JO(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new vi(t.weightData).byteLength}}function jw(t){const e=[];for(const n of t)e.push(...n.weights);return e}function wre(){const t=n=>{let s=n<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function vre(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function xre(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function bre(){const t=wre(),e=vre(),n=xre();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=t[n[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kt{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return kt.instance==null&&(kt.instance=new kt),kt.instance}static registerSaveRouter(e){kt.getInstance().saveRouters.push(e)}static registerLoadRouter(e){kt.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return kt.getHandlers(e,"save")}static getLoadHandlers(e,n){return kt.getHandlers(e,"load",n)}static getHandlers(e,n,s){const r=[];return(n==="load"?kt.getInstance().loadRouters:kt.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const Ire=t=>kt.registerSaveRouter(t),Tre=t=>kt.registerLoadRouter(t),R4=t=>kt.getSaveHandlers(t),D4=(t,e)=>kt.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HS="tensorflowjs",qS=1,Pl="models_store",fa="model_info_store";function O4(){if(!U().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function KS(t){const e=t.result;e.createObjectStore(Pl,{keyPath:"modelPath"}),e.createObjectStore(fa,{keyPath:"modelPath"})}class hu{constructor(e){if(this.indexedDB=O4(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,r)=>{const i=this.indexedDB.open(HS,qS);i.onupgradeneeded=()=>KS(i),i.onsuccess=()=>{const o=i.result;if(n==null){const a=o.transaction(Pl,"readonly"),u=a.objectStore(Pl).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=c=>(o.close(),r(u.error)),a.oncomplete=()=>o.close()}else{n.weightData=vi.join(n.weightData);const a=Mg(n),l=o.transaction(fa,"readwrite");let u=l.objectStore(fa),c;try{c=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(d){return r(d)}let h;c.onsuccess=()=>{h=o.transaction(Pl,"readwrite");const d=h.objectStore(Pl);let f;try{f=d.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return r(p)}f.onsuccess=()=>s({modelArtifactsInfo:a}),f.onerror=p=>{u=l.objectStore(fa);const m=u.delete(this.modelPath);m.onsuccess=()=>(o.close(),r(f.error)),m.onerror=g=>(o.close(),r(f.error))}},c.onerror=d=>(o.close(),r(c.error)),l.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}hu.URL_SCHEME="indexeddb://";const P4=t=>U().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(hu.URL_SCHEME)?Sre(t.slice(hu.URL_SCHEME.length)):null;kt.registerSaveRouter(P4);kt.registerLoadRouter(P4);function Sre(t){return new hu(t)}function _re(t){return t.startsWith(hu.URL_SCHEME)?t.slice(hu.URL_SCHEME.length):t}class Cre{constructor(){this.indexedDB=O4()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(HS,qS);s.onupgradeneeded=()=>KS(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(fa,"readonly"),a=i.objectStore(fa).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),n(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>n(s.error)})}async removeModel(e){return e=_re(e),new Promise((n,s)=>{const r=this.indexedDB.open(HS,qS);r.onupgradeneeded=()=>KS(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(fa,"readwrite"),a=o.objectStore(fa),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const c=a.delete(e),h=()=>{u=i.transaction(Pl,"readwrite");const f=u.objectStore(Pl).delete(e);f.onsuccess=()=>n(l.result.modelArtifactsInfo),f.onerror=p=>s(l.error)};c.onsuccess=h,c.onerror=d=>(h(),i.close(),s(l.error))}},l.onerror=c=>(i.close(),s(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const co="/",dc="tensorflowjs_models",F4="info",Ere="model_topology",kre="weight_specs",Nre="weight_data",$re="model_metadata";function L4(t){return{info:[dc,t,F4].join(co),topology:[dc,t,Ere].join(co),weightSpecs:[dc,t,kre].join(co),weightData:[dc,t,Nre].join(co),modelMetadata:[dc,t,$re].join(co)}}function M4(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Are(t){const e=t.split(co);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(co)}function Rre(t){return t.startsWith(du.URL_SCHEME)?t.slice(du.URL_SCHEME.length):t}class du{constructor(e){if(!U().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=L4(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=Mg(e),i=vi.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,gre(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw M4(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=yre(o),n}}du.URL_SCHEME="localstorage://";const V4=t=>U().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(du.URL_SCHEME)?Dre(t.slice(du.URL_SCHEME.length)):null;kt.registerSaveRouter(V4);kt.registerLoadRouter(V4);function Dre(t){return new du(t)}class Ore{constructor(){C(U().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),C(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=dc+co,s=co+F4;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(n)&&i.endsWith(s)){const o=Are(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=Rre(e);const n=L4(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return M4(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zc="://";class ss{constructor(){this.managers={}}static getInstance(){return ss.instance==null&&(ss.instance=new ss),ss.instance}static registerManager(e,n){C(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(zc)&&(e=e.slice(0,e.indexOf(zc))),C(e.length>0,()=>"scheme must not be an empty string.");const s=ss.getInstance();C(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=ss.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(ss.getInstance().managers)}}function O0(t){if(t.indexOf(zc)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${ss.getSchemes().join(",")}`);return{scheme:t.split(zc)[0],path:t.split(zc)[1]}}async function z4(t,e,n=!1){C(t!==e,()=>`Old path and new path are the same: '${t}'`);const s=kt.getLoadHandlers(t);C(s.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),C(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${t}.`);const r=s[0],i=kt.getSaveHandlers(e);C(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),C(i.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const o=i[0],a=O0(t).scheme,l=O0(t).path,u=a===O0(t).scheme,c=await r.load();n&&u&&await ss.getManager(a).removeModel(l);const h=await o.save(c);return n&&!u&&await ss.getManager(a).removeModel(l),h.modelArtifactsInfo}async function Pre(){const t=ss.getSchemes(),e={};for(const n of t){const s=await ss.getManager(n).listModels();for(const r in s){const i=n+zc+r;e[i]=s[r]}}return e}async function Fre(t){const e=O0(t);return ss.getManager(e.scheme).removeModel(e.path)}async function Lre(t,e){return z4(t,e,!1)}async function Mre(t,e){return z4(t,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vre{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!U().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return u4(e)}}if(U().get("IS_BROWSER")){U().setPlatform("browser",new Vre);try{ss.registerManager(du.URL_SCHEME,new Ore)}catch{}try{ss.registerManager(hu.URL_SCHEME,new Cre)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zre={importFetch:()=>require("node-fetch")};let GI;class Bre{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return U().global.fetch!=null?U().global.fetch(e,n):(GI==null&&(GI=zre.importFetch()),GI(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}U().get("IS_NODE")&&!U().get("IS_BROWSER")&&U().setPlatform("node",new Bre);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fe(t,e="float32",n){return e=e||"float32",er(t),new Jt(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ure(t,e){const n=k(t,"x","cast");if(!ZB(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},r={dtype:e};return R.runKernel(zh,s,r)}const re=O({cast_:Ure});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wre(t){const n={x:k(t,"x","clone","string_or_numeric")};return R.runKernel(Zh,n)}const Ui=O({clone_:Wre});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gk(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_4();const jre={buffer:Fe,cast:re,clone:Ui,print:gk};Wse(jre);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gre(t,e){let n=k(t,"a","add"),s=k(e,"b","add");[n,s]=Rt(n,s);const r={a:n,b:s};return R.runKernel(Bu,r)}const Y=O({add_:Gre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hre(t,e){let n=k(t,"a","floorDiv"),s=k(e,"b","floorDiv");[n,s]=Rt(n,s);const r={a:n,b:s};return R.runKernel(Yh,r)}const k1=O({floorDiv_:Hre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qre(t,e){let n=k(t,"a","div"),s=k(e,"b","div");if([n,s]=Rt(n,s),n.dtype==="int32"&&s.dtype==="int32")return k1(n,s);const r={a:n,b:s},i={};return R.runKernel(Gh,r,i)}const be=O({div_:qre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kre(t,e){let n=k(t,"a","mul"),s=k(e,"b","mul");[n,s]=Rt(n,s);const r={a:n,b:s};return R.runKernel(ld,r)}const P=O({mul_:Kre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xre(t){const e=k(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return R.runKernel(Wm,n)}else{const n={x:e};return R.runKernel(Om,n)}}const Kt=O({abs_:Xre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qre(t){const n={x:k(t,"x","acos")};return R.runKernel(Dh,n)}const yk=O({acos_:Qre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yre(t){const n={x:k(t,"x","acosh")};return R.runKernel(Oh,n)}const wk=O({acosh_:Yre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jre(t){C(Array.isArray(t),()=>"The argument passed to tf.addN() must be a list of tensors"),C(t.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`);const e=t.map((r,i)=>k(r,`tensors${i}`,"addN")),n=e[0];e.forEach(r=>{if(r.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(r=>{if(!We(r.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return R.runKernel(Pm,s)}const B4=O({addN_:Jre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zre(t,e=null,n=!1){const r={x:k(t,"x","all","bool")},i={axis:e,keepDims:n};return R.runKernel(xx,r,i)}const N1=O({all_:Zre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eie(t,e=null,n=!1){const r={x:k(t,"x","any","bool")},i={axis:e,keepDims:n};return R.runKernel(bx,r,i)}const Xp=O({any_:eie});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tie(t,e=0){const s={x:k(t,"x","argMax")},r={axis:e};return R.runKernel(Fm,s,r)}const fu=O({argMax_:tie});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nie(t,e=0){const s={x:k(t,"x","argMin")},r={axis:e};return R.runKernel(Lm,s,r)}const vk=O({argMin_:nie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sie(t){const n={x:k(t,"x","asin")};return R.runKernel(Ph,n)}const xk=O({asin_:sie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rie(t){const n={x:k(t,"x","asinh")};return R.runKernel(Fh,n)}const bk=O({asinh_:rie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iie(t){const n={x:k(t,"x","atan")};return R.runKernel(Lh,n)}const Ik=O({atan_:iie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oie(t,e){let n=k(t,"a","atan2"),s=k(e,"b","atan2");[n,s]=Rt(n,s);const r={a:n,b:s};return R.runKernel(Vh,r)}const Tk=O({atan2_:oie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aie(t){const n={x:k(t,"x","atanh")};return R.runKernel(Mh,n)}const Sk=O({atanh_:aie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vg(t,e,n,s,r="NHWC",i){const o=t[3],a=[...e,o],l=Vo(r);return bn(t,a,n,i,s,null,null,l)}function Ur(t,e,n,s,r,i,o="channelsLast"){const[a,l]=Qp(e);let u;if(o==="channelsLast")u=[a,l,t[3],t[3]];else if(o==="channelsFirst")u=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return bn(t,u,n,s,r,i,!1,o)}function Mo(t,e,n,s,r,i,o="NDHWC"){const[a,l,u]=XS(e);let c,h;if(o==="NDHWC")h="channelsLast",c=[a,l,u,t[4],t[4]];else if(o==="NCDHW")h="channelsFirst",c=[a,l,u,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return rl(t,c,n,s,r,!1,h,i)}function bn(t,e,n,s,r,i,o=!1,a="channelsLast"){let[l,u,c,h]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,c,h]=t;else if(a==="channelsFirst")[l,h,u,c]=t;else throw new Error(`Unknown dataFormat ${a}`);const[d,f,,p]=e,[m,g]=Qp(n),[y,w]=Qp(s),x=Bc(d,y),v=Bc(f,w),{padInfo:b,outHeight:S,outWidth:T}=cie(r,u,c,m,g,x,v,i,a),_=o?p*h:p;let E;return a==="channelsFirst"?E=[l,_,S,T]:a==="channelsLast"&&(E=[l,S,T,_]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:c,inChannels:h,outHeight:S,outWidth:T,outChannels:_,padInfo:b,strideHeight:m,strideWidth:g,filterHeight:d,filterWidth:f,effectiveFilterHeight:x,effectiveFilterWidth:v,dilationHeight:y,dilationWidth:w,inShape:t,outShape:E,filterShape:e}}function rl(t,e,n,s,r,i=!1,o="channelsLast",a){let[l,u,c,h,d]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,c,h,d]=t;else if(o==="channelsFirst")[l,d,u,c,h]=t;else throw new Error(`Unknown dataFormat ${o}`);const[f,p,m,,g]=e,[y,w,x]=XS(n),[v,b,S]=XS(s),T=Bc(f,v),_=Bc(p,b),E=Bc(m,S),{padInfo:N,outDepth:$,outHeight:A,outWidth:D}=hie(r,u,c,h,y,w,x,T,_,E,a),F=i?g*d:g;let B;return o==="channelsFirst"?B=[l,F,$,A,D]:o==="channelsLast"&&(B=[l,$,A,D,F]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:c,inWidth:h,inChannels:d,outDepth:$,outHeight:A,outWidth:D,outChannels:F,padInfo:N,strideDepth:y,strideHeight:w,strideWidth:x,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:T,effectiveFilterHeight:_,effectiveFilterWidth:E,dilationDepth:v,dilationHeight:b,dilationWidth:S,inShape:t,outShape:B,filterShape:e}}function lie(t,e,n,s,r){s==null&&(s=_k(t,e,n));const i=t[0],o=t[1],a=Yp((i-e+2*s)/n+1,r),l=Yp((o-e+2*s)/n+1,r);return[a,l]}function uie(t,e,n,s,r,i){r==null&&(r=_k(t,e[0],s[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*r>=e[a]&&(o[a]=Yp((t[a]-e[a]+2*r)/s[a]+1,i));return o}function _k(t,e,n,s=1){const r=Bc(e,s);return Math.floor((t[0]*(n-1)-n+r)/2)}function Qp(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function XS(t){return typeof t=="number"?[t,t,t]:t}function Bc(t,e){return e<=1?t:t+(t-1)*(e-1)}function cie(t,e,n,s,r,i,o,a,l){let u,c,h;if(typeof t=="number"){u={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const f=lie([e,n],i,s,t,a);c=f[0],h=f[1]}else if(t==="same"){c=Math.ceil(e/s),h=Math.ceil(n/r);const d=Math.max(0,(c-1)*s+i-e),f=Math.max(0,(h-1)*r+o-n),p=Math.floor(d/2),m=d-p,g=Math.floor(f/2),y=f-g;u={top:p,bottom:m,left:g,right:y,type:"SAME"}}else if(t==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/s),h=Math.ceil((n-o+1)/r);else if(typeof t=="object"){const d=l==="channelsLast"?t[1][0]:t[2][0],f=l==="channelsLast"?t[1][1]:t[2][1],p=l==="channelsLast"?t[2][0]:t[3][0],m=l==="channelsLast"?t[2][1]:t[3][1];u={top:d,bottom:f,left:p,right:m,type:d===0&&f===0&&p===0&&m===0?"VALID":"EXPLICIT"},c=Yp((e-i+d+f)/s+1,a),h=Yp((n-o+p+m)/r+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:u,outHeight:c,outWidth:h}}function hie(t,e,n,s,r,i,o,a,l,u,c){let h,d,f,p;if(t==="valid"&&(t=0),typeof t=="number"){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const g=uie([e,n,s,1],[a,l,u],1,[r,i,o],t,c);d=g[0],f=g[1],p=g[2]}else if(t==="same"){d=Math.ceil(e/r),f=Math.ceil(n/i),p=Math.ceil(s/o);const m=(d-1)*r+a-e,g=(f-1)*i+l-n,y=(p-1)*o+u-s,w=Math.floor(m/2),x=m-w,v=Math.floor(g/2),b=g-v,S=Math.floor(y/2),T=y-S;h={top:v,bottom:b,left:S,right:T,front:w,back:x,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:h,outDepth:d,outHeight:f,outWidth:p}}function Yp(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function za(t){const[e,n,s]=Qp(t);return e===1&&n===1&&s===1}function Vn(t,e){return za(t)||za(e)}function pu(t){return Qp(t).every(e=>e>0)}function Vo(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function ms(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")C(uu(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{C(uu(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function die(t,e){const s={x:k(t,"x","reshape","string_or_numeric")},r={shape:e};return R.runKernel(Tg,s,r)}const L=O({reshape_:die});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fie(t,e,n,s,r){const i=k(t,"x","avgPool","float32"),o=1;C(Vn(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=L(i,[1,i.shape[0],i.shape[1],i.shape[2]])),C(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),ms("avgPool",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r};let h=R.runKernel(Mm,u,c);return h=re(h,i.dtype),l?L(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const zg=O({avgPool_:fie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pie(t,e,n,s,r,i="NDHWC"){const o=k(t,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=L(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),C(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),C(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),C(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),ms("avgPool3d",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i};let h=R.runKernel(Vm,u,c);return h=re(h,a.dtype),l?L(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const Ck=O({avgPool3d_:pie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mie(t,e=0){C(t.length>=1,()=>"Pass at least one tensor to concat");const n=Kp(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),n.length===1)return Ui(n[0]);const s=n,r={axis:e};return R.runKernel(jm,s,r)}const Bt=O({concat_:mie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gie(t,e,n=!1,s=!1){let r=k(t,"a","matMul"),i=k(e,"b","matMul");[r,i]=Rt(r,i);const o={a:r,b:i},a={transposeA:n,transposeB:s};return R.runKernel(zm,o,a)}const ze=O({matMul_:gie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yie(t){const n={x:k(t,"x","sigmoid","float32")};return R.runKernel(vd,n)}const oi=O({sigmoid_:yie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wie(t,e,n){const s=k(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:n};return R.runKernel(kg,r,i)}const Ge=O({slice_:wie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vie(t){const n={x:k(t,"x","tanh","float32")};return R.runKernel(_d,n)}const mu=O({tanh_:vie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xie(t,e,n,s,r,i){const o=k(t,"forgetBias","basicLSTMCell"),a=k(e,"lstmKernel","basicLSTMCell"),l=k(n,"lstmBias","basicLSTMCell"),u=k(s,"data","basicLSTMCell"),c=k(r,"c","basicLSTMCell"),h=k(i,"h","basicLSTMCell"),d=Bt([u,h],1),f=ze(d,a),p=Y(f,l),m=p.shape[0],g=p.shape[1]/4,y=[m,g],w=Ge(p,[0,0],y),x=Ge(p,[0,g],y),v=Ge(p,[0,g*2],y),b=Ge(p,[0,g*3],y),S=Y(P(oi(w),mu(x)),P(c,oi(Y(o,v)))),T=P(mu(S),oi(b));return[S,T]}const U4=O({basicLSTMCell_:xie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bie(t,e,n){const s=k(t,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);C(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),C(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),C(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:n};return R.runKernel(Bm,i,o)}const Bg=O({batchToSpaceND_:bie});function Iie(t){let e;return t.rank===0||t.rank===1?e=L(t,[1,1,1,t.size]):t.rank===2?e=L(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=L(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tie(t,e,n,s,r,i){i==null&&(i=.001);const o=k(t,"x","batchNorm"),a=k(e,"mean","batchNorm"),l=k(n,"variance","batchNorm");let u;r!=null&&(u=k(r,"scale","batchNorm"));let c;s!=null&&(c=k(s,"offset","batchNorm")),C(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),C(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),C(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const d={x:Iie(o),scale:u,offset:c,mean:a,variance:l},f={varianceEpsilon:i},p=R.runKernel(Zm,d,f);return L(p,o.shape)}const kd=O({batchNorm_:Tie});function Sie(t,e,n,s,r,i){const o=k(t,"x","batchNorm"),a=k(e,"mean","batchNorm"),l=k(n,"variance","batchNorm");let u;r!=null&&(u=k(r,"scale","batchNorm"));let c;return s!=null&&(c=k(s,"offset","batchNorm")),C(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),C(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),C(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&C(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&C(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),kd(o,a,l,c,u,i)}const Ek=O({batchNorm2d_:Sie});function _ie(t,e,n,s,r,i){const o=k(t,"x","batchNorm"),a=k(e,"mean","batchNorm"),l=k(n,"variance","batchNorm");let u;r!=null&&(u=k(r,"scale","batchNorm"));let c;return s!=null&&(c=k(s,"offset","batchNorm")),C(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),C(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),C(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&C(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&C(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),kd(o,a,l,c,u,i)}const kk=O({batchNorm3d_:_ie});function Cie(t,e,n,s,r,i){const o=k(t,"x","batchNorm"),a=k(e,"mean","batchNorm"),l=k(n,"variance","batchNorm");let u;r!=null&&(u=k(r,"scale","batchNorm"));let c;return s!=null&&(c=k(s,"offset","batchNorm")),C(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),C(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),C(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&C(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&C(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),kd(o,a,l,c,u,i)}const Nk=O({batchNorm4d_:Cie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eie(t,e,n){const s=k(t,"x","bincount"),r=k(e,"weights","bincount");C(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),C(n>=0,()=>`size must be non-negative, but got ${n}.`),C(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:n};return R.runKernel(Sx,i,o)}const $k=O({bincount_:Eie});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kie(t,e){const n=k(t,"x","bitwiseAnd"),s=k(e,"y","bitwiseAnd");if(!We(n.shape,s.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${s.shape}`);if(n.dtype!=="int32"||s.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${s.dtype}`);const r={a:n,b:s};return R.runKernel(Um,r)}const W4=O({bitwiseAnd_:kie});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nie(t,e){const n=k(t,"s0","broadcastArgs","int32"),s=k(e,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const r={s0:n,s1:s};return R.runKernel(_x,r)}const j4=O({broadcastArgs_:Nie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ie(t,e){let n=k(t,"broadcastTo","x");const s=n.shape;if(er(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const u=n.shape.slice();for(;u.length<e.length;)u.unshift(1);n=L(n,u)}const r=n.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])i[u]=1;else if(n.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((u,c)=>u>1?c:-1).filter(u=>u>=0).length===0)return Ui(n);const a={x:n},l={reps:i};return R.runKernel(Cd,a,l)}const Hl=O({broadcastTo_:$ie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aie(t){const n={x:k(t,"x","ceil","float32")};return R.runKernel(Bh,n)}const Ak=O({ceil_:Aie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wu(t,e,n){er(t),n=n||Vu(e);const s={shape:t,value:e,dtype:n};return R.runKernel(Bx,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rie(t,e,n){const s=k(t,"x","clipByValue");if(C(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return Wu(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:n};return R.runKernel(Uh,r,i)}const Es=O({clipByValue_:Rie});function Die(t){return Bt(t,0)}const Rk=O({concat1d_:Die});function Oie(t,e){return Bt(t,e)}const Dk=O({concat2d_:Oie});function Pie(t,e){return Bt(t,e)}const Ok=O({concat3d_:Pie});function Fie(t,e){return Bt(t,e)}const Pk=O({concat4d_:Fie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lie(t,e,n,s,r="NHWC",i=[1,1],o){const a=k(t,"x","conv2d","float32"),l=k(e,"filter","conv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=L(a,[1,a.shape[0],a.shape[1],a.shape[2]])),C(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),C(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),ms("conv2d",s,o);const h=r==="NHWC"?u.shape[3]:u.shape[1];C(h===l.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`),C(Vn(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),C(pu(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),C(pu(n),()=>"Error in conv2D: Strides should be larger than 0.");const d={x:u,filter:l},f={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},p=R.runKernel(Gm,d,f);return c?L(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Ao=O({conv2d_:Lie});function Mie(t,e,n,s,r="NWC",i=1,o){const a=k(t,"x","conv1d"),l=k(e,"filter","conv1d");let u=a,c=!1;a.rank===2&&(c=!0,u=L(a,[1,a.shape[0],a.shape[1]])),C(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),C(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),ms("conv1d",s,o),C(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),C(Vn(n,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${i}'`),C(pu(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),C(pu(n),()=>"Error in conv1D: Stride should be larger than 0."),C(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=L(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=L(u,[u.shape[0],1,u.shape[1],u.shape[2]]),g=Ao(d,h,[1,n],s,"NHWC",[1,i],o);return c?L(g,[g.shape[2],g.shape[3]]):L(g,[g.shape[0],g.shape[2],g.shape[3]])}const $1=O({conv1d_:Mie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vie(t,e,n,s,r,i="NHWC",o){C(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,u=!1;e.rank===3&&(u=!0,l=L(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),C(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),C(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),C(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const c=i==="NHWC"?a[3]:a[1],h=i==="NHWC"?l.shape[3]:l.shape[1];C(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),C(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),ms("conv2dDerInput",r,o);const d={dy:l,filter:n},f={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},p=R.runKernel(Hm,d,f);return u?L(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Fk=O({conv2DBackpropInput_:Vie});function zie(t,e,n,s,r,i){const o=k(t,"x","conv2dTranspose"),a=k(e,"filter","conv2dTranspose");return Fk(n,o,a,s,r,"NHWC",i)}const A1=O({conv2dTranspose_:zie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bie(t,e,n,s,r="NDHWC",i=[1,1,1]){const o=k(t,"x","conv3d"),a=k(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=L(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),C(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),C(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),C(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),C(Vn(n,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),C(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),C(pu(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),C(pu(n),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:l,filter:a},h={strides:n,pad:s,dataFormat:r,dilations:i},d=R.runKernel(qm,c,h);return u?L(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const Lk=O({conv3d_:Bie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uie(t,e,n,s,r){C(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let i=t,o=e,a=!1;e.rank===4&&(a=!0,o=L(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);const l=i[4],u=o.shape[4];C(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),C(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),C(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),C(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),C(u===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`);const c={dy:o,filter:n},h={pad:r,strides:s,inputShape:i},d=R.runKernel(Nx,c,h);return a?L(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const G4=O({conv3DBackpropInput_:Uie});function Wie(t,e,n,s,r){const i=k(t,"x","conv3dTranspose"),o=k(e,"filter","conv3dTranspose");return G4(n,i,o,s,r)}const Mk=O({conv3dTranspose_:Wie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jie(t){const n={x:k(t,"x","cos","float32")};return R.runKernel(Wh,n)}const Ug=O({cos_:jie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gie(t){const n={x:k(t,"x","cosh","float32")};return R.runKernel(jh,n)}const R1=O({cosh_:Gie});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hie(t,e=0,n=!1,s=!1){const i={x:k(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:s};return R.runKernel($x,i,o)}const Jp=O({cumprod_:Hie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qie(t,e=0,n=!1,s=!1){const i={x:k(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:s};return R.runKernel(Km,i,o)}const D1=O({cumsum_:qie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kie(t,e,n,s=!1){const r=k(t,"x","denseBincount"),i=k(e,"weights","denseBincount");C(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),C(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),C(n>=0,()=>`size must be non-negative, but got ${n}.`),C(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:n,binaryOutput:s};return R.runKernel(Rx,o,a)}const Gw=O({denseBincount_:Kie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xie(t,e,n="NHWC"){const s=k(t,"x","depthToSpace","float32"),r=n==="NHWC"?s.shape[1]:s.shape[2],i=n==="NHWC"?s.shape[2]:s.shape[3],o=n==="NHWC"?s.shape[3]:s.shape[1];C(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),C(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),C(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),C(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return R.runKernel(Dx,a,l)}const Vk=O({depthToSpace_:Xie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qie(t,e,n,s,r="NHWC",i=[1,1],o){const a=k(t,"x","depthwiseConv2d","float32"),l=k(e,"filter","depthwiseConv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=L(a,[1,a.shape[0],a.shape[1],a.shape[2]])),C(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),C(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const h=r==="NHWC"?u.shape[3]:u.shape[1];C(h===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${l.shape[2]}.`),ms("depthwiseConv2d",s,o);const d={x:u,filter:l},f={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},p=R.runKernel(Xm,d,f);return c?L(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Nd=O({depthwiseConv2d_:Qie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yie(t){const n={x:k(t,"x","diag")};return R.runKernel(Fx,n)}const H4=O({diag_:Yie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jie(t,e,n,s,r=[1,1],i="NHWC"){const o=k(t,"x","dilation2d"),a=k(e,"filter","dilation2d");C(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),C(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),C(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=L(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),C(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const c={x:l,filter:a},h={strides:n,pad:s,dilations:r},d=R.runKernel(Qm,c,h);return u?L(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const zk=O({dilation2d_:Jie});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gu(t,e){const n=t.length,s=[];for(let r=0;r<n;r++){const i=n-1-r,o=t[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function Zt(t,e){const n=[];for(let s=0;s<e.length;s++){const r=t[t.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&n.unshift(i)}return n}function Ae(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let r=0;r<n;r++){let i=t[t.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[n-r-1]=o;else if(o===1)s[n-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-r-1]=i}return s}const Zie=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:Ae,getBroadcastDims:gu,getReductionAxes:Zt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eoe(t,e){let n=k(t,"a","equal","string_or_numeric"),s=k(e,"b","equal","string_or_numeric");[n,s]=Rt(n,s),Ae(n.shape,s.shape);const r={a:n,b:s};return R.runKernel(Ym,r)}const Qs=O({equal_:eoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function toe(t,e,n){const s=k(e,"a","where"),r=k(n,"b","where"),i=k(t,"condition","where","bool"),o=Ae(Ae(i.shape,s.shape),r.shape),a=Hl(i,o),l=Hl(s,o),u=Hl(r,o),c={condition:a,t:l,e:u};return R.runKernel(Eg,c)}const wn=O({where_:toe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function noe(t){const n={x:k(t,"x","zerosLike")};return R.runKernel(Fg,n)}const He=O({zerosLike_:noe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function soe(t,e){let n=k(t,"a","div"),s=k(e,"b","div");[n,s]=Rt(n,s);const r=be(n,s),i=He(r),o=Qs(s,i);return wn(o,i,r)}const Bk=O({divNoNan_:soe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function roe(t,e){const n=k(t,"t1","dot"),s=k(e,"t2","dot");C((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const r=n.rank===1?n.size:n.shape[1],i=s.rank===1?s.size:s.shape[0];if(C(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),n.rank===1&&s.rank===1){const o=L(n,[1,-1]),a=L(s,[-1,1]),l=ze(o,a);return L(l,[])}else if(n.rank===1&&s.rank===2){const o=L(n,[1,-1]),a=L(s,[s.shape[0],s.shape[1]]),l=ze(o,a);return L(l,[l.size])}else if(n.rank===2&&s.rank===1){const o=L(s,[-1,1]),a=ze(n,o);return L(a,[a.size])}else{const o=L(s,[s.shape[0],s.shape[1]]);return ze(n,o)}}const Uk=O({dot_:roe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(t,...e){const n=e.map((r,i)=>k(r,`tensors${i}`,"einsum")),s={equation:t};return R.runKernel(Mx,n,s)}const Il=O({einsum_:ioe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ooe(t){const n={x:k(t,"x","elu","float32")};return R.runKernel(Hh,n)}const $d=O({elu_:ooe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aoe(t,e){const n=k(t,"x","ensureShape","string_or_numeric");if(!YB(n.shape,e))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${e}`);return t}const q4=O({ensureShape_:aoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function loe(t){let e=k(t,"x","erf");C(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=re(e,"float32"));const n={x:e};return R.runKernel(qh,n)}const Wk=O({erf_:loe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jk(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function K4(t,e,n){const s=t.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?r.push(t[i++]):r.push(e[o++]);return r}function In(t,e){const n=[],s=t.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&n.push(t[i]);const r=e.map(i=>t[i]);return[n,r]}function jt(t,e){const n=e.map(s=>1);return K4(t,n,e)}function zn(t,e,n){C(jk(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function Dt(t,e){if(jk(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function il(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function Gt(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uoe(t,e=null,n=!1){const r={x:k(t,"x","max")},i={reductionIndices:e,keepDims:n};return R.runKernel(ug,r,i)}const gr=O({max_:uoe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function coe(t,e=null,n=!1){const r={x:k(t,"x","min")},i={axis:e,keepDims:n};return R.runKernel(fg,r,i)}const lh=O({min_:coe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hoe(t,e){let n=k(t,"base","pow"),s=k(e,"exp","pow");[n,s]=Rt(n,s);const r={a:n,b:s};return R.runKernel(ud,r)}const Ro=O({pow_:hoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Te(t,e){if((nn(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&nn(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return sl(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function doe(t){const n={x:k(t,"x","sqrt","float32")};return R.runKernel(bd,n)}const Pn=O({sqrt_:doe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function foe(t){const e=k(t,"x","square"),n={};return R.runKernel("Square",{x:e},n)}const ot=O({square_:foe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function poe(t,e=null,n=!1){let s=k(t,"x","sum");s.dtype==="bool"&&(s=re(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return R.runKernel(Ng,r,i)}const ge=O({sum_:poe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function moe(t,e="euclidean",n=null,s=!1){t=k(t,"x","norm");const r=X4(t,e,n);let i=r.shape;if(s){const o=Be(n,t.shape);i=jt(r.shape,o)}return L(r,i)}function X4(t,e,n=null){if(t.rank===0)return Kt(t);if(t.rank!==1&&n===null)return X4(L(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return ge(Kt(t),n);if(e===1/0)return gr(Kt(t),n);if(e===-1/0)return lh(Kt(t),n);if(e==="euclidean"||e===2)return Pn(ge(Ro(Kt(t),Te(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return gr(ge(Kt(t),n[0]),n[1]-1);if(e===1/0)return gr(ge(Kt(t),n[1]),n[0]);if(e===-1/0)return lh(ge(Kt(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return Pn(ge(ot(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Ad=O({norm_:moe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function goe(t,e=null,n=!1){return Ad(t,"euclidean",e,n)}const Gk=O({euclideanNorm_:goe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yoe(t){const n={x:k(t,"x","exp")};return R.runKernel(Kh,n)}const ks=O({exp_:yoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function woe(t,e=0){const n=k(t,"x","expandDims","string_or_numeric");C(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},r={dim:e};return R.runKernel(Jm,s,r)}const En=O({expandDims_:woe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(t){const n={x:k(t,"x","expm1")};return R.runKernel(Xh,n)}const Hk=O({expm1_:voe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xoe(t,e){const n=k(t,"x","tile","string_or_numeric");C(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},r={reps:e};return R.runKernel(Cd,s,r)}const cr=O({tile_:xoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function boe(t,e,n,s="float32"){e==null&&(e=t);const r=Fe([t,e],s),i=t<=e?t:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=L(r.toTensor(),[t,e]);if(n==null)return o;if(n.length===1)return cr(En(o,0),[n[0],1,1]);if(n.length===2)return cr(En(En(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return cr(En(En(En(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const O1=O({eye_:boe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ioe(t){const n={x:k(t,"x","floor","float32")};return R.runKernel(Qh,n)}const Rd=O({floor_:Ioe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Toe(t,e,n=0,s=0){const r=k(t,"x","gather"),i=k(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:n,batchDims:s};return R.runKernel(eg,o,a)}const Dd=O({gather_:Toe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Soe(t,e){let n=k(t,"a","greater","string_or_numeric"),s=k(e,"b","greater","string_or_numeric");[n,s]=Rt(n,s),Ae(n.shape,s.shape);const r={a:n,b:s};return R.runKernel(tg,r)}const gs=O({greater_:Soe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _oe(t,e){let n=k(t,"a","greaterEqual","string_or_numeric"),s=k(e,"b","greaterEqual","string_or_numeric");[n,s]=Rt(n,s),Ae(n.shape,s.shape);const r={a:n,b:s};return R.runKernel(Jh,r)}const zo=O({greaterEqual_:_oe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Coe(t){const n={input:k(t,"input","imag")};return R.runKernel(Gx,n)}const Wg=O({imag_:Coe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eoe(t){const n={x:k(t,"x","isFinite")};return R.runKernel(ed,n)}const qk=O({isFinite_:Eoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function koe(t){const n={x:k(t,"x","isInf")};return R.runKernel(td,n)}const Kk=O({isInf_:koe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Noe(t){const n={x:k(t,"x","isNaN")};return R.runKernel(nd,n)}const Xk=O({isNaN_:Noe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $oe(t,e=.2){const s={x:k(t,"x","leakyRelu")},r={alpha:e};return R.runKernel(ng,s,r)}const jg=O({leakyRelu_:$oe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aoe(t,e){let n=k(t,"a","less","string_or_numeric"),s=k(e,"b","less","string_or_numeric");[n,s]=Rt(n,s),Ae(n.shape,s.shape);const r={a:n,b:s};return R.runKernel(sg,r)}const uh=O({less_:Aoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Roe(t,e){let n=k(t,"a","lessEqual","string_or_numeric"),s=k(e,"b","lessEqual","string_or_numeric");[n,s]=Rt(n,s),Ae(n.shape,s.shape);const r={a:n,b:s};return R.runKernel(rg,r)}const ol=O({lessEqual_:Roe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q4(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const s={start:t,stop:e,num:n};return R.runKernel(Hx,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Doe(t,e=5,n=1,s=1,r=.5){const i=k(t,"x","localResponseNormalization");C(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),C(uu(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=L(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:n,alpha:s,beta:r},c=R.runKernel(lg,l,u);return a?L(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const Qk=O({localResponseNormalization_:Doe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ooe(t){const n={x:k(t,"x","log","float32")};return R.runKernel(sd,n)}const Ys=O({log_:Ooe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Poe(t){const n={x:k(t,"x","log1p")};return R.runKernel(rd,n)}const Gg=O({log1p_:Poe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Foe(t){return C(Ma(t),()=>"The f passed in grad(f) must be a function"),(e,n)=>{const s=k(e,"x","tf.grad","string_or_numeric"),r=n!=null?k(n,"dy","tf.grad"):null;return R.tidy(()=>{const{value:i,grads:o}=R.gradients(()=>t(s),[s],r);return r!=null&&Mn(i.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),P1(o),o[0]})}}function Loe(t){return C(Ma(t),()=>"The f passed in grads(f) must be a function"),(e,n)=>{C(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const s=Kp(e,"args","tf.grads","string_or_numeric"),r=n!=null?k(n,"dy","tf.grads"):null;return R.tidy(()=>{const{value:i,grads:o}=R.gradients(()=>t(...s),s,r);return r!=null&&Mn(i.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),P1(o),o})}}function Moe(t){return C(Ma(t),()=>"The f passed in valueAndGrad(f) must be a function"),(e,n)=>{C(e instanceof Qe,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),C(n==null||n instanceof Qe,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:s,value:r}=R.gradients(()=>t(e),[e],n);return P1(s),{grad:s[0],value:r}}}function Voe(t){return C(Ma(t),()=>"The f passed in valueAndGrads(f) must be a function"),(e,n)=>{C(Array.isArray(e)&&e.every(r=>r instanceof Qe),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),C(n==null||n instanceof Qe,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const s=R.gradients(()=>t(...e),e,n);return n!=null&&Mn(s.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),P1(s.grads),s}}function Y4(t,e){C(Ma(t),()=>"The f passed in variableGrads(f) must be a function"),C(e==null||Array.isArray(e)&&e.every(u=>u instanceof qp),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const u in R.registeredVariables)e.push(R.registeredVariables[u])}const s=n?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),C(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=R.gradients(t,e,null,i);C(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),C(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,c)=>{a[c]!=null&&(l[u.name]=a[c])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:o,grads:l}}function Qi(t){return R.customGrad(t)}function P1(t){if(t.filter(n=>n==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zoe(t){const n={x:k(t,"x","neg")};return R.runKernel(mg,n)}const pt=O({neg_:zoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Boe(t){const n={x:k(t,"x","softplus")};return R.runKernel(xd,n)}const ju=O({softplus_:Boe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uoe(t){const e=k(t,"x","logSigmoid");return Qi(s=>({value:pt(ju(pt(s))),gradFunc:o=>P(o,oi(pt(s)))}))(e)}const Yk=O({logSigmoid_:Uoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Woe(t,e){let n=k(t,"a","sub"),s=k(e,"b","sub");[n,s]=Rt(n,s);const r={a:n,b:s};return R.runKernel(Td,r)}const pe=O({sub_:Woe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function joe(t,e=-1){const n=k(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return Qi((r,i)=>{const a=gr(r,e,!0),l=pe(r,a),u=pe(re(l,"float32"),Ys(ge(ks(l),e,!0)));return i([u]),{value:u,gradFunc:(h,d)=>{const[f]=d,p=!0,m=ks(f);return pe(h,P(ge(h,e,p),m))}}})(n)}const F1=O({logSoftmax_:joe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Goe(t,e=null,n=!1){const s=k(t,"x","logSumExp"),r=Be(e,s.shape),i=gr(s,r,!0),o=pe(s,i),a=ks(o),l=ge(a,r),u=Ys(l),c=Y(L(i,u.shape),u);if(n){const h=jt(c.shape,r);return L(c,h)}return c}const Hg=O({logSumExp_:Goe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hoe(t,e){const n=k(t,"a","logicalAnd","bool"),s=k(e,"b","logicalAnd","bool");Ae(n.shape,s.shape);const r={a:n,b:s};return R.runKernel(ig,r)}const zr=O({logicalAnd_:Hoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(t){const n={x:k(t,"x","logicalNot","bool")};return R.runKernel(og,n)}const qg=O({logicalNot_:qoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Koe(t,e){const n=k(t,"a","logicalOr","bool"),s=k(e,"b","logicalOr","bool");Ae(n.shape,s.shape);const r={a:n,b:s};return R.runKernel(ag,r)}const L1=O({logicalOr_:Koe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xoe(t,e){const n=k(t,"a","logicalXor","bool"),s=k(e,"b","logicalXor","bool");return Ae(n.shape,s.shape),zr(L1(t,e),qg(zr(t,e)))}const Jk=O({logicalXor_:Xoe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zy=2147483648;function Qoe(t,e,n="left"){const s=k(t,"sortedSequence","searchSorted"),r=k(e,"values","searchSorted"),i=s.shape[s.shape.length-1],o=r.shape[r.shape.length-1],a=L(s,[-1,i]),l=L(r,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(G(l.shape)>=Zy)throw new Error(`values tensor size must less than ${Zy}`);if(a.shape[1]>=Zy)throw new Error(`trailing dim_size must less than ${Zy} for int32 output type, was ${a.shape[1]}`);const u={sortedSequence:a,values:l},c={side:n};return R.runKernel(c1,u,c)}const M1=O({searchSorted_:Qoe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J4(t,e){return M1(t,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yoe(t,e,n,s,r){const i=k(t,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=L(i,[1,i.shape[0],i.shape[1],i.shape[2]])),C(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),C(Vn(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),ms("maxPool",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r},h=R.runKernel(cg,u,c);return l?L(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Kg=O({maxPool_:Yoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Joe(t,e=[1,1,1],n,s,r,i="NDHWC"){const o=k(t,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=L(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),C(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),C(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),ms("maxPool3d",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i},h=R.runKernel(hg,u,c);return l?L(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const Zk=O({maxPool3d_:Joe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zoe(t,e,n,s,r=!1){const o={x:k(t,"x","maxPoolWithArgmax")},a={filterSize:e,strides:n,pad:s,includeBatchInIndex:r},l=R.runKernel(Qx,o,a);return{result:l[0],indexes:l[1]}}const Z4=O({maxPoolWithArgmax_:Zoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eae(t,e){let n=k(t,"a","maximum"),s=k(e,"b","maximum");[n,s]=Rt(n,s),n.dtype==="bool"&&(n=re(n,"int32"),s=re(s,"int32")),Ae(n.shape,s.shape);const r={a:n,b:s};return R.runKernel(id,r)}const Ji=O({maximum_:eae});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tae(t,e=null,n=!1){const r={x:k(t,"x","mean")},i={axis:e,keepDims:n};return R.runKernel(dg,r,i)}const $t=O({mean_:tae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qt(t,e="float32"){if(er(t),e==="complex64"){const s=Qt(t,"float32"),r=Qt(t,"float32");return $o(s,r)}const n=On(G(t),e);return R.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Is(t,e="float32"){if(er(t),e==="complex64"){const s=Is(t,"float32"),r=Qt(t,"float32");return $o(s,r)}const n=vx(G(t),e);return R.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eU(t,e,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(t===void 0)return[];let s=k(t,"x","meshgrid",t instanceof Qe?t.dtype:"float32");if(e===void 0)return[s];let r=k(e,"y","meshgrid",e instanceof Qe?e.dtype:"float32");const i=G(s.shape),o=G(r.shape);return n==="xy"?(s=L(s,[1,-1]),r=L(r,[-1,1]),[ze(Is([o,1],s.dtype),s),ze(r,Is([1,i],r.dtype))]):(s=L(s,[-1,1]),r=L(r,[1,-1]),[ze(s,Is([1,o],s.dtype)),ze(Is([i,1],r.dtype),r)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nae(t,e){let n=k(t,"a","minimum"),s=k(e,"b","minimum");[n,s]=Rt(n,s),n.dtype==="bool"&&(n=re(n,"int32"),s=re(s,"int32")),Ae(n.shape,s.shape);const r={a:n,b:s};return R.runKernel(od,r)}const Ba=O({minimum_:nae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sae(t,e,n){C(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=k(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");C(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)C(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),C(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:n},o={x:s};return R.runKernel(pg,o,i)}const eN=O({mirrorPad_:sae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rae(t,e){let n=k(t,"a","mod"),s=k(e,"b","mod");[n,s]=Rt(n,s);const r={a:n,b:s};return R.runKernel(ad,r)}const tN=O({mod_:rae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iae(t,e=null,n=!1){t=k(t,"x","moments");const s=Be(e,t.shape),r=$t(t,s,n);let i=r.shape;n||(i=jt(r.shape,s));const o=ot(pe(re(t,"float32"),L(r,i))),a=$t(o,s,n);return{mean:r,variance:a}}const Xg=O({moments_:iae});function oae(t,e,n,s){const r=k(e,"data","multiRNNCell"),i=Kp(n,"c","multiRNNCell"),o=Kp(s,"h","multiRNNCell");let a=r;const l=[];for(let h=0;h<t.length;h++){const d=t[h](a,i[h],o[h]);l.push(d[0]),l.push(d[1]),a=d[1]}const u=[],c=[];for(let h=0;h<l.length;h+=2)u.push(l[h]),c.push(l[h+1]);return[u,c]}const tU=O({multiRNNCell_:oae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aae(t,e,n,s=!1){const r=k(t,"logits","multinomial"),i=r.size,o=r.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();const l={logits:o===1?L(r,[1,-1]):r},u={numSamples:e,seed:n,normalized:s},c=R.runKernel(Yx,l,u);return o===1?L(c,[c.size]):c}const nU=O({multinomial_:aae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(t,e){let n=k(t,"a","notEqual","string_or_numeric"),s=k(e,"b","notEqual","string_or_numeric");[n,s]=Rt(n,s),Ae(n.shape,s.shape);const r={a:n,b:s};return R.runKernel(gg,r)}const yu=O({notEqual_:lae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uae(t,e,n=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:k(t,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:n,offValue:s};return R.runKernel(wg,o,a)}const ch=O({oneHot_:uae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cae(t){const n={x:k(t,"x","onesLike")};return R.runKernel(yg,n)}const Js=O({onesLike_:cae});function hae(t,e){const n=k(t,"v1","outerProduct"),s=k(e,"v2","outerProduct");C(n.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${s.rank}.`);const r=L(n,[-1,1]),i=L(s,[1,-1]);return ze(r,i)}const sU=O({outerProduct_:hae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dae(t,e,n=0){const s=k(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:n},i={x:s};return R.runKernel(xg,i,r)}const Bo=O({pad_:dae});function fae(t,e,n=0){return C(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),Bo(t,[e],n)}const rU=O({pad1d_:fae});function pae(t,e,n=0){return C(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Bo(t,e,n)}const iU=O({pad2d_:pae});function mae(t,e,n=0){return C(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Bo(t,e,n)}const oU=O({pad3d_:mae});function gae(t,e,n=0){return C(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Bo(t,e,n)}const aU=O({pad4d_:gae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yae(t,e,n){const s=k(t,"x","spaceToBatchND");C(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),C(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),C(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:n};return R.runKernel($g,r,i)}const Qg=O({spaceToBatchND_:yae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wae(t,e,n,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=k(t,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=L(a,[1,a.shape[0],a.shape[1],a.shape[2]])),C(Vn(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const c=Ur(l.shape,e,i,r,s),h=[c.dilationHeight,c.dilationWidth];let d;s==="same"?d=xae([c.filterHeight,c.filterWidth],h):d=[[0,0],[0,0]];const f=h[0]===1&&h[1]===1,[p,m]=vae([c.inHeight,c.inWidth],h,d),g=f?s:"valid",y=f?l:Qg(l,h,p),x=(n==="avg"?()=>zg(y,e,i,g,o):()=>Kg(y,e,i,g,o))(),v=f?x:Bg(x,h,m);return u?L(v,[v.shape[1],v.shape[2],v.shape[3]]):v}function vae(t,e,n){const s=n.map(c=>c[0]),r=n.map(c=>c[1]),i=t.concat(s,r),o=e.map((c,h)=>(c-i[h]%c)%c),a=r.map((c,h)=>c+o[h]),l=e.map((c,h)=>[s[h],a[h]]),u=e.map((c,h)=>[0,o[h]]);return[l,u]}function xae(t,e){const s=t.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const nN=O({pool_:wae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bae(t,e){const n=k(t,"x","prelu"),s=k(e,"alpha","prelu"),r={x:n,alpha:s};return R.runKernel(bg,r)}const Yg=O({prelu_:bae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iae(t,e=null,n=!1){let s=k(t,"x","prod");s.dtype==="bool"&&(s=re(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return R.runKernel(Ig,r,i)}const sN=O({prod_:Iae});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tae(t,e,n,s){const r=t.map((c,h)=>k(c,`tensors${h}`,"raggedGather","int32")),i=k(e,"paramsDenseValues","raggedGather"),o=k(n,"indices","raggedGather","int32"),a={paramsNestedSplits:r,paramsDenseValues:i,indices:o},l={outputRaggedRank:s},u=R.runKernel(t1,a,l);return{outputNestedSplits:u.slice(0,u.length-1),outputDenseValues:u[u.length-1]}}const lU=O({raggedGather_:Tae});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sae(t,e,n){const s=k(t,"starts","raggedRange"),r=k(e,"limits","raggedRange",s.dtype),i=k(n,"deltas","raggedRange",s.dtype),o={starts:s,limits:r,deltas:i},a=R.runKernel(n1,o);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const uU=O({raggedRange_:Sae});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ae(t,e,n,s,r){const i=k(t,"shape","raggedTensorToTensor","int32"),o=k(e,"values","raggedTensorToTensor"),a=k(n,"defaultValue","raggedTensorToTensor",o.dtype),l=s.map((h,d)=>k(h,`tensors${d}`,"raggedTensorToTensor","int32")),u={shape:i,values:o,defaultValue:a,rowPartitionTensors:l},c={rowPartitionTypes:r};return R.runKernel(s1,u,c)}const cU=O({raggedTensorToTensor_:_ae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cae(t,e,n){er(t);const s=G(t);let r=null;if(n==null||n==="float32")r=new Float32Array(s);else if(n==="int32")r=new Int32Array(s);else if(n==="bool")r=new Uint8Array(s);else throw new Error(`Unknown data type ${n}`);for(let i=0;i<s;i++)r[i]=e();return R.makeTensor(r,t,n)}const hU=O({rand_:Cae});var rN={exports:{}};rN.exports;(function(t){(function(e,n,s){function r(l){var u=this,c=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var c=new r(l),h=u&&u.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,c),d.state=function(){return i(c,{})}),d}function a(){var l=4022871197,u=function(c){c=String(c);for(var h=0;h<c.length;h++){l+=c.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.alea=o})(Pe,t,!1)})(rN);var Eae=rN.exports,iN={exports:{}};iN.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xor128=o})(Pe,t,!1)})(iN);var kae=iN.exports,oN={exports:{}};oN.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xorwow=o})(Pe,t,!1)})(oN);var Nae=oN.exports,aN={exports:{}};aN.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.x,h=l.i,d,f;return d=c[h],d^=d>>>7,f=d^d<<24,d=c[h+1&7],f^=d^d>>>10,d=c[h+3&7],f^=d^d>>>3,d=c[h+4&7],f^=d^d<<7,d=c[h+7&7],d=d^d<<13,f^=d^d<<9,c[h]=f,l.i=h+1&7,f};function u(c,h){var d,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[d&7]=f[d&7]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xorshift7=o})(Pe,t,!1)})(aN);var $ae=aN.exports,lN={exports:{}};lN.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.w,h=l.X,d=l.i,f,p;return l.w=c=c+1640531527|0,p=h[d+34&127],f=h[d=d+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=h[d]=p^f,l.i=d,p+(c^c>>>16)|0};function u(c,h){var d,f,p,m,g,y=[],w=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,w=Math.max(w,h.length)),p=0,m=-32;m<w;++m)h&&(f^=h.charCodeAt((m+32)%h.length)),m===0&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(g=g+1640531527|0,d=y[m&127]^=f+g,p=d==0?p+1:0);for(p>=128&&(y[(h&&h.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=y[p+34&127],d=y[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,y[p]=f^d;c.w=g,c.X=y,c.i=p}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xor4096=o})(Pe,t,!1)})(lN);var Aae=lN.exports,uN={exports:{}};uN.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.b,d=l.c,f=l.d,p=l.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-f|0,l.d=f<<16^d>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.tychei=o})(Pe,t,!1)})(uN);var Rae=uN.exports,dU={exports:{}};const Dae={},Oae=Object.freeze(Object.defineProperty({__proto__:null,default:Dae},Symbol.toStringTag,{value:"Module"})),V1=A_(Oae);(function(t){(function(e,n,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),c=u*2,h=r-1,d;function f(v,b,S){var T=[];b=b==!0?{entropy:!0}:b||{};var _=y(g(b.entropy?[v,x(n)]:v??w(),3),T),E=new p(T),N=function(){for(var $=E.g(i),A=l,D=0;$<u;)$=($+D)*r,A*=r,D=E.g(1);for(;$>=c;)$/=2,A/=2,D>>>=1;return($+D)/A};return N.int32=function(){return E.g(4)|0},N.quick=function(){return E.g(4)/4294967296},N.double=N,y(x(E.S),n),(b.pass||S||function($,A,D,F){return F&&(F.S&&m(F,E),$.state=function(){return m(E,{})}),D?(s[a]=$,A):$})(N,_,"global"in b?b.global:this==s,b.state)}function p(v){var b,S=v.length,T=this,_=0,E=T.i=T.j=0,N=T.S=[];for(S||(v=[S++]);_<r;)N[_]=_++;for(_=0;_<r;_++)N[_]=N[E=h&E+v[_%S]+(b=N[_])],N[E]=b;(T.g=function($){for(var A,D=0,F=T.i,B=T.j,z=T.S;$--;)A=z[F=h&F+1],D=D*r+z[h&(z[F]=z[B=h&B+A])+(z[B]=A)];return T.i=F,T.j=B,D})(r)}function m(v,b){return b.i=v.i,b.j=v.j,b.S=v.S.slice(),b}function g(v,b){var S=[],T=typeof v,_;if(b&&T=="object")for(_ in v)try{S.push(g(v[_],b-1))}catch{}return S.length?S:T=="string"?v:v+"\0"}function y(v,b){for(var S=v+"",T,_=0;_<S.length;)b[h&_]=h&(T^=b[h&_]*19)+S.charCodeAt(_++);return x(b)}function w(){try{var v;return d&&(v=d.randomBytes)?v=v(r):(v=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(v)),x(v)}catch{var b=e.navigator,S=b&&b.plugins;return[+new Date,e,S,e.screen,x(n)]}}function x(v){return String.fromCharCode.apply(0,v)}if(y(s.random(),n),t.exports){t.exports=f;try{d=V1}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:Pe,[],Math)})(dU);var Pae=dU.exports,Fae=Eae,Lae=kae,Mae=Nae,Vae=$ae,zae=Aae,Bae=Rae,Gu=Pae;Gu.alea=Fae;Gu.xor128=Lae;Gu.xorwow=Mae;Gu.xorshift7=Vae;Gu.xor4096=zae;Gu.tychei=Bae;var cN=Gu;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uae=.001,fU=.1;function Wae(t,e,n){return n==null&&(n=hN()),QS(t,e,(s,r)=>dN(s,r,n))}function hN(){return R.backend.floatPrecision()===32?Uae:fU}function QS(t,e,n){let s=!0;if((nn(t)||nn(e))&&(s=!1),nn(t)&&nn(e)&&(s=!0),s){const o=t.constructor.name,a=e.constructor.name;if(o!==a)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${a}`)}if(Array.isArray(t)&&Array.isArray(e)){const o=Xi(t),a=Xi(e);if(!We(o,a))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${a}]`)}const r=nn(t)?t:Ki(t),i=nn(e)?e:Ki(e);if(r.length!==i.length)throw new Error(`Arrays have different lengths actual: ${r.length} vs expected: ${i.length}.
Actual:   ${r}.
Expected: ${i}.`);for(let o=0;o<i.length;++o){const a=r[o],l=i[o];if(!n(a,l))throw new Error(`Arrays differ: actual[${o}] = ${a}, expected[${o}] = ${l}.
Actual:   ${r}.
Expected: ${i}.`)}typeof expect<"u"&&expect().nothing()}function jae(t,e){t().then(()=>e.fail(),()=>e()),typeof expect<"u"&&expect().nothing()}function Gae(t,e){const n=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return Ri(t)||Ri(t[0])||Ri(e)||Ri(e[0])?QS(t,n,(s,r)=>s==r):QS(t,e,(s,r)=>dN(s,r,0))}function Hae(t,e,n){if(n==null&&(n=hN()),!dN(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`);typeof expect<"u"&&expect().nothing()}function dN(t,e,n){return!isFinite(t)&&!isFinite(e)?!0:!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}function qae(t,e,n){for(let s=0;s<t.length;s++)if(t[s]<e||t[s]>n)throw new Error(`Value out of range:${t[s]} low: ${e}, high: ${n}`)}function Kae(t,e){const n=new Float32Array(t),s=new Float32Array(e);if(n.length!==s.length)throw new Error(`Expected ArrayBuffer to be of length ${s.length}, but it was ${n.length}`);for(let r=0;r<s.length;r++)if(n[r]!==s[r])throw new Error(`Expected ArrayBuffer value at ${r} to be ${s[r]} but got ${n[r]} instead`)}function pU(t){for(let e=0;e<t.length;e++){const n=t[e];Array.isArray(n)?pU(n):t[e]=Bi(n)}return t}function Xae(t){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(t),new Promise(n=>{e.addEventListener("loadeddata",s=>n(e)),e.load()})}async function Qae(t){await t.play(),"requestVideoFrameCallback"in t&&await new Promise(e=>{t.requestVideoFrameCallback(e)})}const Yae=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:fU,createVideoElement:Xae,encodeStrings:pU,expectArrayBuffersEqual:Kae,expectArraysClose:Wae,expectArraysEqual:Gae,expectNumbersClose:Hae,expectPromiseToFail:jae,expectValuesInRange:qae,play:Qae,testEpsilon:hN},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fN{constructor(e,n,s,r,i){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=cN.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,n,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,n=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class Jae{constructor(e,n,s,r){this.alpha=e,this.beta=1/n,this.dtype=s;const i=r||Math.random();this.randu=cN.alea(i.toString()),this.randn=new fN(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,n,s,r,i,o;for(;;){do r=this.randn.nextValue(),o=1+this.c*r;while(o<=0);if(o*=o*o,e=r*r,n=1-.331*e*e,s=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<n||Math.log(i)<s)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class Zae{constructor(e=0,n=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=cN.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ele(t,e,n=1,s="float32",r){if(er(t),n==null&&(n=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const i=new Jae(e,n,s,r),o=Fe(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const mU=O({randomGamma_:ele});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tle(t,e=0,n=1,s,r){if(er(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new fN(e,n,s,!1,r),o=Fe(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const z1=O({randomNormal_:tle});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nle(t,e,n){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return z1(t,0,1,e,n)}const gU=O({randomStandardNormal_:nle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sle(t,e=0,n=1,s="float32",r){er(t);const i=Fe(t,s),o=new Zae(e,n,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const al=O({randomUniform_:sle});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rle(t,e,n,s){return al(t,e,n,"int32",s)}const yU=O({randomUniformInt_:rle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wu(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const r={start:t,stop:e,step:n,dtype:s};return R.runKernel(r1,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ile(t){const n={input:k(t,"input","real")};return R.runKernel(i1,n)}const hh=O({real_:ile});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ole(t){const n={x:k(t,"x","reciprocal")};return R.runKernel(cd,n)}const pN=O({reciprocal_:ole});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ale(t){const n={x:k(t,"x","relu")};return R.runKernel(hd,n)}const xi=O({relu_:ale});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lle(t){const n={x:k(t,"x","relu6")};return R.runKernel(dd,n)}const B1=O({relu6_:lle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ule(t,e){const s={x:k(t,"x","reverse")},r={dims:e};return R.runKernel(Cg,s,r)}const vr=O({reverse_:ule});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cle(t){const e=k(t,"x","reverse");return C(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),vr(e,0)}const wU=O({reverse1d_:cle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hle(t,e){const n=k(t,"x","reverse");return C(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),vr(n,e)}const vU=O({reverse2d_:hle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dle(t,e){const n=k(t,"x","reverse");return C(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),vr(n,e)}const xU=O({reverse3d_:dle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fle(t,e){const n=k(t,"x","reverse");return C(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),vr(n,e)}const bU=O({reverse4d_:fle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ple(t){const n={x:k(t,"x","round")};return R.runKernel(fd,n)}const U1=O({round_:ple});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mle(t){const n={x:k(t,"x","rsqrt","float32")};return R.runKernel(pd,n)}const W1=O({rsqrt_:mle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gle(t){const n={x:k(t,"x","selu")};return R.runKernel(md,n)}const j1=O({selu_:gle});function yle(t,e,n,s,r,i=[1,1],o="NHWC"){const a=k(t,"x","separableConv2d"),l=k(e,"depthwiseFilter","separableConv2d"),u=k(n,"pointwiseFilter","separableConv2d");let c=a,h=!1;if(a.rank===3&&(h=!0,c=L(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");C(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),C(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),C(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),C(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),C(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const d=l.shape[2],f=l.shape[3];C(u.shape[2]===d*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*f}, but got ${u.shape[2]}.`);const p=Nd(c,l,s,r,o,i),g=Ao(p,u,1,"valid",o);return h?L(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const G1=O({separableConv2d_:yle});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function wle(t,e){const n=k(t,"x","setdiff1d"),s=k(e,"y","setdiff1d");C(n.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${s.dtype}).`),C(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),C(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const r=await n.data(),i=await s.data(),o=new Set(i);let a=0;for(let c=0;c<r.length;c++)o.has(r[c])||a++;const l=new Jt([a],n.dtype),u=new Jt([a],"int32");for(let c=0,h=0;c<r.length;c++)o.has(r[c])||(l.values[h]=r[c],u.values[h]=c,h++);return[l.toTensor(),u.toTensor()]}const IU=wle;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vle(t){const n={x:k(t,"x","sign")};return R.runKernel(wd,n)}const mN=O({sign_:vle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xle(t){const n={x:k(t,"x","sin","float32")};return R.runKernel(gd,n)}const H1=O({sin_:xle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ble(t){const n={x:k(t,"x","sinh")};return R.runKernel(yd,n)}const q1=O({sinh_:ble});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ile(t,e,n){const s=k(t,"x","slice1d");return C(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Ge(s,[e],[n])}const Jg=O({slice1d_:Ile});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tle(t,e,n){const s=k(t,"x","slice2d");return C(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Ge(s,e,n)}const K1=O({slice2d_:Tle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sle(t,e,n){const s=k(t,"x","slice3d");return C(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Ge(s,e,n)}const Zg=O({slice3d_:Sle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _le(t,e,n){const s=k(t,"x","slice4d");return C(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Ge(s,e,n)}const dh=O({slice4d_:_le});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cle(t,e=-1){const n=k(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},r={dim:e};return R.runKernel(Rg,s,r)}const ey=O({softmax_:Cle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(t){C(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return R.runKernel(zx,e)}const ty=O({fft_:Ele});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kle(t){C(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return R.runKernel(jx,e)}const fh=O({ifft_:kle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nle(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const r=L(t,[n,e]);s=fh(r)}else{const r=[n,2*(e-1)],i=L(hh(t),[n,e]),o=L(Wg(t),[n,e]),a=vr(Ge(i,[0,1],[n,e-2]),1),l=P(vr(Ge(o,[0,1],[n,e-2]),1),Te(-1)),u=Bt([i,a],1),c=Bt([o,l],1),h=L($o(u,c),[r[0],r[1]]);s=fh(h)}if(s=hh(s),t.rank===3&&t.shape[0]!==0){const r=s,i=t.shape[0];s=L(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const X1=O({irfft_:Nle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $le(t,e,n=0){const r={x:k(t,"x","split")},i={numOrSizeSplits:e,axis:n};return R.runKernel(Ag,r,i)}const Ss=O({split_:$le});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ale(t,e){C(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let r;if(e!=null&&e<n){const p=t.shape.map(g=>0),m=t.shape.map(g=>g);m[t.shape.length-1]=e,r=Ge(t,p,m),n=e}else if(e!=null&&e>n){const p=t.shape.map(m=>m);p[t.shape.length-1]=e-n,r=Bt([t,Qt(p)],t.shape.length-1),n=e}else r=t;const i=He(r),o=L($o(r,i),[s,n]),a=ty(o),l=Math.floor(n/2)+1,u=hh(a),c=Wg(a),h=Ss(u,[l,n-l],u.shape.length-1),d=Ss(c,[l,n-l],c.shape.length-1),f=r.shape.slice();return f[r.shape.length-1]=l,L($o(h[0],d[0]),f)}const ny=O({rfft_:Ale});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rle(t,e){let n=k(t,"a","squaredDifference"),s=k(e,"b","squaredDifference");[n,s]=Rt(n,s),Ae(n.shape,s.shape);const r={a:n,b:s},i={};return R.runKernel(Id,r,i)}const Q1=O({squaredDifference_:Rle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dle(t,e){const n=k(t,"x","squeeze","string_or_numeric");return L(n,Fo(n.shape,e).newShape)}const ll=O({squeeze_:Dle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ole(t,e=0){const n=Kp(t,"tensors","stack","string_or_numeric");C(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&C(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,r={axis:e};return R.runKernel(vg,s,r)}const fs=O({stack_:Ole});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ple(t,e=0){const s={x:k(t,"x","step")},r={alpha:e};return R.runKernel(Ed,s,r)}const Hu=O({step_:Ple});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fle(t,e,n,s,r=0,i=0,o=0,a=0,l=0){const c={x:k(t,"x","stridedSlice","string_or_numeric")},h={begin:e,end:n,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return R.runKernel(y1,c,h)}const gN=O({stridedSlice_:Fle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lle(t){const n={x:k(t,"x","tan","float32")};return R.runKernel(Sd,n)}const yN=O({tan_:Lle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $n(t,e){Mu(t);const n=Xi(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return sl(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Na(t,e,n){if(Mu(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Xi(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return sl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wN(t,e,n){if(Mu(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=Xi(t,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return sl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TU(t,e,n){if(Mu(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=Xi(t,n);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return sl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SU(t,e,n){if(Mu(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=Xi(t,n);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return sl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _U(t,e,n){if(Mu(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=Xi(t,n);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,sl(t,e,s,n)}function vN(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(i+` update.rank < ${r}. `);if(t.length<s+(n.rank-r))throw new Error(i+` Output shape length < ${s+(n.rank-r)}`);if(n.rank!==r+t.length-s)throw new Error(i+` update.rank != ${r+t.length-s}`);for(let o=0;o<r;++o)if(n.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-r;++o)if(n.shape[o+r]!==t[o+s])throw new Error(i+` updates.shape[${o+r}] (${n.shape[o+r]}) != shape[${o+r}] (${t[o+r]})`)}function Y1(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}vN(n,e,t)}function ul(t,e,n){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=n.length;let o=1;for(let h=r;h<i;++h)o*=n[h];const a=r<1?1:r,l=G(e.shape)/a,u=[...Ie(n.slice(0,r)),1],c=G(n);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:u,outputSize:c}}const Mle=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:ul,validateInput:Y1,validateUpdateShape:vN},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vle(t,e,n){const s=k(t,"tensor","tensorScatterupdate"),r=k(e,"indices","tensorScatterupdate","int32"),i=k(n,"updates","tensorScatterupdate");if(Y1(i,r,s.shape),s.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${s.dtype} and ${i.dtype}.`);const o={tensor:s,indices:r,updates:i},a={};return R.runKernel(u1,o,a)}const CU=O({tensorScatterUpdate_:Vle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zle(t,e=1,n=!0){const s=k(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:n},[a,l]=R.runKernel(b1,i,o);return{values:a,indices:l}}const xN=O({topk_:zle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ble(t,e=0,n=1,s,r){if(er(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new fN(e,n,s,!0,r),o=Fe(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const J1=O({truncatedNormal_:Ble});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ule(t,e=0){const n=k(t,"x","unique","string_or_numeric");C(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},r={axis:e},[i,o]=R.runKernel(T1,s,r);return{values:i,indices:o}}const bN=O({unique_:Ule});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wle(t,e,n){const s=k(t,"x","unsortedSegmentSum"),r=k(e,"segmentIds","unsortedSegmentSum","int32");C(uu(n),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:n};return R.runKernel(Pg,i,o)}const Z1=O({unsortedSegmentSum_:Wle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jle(t,e=0){const n=k(t,"x","unstack","string_or_numeric");C(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},r={axis:e};return R.runKernel(Og,s,r)}const xr=O({unstack_:jle});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EU(t,e){return M1(t,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IN(t,e=!0,n,s){return R.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eb(t,e){const n=[];for(let i=0;i<e.length;i++)e[i]&&n.push(i);const s=Fe(t,"int32"),r=Fe([n.length,t.length],"int32");for(let i=0;i<n.length;i++){const o=s.indexToLoc(n[i]),a=i*t.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Gle(t){const e=k(t,"condition","whereAsync","bool"),n=await e.data(),s=eb(e.shape,n);return t!==e&&e.dispose(),s}const TN=Gle;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Hle(t,e,n){const s=k(t,"tensor","boolMask"),r=k(e,"mask","boolMask","bool"),i=n??0,o=r.rank,a=s.shape;C(o>0,()=>"mask cannot be scalar"),Mn(a.slice(i,i+o),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let m=i;m<i+o;m++)l*=a[m];const u=a.slice(0,i).concat([l],a.slice(i+o)),c=L(s,u),h=L(r,[-1]),d=await TN(h),f=ll(d,[1]),p=Dd(c,f,i);return t!==s&&s.dispose(),e!==r&&r.dispose(),f.dispose(),c.dispose(),h.dispose(),d.dispose(),p}const kU=Hle;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qle(t,e,n){const s=k(t,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),C(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{C(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?W(()=>{let o=hh(s),a=Wg(s);return o=R.runKernel(Gl,{x:o},i),a=R.runKernel(Gl,{x:a},i),n&&(a=pt(a)),$o(o,a)}):R.runKernel(Gl,r,i)}const je=O({transpose_:qle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kle(t,e,n,s,r=!0){const i=k(t,"v","movingAverage"),o=k(e,"x","movingAverage"),a=k(n,"decay","movingAverage");T4(i,o),C(We(i.shape,o.shape),()=>"Shape mismatch in v and x");const l=Te(1),u=pe(l,a);let c=P(pe(o,i),u);if(r){C(s!=null,()=>"When using zeroDebias: true, step is required.");const h=k(s,"step","movingAverage");c=be(c,pe(l,Ro(a,h)))}return Y(i,c)}const NU=O({movingAverage_:Kle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xle(t,e,n){er(n);const s=k(t,"indices","scatterND","int32"),r=k(e,"updates","scatterND");Y1(r,s,n);const i={indices:s,updates:r},o={shape:n};return R.runKernel(l1,i,o)}const $U=O({scatterND_:Xle});function Qle(t,e,n,s){if(t.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const r=t.rank>0?t.shape[0]:1,i=t.rank>1?t.shape[1]:1;if(n.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${i}.`);const o=e.size;if(!(e.rank===0||e.rank===1&&o===r))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${r}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yle(t,e,n,s=0){er(n);const r=k(t,"sparseIndices","sparseToDense","int32"),i=k(e,"sparseValues","sparseToDense","string_or_numeric"),o=k(s,"defaultValue","sparseToDense",i.dtype);Qle(r,i,n,o);const a={sparseIndices:r,sparseValues:i,defaultValue:o},l={outputShape:n};return R.runKernel(m1,a,l)}const AU=O({sparseToDense_:Yle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jle(t,e){const n=k(e,"indices","gatherND","int32"),r={params:k(t,"x","gatherND","string_or_numeric"),indices:n};return R.runKernel(Wx,r)}const RU=O({gatherND_:Jle});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zle(t,e){if(e==null)return t.shape.slice();if(We(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eue(t,e,n,s){const r=k(t,"x","dropout");if(C(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),C(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Qe?r.clone():r;const i=Zle(r,n),o=1-e,a=be(Rd(Y(al(i,0,1,"float32",s),o)),o);return P(r,a)}const SN=O({dropout_:eue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _N(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function tb(t,e,n){const s=1-t%2,r=new Float32Array(t);for(let i=0;i<t;++i){const o=2*Math.PI*i/(t+s-1);r[i]=e-n*Math.cos(o)}return $n(r,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function tue(t,e,n=1){const s=k(t,"predictions","inTopK"),r=k(e,"targets","inTopK");C(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),C(s.rank-1===r.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${r.rank}`),Mn(s.shape.slice(0,s.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=s.shape[s.shape.length-1];C(n>0&&n<=i,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${n}`);const o=await s.data(),a=await r.data(),[l,u]=[o.length/i,i],c=vn("bool",l);for(let h=0;h<l;h++){const d=h*u,f=o.subarray(d,d+u),p=[];for(let m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort((m,g)=>g.value-m.value),c[h]=0;for(let m=0;m<n;m++)if(p[m].index===a[h]){c[h]=1;break}}return t!==s&&s.dispose(),e!==r&&r.dispose(),Xs(c,r.shape,"bool")}const DU=tue;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nue(t,e,n,s,r,i="NHWC",o){let a=t;t.rank===3&&(a=L(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=L(e,[1,e.shape[0],e.shape[1],e.shape[2]])),C(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),C(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),C(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],c=i==="NHWC"?l.shape[3]:l.shape[1];C(u===n[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`),C(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),ms("conv2dDerFilter",r,o);const h={x:a,dy:l},d={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:n};return R.runKernel(Ex,h,d)}const CN=O({conv2DBackpropFilter_:nue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nb(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return P(t,Hu(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function sb(t,e){let n=e;const s=Zt(t.shape,e.shape);return s.length>0&&(n=ge(n,s)),L(n,t.shape)}function rb(t,e,n,s){if(e==="linear")return t;if(e==="relu")return xi(t);if(e==="elu")return $d(t);if(e==="relu6")return B1(t);if(e==="prelu")return Yg(t,n);if(e==="leakyrelu")return jg(t,s);if(e==="sigmoid")return oi(t);throw new Error(`Unknown fused activation ${e}.`)}const ib=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sue({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(l=l||"linear",ib(R.state.gradientDepth,l)===!1){C(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let S=Ao(t,e,n,s,r,i,o);return a!=null&&(S=Y(S,a)),rb(S,l,u,c)}const h=k(t,"x","conv2d","float32"),d=k(e,"filter","conv2d","float32");let f=h,p=!1;h.rank===3&&(p=!0,f=L(h,[1,h.shape[0],h.shape[1],h.shape[2]])),C(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),C(d.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${d.rank}.`),ms("fused conv2d",s,o);const m=r==="NHWC"?f.shape[3]:f.shape[1];C(d.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${d.shape[2]}.`),C(Vn(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);const g=bn(f.shape,d.shape,n,i,s,o);let y;a!=null&&(y=k(a,"bias","fused conv2d"),[y]=Rt(y,h),r==="NHWC"?Ae(g.outShape,y.shape):(C(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),C(y.shape.length===0||y.shape[0]===g.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let w;if(u!=null){const S=u.shape;if(C(S.length<=1||S.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${S.length}.`),S.length===1)C(S[0]===1||S[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the number of output channels (${g.outChannels}).`);else if(S.length===3)try{Ae(S,g.outShape)}catch{const _=`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(_)}w=k(u,"prelu weights","fused conv2d")}const x=(S,T)=>{C(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[_,E,N,$]=T,A=nb(S,N,l);C(za(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const D=Fk(E.shape,A,_,n,s),F=CN(E,A,_.shape,n,s),B=[D,F];if($!=null){const z=sb($,A);B.push(z)}return B},v={x:f,filter:d,bias:y,preluActivationWeights:w},b={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:c};return a==null?Qi((T,_,E)=>{let N=R.runKernel(Wp,v,b);return E([_,T,N]),p&&(N=L(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:x}})(f,d):Qi((T,_,E,N)=>{let $=R.runKernel(Wp,v,b);return N([_,T,$,E]),p&&($=L($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:x}})(f,d,y)}const OU=O({fusedConv2d_:sue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rue(t,e,n,s,r,i=[1,1],o){let a=t;t.rank===3&&(a=L(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=L(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},c={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:n};return R.runKernel(Ox,u,c)}const PU=O({depthwiseConv2dNativeBackpropFilter_:rue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iue(t,e,n,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=L(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:n},c={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:t},h=R.runKernel(Px,u,c);return l?L(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const FU=O({depthwiseConv2dNativeBackpropInput_:iue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oue({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(ib(R.state.gradientDepth,l)===!1){let b=Nd(t,e,n,s,r,i,o);return a!=null&&(b=Y(b,a)),rb(b,l,u,c)}const h=k(t,"x","depthwiseConv2d","float32"),d=k(e,"filter","depthwiseConv2d","float32");let f=h,p=!1;h.rank===3&&(p=!0,f=L(h,[1,h.shape[0],h.shape[1],h.shape[2]])),C(f.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`),C(d.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${d.rank}.`),C(f.shape[3]===d.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`),i==null&&(i=[1,1]),C(Vn(n,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),ms("fused depthwiseConv2d",s,o);const m=bn(f.shape,d.shape,n,i,s,o,!0);let g;a!=null&&(g=k(a,"bias","fused conv2d"),[g]=Rt(g,h),Ae(m.outShape,g.shape));let y;u!=null&&(y=k(u,"prelu weights","fused depthwiseConv2d"));const w=(b,S)=>{C(za(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);const[T,_,E,N]=S,$=nb(b,E,l),A=FU(_.shape,$,T,n,s,i,o),D=PU(_,$,T.shape,n,s,i,o);if(N!=null){const F=sb(g,$);return[A,D,F]}return[A,D]},x={x:f,filter:d,bias:g,preluActivationWeights:y},v={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:c};return a==null?Qi((S,T,_)=>{let E=R.runKernel(jp,x,v);return _([T,S,E]),p&&(E=L(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:w}})(f,d):Qi((S,T,_,E)=>{let N=R.runKernel(jp,x,v);return E([T,S,N,_]),p&&(N=L(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:w}})(f,d,g)}const aue=O({fusedDepthwiseConv2d_:oue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lue({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(ib(R.state.gradientDepth,i)===!1){let $=ze(t,e,n,s);return r!=null&&($=Y($,r)),rb($,i,o,a)}let l=k(t,"a","fused matMul"),u=k(e,"b","fused matMul");[l,u]=Rt(l,u);const c=n?l.shape[l.rank-2]:l.shape[l.rank-1],h=s?u.shape[u.rank-1]:u.shape[u.rank-2],d=n?l.shape[l.rank-1]:l.shape[l.rank-2],f=s?u.shape[u.rank-2]:u.shape[u.rank-1],p=l.shape.slice(0,-2),m=u.shape.slice(0,-2),g=G(p),y=G(m);C(c===h,()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${n} and transposeB=${s} must match.`);const x=Ae(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([d,f]),v=n?L(l,[g,c,d]):L(l,[g,d,c]),b=s?L(u,[y,f,h]):L(u,[y,h,f]);let S;r!=null&&(S=k(r,"bias","fused matMul"),[S]=Rt(S,l),Ae(x,S.shape));let T;o!=null&&(T=k(o,"prelu weights","fused matMul"));const _=($,A)=>{const[D,F,B,z]=A,H=nb(L($,B.shape),B,i);let M,j;if(!n&&!s?(M=ze(H,F,!1,!0),j=ze(D,H,!0,!1)):!n&&s?(M=ze(H,F,!1,!1),j=ze(H,D,!0,!1)):n&&!s?(M=ze(F,H,!1,!0),j=ze(D,H,!1,!1)):(M=ze(F,H,!0,!0),j=ze(H,D,!0,!0)),r!=null){const K=sb(z,H);return[M,j,K]}else return[M,j]},E={a:v,b,bias:S,preluActivationWeights:T},N={transposeA:n,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?Qi((A,D,F)=>{const B=R.runKernel(Up,E,N);return F([A,D,B]),{value:L(B,x),gradFunc:_}})(v,b):Qi((A,D,F,B)=>{const z=R.runKernel(Up,E,N);return B([A,D,z,F]),{value:L(z,x),gradFunc:_}})(v,b,S)}const YS=O({fusedMatMul_:lue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LU=Object.freeze(Object.defineProperty({__proto__:null,conv2d:OU,depthwiseConv2d:aue,matMul:YS},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uue(t){return tb(t,.54,.46)}const cue=O({hammingWindow_:uue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hue(t){return tb(t,.5,.5)}const MU=O({hannWindow_:hue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function due(t,e,n,s=!1,r=0){let i=0;const o=[];for(;i+e<=t.size;)o.push(Ge(t,i,e)),i+=n;if(s)for(;i<t.size;){const a=i+e-t.size,l=Bt([Ge(t,i,e-a),Wu([a],r)]);o.push(l),i+=n}return o.length===0?Na([],[0,e]):L(Bt(o),[o.length,e])}const VU=O({frame_:due});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fue(t,e,n,s,r=MU){s==null&&(s=_N(e));const i=VU(t,e,n),o=P(i,r(e));return ny(o,s)}const pue=O({stft_:fue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mue(t,e,n,s,r="bilinear",i=0){const o=k(t,"image","cropAndResize"),a=k(e,"boxes","cropAndResize","float32"),l=k(n,"boxInd","cropAndResize","int32"),u=a.shape[0];C(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),C(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),C(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),C(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),C(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),C(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const c={image:o,boxes:a,boxInd:l},h={method:r,extrapolationValue:i,cropSize:s};return R.runKernel(Ax,c,h)}const gue=O({cropAndResize_:mue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yue(t){const e=k(t,"image","flipLeftRight","float32");C(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return R.runKernel(Ux,n,{})}const wue=O({flipLeftRight_:yue});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vue(t){const e=k(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];C(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),C(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,n),r[n]=3,cr(e,r)}const xue=O({grayscaleToRGB_:vue});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bue(t){const e=k(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];C(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),C(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=re(e,"float32"),o=$n([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Il("ij,j->i",i,o);break;case 3:a=Il("ijk,k->ij",i,o);break;case 4:a=Il("ijkl,l->ijk",i,o);break;case 5:a=Il("ijklm,m->ijkl",i,o);break;case 6:a=Il("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=En(a,-1),re(a,r)}const Iue=O({rgbToGrayscale_:bue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tue(t,e,n=0,s=.5){const r=k(t,"image","rotateWithOffset","float32");C(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:n,center:s};return R.runKernel(S1,i,o)}const Sue=O({rotateWithOffset_:Tue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Od(t,e,n,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=t.shape[0];return n=Math.min(n,o),C(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),C(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),C(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),C(e.rank===1,()=>"scores must be a 1D tensor"),C(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),C(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ue(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=k(t,"boxes","nonMaxSuppression","float32"),o=k(e,"scores","nonMaxSuppression","float32"),a=Od(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:r};return R.runKernel(Jx,{boxes:i,scores:o},l)}const Cue=O({nonMaxSuppression_:_ue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eue(t,e,n){const s=kue(t,e,n),r=s<0?-(s+1):s;t.splice(r,0,e)}function kue(t,e,n){return $ue(t,e,n||Nue)}function Nue(t,e){return t>e?1:t<e?-1:0}function $ue(t,e,n){let s=0,r=t.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=n(e,t[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ob(t,e,n,s,r){return EN(t,e,n,s,r,0)}function ab(t,e,n,s,r,i){return EN(t,e,n,s,r,0,!1,i,!0)}function lb(t,e,n,s,r,i){return EN(t,e,n,s,r,i,!0)}function EN(t,e,n,s,r,i,o=!1,a=!1,l=!1){const u=[];for(let g=0;g<e.length;g++)e[g]>r&&u.push({score:e[g],boxIndex:g,suppressBeginIndex:0});u.sort(eP);const c=i>0?-.5/i:0,h=[],d=[];for(;h.length<n&&u.length>0;){const g=u.pop(),{score:y,boxIndex:w,suppressBeginIndex:x}=g;if(y<r)break;let v=!1;for(let b=h.length-1;b>=x;--b){const S=Aue(t,w,h[b]);if(S>=s){v=!0;break}if(g.score=g.score*Rue(s,c,S),g.score<=r)break}g.suppressBeginIndex=h.length,v||(g.score===y?(h.push(w),d.push(g.score)):g.score>r&&Eue(u,g,eP))}const f=h.length,p=n-f;a&&p>0&&(h.push(...new Array(p).fill(0)),d.push(...new Array(p).fill(0)));const m={selectedIndices:h};return o&&(m.selectedScores=d),l&&(m.validOutputs=f),m}function Aue(t,e,n){const s=t.subarray(e*4,e*4+4),r=t.subarray(n*4,n*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),c=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),d=Math.max(r[1],r[3]),f=(a-i)*(l-o),p=(h-u)*(d-c);if(f<=0||p<=0)return 0;const m=Math.max(i,u),g=Math.max(o,c),y=Math.min(a,h),w=Math.min(l,d),x=Math.max(y-m,0)*Math.max(w-g,0);return x/(f+p-x)}function Rue(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function eP(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Due(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=k(t,"boxes","nonMaxSuppressionAsync"),o=k(e,"scores","nonMaxSuppressionAsync"),a=Od(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],c=l[1],{selectedIndices:h}=ob(u,c,n,s,r);return i!==t&&i.dispose(),o!==e&&o.dispose(),$n(h,"int32")}const Oue=Due;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pue(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=k(t,"boxes","nonMaxSuppression"),a=k(e,"scores","nonMaxSuppression"),l=Od(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},c={maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},h=R.runKernel(e1,u,c);return{selectedIndices:h[0],selectedScores:h[1]}}const Fue=O({nonMaxSuppressionWithScore_:Pue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Lue(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=k(t,"boxes","nonMaxSuppressionAsync"),a=k(e,"scores","nonMaxSuppressionAsync"),l=Od(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),c=u[0],h=u[1],{selectedIndices:d,selectedScores:f}=lb(c,h,n,s,r,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:$n(d,"int32"),selectedScores:$n(f)}}const Mue=Lue;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vue(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=k(t,"boxes","nonMaxSuppression"),a=k(e,"scores","nonMaxSuppression"),l=Od(o,a,n,s,r,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,d={boxes:o,scores:a},f={maxOutputSize:u,iouThreshold:c,scoreThreshold:h,padToMaxOutputSize:i},p=R.runKernel(Zx,d,f);return{selectedIndices:p[0],validOutputs:p[1]}}const zue=O({nonMaxSuppressionPadded_:Vue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Bue(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=k(t,"boxes","nonMaxSuppressionAsync"),a=k(e,"scores","nonMaxSuppressionAsync"),l=Od(o,a,n,s,r,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,[d,f]=await Promise.all([o.data(),a.data()]),{selectedIndices:p,validOutputs:m}=ab(d,f,u,c,h,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:$n(p,"int32"),validOutputs:Te(m,"int32")}}const Uue=Bue;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wue(t,e,n=!1,s=!1){const r=k(t,"images","resizeBilinear");C(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),C(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),C(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=L(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},u=R.runKernel(_g,a,l);return o?L(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const zU=O({resizeBilinear_:Wue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jue(t,e,n=!1,s=!1){const r=k(t,"images","resizeNearestNeighbor");C(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),C(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),C(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),C(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=L(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},u=R.runKernel(Sg,a,l);return o?L(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const BU=O({resizeNearestNeighbor_:jue});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gue(t,e="binary",n=!1,s=.5){const r=k(t,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let u=P($n([s]),255),c,h,d,f;if(C(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),C(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),C(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),C(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[c,h,d]=Ss(r,[1,1,1],-1);const g=P(c,i),y=P(h,o),w=P(d,a);f=Y(Y(g,y),w)}else f=t;if(e==="otsu"){const g=$k(re(U1(f),"int32"),Xs([]),256);u=Hue(g,l)}const p=n?ol(f,u):gs(f,u);return re(P(p,255),"int32")}function Hue(t,e){let n=$n([-1]),s=$n([0]),r=$n([0]),i,o,a,l,u,c;for(let h=0;h<t.size-1;h++){i=Ge(t,0,h+1),o=Ge(t,h+1),u=be(ge(i),e),c=be(ge(o),e);const d=ge(P(i,wu(0,i.size)));a=be(d,ge(i));const f=Wu(o.shape,i.size),p=Y(wu(0,o.size),f),m=P(o,p);l=be(ge(m),ge(o));const g=pe(a,l),y=pe(a,l),w=P(u,c);r=P(P(w,g),y);const x=gs(r,s);s=wn(x,r,s),n=wn(x,$n([h]),n)}return n}const que=O({threshold_:Gue});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kue(t,e,n="nearest",s="constant",r=0,i){const o=k(t,"image","transform","float32"),a=k(e,"transforms","transform","float32");C(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),C(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),C(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:n,fillMode:s,fillValue:r,outputShape:i};return R.runKernel(I1,l,u)}const Xue=O({transform_:Kue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Que(t,e,n){const s=k(t,"a","bandPart");C(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(C(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),C(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=k(e<0?i:e,"numLower","bandPart")):(C(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=wn(uh(e,0),i,Ba(e,i))),typeof n=="number"?(C(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),C(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),l=k(n<0?o:n,"numUpper","bandPart")):(C(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=wn(uh(n,0),o,Ba(n,o)));const u=L(wu(0,i,1,"int32"),[-1,1]),c=wu(0,o,1,"int32"),h=pe(u,c),d=zr(ol(h,a),zo(h,pt(l))),f=Qt([i,o],s.dtype);return L(fs(xr(L(s,[-1,i,o])).map(p=>wn(d,p,f))),r)}const Yue=O({bandPart_:Que});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jue(t){let e;if(Array.isArray(t)){e=!1,C(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=t[0].shape[0];for(let i=1;i<t.length;++i)C(t[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${r})`)}else e=!0,t=Ss(t,t.shape[0],0).map(r=>ll(r,[0]));C(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let r=0;r<t.length;++r)n.push(R.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=P(ge(P(n[o],i)),n[o]);i=pe(i,a)}return be(i,Ad(i,"euclidean"))}));return e?fs(n,0):n}const Zue=O({gramSchmidt_:Jue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ece(t,e=!1){if(C(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return tP(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,u)=>l*u),s=xr(L(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[u,c]=tP(l,e);r.push(u),i.push(c)});const o=L(fs(r,0),t.shape),a=L(fs(i,0),t.shape);return[o,a]}}function tP(t,e=!1){return R.tidy(()=>{C(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let r=O1(n),i=Ui(t);const o=Na([[1]],[1,1]);let a=Ui(o);const l=n>=s?s:n;for(let u=0;u<l;++u){const c=i,h=a,d=r;[a,i,r]=R.tidy(()=>{const f=Ge(i,[u,u],[n-u,1]),p=Ad(f),m=Ge(i,[u,u],[1,1]),g=wn(gs(m,0),Na([[-1]]),Na([[1]])),y=pe(m,P(g,p)),w=be(f,y);w.shape[0]===1?a=Ui(o):a=Bt([o,Ge(w,[1,0],[w.shape[0]-1,w.shape[1]])],0);const x=pt(be(ze(g,y),p)),v=Ge(i,[u,0],[n-u,s]),b=P(x,a),S=je(a);if(u===0)i=pe(v,ze(b,ze(S,v)));else{const E=pe(v,ze(b,ze(S,v)));i=Bt([Ge(i,[0,0],[u,s]),E],0)}const T=je(b),_=Ge(r,[0,u],[n,r.shape[1]-u]);if(u===0)r=pe(_,ze(ze(_,a),T));else{const E=pe(_,ze(ze(_,a),T));r=Bt([Ge(r,[0,0],[n,u]),E],1)}return[a,i,r]}),$e([c,h,d])}return!e&&n>s&&(r=Ge(r,[0,0],[n,s]),i=Ge(i,[0,0],[s,s])),[r,i]})}const tce=O({qr_:ece});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var as;(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(as||(as={}));function nce(t,e,n=as.SUM_BY_NONZERO_WEIGHTS){const s=k(t,"losses","computeWeightedLoss");let r=null;e!=null&&(r=k(e,"weights","computeWeightedLoss"));const i=r==null?s:P(s,r);if(n===as.NONE)return i;if(n===as.SUM)return ge(i);if(n===as.MEAN){if(r==null)return $t(i);{const o=s.size/r.size,a=be(ge(i),ge(r));return o>1?be(a,Te(o)):a}}if(n===as.SUM_BY_NONZERO_WEIGHTS){if(r==null)return be(ge(i),Te(s.size));{const o=P(r,Is(s.shape)),a=re(ge(yu(o,Te(0))),"float32");return be(ge(i),a)}}throw Error(`Unknown reduction: ${n}`)}const Uo=O({computeWeightedLoss_:nce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sce(t,e,n,s=as.SUM_BY_NONZERO_WEIGHTS){const r=k(t,"labels","absoluteDifference"),i=k(e,"predictions","absoluteDifference");let o=null;n!=null&&(o=k(n,"weights","absoluteDifference")),Mn(r.shape,i.shape,"Error in absoluteDifference: ");const a=Kt(pe(r,i));return Uo(a,o,s)}const rce=O({absoluteDifference_:sce});function ice(t,e,n,s,r=as.SUM_BY_NONZERO_WEIGHTS){const i=k(t,"labels","cosineDistance"),o=k(e,"predictions","cosineDistance");let a=null;s!=null&&(a=k(s,"weights","cosineDistance")),Mn(i.shape,o.shape,"Error in cosineDistance: ");const l=Te(1),u=pe(l,ge(P(i,o),n,!0));return Uo(u,a,r)}const oce=O({cosineDistance_:ice});function ace(t,e,n,s=as.SUM_BY_NONZERO_WEIGHTS){let r=k(t,"labels","hingeLoss");const i=k(e,"predictions","hingeLoss");let o=null;n!=null&&(o=k(n,"weights","hingeLoss")),Mn(r.shape,i.shape,"Error in hingeLoss: ");const a=Te(1);r=pe(P(Te(2),r),a);const l=xi(pe(a,P(r,i)));return Uo(l,o,s)}const lce=O({hingeLoss_:ace});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uce(t,e,n,s=1,r=as.SUM_BY_NONZERO_WEIGHTS){const i=k(t,"labels","huberLoss"),o=k(e,"predictions","huberLoss");let a=null;n!=null&&(a=k(n,"weights","huberLoss")),Mn(i.shape,o.shape,"Error in huberLoss: ");const l=Te(s),u=Kt(pe(o,i)),c=Ba(u,l),h=pe(u,c),d=Y(P(Te(.5),ot(c)),P(l,h));return Uo(d,a,r)}const cce=O({huberLoss_:uce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hce(t,e,n,s=1e-7,r=as.SUM_BY_NONZERO_WEIGHTS){const i=k(t,"labels","logLoss"),o=k(e,"predictions","logLoss");let a=null;n!=null&&(a=k(n,"weights","logLoss")),Mn(i.shape,o.shape,"Error in logLoss: ");const l=Te(1),u=Te(s),c=pt(P(i,Ys(Y(o,u)))),h=P(pe(l,i),Ys(Y(pe(l,o),u))),d=pe(c,h);return Uo(d,a,r)}const dce=O({logLoss_:hce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fce(t,e,n,s=as.SUM_BY_NONZERO_WEIGHTS){const r=k(t,"labels","meanSquaredError"),i=k(e,"predictions","meanSquaredError");let o=null;n!=null&&(o=k(n,"weights","meanSquaredError")),Mn(r.shape,i.shape,"Error in meanSquaredError: ");const a=Q1(r,i);return Uo(a,o,s)}const pce=O({meanSquaredError_:fce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mce(t,e){const n=k(t,"labels","sigmoidCrossEntropyWithLogits"),s=k(e,"logits","sigmoidCrossEntropyWithLogits");Mn(n.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=xi(s),i=P(s,n),o=Gg(ks(pt(Kt(s))));return Y(pe(r,i),o)}function gce(t,e,n,s=0,r=as.SUM_BY_NONZERO_WEIGHTS){let i=k(t,"multiClassLabels","sigmoidCrossEntropy");const o=k(e,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=k(n,"weights","sigmoidCrossEntropy")),Mn(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),s>0){const u=Te(s),c=Te(1),h=Te(.5);i=Y(P(i,pe(c,u)),P(h,u))}const l=mce(i,o);return Uo(l,a,r)}const yce=O({sigmoidCrossEntropy_:gce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(t,e,n=-1){if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return Qi((r,i,o)=>{const l=Hg(i,[n],!0),u=pe(re(i,"float32"),l);o([r,u]);const c=pt(P(u,r));return{value:ge(c,[n]),gradFunc:(f,p)=>{const[m,g]=p,y=jt(f.shape,[n]);return[P(L(f,y),pe(re(m,"float32"),ks(g))),P(L(f,y),pe(ks(g),re(m,"float32")))]}}})(t,e)}function vce(t,e,n,s=0,r=as.SUM_BY_NONZERO_WEIGHTS){let i=k(t,"onehotLabels","softmaxCrossEntropy");const o=k(e,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=k(n,"weights","softmaxCrossEntropy")),Mn(i.shape,o.shape,"Error in softmaxCrossEntropy: "),s>0){const u=Te(s),c=Te(1),h=Te(i.shape[1]);i=Y(P(i,pe(c,u)),be(u,h))}const l=wce(i,o);return Uo(l,a,r)}const xce=O({softmaxCrossEntropy_:vce});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bce(t,e,n,s){const r=k(t,"indices","sparseFillEmptyRows","int32"),i=k(e,"values","sparseFillEmptyRows"),o=k(n,"denseShape","sparseFillEmptyRows","int32"),a=k(s,"defaultValue","sparseFillEmptyRows",i.dtype);if(r.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:r,values:i,denseShape:o,defaultValue:a},u=R.runKernel(h1,l);return{outputIndices:u[0],outputValues:u[1],emptyRowIndicator:u[2],reverseIndexMap:u[3]}}const Ice=O({sparseFillEmptyRows_:bce});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tce(t,e,n){const s=k(t,"inputIndices","sparseReshape","int32"),r=k(e,"inputShape","sparseReshape","int32"),i=k(n,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(r.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);const o={inputIndices:s,inputShape:r,newShape:i},a=R.runKernel(d1,o);return{outputIndices:a[0],outputShape:a[1]}}const Sce=O({sparseReshape_:Tce});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ce(t,e,n){const s=k(t,"data","sparseSegmentMean"),r=k(e,"indices","sparseSegmentMean","int32"),i=k(n,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return R.runKernel(f1,o)}const Cce=O({sparseSegmentMean_:_ce});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ece(t,e,n){const s=k(t,"data","sparseSegmentSum"),r=k(e,"indices","sparseSegmentSum","int32"),i=k(n,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return R.runKernel(p1,o)}const kce=O({sparseSegmentSum_:Ece});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nce(t,e,n,s,r,i,o,a){const l=k(t,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const u=k(e,"dataSplits","stringNGrams");if(u.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:s,leftPad:r,rightPad:i,padWidth:o,preserveShortSequences:a},h={data:l,dataSplits:u},d=R.runKernel(w1,h,c);return{nGrams:d[0],nGramsSplits:d[1]}}const $ce=O({stringNGrams_:Nce});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ace(t,e,n=!0){const s=k(t,"input","stringSplit","string"),r=k(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(r.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const i={skipEmpty:n},o={input:s,delimiter:r},a=R.runKernel(v1,o,i);return{indices:a[0],values:a[1],shape:a[2]}}const Rce=O({stringSplit_:Ace});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dce(t,e){const n=k(t,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const r={input:n};return R.runKernel(x1,r,s)}const Oce=O({stringToHashBucketFast_:Dce});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pce(t,e,n,s=!0){const r=k(t,"input","staticRegexReplace","string"),i={pattern:e,rewrite:n,replaceGlobal:s};return R.runKernel(Dg,{x:r},i)}const Fce=O({staticRegexReplace_:Pce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UU={fft:ty,ifft:fh,rfft:ny,irfft:X1},WU={hammingWindow:cue,hannWindow:MU,frame:VU,stft:pue},Or={flipLeftRight:wue,grayscaleToRGB:xue,resizeNearestNeighbor:BU,resizeBilinear:zU,rgbToGrayscale:Iue,rotateWithOffset:Sue,cropAndResize:gue,nonMaxSuppression:Cue,nonMaxSuppressionAsync:Oue,nonMaxSuppressionWithScore:Fue,nonMaxSuppressionWithScoreAsync:Mue,nonMaxSuppressionPadded:zue,nonMaxSuppressionPaddedAsync:Uue,threshold:que,transform:Xue},kN={bandPart:Yue,gramSchmidt:Zue,qr:tce},jU={absoluteDifference:rce,computeWeightedLoss:Uo,cosineDistance:oce,hingeLoss:lce,huberLoss:cce,logLoss:dce,meanSquaredError:pce,sigmoidCrossEntropy:yce,softmaxCrossEntropy:xce},GU={sparseFillEmptyRows:Ice,sparseReshape:Sce,sparseSegmentMean:Cce,sparseSegmentSum:kce},HU={stringNGrams:$ce,stringSplit:Rce,stringToHashBucketFast:Oce,staticRegexReplace:Fce};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lce=new Map,JS=new Map;class qu{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class or{constructor(){this.classNameMap={}}static getMap(){return or.instance==null&&(or.instance=new or),or.instance}static register(e){or.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function ee(t,e,n){C(t.className!=null,()=>"Class being registered does not have the static className property defined."),C(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),C(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,r=e+">"+s;return or.register(t),Lce.set(r,t),JS.set(t,r),t}function Mce(t){return JS.has(t)?JS.get(t):t.className}const Vce=Object.freeze(Object.defineProperty({__proto__:null,Serializable:qu,SerializationMap:or,getRegisteredName:Mce,registerClass:ee},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wo extends qu{minimize(e,n=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return $e(i),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return Y4(e,n)}dispose(){this.iterations_!=null&&$e(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Te(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Wo,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NN extends Wo{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=R.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=R.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:W(()=>He(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:W(()=>He(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;W(()=>{const c=Y(P(l,this.rho),P(ot(a),1-this.rho)),h=P(be(Pn(Y(u,this.epsilon)),Pn(Y(l,this.epsilon))),a),d=Y(P(u,this.rho),P(ot(h),1-this.rho));l.assign(c),u.assign(d);const f=Y(P(h,-this.learningRate),i);i.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&($e(this.accumulatedGrads.map(e=>e.variable)),$e(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $N extends Wo{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=R.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:W(()=>Wu(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;W(()=>{const l=Y(a,ot(o));a.assign(l);const u=Y(P(be(o,Pn(Y(l,R.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&$e(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AN extends Wo{static get className(){return"Adam"}constructor(e,n,s,r=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],W(()=>{this.accBeta1=Te(n).variable(),this.accBeta2=Te(s).variable()}),r==null&&(this.epsilon=R.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);W(()=>{const s=pe(1,this.accBeta1),r=pe(1,this.accBeta2);n.forEach((i,o)=>{const a=R.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:W(()=>He(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:W(()=>He(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,d=Y(P(c,this.beta1),P(u,1-this.beta1)),f=Y(P(h,this.beta2),P(ot(u),1-this.beta2)),p=be(d,s),m=be(f,r);c.assign(d),h.assign(f);const g=Y(P(be(p,Y(Pn(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(P(this.accBeta1,this.beta1)),this.accBeta2.assign(P(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&$e(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&$e(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),W(()=>{this.accBeta1.assign(Ro(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ro(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RN extends Wo{static get className(){return"Adamax"}constructor(e,n,s,r=null,i=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],W(()=>{this.iteration=Te(0).variable(),this.accBeta1=Te(n).variable()}),r==null&&(this.epsilon=R.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);W(()=>{const s=pe(1,this.accBeta1),r=be(-this.learningRate,Y(P(this.iteration,this.decay),1));n.forEach((i,o)=>{const a=R.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:He(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:He(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,d=Y(P(c,this.beta1),P(u,1-this.beta1)),f=P(h,this.beta2),p=Kt(u),m=Ji(f,p);c.assign(d),h.assign(m);const g=Y(P(be(r,s),be(d,Y(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign(Y(this.iteration,1)),this.accBeta1.assign(P(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&$e(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&$e(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ub extends Wo{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=R.registeredVariables[s];W(()=>{const a=Y(P(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=on(Te(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DN extends ub{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=Te(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=R.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:W(()=>He(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&W(()=>{let l;const u=Y(P(this.m,o),a);this.useNesterov?l=Y(P(this.c,Y(a,P(u,this.m))),i):l=Y(P(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&$e(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ON extends Wo{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=R.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=R.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:W(()=>He(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:W(()=>He(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:W(()=>He(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;W(()=>{const c=Y(P(l,this.decay),P(ot(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,d=Y(P(h,this.decay),P(a,1-this.decay)),f=be(P(a,this.learningRate),Pn(pe(c,Y(ot(d),this.epsilon)))),p=Y(P(u,this.momentum),f);l.assign(c),h.assign(d),u.assign(p);const m=pe(i,p);i.assign(m)}else{const h=Y(P(l,this.decay),P(ot(a),1-this.decay)),d=Y(P(u,this.momentum),be(P(a,this.learningRate),Pn(Y(h,this.epsilon))));l.assign(h),u.assign(d);const f=pe(i,d);i.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&$e(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&$e(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&$e(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zce=[NN,$N,AN,RN,DN,ON,ub];function Bce(){for(const t of zce)ee(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uce="model",Wce=".json",jce=".weights.bin";function nP(t){return new Promise(e=>setTimeout(e)).then(t)}class vu{constructor(e){if(!U().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(vu.URL_SCHEME)&&(e=e.slice(vu.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Uce),this.modelJsonFileName=e+Wce,this.weightDataFileName=e+jce}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=vi.join(e.weightData),s=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=A4(e,r),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await nP(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=s,await nP(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Mg(e)}}}}vu.URL_SCHEME="downloads://";class Gce{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,n)=>{const s=new FileReader;s.onload=r=>{const i=JSON.parse(r.target.result),o=i.modelTopology;if(o==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(i.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:o});return}const l=mk(i,u=>this.loadWeights(u));e(l)},s.onerror=r=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const n=[],s=[];for(const o of e)n.push(...o.weights),s.push(...o.paths);const r=this.checkManifestAndWeightFiles(e),i=s.map(o=>this.loadWeightsFile(o,r[o]));return Promise.all(i).then(o=>[n,o])}loadWeightsFile(e,n){return new Promise((s,r)=>{const i=new FileReader;i.onload=o=>{const a=o.target.result;s(a)},i.onerror=o=>r(`Failed to weights data from file of path '${e}'.`),i.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(e){const n=[],s=this.weightsFiles.map(i=>ZO(i.name)),r={};for(const i of e)i.paths.forEach(o=>{const a=ZO(o);if(n.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),s.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);r[o]=this.weightsFiles[s.indexOf(a)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const Hce=t=>U().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(vu.URL_SCHEME)?qce(t.slice(vu.URL_SCHEME.length)):null;kt.registerSaveRouter(Hce);function qce(t="model"){return new vu(t)}function Kce(t){return new Gce(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sP(t,e,n,s){o(t),n=n??0,s=s??1,a(n,s);let r=0;const i=l=>(l.then(u=>{const c=n+ ++r/t.length*(s-n);return e(c),u}),l);function o(l){C(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){C(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),C(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),C(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(t.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function qU(t,e){e==null&&(e={});const n=e.fetchFunc==null?U().platform.fetch:e.fetchFunc,s=t.map(h=>n(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await sP(s,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await sP(a,e.onProgress,.5,1)}function Xce(t,e){var n;const s=e.fetchFunc==null?U().platform.fetch:e.fetchFunc;let r=0,i;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<t.length;){i||(i=(await s(t[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/t.length);continue}o.enqueue(u);return}o.close()}})}async function KU(t,e="",n,s){return XU(o=>qU(o,{requestInit:s}))(t,e,n)}function XU(t){return async(e,n="",s)=>{const r=e.map(()=>!1),i={},o=s!=null?s.map(()=>!1):[],a=[];if(e.forEach((f,p)=>{let m=0;f.weights.forEach(g=>{const y="quantization"in g?g.quantization.dtype:g.dtype,w=cu[y]*G(g.shape),x=()=>{r[p]=!0,i[p]==null&&(i[p]=[]),i[p].push({manifestEntry:g,groupOffset:m,sizeBytes:w})};s!=null?s.forEach((v,b)=>{v===g.name&&(x(),o[b]=!0)}):x(),a.push(g.name),m+=w})}),!o.every(f=>f)){const f=s.filter((p,m)=>!o[m]);throw new Error(`Could not find weights in manifest with names: ${f.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const l=r.reduce((f,p,m)=>(p&&f.push(m),f),[]),u=[];l.forEach(f=>{e[f].paths.forEach(p=>{const m=n+(n.endsWith("/")?"":"/")+p;u.push(m)})});const c=await t(u),h={};let d=0;return l.forEach(f=>{const p=e[f].paths.length,m=new vi(c.slice(d,d+p));i[f].forEach(y=>{const w=m.slice(y.groupOffset,y.groupOffset+y.sizeBytes),x=dk(w,[y.manifestEntry]);for(const v in x)h[v]=x[v]}),d+=p}),h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qce="application/octet-stream",Yce="application/json";class PN{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(C(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=U().platform.fetch,C(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&C(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=A4(e,s);if(n.body.append("model.json",new Blob([JSON.stringify(r)],{type:Yce}),"model.json"),e.weightData!=null){const o=vi.join(e.weightData);n.body.append("model.weights.bin",new Blob([o],{type:Qce}),"model.weights.bin")}const i=await this.fetch(this.path,n);if(i.ok)return{modelArtifactsInfo:Mg(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=n.modelTopology,r=n.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return mk(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),s=jw(e.weightsManifest),r=()=>Xce(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=Jce(n),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const n=await this.getWeightUrls(e),s=jw(e),r=await qU(n,this.loadOptions);return[s,r]}}PN.URL_SCHEME_REGEX=/^https?:\/\//;function Jce(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),r=n>e?t.substring(n):"";return[s+"/",r]}function ZS(t){return t.match(PN.URL_SCHEME_REGEX)!=null}const QU=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>ZS(s)):n=ZS(t),n)return FN(t,e)}return null};kt.registerSaveRouter(QU);kt.registerLoadRouter(QU);function FN(t,e){return new PN(t,e)}function YU(t,e){return FN(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HI{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class JU{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class Zce{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=n=>Promise.resolve(e.save(n)))}}function ehe(t,e,n,s){const r=arguments;return new Zce(Hw(...r))}function Hw(t,e,n,s){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new HI(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new HI({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new HI({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:s}))}function the(t){return new JU(t)}function nhe(t){return new JU(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LN=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:vi,browserFiles:Kce,browserHTTPRequest:YU,concatenateArrayBuffers:$4,copyModel:Lre,decodeWeights:dk,decodeWeightsStream:N4,encodeWeights:GS,fromMemory:ehe,fromMemorySync:Hw,getLoadHandlers:D4,getModelArtifactsForJSON:mk,getModelArtifactsForJSONSync:pk,getModelArtifactsInfoForJSON:Mg,getSaveHandlers:R4,getWeightSpecs:jw,http:FN,isHTTPScheme:ZS,listModels:Pre,loadWeights:KU,moveModel:Mre,registerLoadRouter:Tre,registerSaveRouter:Ire,removeModel:Fre,weightsLoaderFactory:XU,withSaveHandler:the,withSaveHandlerSync:nhe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function she(t,e,n){const s=k(t,"labels","confusionMatrix"),r=k(e,"predictions","confusionMatrix");C(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),C(s.rank===1,()=>`Expected the rank of labels to be 1, but got ${s.rank}`),C(r.rank===1,()=>`Expected the rank of predictions to be 1, but got ${r.rank}`),C(s.shape[0]===r.shape[0],()=>`Mismatch in the number of examples: ${s.shape[0]} vs. ${r.shape[0]}. Labels and predictions should have the same number of elements.`),C(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);const i=ch(re(s,"int32"),n),o=ch(re(r,"int32"),n),a=je(i),l=ze(a,o);return re(l,"int32")}const rhe=O({confusionMatrix_:she});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ihe=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:rhe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let fl,rP=!1;function ZU(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,r=!1,i=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)i=!0;else if(t.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(Hp(zw,R.backendName)!=null){const p={pixels:t},m={numChannels:e};return R.runKernel(zw,p,m)}const[u,c]=r?[t.videoWidth,t.videoHeight]:[t.width,t.height];let h;if(o)h=t.getContext("2d").getImageData(0,0,u,c).data;else if(s||n)h=t.data;else if(i||r||a){if(fl==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")fl=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else fl=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});fl.canvas.width=u,fl.canvas.height=c,fl.drawImage(t,0,0,u,c),h=fl.getImageData(0,0,u,c).data}let d;if(e===4)d=new Int32Array(h);else{const p=u*c;d=new Int32Array(p*e);for(let m=0;m<p;m++)for(let g=0;g<e;++g)d[m*e+g]=h[m*4+g]}return wN(d,[c,u,e],"int32")}function ohe(t){return t!=null&&t.data instanceof Uint8Array}function ahe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function lhe(t){return t!=null&&t.width!==0&&t.height!==0}function uhe(t){return ahe()&&!(t instanceof ImageBitmap)&&lhe(t)&&!ohe(t)}async function che(t,e=3){let n=null;if(U().getBool("WRAP_TO_IMAGEBITMAP")&&uhe(t)){let s;try{s=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch{s=null}s!=null&&s.width===t.width&&s.height===t.height?n=s:n=t}else n=t;return ZU(n,e)}function eW(t){if(t.rank!==2&&t.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${t.rank}.`);const e=t.rank===2?1:t.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${t.dtype}. Please use float32 or int32 tensors.`)}function hhe(t){const e=(t==null?void 0:t.alpha)||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}async function dhe(t,e){let n=k(t,"img","toPixels");if(!(t instanceof Qe)){const u=n;n=re(u,"int32"),u.dispose()}eW(n);const[s,r]=n.shape.slice(0,2),i=n.rank===2?1:n.shape[2],o=await n.data(),a=n.dtype==="float32"?255:1,l=new Uint8ClampedArray(r*s*4);for(let u=0;u<s*r;++u){const c=[0,0,0,255];for(let d=0;d<i;d++){const f=o[u*i+d];if(n.dtype==="float32"){if(f<0||f>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${f}.`)}else if(n.dtype==="int32"&&(f<0||f>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${f}.`);i===1?(c[0]=f*a,c[1]=f*a,c[2]=f*a):c[d]=f*a}const h=u*4;l[h+0]=Math.round(c[0]),l[h+1]=Math.round(c[1]),l[h+2]=Math.round(c[2]),l[h+3]=Math.round(c[3])}if(e!=null){rP||Hp(Lx,R.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),rP=!0),e.width=r,e.height=s;const u=e.getContext("2d"),c=new ImageData(l,r,s);u.putImageData(c,0,0)}return n!==t&&n.dispose(),l}function fhe(t,e,n){let s=k(t,"img","draw");if(!(t instanceof Qe)){const o=s;s=re(o,"int32"),o.dispose()}eW(s),hhe(n==null?void 0:n.imageOptions);const r={image:s},i={canvas:e,options:n};R.runKernel(Lx,r,i)}const tW=O({fromPixels_:ZU}),phe=Object.freeze(Object.defineProperty({__proto__:null,draw:fhe,fromPixels:tW,fromPixelsAsync:che,toPixels:dhe},Symbol.toStringTag,{value:"Module"}));function cb(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(G(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let h=0;h<r.length-1;++h)o*=r[h];const a=t.shape,l=r.slice();l.pop();let u=1;for(let h=i;h<n;++h)u*=a[h],l.push(a[h]);const c=[...Ie(t.shape).map(h=>h/u),1].slice(0,i);return[l,o,u,c]}const mhe=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:cb},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e_=-2,ghe=-1;function MN(t,e,n){const s=t.shape.length;C(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),C(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)C(e[r]+n[r]<=t.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function yhe(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function VN(t,e,n){const s=[];for(let r=0;r<t.length;r++)s[r]=Math.ceil((e[r]-t[r])/n[r]);return s}function nW(t,e,n,s){const r=[...t];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<n;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function sW(t,e,n){return n<=t?n:n-(e-1)}function rW(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function whe(t,e,n,s,r,i,o,a,l){const u=t.length;let c=new Array(u),h=new Array(u),d=new Array(u);if(e.length&&n>0){const f=e[0],p=n+1;c=iW(o,f,p,s,t),h=oW(a,f,p,r,t),d=nW(i,f,p,t)}else for(let f=0;f<u;f++)c[f]=lW(o,s,i,t,f,l),h[f]=uW(a,r,i,t,f,l),d[f]=aW(i,f,l);return{begin:c,end:h,strides:d}}function iW(t,e,n,s,r){const i=[...r],o=rW(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=sW(e,n,a);let u=s[l];t&1<<l&&(u=0),i[a]=u}return i}function oW(t,e,n,s,r){const i=[...r],o=rW(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=sW(e,n,a);let u=s[l];t&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=La(0,i[a],r[a])}return i}function aW(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function lW(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=La(0,o,l-1),o}function uW(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=La(0,o,l):o=La(-1,o,l-1),o}function zN(t,e,n){let s=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){s=r;break}for(let r=s+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function BN(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function hb(t,e,n){let s;const r=t.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{C(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return n==null?i=new Array(r).fill(-1):typeof n=="number"?i=[n,...new Array(r-1).fill(-1)]:n.length<r?i=n.concat(new Array(r-n.length).fill(-1)):i=n,i=i.map((o,a)=>o>=0?o:(C(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,i]}function UN(t,e,n,s,r,i,o,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const h={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:u.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let x=0;x<h.dims;x++)c&&1<<x&a&&h.numAddAxisAfterEllipsis++,1<<x&o&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};vhe(h,d);let f=!0,p=!0,m=!0;const g=[],y=[];for(let x=0;x<t.length;++x){if(d.strides[x]===0)throw Error(`strides[${x}] must be non-zero`);const v=!!(d.shrinkAxisMask&1<<x),b=t[x];if(b===-1){g.push(v?1:-1);continue}const S=[d.beginMask&1<<x,d.endMask&1<<x],T=[d.strides[x]>0?0:-1,d.strides[x]>0?b:b-1];if(v&&d.strides[x]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&d.strides[x]===1;const _=!!(d.beginMask&1<<x&&d.endMask&1<<x);if(d.beginValid&&d.endValid){if(v){const A=d.begin[x]<0?b+d.begin[x]:d.begin[x];if(d.begin[x]=A,d.end[x]=d.begin[x]+1,A<0||A>=b)throw Error(`slice index ${d.begin[x]} of dimension ${x} out of bounds.`)}else d.begin[x]=iP(d.begin[x],0,d.strides[x],b,S,T),d.end[x]=iP(d.end[x],1,d.strides[x],b,S,T);const $=d.strides[x]===1&&d.begin[x]===0&&d.end[x]===b;f=f&&$,p=p&&(x===0&&d.strides[x]===1||$)}else f=f&&d.strides[x]===1&&_,p=p&&(x===0&&d.strides[x]===1||_);let E,N=!1;if(d.beginValid&&d.endValid?(E=d.end[x]-d.begin[x],N=!0):v?(E=1,N=!0):_&&b>=0&&(d.strides[x]<0?E=-b:E=b,N=!0),N){let $;E===0||E<0!=d.strides[x]<0?$=0:$=Math.trunc(E/d.strides[x])+(E%d.strides[x]!==0?1:0),g.push($)}else g.push(-1)}for(let x=0;x<d.finalShapeGatherIndices.length;++x){const v=d.finalShapeGatherIndices[x];v>=0?y.push(g[v]):v===e_&&y.push(1)}return{finalShapeSparse:y.filter((x,v)=>d.finalShapeGatherIndices[v]!==e_),finalShape:y,isIdentity:f,sliceDim0:p,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function vhe(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<r;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(e_),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(ghe),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function iP(t,e,n,s,r,i){if(r[e])return n>0?i[e]:i[e+1&1];{const o=t<0?s+t:t;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const cW=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:MN,computeFlatOffset:BN,computeOutShape:VN,getNormalizedAxes:whe,isSliceContinous:zN,maskToAxes:yhe,parseSliceParams:hb,sliceInfo:UN,startForAxis:lW,startIndicesWithElidedDims:iW,stopForAxis:uW,stopIndicesWithElidedDims:oW,stridesForAxis:aW,stridesWithElidedDims:nW},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const hW="4.17.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dW{static sgd(e){return new ub(e)}static momentum(e,n,s=!1){return new DN(e,n,s)}static rmsprop(e,n=.9,s=0,r=null,i=!1){return new ON(e,n,s,r,i)}static adam(e=.001,n=.9,s=.999,r=null){return new AN(e,n,s,r)}static adadelta(e=.001,n=.95,s=null){return new NN(e,n,s)}static adamax(e=.002,n=.9,s=.999,r=null,i=0){return new RN(e,n,s,r,i)}static adagrad(e,n=.1){return new $N(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vl=dW;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xhe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function WN(){return new Promise(t=>xhe(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jN(t,e){const n=t[0].length;t.forEach((r,i)=>{C(r.length===n,()=>`Error in concat${n}D: rank of tensors[${i}] must be the same as the rank of the rest (${n})`)}),C(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((r,i)=>{for(let o=0;o<n;o++)C(o===e||r[o]===s[o],()=>`Error in concat${n}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function Wi(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ei;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(ei||(ei={}));function fW(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let r=1;r<n.length;++r){const i=n[r],o=s[s.length-n.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${i} but shape[${r+t}] = ${a}`)}else s[o]=i}return s}function pW(t){const e={FIRST_DIM_SIZE:ei.FIRST_DIM_SIZE,VALUE_ROWIDS:ei.VALUE_ROWIDS,ROW_LENGTHS:ei.ROW_LENGTHS,ROW_SPLITS:ei.ROW_SPLITS,ROW_LIMITS:ei.ROW_LIMITS,ROW_STARTS:ei.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function mW(t){return t.length===0?0:t[0]===ei.FIRST_DIM_SIZE?t.length-1:t.length}function gW(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(n,s-1);++r){const i=t[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${i} but ragged tensor input.flatValues.shape[${r-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GN=30;function db(t){return t<=GN?t:Lw(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HN(t,e,n){const s=n*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sy(t,e,n,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([t[o+1]/e[o],e[o]]);r=r.concat(t.slice(i+1))}return r}function ry(t,e,n=!0){const s=[];if(n){s.push(e);for(let r=e+1;r<t;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function iy(t,e,n,s=!0){const r=[];s?r.push(t[0]/n):r.push(t[0]*n);for(let i=1;i<t.length;++i)i<=e.length?s?r.push(e[i-1]*t[i]):r.push(t[i]/e[i-1]):r.push(t[i]);return r}function qN(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function KN(t,e,n){const s=t.slice(0,1);for(let r=0;r<n;++r)s.push(t[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fb=1.7580993408473768,pb=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XN=.3275911,QN=.254829592,YN=-.284496736,JN=1.421413741,ZN=-1.453152027,e$=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Do(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function yW(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function wW(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function vW(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function t$(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function xW(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function bW(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const i=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:n,imag:s}}function IW(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qI="->",bhe=/->/g,oP=",",aP="...";function n$(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(bhe,"").length)/qI.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${qI}").`);const[s,r]=t.split(qI);C(s.indexOf(aP)===-1,()=>`The ellipsis notation ("${aP}") is not supported yet.`);const i=s.split(oP),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let d=0;d<r.length;++d){const f=r[d];if(!i.some(p=>p.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let d=0;d<s.length;++d){const f=s[d];a.indexOf(f)===-1&&f!==oP&&a.push(f)}const l=new Array(i.length);for(let d=0;d<o;++d){if(new Set(i[d].split("")).size!==i[d].length)throw new Error(`Found duplicate axes in input component ${i[d]}. Support for duplicate axes in input is not implemented yet.`);l[d]=[];for(let f=0;f<i[d].length;++f)l[d].push(a.indexOf(i[d][f]))}const u=a.length,c=r.length,h=[];for(let d=c;d<u;++d)h.push(d);return{allDims:a,summedDims:h,idDims:l}}function s$(t,e){let n=new Array(t);n.fill(-1);for(let r=0;r<e.length;++r)n[e[r]]=r;const s=[];for(let r=0;r<t;++r)n[r]===-1&&s.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:s}}function r$(t,e,n){const s=new Array(t);for(let r=0;r<n.length;++r){const i=n[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:C(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function i$(t,e){const n=t,s=[];let r=0;t.length===0&&n.push(-1),r=t.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<n.length;++o){const a=n[o],l=Ihe(e,a);for(const u of l)i.indexOf(u)===-1&&(s[o].push(u),i.push(u))}return{path:n,steps:s}}function o$(t){return t.every((e,n)=>e===n)}function Ihe(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function a$(t,e,n=0){let s=[];if(typeof e=="number")C(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);C(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=t.shape[n]-o}C(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TW(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function SW(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function _W(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CW(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function EW(t,e){return`size ${t} must be non-negative, not ${e}`}function kW(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function NW(t,e){const n=G(t),s=G(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function $W(t,e){const n=G(t),s=G(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t_(){return"segment ids must be >= 0"}function AW(){return"segment ids are not increasing"}function RW(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function DW(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OW(t,e){let n=!1,s;for(t<=GN?(s=t,n=!0):s=Lw(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=Lw(t,s+1);return s}function PW(t,e,n){const s=[],r=t.length;for(let i=0;i<r;i++)i!==e?s.push(t[i]):s.push(n);return s}function l$(t,e,n,s){const r=e.shape.length,i=t.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let h=0;h<s;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=t.shape[n],a=[];let l=1,u=1,c=1;for(let h=0;h<s;++h)a.push(t.shape[h]),l*=t.shape[h];for(let h=s;h<n;h++)a.push(t.shape[h]),u*=t.shape[h];for(let h=s;h<r;h++)a.push(e.shape[h]);for(let h=n+1;h<i;h++)a.push(t.shape[h]),c*=t.shape[h];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:o,outputShape:a}}const The=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:l$,computeOutShape:PW,segOpComputeOptimalWindowSize:OW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oo(t){try{return t.map(e=>ko(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function FW(t){return t.map(e=>Bi(e))}const LW=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:QN,ERF_A2:YN,ERF_A3:JN,ERF_A4:ZN,ERF_A5:e$,ERF_P:XN,PARALLELIZE_THRESHOLD:GN,get RowPartitionType(){return ei},SELU_SCALE:pb,SELU_SCALEALPHA:fb,applyActivation:rb,assertAndGetBroadcastShape:Ae,assertAxesAreInnerMostDims:zn,assertParamsConsistent:jN,assignToTypedArray:xW,axesAreInnerMostDims:jk,calculateShapes:ul,checkEinsumDimSizes:r$,checkPadOnDimRoundingMode:ms,combineLocations:K4,combineRaggedTensorToTensorShapes:fW,complexWithEvenIndex:wW,complexWithOddIndex:vW,computeConv2DInfo:bn,computeConv3DInfo:rl,computeDefaultPad:_k,computeDilation2DInfo:Vg,computeOptimalWindowSize:db,computeOutAndReduceShapes:In,computeOutShape:Wi,computePool2DInfo:Ur,computePool3DInfo:Mo,convertConv2DDataFormat:Vo,decodeEinsumEquation:n$,eitherStridesOrDilationsAreOne:Vn,expandShapeToKeepDim:jt,exponent:IW,exponents:bW,fromStringArrayToUint8:FW,fromUint8ToStringArray:Oo,getAxesPermutation:Dt,getBroadcastDims:gu,getComplexWithIndex:t$,getEinsumComputePath:i$,getEinsumPermutation:s$,getFusedBiasGradient:sb,getFusedDyActivation:nb,getImageCenter:HN,getInnerMostAxes:Gt,getPermuted:ry,getRaggedRank:mW,getReductionAxes:Zt,getReshaped:sy,getReshapedPermuted:iy,getRowPartitionTypesHelper:pW,getSliceBeginCoords:qN,getSliceSize:KN,getSparseFillEmptyRowsIndicesDenseShapeMismatch:TW,getSparseFillEmptyRowsNegativeIndexErrorMessage:SW,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:_W,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:kW,getSparseReshapeInputOutputMismatchErrorMessage:$W,getSparseReshapeInputOutputMultipleErrorMessage:NW,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:CW,getSparseReshapeNegativeOutputDimErrorMessage:EW,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:DW,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:t_,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:AW,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:RW,getUndoAxesPermutation:il,isIdentityPermutation:o$,log:Tse,mergeRealAndImagArrays:Do,prepareAndValidate:cb,prepareSplitSize:a$,segment_util:The,shouldFuse:ib,slice_util:cW,splitRealAndImagArrays:yW,stridesOrDilationsArePositive:pu,tupleValuesAreOne:za,upcastType:_s,validateDefaultValueShape:gW,validateInput:Y1,validateUpdateShape:vN,warn:ir},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const She=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:ob,nonMaxSuppressionV4Impl:ab,nonMaxSuppressionV5Impl:lb,whereImpl:eb},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Bce();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MW={kernelName:Om,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(t,Hu(re(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _he={kernelName:Dh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=ot(re(n,"float32")),r=Pn(pe(Te(1),s));return pt(be(t,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Che={kernelName:Oh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Pn(pe(ot(re(n,"float32")),1));return be(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ehe={kernelName:Bu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ae(n.shape,s.shape);return{a:()=>{let a=t;const l=Zt(n.shape,r);return l.length>0&&(a=ge(a,l)),L(a,n.shape)},b:()=>{let a=t;const l=Zt(s.shape,r);return l.length>0&&(a=ge(a,l)),L(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const khe={kernelName:Pm,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,r)=>{n[r]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nhe={kernelName:Fm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>He(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $he={kernelName:Lm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>He(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ahe={kernelName:Ph,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>be(t,Pn(pe(Te(1),ot(re(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rhe={kernelName:Fh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Pn(Y(Te(1),ot(re(n,"float32"))));return be(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dhe={kernelName:Vh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ae(n.shape,s.shape);return{a:()=>{const a=Y(ot(n),ot(s));let l=P(t,be(s,a));const u=Zt(n.shape,r);return u.length>0&&(l=ge(l,u)),L(l,n.shape)},b:()=>{const a=Y(ot(n),ot(s));let l=pt(P(t,be(n,a)));const u=Zt(s.shape,r);return u.length>0&&(l=ge(l,u)),L(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ohe={kernelName:Lh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>be(t,Y(ot(re(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Phe={kernelName:Mh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>be(t,pe(Te(1),ot(re(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fhe(t,e,n,s,r,i){const o=k(t,"dy","avgPool3dGrad"),a=k(e,"input","avgPool3dGrad");let l=o,u=a,c=!1;a.rank===4&&(c=!0,l=L(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=L(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),C(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),C(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),ms("avgPool3dGrad",r,i);const h={dy:l,input:u},d={filterSize:n,strides:s,pad:r,dimRoundingMode:i},f=R.runKernel(Tx,h,d);return c?L(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Lhe=O({avgPool3dGrad_:Fhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mhe={kernelName:Vm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=n;return{x:()=>Lhe(t,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vhe(t,e,n,s,r){const i=k(t,"dy","avgPoolGrad"),o=k(e,"input","avgPoolGrad");C(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=L(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=L(i,[1,i.shape[0],i.shape[1],i.shape[2]])),C(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),C(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const c={dy:l,input:a},h={filterSize:n,strides:s,pad:r},d=R.runKernel(Ix,c,h);return u?L(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const zhe=O({avgPoolGrad_:Vhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bhe={kernelName:Mm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=n;return{x:()=>zhe(t,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uhe={kernelName:zm,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,r]=e,{transposeA:i,transposeB:o}=n;return!i&&!o?{a:()=>ze(t,r,!1,!0),b:()=>ze(s,t,!0,!1)}:!i&&o?{a:()=>ze(t,r,!1,!1),b:()=>ze(t,s,!0,!1)}:i&&!o?{a:()=>ze(r,t,!1,!0),b:()=>ze(s,t,!1,!1)}:{a:()=>ze(r,t,!0,!0),b:()=>ze(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Whe={kernelName:Bm,gradFunc:(t,e,n)=>{const{blockShape:s,crops:r}=n;return{x:()=>Qg(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jhe={kernelName:o4,gradFunc:(t,e,n)=>{const s=n,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>ge(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ghe={kernelName:zh,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hhe={kernelName:Bh,gradFunc:t=>({x:()=>He(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qhe={kernelName:Uh,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=n;return{x:()=>wn(zr(zo(s,r),ol(s,i)),t,He(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Khe={kernelName:Wm,inputsToSave:["x"],gradFunc:MW.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xhe={kernelName:jm,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:r}=n,i=Be(r,e[0].shape)[0],o=s.map(l=>l[i]);return Ss(t,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qhe={kernelName:Gm,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=n;return C(za(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>Fk(s.shape,t,r,o,a,l),filter:()=>CN(s,t,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yhe={kernelName:Hm,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>Ao(t,r,i,o,a,1,l),filter:()=>CN(t,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jhe(t,e,n,s,r){let i=t;t.rank===4&&(i=L(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;o.rank===4&&(o=L(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),C(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),C(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),C(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),C(i.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${n[3]}.`),C(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:n};return R.runKernel(kx,a,l)}const Zhe=O({conv3DBackpropFilter_:Jhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ede={kernelName:qm,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:i}=n;C(za(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>G4(o.shape,t,a,r,i),filter:()=>Zhe(o,t,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tde={kernelName:Wh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(pt(H1(re(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nde={kernelName:jh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(q1(re(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sde={kernelName:Km,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=n;return{x:()=>{const a=Dt([r],s.rank);let l=D1(t,r,i,!o);return a!=null&&(l=je(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rde={kernelName:Xm,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=n,a=s??[1,1];C(za(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return C(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),C(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),C(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),C(Vn(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),ms("depthwiseConv2d",i,o),{x:()=>FU(l.shape,t,u,r,i,a,o),filter:()=>PU(l,t,u.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ide={kernelName:Qm,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,i={x:s,filter:r,dy:t},o={x:s,filter:r,dy:t};return{x:()=>R.runKernel(Mw,i,n),filter:()=>R.runKernel(Vw,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ode={kernelName:Hh,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>R.runKernel(Vx,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ade={kernelName:qh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=P(ks(pt(ot(n))),2/Math.sqrt(Math.PI));return{x:()=>P(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lde={kernelName:Kh,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ude={kernelName:Jm,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>L(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cde={kernelName:Xh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(t,ks(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hde={kernelName:Qh,gradFunc:t=>({x:()=>He(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dde={kernelName:Yh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ae(n.shape,s.shape);return{a:()=>{const a=be(t,re(s,"float32")),l=Zt(n.shape,r);return l.length>0?L(ge(a,l),n.shape):a},b:()=>{let a=P(t,re(n,"float32"));const l=Zt(s.shape,r);l.length>0&&(a=L(ge(a,l),s.shape));const u=ot(s);return pt(be(a,re(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fde={kernelName:Zm,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[r,i,o,a]=e,l=a??Te(1),u=Zt(i.shape,r.shape),c=[];if(i.rank===1){for(let v=0;v<r.shape.length-1;++v)c.push(r.shape[v]);c.push(1)}const h=pe(r,i),d=P(t,l),f=W1(Y(o,Te(s))),p=P(P(P(f,f),f),Te(-.5));return{x:()=>i.rank===1?L(P(P(t,cr(L(f,[1,1,1,i.shape[0]]),c)),l),r.shape):L(P(P(t,f),l),r.shape),mean:()=>{let v=P(P(f,Te(-1)),d);return i.rank===1&&(v=ge(v,u)),L(v,i.shape)},variance:()=>{let v=P(P(p,h),d);return i.rank===1&&(v=ge(v,u)),L(v,i.shape)},scale:()=>{const v=P(h,f);let b=P(t,v);return i.rank===1&&(b=ge(b,u)),L(b,i.shape)},offset:()=>{let v=t;return i.rank===1&&(v=ge(v,u)),L(v,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pde={kernelName:eg,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,r]=e,{axis:i,batchDims:o}=n,a=Be(i,s.shape)[0],l=(u,c,h)=>()=>{const d=u.shape,f=c.size,p=d.slice(0,a),m=p.length,g=d.slice(i,d.length).slice(1),y=g.length,w=lP(0,m),x=lP(m+1,m+1+y),v=uP([p,[f],g]),b=L(h,v),S=L(c,[f]),T=uP([[m],w,x]),_=je(b,T);let E=Z1(_,S,u.shape[a]);const N=il(T);return E=je(E,N),E};if(o===1){const u=s.shape[0],c=s.split(u,0);return{x:()=>fs(c.map((f,p)=>l(f,r.slice(p,1),t.slice(p,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,t),indices:()=>r}}};function lP(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function uP(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mde={kernelName:Jh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>He(n),b:()=>He(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gde={kernelName:Zh,gradFunc:t=>({x:()=>re(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yde={kernelName:ed,gradFunc:t=>({x:()=>He(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wde={kernelName:td,gradFunc:t=>({x:()=>He(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vde={kernelName:nd,gradFunc:t=>({x:()=>He(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xde={kernelName:ng,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:r}=n,i=gs(s,0);return{x:()=>wn(i,t,P(t,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bde={kernelName:rd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>be(t,Y(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ide={kernelName:sd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>be(t,re(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tde={kernelName:a4,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;return{logits:()=>{const o=ks(s);return pe(t,P(ge(t,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sde(t,e,n,s=5,r=1,i=1,o=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:r,alpha:i,beta:o};return R.runKernel(qx,a,l)}const _de=O({localResponseNormalizationBackprop_:Sde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cde={kernelName:lg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=n;return{x:()=>_de(s,r,t,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VW(t,e,n,s){return e.rank<n.rank&&(e=L(e,jt(e.shape,s))),t.rank<n.rank&&(t=L(t,jt(t.shape,s))),{x:()=>P(t,re(Qs(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cP={kernelName:ug,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:r}=s,i=e[0],o=e[1],a=Be(r,i.shape),l=VW(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ede={kernelName:id,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>P(t,re(zo(n,s),"float32")),b:()=>P(t,re(uh(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kde(t,e,n,s,r,i,o){const a=k(t,"dy","maxPool3dGrad"),l=k(e,"input","maxPool3dGrad"),u=k(n,"output","maxPool3dGrad");let c=a,h=l,d=u,f=!1;l.rank===4&&(f=!0,c=L(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=L(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=L(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),C(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),C(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),C(d.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`),ms("maxPool3dGrad",i,o);const p={dy:c,input:h,output:d},m={filterSize:s,strides:r,pad:i,dimRoundingMode:o},g=R.runKernel(Xx,p,m);return f?L(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const Nde=O({maxPool3dGrad_:kde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $de={kernelName:hg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=n;return{x:()=>Nde(t,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ade(t,e,n,s,r,i,o){const a=k(t,"dy","maxPoolGrad"),l=k(e,"input","maxPoolGrad"),u=k(n,"output","maxPoolGrad");C(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),C(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),C(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),ms("maxPoolGrad",i,o);const c={dy:a,input:l,output:u},h={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return R.runKernel(Kx,c,h)}const Rde=O({maxPoolGrad_:Ade});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dde={kernelName:cg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=n;return{x:()=>Rde(t,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ode={kernelName:dg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n,i=Be(r,s.shape),a=In(s.shape,i)[1],l=G(a);return{x:()=>{const c=s.shape.slice();i.forEach(f=>{c[f]=1});const h=L(t,c);return be(P(h,Is(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pde={kernelName:fg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:r}=s,[i,o]=e,a=Be(r,i.shape),l=VW(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fde={kernelName:od,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>P(t,re(ol(n,s),"float32")),b:()=>P(t,re(gs(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lde={kernelName:pg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,i=r.map(o=>o[0]);return{x:()=>Ge(t,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mde={kernelName:ad,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ae(n.shape,s.shape);return{a:()=>{const a=Zt(n.shape,r);return a.length>0?L(ge(t,a),n.shape):t},b:()=>{const a=P(t,pt(Rd(be(n,s)))),l=Zt(s.shape,r);return l.length>0?L(ge(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vde={kernelName:ld,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ae(n.shape,s.shape);return{a:()=>{const a=P(t,re(s,"float32")),l=Zt(n.shape,r);return l.length>0?L(ge(a,l),n.shape):a},b:()=>{const a=P(t,re(n,"float32")),l=Zt(s.shape,r);return l.length>0?L(ge(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zde={kernelName:mg,gradFunc:t=>({x:()=>pt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bde={kernelName:wg,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>Qt(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ude={kernelName:yg,gradFunc:t=>({x:()=>He(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wde={kernelName:vg,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return xr(t,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hP={kernelName:xg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,i=r.map(o=>o[0]);return{x:()=>Ge(t,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jde={kernelName:ud,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,r]=e,i=n,o=s,a=Ae(i.shape,o.shape);return{a:()=>{const c=re(o,"float32");let h=P(t,P(c,Ro(i,pe(c,Te(1)))));const d=Zt(i.shape,a);return d.length>0&&(h=ge(h,d)),L(h,i.shape)},b:()=>{const c=gs(i,0),h=wn(c,Ys(i),He(i));let d=P(t,P(r,h));const f=Zt(o.shape,a);return f.length>0&&(d=ge(d,f)),L(d,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gde={kernelName:bg,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,r=gs(n,0);return{x:()=>wn(r,t,P(t,s)),alpha:()=>{let i=wn(r,He(t),P(t,n));const o=Zt(s.shape,t.shape);return o.length>0&&(i=ge(i,o)),L(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hde(t,e,n){const s=t.shape.slice();s[n]=1;const r=L(e,s),i=Jp(t,n,!0,!1),o=Jp(t,n,!0,!0),a=P(i,o);return P(r,a)}function qde(t,e,n){const s=t.shape.length,r=s-n.length,i=Dt(n,s);let o=t;i!=null&&(o=je(t,i));const a=o.shape.slice(),u=a.splice(s-n.length,n.length).reduce((d,f)=>d*f,1);a.push(u);const c=o.reshape(a);let h=Hde(c,e,r);if(h=h.reshape(o.shape),i!=null){const d=il(i);h=je(h,d)}return h}const Kde={kernelName:Ig,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>qde(s,t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xde={kernelName:Gh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ae(n.shape,s.shape);return{a:()=>{const a=be(t,re(s,"float32")),l=Zt(n.shape,r);return l.length>0?L(ge(a,l),n.shape):a},b:()=>{let a=P(t,re(n,"float32"));const l=Zt(s.shape,r);l.length>0&&(a=L(ge(a,l),s.shape));const u=ot(s);return pt(be(a,re(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qde={kernelName:cd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>be(t,pt(ot(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yde={kernelName:dd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=P(ol(n,6),Hu(n));return{x:()=>P(t,re(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jde={kernelName:hd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(t,re(Hu(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zde={kernelName:Tg,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>L(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const efe={kernelName:_g,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>R.runKernel(a1,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tfe={kernelName:Sg,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>R.runKernel(o1,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nfe={kernelName:Cg,gradFunc:(t,e,n)=>{const{dims:s}=n,r=Be(s,t.shape);return{x:()=>vr(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sfe={kernelName:fd,gradFunc:t=>({x:()=>He(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rfe={kernelName:pd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>pt(be(t,P(Ro(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ife={kernelName:Eg,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>re(He(n),"float32"),t:()=>P(t,re(n,t.dtype)),e:()=>P(t,re(qg(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ofe={kernelName:md,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=gs(n,Te(0)),r=Te(fb),i=Te(pb),o=P(t,i),a=P(P(t,r),ks(re(n,"float32")));return wn(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const afe={kernelName:vd,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(t,P(n,pe(Te(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lfe={kernelName:wd,gradFunc:t=>({x:()=>He(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ufe={kernelName:gd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(Ug(re(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cfe={kernelName:yd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(R1(re(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hfe={kernelName:kg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:r,size:i}=n,o=s.shape,[a,l]=hb(s,r,i),u=[];for(let c=0;c<t.rank;c++)u.push([a[c],o[c]-a[c]-l[c]]);return{x:()=>Bo(t,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dfe={kernelName:Rg,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:r}=n,i=!0,o=P(t,s);return{logits:()=>pe(o,P(ge(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ffe={kernelName:xd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(t,oi(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dP={kernelName:$g,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:r}=n;return{x:()=>Bg(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fP={kernelName:Ag,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>Bt(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pfe={kernelName:bd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>be(t,P(Pn(re(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mfe={kernelName:g1,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(t,P(re(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gfe={kernelName:Id,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Te(2);return{a:()=>P(t,P(r,pe(n,s))),b:()=>P(t,P(r,pe(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yfe={kernelName:Ed,gradFunc:t=>({x:()=>He(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wfe={kernelName:Td,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ae(n.shape,s.shape);return{a:()=>{let a=t;const l=Zt(n.shape,r);return l.length>0&&(a=ge(a,l)),L(a,n.shape)},b:()=>{let a=t;const l=Zt(s.shape,r);return l.length>0&&(a=ge(a,l)),L(pt(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vfe={kernelName:Ng,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,r=s.shape.slice(),{axis:i}=n;Be(i,s.shape).forEach(u=>{r[u]=1});const a=L(t,r),l=P(a,Is(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xfe={kernelName:Sd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>be(t,ot(Ug(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bfe={kernelName:_d,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>P(pe(Te(1),ot(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ife={kernelName:Cd,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:r}=n;return{x:()=>{let o=He(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=Y(o,Ge(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=Y(o,Ge(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)o=Y(o,Ge(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let c=0;c<r[3];++c)o=Y(o,Ge(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2],c*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tfe={kernelName:Gl,gradFunc:(t,e,n)=>{const s=n,{perm:r}=s,i=il(r);return{x:()=>je(t,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sfe={kernelName:Og,gradFunc:(t,e,n)=>{const s=n,{axis:r}=s;return{value:()=>fs(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _fe={kernelName:Pg,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Cfe(t,n)}}};function Cfe(t,e){const n=Ji(e,He(e)),s=Dd(t,n);let r=zo(e,Te(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=En(r,a+1);r=zr(r,Is(s.shape,"bool"));const o=He(s);return wn(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Efe={kernelName:Fg,gradFunc:t=>({x:()=>He(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kfe=[MW,_he,Che,Ehe,khe,Nhe,$he,Ahe,Rhe,Dhe,Ohe,Phe,Mhe,Bhe,Uhe,Whe,jhe,Ghe,Hhe,qhe,Khe,Xhe,Yhe,Qhe,ede,tde,nde,sde,rde,ide,Xde,ode,ade,lde,ude,cde,dde,hde,fde,pde,mde,gde,yde,wde,vde,xde,bde,Ide,Tde,Cde,cP,cP,Ede,$de,Dde,Ode,Pde,Fde,Lde,Mde,Vde,zde,Bde,Ude,Wde,hP,hP,jde,Gde,Kde,Qde,Yde,Jde,Zde,efe,tfe,nfe,sfe,rfe,ife,ofe,afe,lfe,ufe,cfe,hfe,dfe,ffe,dP,dP,fP,fP,pfe,gfe,mfe,yfe,wfe,vfe,xfe,bfe,Ife,Tfe,Sfe,_fe,Efe];for(const t of kfe)l4(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.abs=function(){return this.throwIfDisposed(),Kt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.acos=function(){return this.throwIfDisposed(),yk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.acosh=function(){return this.throwIfDisposed(),wk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.add=function(t){return this.throwIfDisposed(),Y(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.all=function(t,e){return this.throwIfDisposed(),N1(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.any=function(t,e){return this.throwIfDisposed(),Xp(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.argMax=function(t){return this.throwIfDisposed(),fu(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.argMin=function(t){return this.throwIfDisposed(),vk(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.asScalar=function(){return this.throwIfDisposed(),C(this.size===1,()=>"The array must have only 1 element."),L(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.asType=function(t){return this.throwIfDisposed(),re(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.as1D=function(){return this.throwIfDisposed(),L(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.as2D=function(t,e){return this.throwIfDisposed(),L(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),L(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),L(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.as5D=function(t,e,n,s,r){return this.throwIfDisposed(),L(this,[t,e,n,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.asin=function(){return this.throwIfDisposed(),xk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.asinh=function(){return this.throwIfDisposed(),bk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.atan=function(){return this.throwIfDisposed(),Ik(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.atan2=function(t){return this.throwIfDisposed(),Tk(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.atanh=function(){return this.throwIfDisposed(),Sk(this)};q().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),zg(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Bg(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.batchNorm=function(t,e,n,s,r){return this.throwIfDisposed(),kd(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Hl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.cast=function(t){return this.throwIfDisposed(),re(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.ceil=function(){return this.throwIfDisposed(),Ak(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Es(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Qe&&(t=[t]),Bt([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.conv1d=function(t,e,n,s,r,i){return this.throwIfDisposed(),$1(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.conv2dTranspose=function(t,e,n,s,r){return this.throwIfDisposed(),A1(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.conv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),Ao(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.cos=function(){return this.throwIfDisposed(),Ug(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.cosh=function(){return this.throwIfDisposed(),R1(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),Jp(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),D1(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),Vk(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.depthwiseConv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),Nd(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.dilation2d=function(t,e,n,s,r){return this.throwIfDisposed(),zk(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.divNoNan=function(t){return this.throwIfDisposed(),Bk(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.div=function(t){return this.throwIfDisposed(),be(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.dot=function(t){return this.throwIfDisposed(),Uk(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.elu=function(){return this.throwIfDisposed(),$d(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.equal=function(t){return this.throwIfDisposed(),Qs(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.erf=function(){return this.throwIfDisposed(),Wk(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),Gk(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.exp=function(){return this.throwIfDisposed(),ks(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.expandDims=function(t){return this.throwIfDisposed(),En(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.expm1=function(){return this.throwIfDisposed(),Hk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.fft=function(){return this.throwIfDisposed(),ty(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.flatten=function(){return this.throwIfDisposed(),L(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.floor=function(){return this.throwIfDisposed(),Rd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.floorDiv=function(t){return this.throwIfDisposed(),k1(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.gather=function(t,e,n){return this.throwIfDisposed(),Dd(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.greaterEqual=function(t){return this.throwIfDisposed(),zo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.greater=function(t){return this.throwIfDisposed(),gs(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.ifft=function(){return this.throwIfDisposed(),fh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.irfft=function(){return this.throwIfDisposed(),X1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.isFinite=function(){return this.throwIfDisposed(),qk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.isInf=function(){return this.throwIfDisposed(),Kk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.isNaN=function(){return this.throwIfDisposed(),Xk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.leakyRelu=function(t){return this.throwIfDisposed(),jg(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.lessEqual=function(t){return this.throwIfDisposed(),ol(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.less=function(t){return this.throwIfDisposed(),uh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),Qk(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.logSigmoid=function(){return this.throwIfDisposed(),Yk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.logSoftmax=function(t){return this.throwIfDisposed(),F1(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),Hg(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.log=function(){return this.throwIfDisposed(),Ys(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.log1p=function(){return this.throwIfDisposed(),Gg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.logicalAnd=function(t){return this.throwIfDisposed(),zr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.logicalNot=function(){return this.throwIfDisposed(),qg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.logicalOr=function(t){return this.throwIfDisposed(),L1(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.logicalXor=function(t){return this.throwIfDisposed(),Jk(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),ze(this,t,e,n)};q().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),Kg(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.max=function(t,e){return this.throwIfDisposed(),gr(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.maximum=function(t){return this.throwIfDisposed(),Ji(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.mean=function(t,e){return this.throwIfDisposed(),$t(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.min=function(t,e){return this.throwIfDisposed(),lh(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.minimum=function(t){return this.throwIfDisposed(),Ba(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),eN(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.mod=function(t){return this.throwIfDisposed(),tN(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.mul=function(t){return this.throwIfDisposed(),P(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.neg=function(){return this.throwIfDisposed(),pt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.norm=function(t,e,n){return this.throwIfDisposed(),Ad(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.notEqual=function(t){return this.throwIfDisposed(),yu(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),ch(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.onesLike=function(){return this.throwIfDisposed(),Js(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.pad=function(t,e){return this.throwIfDisposed(),Bo(this,t,e)};q().prototype.pool=function(t,e,n,s,r,i){return this.throwIfDisposed(),nN(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.pow=function(t){return this.throwIfDisposed(),Ro(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.prelu=function(t){return this.throwIfDisposed(),Yg(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.prod=function(t,e){return this.throwIfDisposed(),sN(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.reciprocal=function(){return this.throwIfDisposed(),pN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.relu=function(){return this.throwIfDisposed(),xi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.relu6=function(){return this.throwIfDisposed(),B1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.reshapeAs=function(t){return this.throwIfDisposed(),L(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.reshape=function(t){return this.throwIfDisposed(),L(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),zU(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),BU(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.reverse=function(t){return this.throwIfDisposed(),vr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.rfft=function(){return this.throwIfDisposed(),ny(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.round=function(){return this.throwIfDisposed(),U1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.rsqrt=function(){return this.throwIfDisposed(),W1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.selu=function(){return this.throwIfDisposed(),j1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.separableConv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),G1(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.sigmoid=function(){return this.throwIfDisposed(),oi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.sign=function(){return this.throwIfDisposed(),mN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.sin=function(){return this.throwIfDisposed(),H1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.sinh=function(){return this.throwIfDisposed(),q1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.slice=function(t,e){return this.throwIfDisposed(),Ge(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.softmax=function(t){return this.throwIfDisposed(),ey(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.softplus=function(){return this.throwIfDisposed(),ju(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Qg(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.split=function(t,e){return this.throwIfDisposed(),Ss(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.sqrt=function(){return this.throwIfDisposed(),Pn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.square=function(){return this.throwIfDisposed(),ot(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.squaredDifference=function(t){return this.throwIfDisposed(),Q1(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.squeeze=function(t){return this.throwIfDisposed(),ll(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof Qe?[this,t]:[this,...t];return fs(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.step=function(t){return this.throwIfDisposed(),Hu(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.stridedSlice=function(t,e,n,s,r,i,o,a){return this.throwIfDisposed(),gN(this,t,e,n,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.sub=function(t){return this.throwIfDisposed(),pe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.sum=function(t,e){return this.throwIfDisposed(),ge(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.tan=function(){return this.throwIfDisposed(),yN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.tanh=function(){return this.throwIfDisposed(),mu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.tile=function(t){return this.throwIfDisposed(),cr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.toBool=function(){return this.throwIfDisposed(),re(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.toFloat=function(){return this.throwIfDisposed(),re(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.toInt=function(){return this.throwIfDisposed(),re(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.topk=function(t,e){return this.throwIfDisposed(),xN(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.transpose=function(t){return this.throwIfDisposed(),je(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.unique=function(t){return this.throwIfDisposed(),bN(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),Z1(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.unstack=function(t){return this.throwIfDisposed(),xr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.where=function(t,e){return this.throwIfDisposed(),wn(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q().prototype.zerosLike=function(){return this.throwIfDisposed(),He(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _i extends Error{constructor(e){super(e),Object.setPrototypeOf(this,_i.prototype)}}class Pr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Pr.prototype)}}class V extends Error{constructor(e){super(e),Object.setPrototypeOf(this,V.prototype)}}class Oe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Oe.prototype)}}class u$ extends Error{constructor(e){super(e),Object.setPrototypeOf(this,u$.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zW{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xu(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function Ci(t,e){if(!t)throw new u$(e)}function pP(t,e){let n=0;for(const s of t)s===e&&n++;return n}function xs(t){return t.length===1?t[0]:t}function st(t){return Array.isArray(t)?t:[t]}function oo(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Tl(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let Sr={};function c$(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function n_(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>n_(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:n_(s))}}}function oy(t,e={},n={},s="object",r=!1){if(typeof t=="string"){const i=t;let o;if(i in n)o=n[i];else if(i in Sr)o=Sr[i];else if(o=e[i],o==null)throw new V(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=t;if(i.className==null||i.config==null)throw new V(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in n?[a,l]=n[o]:o in Sr?[a,l]=Sr.className:o in e&&([a,l]=e[o]),a==null)throw new V(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const f of Object.keys(Sr))u[f]=Sr[f];for(const f of Object.keys(n))u[f]=n[f];const c=i.config;c.customObjects=u;const h=Object.assign({},Sr);for(const f of Object.keys(n))Sr[f]=n[f];n_(i.config);const d=l(a,i.config,n,r);return Sr=Object.assign({},h),d}else{const u=Object.assign({},Sr);for(const h of Object.keys(n))Sr[h]=n[h];const c=new a(i.config);return Sr=Object.assign({},u),c}}}function Nfe(t,e){return t<e?-1:t>e?1:0}function e0(t,e){return-1*Nfe(t,e)}function $a(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function $fe(t){if(t==null)throw new V(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function Ku(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new V(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function h$(t,e,n=0,s=1/0){return Ci(n>=0),Ci(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(r=>typeof r===e)}function gn(t,e){Array.isArray(t)?(C(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>gn(n,`element ${s+1} of ${e}`))):C(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${BW(t)}.`)}function BW(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>BW(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function Afe(t,e,n){let s=n!=null?n():Cn(),r;return(...o)=>{const a=n!=null?n():Cn();return a-s<e||(s=a,r=t(...o)),r}}function UW(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Rfe=0;function WW(){return Rfe++}const t0={};function mb(t=""){return t in t0||(t0[t]=0),t0[t]+=1,t+t0[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Dfe=["channelsFirst","channelsLast"],Ofe=["nearest","bilinear"],Pfe=["valid","same","causal"],Ffe=["max","avg"],Lfe=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const oc=new Map;function Ht(t){Ku(Dfe,"DataFormat",t)}function Mfe(t){Ku(Ofe,"InterpolationFormat",t)}function Tr(t){Ku(Pfe,"PaddingMode",t)}function jW(t){Ku(Ffe,"PoolMode",t)}const Zf=[],mP="/";function ql(t,e){Zf.push(t);try{const n=e();return Zf.pop(),n}catch(n){throw Zf.pop(),n}}function Vfe(){return Zf.length===0?"":Zf.join(mP)+mP}function GW(t){if(!qW(t))throw new Error("Not a valid tensor name: '"+t+"'");return Vfe()+t}function HW(t){if(!qW(t))throw new Error("Not a valid tensor name: '"+t+"'");oc.has(t)||oc.set(t,0);const e=oc.get(t);if(oc.set(t,oc.get(t)+1),e>0){const n=`${t}_${e}`;return oc.set(n,1),n}else return t}const zfe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function qW(t){return!!t.match(zfe)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bfe(t){return t===parseInt(t.toString(),10)}function Aa(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let r=e;r<n;++r)s*=t[r];return s}function ph(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function Ua(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function pi(t,e){if(e<t)throw new V(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let KI;function an(){return KI==null&&(KI=hk().epsilon()),KI}function mi(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ji(t,e){return re(t,e)}function ay(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),L(t,n)}function Ufe(t,e){return W(()=>{if(t.shape.length!==2)throw new V(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=ay(t,1);return s_(n,[1,e,1])})}function Wfe(t){const e=[Aa(t.shape)];return L(t,e)}function jfe(t){if(t.rank<=1)throw new V(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],Aa(t.shape,1)];return L(t,e)}function Kl(t,e,n){return W(()=>{switch(t.rank){case 1:return Jg(t,e,n);case 2:return K1(t,[e,0],[n,t.shape[1]]);case 3:return Zg(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return dh(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return Ge(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return Ge(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new V(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function XI(t,e,n){return W(()=>{switch(t.rank){case 1:return Jg(t,e,n);case 2:return K1(t,[0,e],[t.shape[0],n]);case 3:return Zg(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return dh(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new V(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function n0(t,e,n,s){return W(()=>{switch(t.rank){case 1:return Jg(t,e,n);case 2:switch(s){case 1:return Kl(t,e,n);case 2:return XI(t,e,n);default:throw new V(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Kl(t,e,n);case 2:return Zg(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return XI(t,e,n);default:throw new V(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Kl(t,e,n);case 2:return dh(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return dh(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return XI(t,e,n);default:throw new V(`The axis is not within the rank of the tensor ${s}`)}default:throw new V(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function d$(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),Bt(t,e)}function gP(t,e){switch(t.rank){case 1:return Rk([t,e]);case 2:return Dk([t,e],0);case 3:return Ok([t,e],0);case 4:return Pk([t,e],0);default:throw new V(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function s_(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new V(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return cr(t,e)}function gb(t,e=0,n=1,s,r){return z1(t,e,n,s,r)}function Gi(t,e,n,s){if(t.rank<2||e.rank<2)throw new Oe(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=t.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new Oe(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return YS({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?r_(t.rank,s,mi()):null,activation:n});{const r=t.shape.slice(),i=r.pop();t=L(t,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],c=Array.from({length:e.rank},(p,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=L(je(e,c),[l,-1]);const h=[...r,...u];return L(YS({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?r_(t.rank,s,mi()):null,activation:n}),h)}}function KW(t,e,n){return W(()=>(Array.isArray(e)?e=$n(e,"int32"):e=re(e,"int32"),Dd(t,e,n)))}function ly(t){return P(t,t)}function r_(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new V(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?L(e,[1,s[0],1,1,1]):L(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?L(e,[1,1,1,1,s[0]]):L(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?L(e,[1,s[0],1,1]):L(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?L(e,[1,1,1,s[0]]):L(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?L(e,[1,s[0],1]):L(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?L(e,[1,1,s[0]]):L(e,[1].concat(s))}else if(t<3)return e;throw new V(`Unsupported input rank by biasAdd: ${e.rank}`)}function bi(t,e,n){return W(()=>(n==null&&(n=mi()),Ht(n),Y(t,r_(t.rank,e,n))))}function Gfe(t,e=1){if(e!==1)throw new Oe(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return $d(t)}function Hfe(t){return W(()=>be(t,Y(Kt(t),1)))}function XW(t,e,n,s){return W(()=>SN(t,e,n,s))}function qfe(t){return W(()=>{const e=Y(.5,P(.2,t));return Es(e,0,1)})}function uy(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Kfe=["fanIn","fanOut","fanAvg"],Xfe=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qfe(t){Ku(Kfe,"FanMode",t)}function Yfe(t){Ku(Xfe,"Distribution",t)}class Wr extends qu{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class f$ extends Wr{apply(e,n){return Qt(e,n)}}f$.className="Zeros";ee(f$);class yb extends Wr{apply(e,n){return Is(e,n)}}yb.className="Ones";ee(yb);class p$ extends Wr{constructor(e){if(super(),typeof e!="object")throw new V(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new V(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return W(()=>P(Te(this.value),Is(e,n)))}getConfig(){return{value:this.value}}}p$.className="Constant";ee(p$);class m$ extends Wr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return al(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}m$.className="RandomUniform";ee(m$);class g$ extends Wr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Oe(`randomNormal does not support dType ${n}.`);return gb(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}g$.className="RandomNormal";ee(g$);class y$ extends Wr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Oe(`truncatedNormal does not support dType ${n}.`);return J1(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}y$.className="TruncatedNormal";ee(y$);class w$ extends Wr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return W(()=>{if(e.length!==2||e[0]!==e[1])throw new V("Identity matrix initializer can only be used for 2D square matrices.");return P(this.gain,O1(e[0]))})}getConfig(){return{gain:this.gain}}}w$.className="Identity";ee(w$);function Jfe(t,e="channelsLast"){let n,s;if(Ht(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const r=Aa(t,2);n=t[1]*r,s=t[0]*r}else if(e==="channelsLast"){const r=Aa(t,0,t.length-2);n=t[t.length-2]*r,s=t[t.length-1]*r}}else{const r=Aa(t);n=Math.sqrt(r),s=Math.sqrt(r)}return[n,s]}class Ns extends Wr{constructor(e){if(super(),e.scale<0)throw new V(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Qfe(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Yfe(this.distribution),this.seed=e.seed}apply(e,n){const s=Jfe(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Oe(`${this.getClassName()} does not support dType ${n}.`);return J1(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return al(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ns.className="VarianceScaling";ee(Ns);class wb extends Ns{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ns.className}}wb.className="GlorotUniform";ee(wb);class vb extends Ns{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ns.className}}vb.className="GlorotNormal";ee(vb);class xb extends Ns{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ns.className}}xb.className="HeNormal";ee(xb);class bb extends Ns{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ns.className}}bb.className="HeUniform";ee(bb);class Ib extends Ns{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ns.className}}Ib.className="LeCunNormal";ee(Ib);class Tb extends Ns{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ns.className}}Tb.className="LeCunUniform";ee(Tb);class v$ extends Wr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return W(()=>{if(e.length<2)throw new Oe("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=G(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=gb(o,0,1,n,this.seed),l=kN.qr(a,!1);let u=l[0];const h=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=P(u,h.sign()),s<r&&(u=u.transpose()),P(Te(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}v$.className="Orthogonal";ee(v$);const yP={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function wP(t,e={}){return oy(t,or.getMap().classNameMap,e,"initializer")}function At(t){return c$(t)}function _t(t){if(typeof t=="string"){const e=t in yP?yP[t]:t;if(e==="GlorotNormal")return new vb;if(e==="GlorotUniform")return new wb;if(e==="HeNormal")return new xb;if(e==="HeUniform")return new bb;if(e==="LeCunNormal")return new Ib;if(e==="LeCunUniform")return new Tb;{const n={};return n.className=e,n.config={},wP(n)}}else return t instanceof Wr?t:wP(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function i_(t){return Array.isArray(t)&&Array.isArray(t[0])}function qw(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Ee(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new V(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function Ze(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new V(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Kw(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const vP="Variable";class QW{constructor(e,n="float32",s=vP,r=!0,i=null){this.dtype=n??"float32",this.shape=e.shape,this.id=WW(),s=s??vP,this.originalName=GW(s),this.name=HW(this.originalName),this.trainable_=r,this.constraint=i,this.val=IN(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Zfe(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Zfe(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function o_(t){return t.map(e=>e.read())}function x$(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Yt{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class gi{constructor(e,n,s,r,i,o,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=WW(),o!=null&&(this.originalName=GW(o),this.name=HW(this.originalName)),this.rank=n.length}}let epe=0;class Sb{constructor(e,n){this.callArgs=n,this.id=epe++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let tpe=0;class Ue extends qu{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=tpe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=oo(s)+"_"+mb(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new Pr(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new V(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return xs(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return xs(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new _i(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new _i(`Layer ${this.name} is not connected, no input to return.`);return xs(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new _i(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new _i(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return xs(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=st(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=st(this.inputSpec);if(n.length!==s.length)throw new V(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let r=0;r<n.length;r++){const i=n[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new V(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new V(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new V(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new V(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const c=Number(u),h=o.axes[u],d=c>=0?l[c]:l[l.length+c];if(h!=null&&[h,null].indexOf(d)===-1)throw new V(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${h} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],c=i.shape[l];if(u!=null&&c!=null&&u!==c)throw new V(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=st(e),r=rpe(e),i=ipe(e);if(r===i)throw new V("Arguments to apply() must be all SymbolicTensors or all Tensors");return ql(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of st(e))o.push(a.shape);this.build(xs(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,o);const a=st(o),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=xs(l),this.activityRegularizer!=null)throw new Oe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=npe(e),a=this.computeOutputShape(o);let l;const u=spe(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((c,h)=>new gi(u,c,this,st(e),n,this.name,h)):l=new gi(u,a,this,st(e),n,this.name),this.addInboundNode(e,l,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new Oe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new _i(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new _i(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Pr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Kw(this.weights)}build(e){this.built=!0}getWeights(e=!1){return o_(e?this.trainableWeights:this.weights)}setWeights(e){W(()=>{const n=this.weights;if(n.length!==e.length)throw new V(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],r=o_(n);for(let i=0;i<r.length;++i){const o=r[i],a=n[i],l=e[i];if(!We(o.shape,l.shape))throw new V(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}x$(s)})}addWeight(e,n,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new V(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():_t("zeros"));const u=r.apply(n,s),c=new QW(u,s,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),o==null&&(o=!0),o?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=st(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=st(n),o=st(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,n,s,r,i,o,a=null){const l=st(e);n=st(n),s=st(s),r=st(r),i=qw(i),o=qw(o);const u=[],c=[],h=[];for(const d of l)u.push(d.sourceLayer),c.push(d.nodeIndex),h.push(d.tensorIndex);new Sb({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:h,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let d=0;d<n.length;d++)n[d].sourceLayer=this,n[d].nodeIndex=this.inboundNodes.length-1,n[d].tensorIndex=d}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function npe(t){t=st(t);const e=[];for(const n of t)e.push(n.shape);return xs(e)}function spe(t){return"float32"}function YW(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],u=YW(o,a,l);for(const c of u)r.indexOf(c)===-1&&r.push(c)}return r}}}function rpe(t){let e=!0;for(const n of st(t))if(!(n instanceof gi)){e=!1;break}return e}function ipe(t){let e=!0;for(const n of st(t))if(n instanceof gi){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Pd extends Ue{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:mb("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new V("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new V("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new V("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const r=new gi(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Sb({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new V(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Pd.className="InputLayer";ee(Pd);function JW(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new V("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new Pd({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ope(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return re(e,t.dtype)}catch{throw new V(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class pa{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof pa)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=ope(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new V(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof gi){if(this.id2Value[e.id]==null)throw new V(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new V(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof gi){if(this.id2Value[e.id]==null)throw new V(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new V(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&$e(this.id2Mask)}}const Xw=new zW,Qw=new zW;function ape(t){Xw!=null&&Xw.setMaxEntries(t),Qw!=null&&Qw.setMaxEntries(t)}function Nf(t,e,n,s){const r=n==null?!1:n.training,i=Array.isArray(t),o=i?t:[t],a=o.map(p=>p.name),l=[],u=e.names();for(const p of a)u.indexOf(p)!==-1?l.push(e.getValue(p)):l.push(null);s!=null&&(s.maxNumTensors=-1/0,s.minNumTensors=1/0);const c=a.join(",")+"|"+e.names().sort().join(",");let h=Xw.get(c),d;if(h==null){const p=lpe(o,e);h=p.sorted,d=p.recipientCounts,Xw.put(c,h),Qw.put(c,d)}d={},r||Object.assign(d,Qw.get(c));const f=new pa(e);for(let p=0;p<h.length;++p){if(s!=null){const E=Ww().numTensors;E>s.maxNumTensors&&(s.maxNumTensors=E),E<s.minNumTensors&&(s.minNumTensors=E)}const m=h[p],g=m.sourceLayer;if(g instanceof Pd)continue;const y=[],w=[],x=[];let v=!1;for(const E of m.inputs){const N=f.getValue(E),$=f.getMask(E);y.push(N),w.push($),$!=null&&(v=!0),r||(d[E.name]--,d[E.name]===0&&!e.hasKey(E)&&a.indexOf(E.name)===-1&&!N.isDisposed&&E.sourceLayer.stateful!==!0&&x.push(N))}v&&(n=n||{},n.mask=w[0]);const b=st(g.apply(y,n));let S=null;g.supportsMasking&&(S=g.computeMask(y,w));const T=cpe(m),_=Array.isArray(T)?T:[T];for(let E=0;E<_.length;++E){f.hasKey(_[E])||f.add(_[E],b[E],Array.isArray(S)?S[0]:S);const N=a.indexOf(_[E].name);N!==-1&&(l[N]=b[E])}r||$e(x)}return f.disposeMasks(),i?l:l[0]}function lpe(t,e){C(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const r=xP(t[0],e);n=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of t){const{sorted:o,recipientMap:a}=xP(i,e);for(const l of o)r.has(l.name)||(n.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:n,recipientCounts:upe(s)}}function upe(t){const e={};for(const n in t)e[n]=t[n].size;return e}function xP(t,e){const n=new Set,s=[],r={};for(const a of e.names())n.add(a);const i=[],o=[];for(i.push(t);i.length>0;){const a=i[i.length-1];if(n.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),n.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!n.has(u.name)&&i.push(u)}}return{sorted:s,recipientMap:r}}function cpe(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const r of t.sourceLayer.inboundNodes[s].outputTensors)if(r.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hpe=U();hpe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,ape);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function b$(t,e){return W(()=>Pn(ge(P(t,t),e,!0)))}class cy extends qu{getConfig(){return{}}}class I$ extends cy{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return W(()=>{const n=b$(e,this.axis),s=Es(n,0,this.maxValue);return P(e,be(s,Y(an(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}I$.className="MaxNorm";ee(I$);class T$ extends cy{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return W(()=>be(e,Y(an(),b$(e,this.axis))))}getConfig(){return{axis:this.axis}}}T$.className="UnitNorm";ee(T$);class S$ extends cy{apply(e){return xi(e)}}S$.className="NonNeg";ee(S$);class _$ extends cy{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return W(()=>{const n=b$(e,this.axis),s=Y(P(this.rate,Es(n,this.minValue,this.maxValue)),P(1-this.rate,n));return P(e,be(s,Y(an(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}_$.className="MinMaxNorm";ee(_$);const bP={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function un(t){return c$(t)}function IP(t,e={}){return oy(t,or.getMap().classNameMap,e,"constraint")}function cn(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in bP?bP[t]:t,config:{}};return IP(n)}else return t instanceof cy?t:IP(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function dpe(t){return new I$(t)}function fpe(t){return new T$(t)}function ppe(){return new S$}function mpe(t){return new _$(t)}const gpe=Object.freeze(Object.defineProperty({__proto__:null,maxNorm:dpe,minMaxNorm:mpe,nonNeg:ppe,unitNorm:fpe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ype(){return new f$}function wpe(){return new yb}function vpe(t){return new p$(t)}function xpe(t){return new m$(t)}function bpe(t){return new g$(t)}function Ipe(t){return new y$(t)}function Tpe(t){return new w$(t)}function Spe(t){return new Ns(t)}function _pe(t){return new wb(t)}function Cpe(t){return new vb(t)}function Epe(t){return new xb(t)}function kpe(t){return new bb(t)}function Npe(t){return new Ib(t)}function $pe(t){return new Tb(t)}function Ape(t){return new v$(t)}const Rpe=Object.freeze(Object.defineProperty({__proto__:null,constant:vpe,glorotNormal:Cpe,glorotUniform:_pe,heNormal:Epe,heUniform:kpe,identity:Tpe,leCunNormal:Npe,leCunUniform:$pe,ones:wpe,orthogonal:Ape,randomNormal:bpe,randomUniform:xpe,truncatedNormal:Ipe,varianceScaling:Spe,zeros:ype},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Zo(t){if(t==null)return;const e=[],n=[],s=[];for(const r in t){const i=t[r];if(typeof i!="number"){const o=i;e.push(o.data()),n.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)t[n[i]]=r[i][0];$e(s)}}function ZW(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var TP;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(TP||(TP={}));const Dpe=125;class mh{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class ej{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class Ope extends mh{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const r in n){const i=n[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=W(()=>Y(this.totals[r],P(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:W(()=>{const r=P(be(1,this.seen),this.totals[s]);n[s]=r,this.totals[s].dispose(),on(n[s])}))}}class tj extends mh{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),n.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[n[i]][s[i]].dispose(),this.history[n[i]][s[i]]=r[i][0]}}class nj extends mh{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||WN,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Dpe),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Fw(this.yieldEvery)&&(this.maybeWait=Afe(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const r=[];this.yield!=null&&(await Zo(s),r.push(this.yield(e,n,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await Zo(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await Zo(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await Zo(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await Zo(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):Fw(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Zo(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Zo(e),await this.trainEnd(e))}}function sj(t,e){return t==null&&(t={}),t instanceof mh?[t]:Array.isArray(t)&&t[0]instanceof mh?t:st(t).map(s=>new nj(s,e))}class sr{constructor(){}static registerCallbackConstructor(e,n){C(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),sr.checkForDuplicate(n),sr.constructors[e]==null&&(sr.constructors[e]=[]),sr.constructors[e].push(n)}static checkForDuplicate(e){for(const n in sr.constructors)sr.constructors[+n].forEach(r=>{if(r===e)throw new V("Duplicate callback constructor.")})}static clear(){sr.constructors={}}static createCallbacks(e){const n=[];for(const s in sr.constructors){const r=+s;e>=r&&n.push(...sr.constructors[r])}return n.map(s=>new s)}}sr.constructors={};function rj(t,e,n,s,r,i,o,a,l){const u=new tj,c=[new Ope,...sr.createCallbacks(e)];t!=null&&c.push(...t),c.push(u);const h=new ej(c);return h.setParams({epochs:n,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:h,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ai(t,e={},n=!1){return oy(t,or.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yw(t,e){return W(()=>{t.dtype!=="float32"&&(t=re(t,"float32"));const n=ge(ly(t),e,!0),s=Wu(n.shape,an()),r=Pn(Ji(n,s));return be(t,r)})}function Xu(t,e){return W(()=>$t(ly(pe(e,t)),-1))}function _b(t,e){return W(()=>$t(Kt(pe(e,t)),-1))}function Fd(t,e){return W(()=>{const n=pe(t,e),s=Es(Kt(t),an(),Number.MAX_VALUE),r=Kt(be(n,s));return P(100,$t(r,-1))})}function Ppe(t,e){return W(()=>{const n=Es(e,an(),Number.MAX_VALUE),s=Ys(Y(1,n)),r=Es(t,an(),Number.MAX_VALUE),i=Ys(Y(1,r));return $t(ly(pe(s,i)),-1)})}function Fpe(t,e){return W(()=>{const n=Ji(0,pe(1,P(t,e)));return $t(ly(n),-1)})}function Lpe(t,e){return W(()=>{const n=Ji(0,pe(1,P(t,e)));return $t(n,-1)})}function Mpe(t,e){return W(()=>{const n=ge(P(t,e),-1),s=gr(P(pe(1,t),e),-1);return Ji(0,Y(1,pe(s,n)))})}function Vpe(t,e){return W(()=>{const n=Math.log(2),s=pe(e,t),r=pe(Y(s,ju(P(-2,s))),n);return $t(r,-1)})}function Zp(t,e,n=!1){return W(()=>{if(n)e=ey(e);else{const s=ge(e,e.shape.length-1,!0);e=be(e,s)}return e=Es(e,an(),1-an()),pt(ge(P(re(t,"float32"),Ys(e)),e.shape.length-1))})}function Jw(t,e,n=!1){return W(()=>{const s=re(Rd(Wfe(t)),"int32");e=Es(e,an(),1-an());const r=e.shape,i=L(ch(s,r[r.length-1]),r);return Zp(i,e,n)})}function zpe(t,e){if(!We(t.shape,e.shape))throw new V(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return W(()=>{const n=xi(e),s=pt(Kt(e));return Y(pe(n,P(e,t)),Gg(ks(s)))})}function Cb(t,e){return W(()=>{let n;return n=Es(e,an(),1-an()),n=Ys(be(n,pe(1,n))),$t(zpe(t,n),-1)})}function Bpe(t,e){return W(()=>{const n=Es(t,an(),1),s=Es(e,an(),1);return ge(P(t,Ys(be(n,s))),-1)})}function Upe(t,e){return W(()=>{const n=Ys(Y(an(),e));return $t(pe(e,P(t,n)),-1)})}function C$(t,e){return W(()=>{const n=Yw(t,-1),s=Yw(e,-1),r=P(n,s);return pt(ge(r,-1))})}const Zw={meanSquaredError:Xu,meanAbsoluteError:_b,meanAbsolutePercentageError:Fd,meanSquaredLogarithmicError:Ppe,squaredHinge:Fpe,hinge:Lpe,categoricalHinge:Mpe,logcosh:Vpe,categoricalCrossentropy:Zp,sparseCategoricalCrossentropy:Jw,binaryCrossentropy:Cb,kullbackLeiblerDivergence:Bpe,poisson:Upe,cosineProximity:C$};function QI(t){if(typeof t=="string"){if(t in Zw)return Zw[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new V(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function E$(t,e){return W(()=>{const n=P(.5,Js(e)),s=ji(gs(e,n),t.dtype);return $t(Qs(t,s),-1)})}function k$(t,e){return W(()=>ji(Qs(fu(t,-1),fu(e,-1)),"float32"))}function ij(t,e){return W(()=>re(ge(zr(Qs(t,1),Qs(e,1))),"float32"))}function Wpe(t,e){return W(()=>re(ge(zr(Qs(t,1),Qs(e,0))),"float32"))}function jpe(t,e){return W(()=>re(ge(zr(Qs(t,0),Qs(e,1))),"float32"))}function oj(t,e){return W(()=>{const n=ij(t,e),s=jpe(t,e),r=Y(n,s);return re(wn(gs(r,0),be(n,r),0),"float32")})}function Gpe(t,e){return W(()=>{const n=ij(t,e),s=Wpe(t,e),r=Y(n,s);return re(wn(gs(r,0),be(n,r),0),"float32")})}function aj(t,e){return Cb(t,e)}function lj(t,e){return t.rank===e.rank&&(t=ll(t,[t.rank-1])),e=fu(e,-1),e.dtype!==t.dtype&&(e=re(e,t.dtype)),re(Qs(t,e),"float32")}const Hpe=Xu,qpe=Xu,Kpe=_b,Xpe=_b,Qpe=Fd,Ype=Fd,N$=Zp,Jpe=C$,uj=Jw,ev={binaryAccuracy:E$,categoricalAccuracy:k$,precision:oj,categoricalCrossentropy:N$,sparseCategoricalCrossentropy:uj,mse:Hpe,MSE:qpe,mae:Kpe,MAE:Xpe,mape:Qpe,MAPE:Ype,cosine:Jpe};function Zpe(t){if(typeof t=="string"&&t in ev)return ev[t];if(typeof t!="string"&&t!=null)return t;throw new V(`Unknown metric ${t}`)}function s0(t){if(Ci(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(Zw))if(Zw[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(ev))if(ev[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eme(t){const e={Adagrad:()=>vl.adagrad(.01),Adadelta:()=>vl.adadelta(1,.95,an()),Adam:()=>vl.adam(.001,.9,.999,an()),Adamax:()=>vl.adamax(.002,.9,.999,an(),0),RMSProp:()=>vl.rmsprop(.001,.9,0,an()),SGD:()=>vl.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new V(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const SP=1*1024*1024;function _P(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!a_(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>SP&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${SP}.`)}}function a_(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!a_(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!a_(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tme(t,e,n,s=console.log){const r=sme(t),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(c=>Math.floor(e*c)));let o;if(!r){i.push("Receives inputs"),o=[];for(const c in t.nodesByDepth)o.push(...t.nodesByDepth[c])}s("_".repeat(e)),tv(i,n,s),s("=".repeat(e));const a=t.layers;for(let c=0;c<a.length;++c)r?rme(a[c],n,s):ime(a[c],n,o,s),s((c===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=nme(t),u=Kw(t.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function nme(t){let e;return t.collectedTrainableWeights!=null?e=Kw(t.collectedTrainableWeights):e=Kw(t.trainableWeights),e}function sme(t){let e=!0;const n=[],s=[];for(const r in t.nodesByDepth)n.push(t.nodesByDepth[r]);for(const r of n){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of t.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function tv(t,e,n=console.log){let s="";for(let r=0;r<t.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=t[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);n(s)}function rme(t,e,n){let s,r;try{r=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const i=t.name,o=t.getClassName(),a=[`${i} (${o})`,r,s,t.countParams().toString()];tv(a,e,n)}function ime(t,e,n,s){let r,i;try{i=t.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}const o=[];for(const h of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(h)===-1))for(let d=0;d<h.inboundLayers.length;++d){const f=h.inboundLayers[d].name,p=h.nodeIndices[d],m=h.tensorIndices[d];o.push(`${f}[${p}][${m}]`)}const a=t.name,l=t.getClassName(),u=o.length===0?"":o[0],c=[`${a} (${l})`,i,r,t.countParams().toString(),u];tv(c,e,s);for(let h=1;h<o.length;++h)tv(["","","","",o[h]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cj(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function em(t,e){if(t===null)return null;if(typeof t=="string")return Tl(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const i=t[r];cj(e,r,i)?n.push(i):n.push(em(i,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s];if(s==="name"&&typeof r=="string")n[s]=r;else{const i=Tl(s);n[i]=em(r,i)}}return n}}function l_(t,e){if(t==null)return null;if(typeof t=="string")return oo(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const i=t[r];cj(e,r,i)?n.push(i):n.push(l_(i,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s],i=oo(s);(s==="name"||s==="className")&&typeof r=="string"?n[i]=r:n[i]=l_(r,s)}return n}}/** @license See the LICENSE file. */const Eb="4.17.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ome=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class Kr extends Ue{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const w=this.getClassName().toLowerCase();this.name=mb(w)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],$a(this.inputs).length!==this.inputs.length)throw new V(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(w=>w.name)}`);$a(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(w=>w.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const w of this.outputs){const x=w.sourceLayer,v=w.nodeIndex,b=w.tensorIndex;this.outputLayers.push(x),this.outputLayersNodeIndices.push(v),this.outputLayersTensorIndices.push(b)}for(const w of this.inputs){const x=w.sourceLayer,v=w.nodeIndex,b=w.tensorIndex;Ci(v===0,"input layer has >1 nodes"),Ci(b===0,"input layer has >1 tensors"),this.inputLayers.push(x),this.inputLayersNodeIndices.push(v),this.inputLayersTensorIndices.push(b)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let w=0;w<this.inputLayers.length;w++){const x=this.inputLayers[w];if(!(x instanceof Pd))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${w} (0-based) originates from layer type ${x.getClassName()}.`);this.inputNames.push(x.name),this.feedInputShapes.push(x.batchInputShape),this.feedInputNames.push(x.name)}for(const w of this.outputLayers)this.outputNames.push(w.name);this.internalInputShapes=this.inputs.map(w=>w.shape),this.internalOutputShapes=this.outputs.map(w=>w.shape);const n={},s={},r={},i={},o={},a=[],l=(w,x,v,b,S,T)=>{(b==null||S==null||T==null)&&(b=w.sourceLayer,S=w.nodeIndex,T=w.tensorIndex);const _=b.inboundNodes[S];if(v.indexOf(_)!==-1)throw new Pr(`The tensor ${w.name} at layer "${b.name}" is part of a cycle.`);if(x.indexOf(_)!==-1)return;this.containerNodes.add(Kr.nodeKey(b,S)),b.id in o||(o[b.id]=Object.keys(o).length),v.indexOf(_)===-1&&v.push(_);const E=_.inboundLayers.length;for(let N=0;N<E;N++){const $=_.inputTensors[N],A=_.inboundLayers[N],D=_.nodeIndices[N],F=_.tensorIndices[N];l($,x,v,A,D,F)}for(x.push(_);v.indexOf(_)>=0;)v.splice(v.indexOf(_),1);a.push(_)},u=[],c=[];for(const w of this.outputs)l(w,u,c);const h=a.slice().reverse();for(const w of h){s[w.id]=w,w.id in n||(n[w.id]=0);let x=n[w.id];const v=r[w.outboundLayer.id]==null?0:r[w.outboundLayer.id];x=Math.max(x,v),r[w.outboundLayer.id]=x,i[w.outboundLayer.id]=w.outboundLayer,n[w.id]=x;for(let b=0;b<w.inboundLayers.length;b++){const S=w.inboundLayers[b],T=w.nodeIndices[b],_=S.inboundNodes[T],E=n[_.id]==null?0:n[_.id];n[_.id]=Math.max(x+1,E),s[_.id]=_}}const d={};for(const w in n){const x=n[w];x in d||(d[x]=[]),d[x].push(s[w])}const f={};for(const w in r){const x=r[w];x in f||(f[x]=[]),f[x].push(i[w])}let p=Object.keys(f).map(w=>parseInt(w,10)).sort(e0);this.layers=[];for(const w of p){const x=f[w];x.sort((v,b)=>{const S=o[v.id],T=o[b.id];return S<T?-1:S>T?1:0});for(const v of x)v instanceof Kr&&this.internalContainerRefs.push(v),this.layers.push(v)}this.layersByDepth=f,p=Object.keys(d).map(w=>parseInt(w,10)).sort(e0);const m=this.inputs.slice(),g=[];for(const w of p)for(const x of d[w]){const v=x.outboundLayer;if(v!=null){for(const b of x.inputTensors)if(m.indexOf(b)===-1)throw new Pr(`Graph disconnected: cannot obtain value for tensor ${b} at layer "${v.name}". The following previous layers were accessed without issue: ${g}`);for(const b of x.outputTensors)m.push(b);g.push(v.name)}}this.nodesByDepth=d;const y=this.layers.map(w=>w.name);for(const w of y){const x=y.filter(v=>v===w).length;if(x!==1)throw new Pr(`The name "${w}" is used ${x} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Sb({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(w=>null),outputMasks:this.outputs.map(w=>null),inputShapes:this.inputs.map(w=>w.shape),outputShapes:this.outputs.map(w=>w.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new V("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let r=0;const i=ome(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const c=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[c]!=null)throw new V(`Duplicate weight name: ${c}`);s[c]=u,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(n)throw new V(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new V(`${a.length} of ${r} weights are not set: ${a}`)}x$(o)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==n&&(e[i]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${Eb}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=l_(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return W(()=>{e=st(e);const s=new pa;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Nf(this.outputs,s,n)})}computeMask(e,n){return W(()=>{e=st(e);let s;return n==null?s=xu(null,e.length):s=st(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=qw(e);if(n.length!==this.inputLayers.length)throw new V(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],u=n[a],c=l.name+"_0_0";s[c]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(e0);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const c=u.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(c.id)!==-1)continue;const h=[];for(let m=0;m<u.inboundLayers.length;m++){const g=u.inboundLayers[m],y=u.nodeIndices[m],w=u.tensorIndices[m],x=`${g.name}_${y}_${w}`,v=s[x];h.push(v)}const d=c.computeOutputShape(xs(h)),f=qw(d),p=c.inboundNodes.indexOf(u);for(let m=0;m<f.length;m++){const g=`${c.name}_${p}_${m}`;s[g]=f[m]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],h=`${l.name}_${u}_${c}`;o.push(h)}for(let a=0;a<o.length;a++){const l=o[a];Ci(l in s),i.push(s[l])}return xs(i)}runInternalGraph(e,n){n==null&&(n=xu(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],c=e[l],h=n[l];s[u.id]=[c,h]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(e0);for(const l of r){const u=this.nodesByDepth[l];for(const c of u){const h=c.outboundLayer,d=c.inputTensors,f=c.outputTensors,p=new Array;for(const m of d)m.id in s&&p.push(s[m.id]);if(p.length===d.length){let m={},g,y,w,x;if(c.callArgs!=null&&(m=c.callArgs),p.length===1){const[v,b]=p[0];m.mask==null&&(m.mask=b),w=st(h.call(v,m)),x=st(h.computeMask(v,b)),g=[v],y=[b]}else g=p.map(v=>v[0]),y=p.map(v=>v[1]),m.mask==null&&(m.mask=y),w=st(h.call(g,m)),x=st(h.computeMask(g,y));if(h.activityRegularizer)throw new Oe("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let v=0;v<f.length;++v){const b=f[v],S=w[v],T=x[v];s[b.id]=[S,T]}}}}const i=[],o=[],a=[];for(const l of this.outputs){Ci(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,c]=s[l.id];a.push(u.shape),i.push(u),o.push(c)}return[i,o,a]}buildNodeConversionMap(e){const n={};let s;for(const r of this.layers){s=r instanceof Kr?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=Kr.nodeKey(r,i);this.containerNodes.has(o)&&(n[o]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new V("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new V(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new V(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return W(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const r=Kr.nodeKey(n,s);this.containerNodes.has(r)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let h=0;h<o.inboundNodes.length;h++){const d=o.inboundNodes[h],f=Kr.nodeKey(o,h);let p={};if(this.containerNodes.has(f)){if(d.callArgs)try{JSON.stringify(d.callArgs),p=d.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${d.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(d.inboundLayers.length>0){const m=[];for(let g=0;g<d.inboundLayers.length;g++){const y=d.inboundLayers[g],w=d.nodeIndices[g],x=d.tensorIndices[g],v=Kr.nodeKey(y,w);let b=n[v];b==null&&(b=0),m.push([y.name,b,x,p])}u.push(m)}}}const c={};c.name=o.name,c.className=a,c.config=l,c.inboundNodes=u,s.push(c)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=Kr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const h=this.inputLayersTensorIndices[o];r.push([a.name,c,h])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=Kr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const h=this.outputLayersTensorIndices[o];i.push([a.name,c,h])}return e.outputLayers=i,e}static fromConfig(e,n,s={},r=!1){const i={},o={};function a(g,y){g.name in o?o[g.name].push(y):o[g.name]=[y]}function l(g,y){const w=[];let x;for(const v of y){const b=v[0],S=v[1],T=v[2];if(x=v[3]==null?{}:v[3],!(b in i)){a(g,y);return}const _=i[b];if(_.inboundNodes.length<=S){a(g,y);return}const E=_.inboundNodes[S];w.push(E.outputTensors[T])}w.length>0&&g.apply(xs(w),x)}function u(g){const y=g.name,w=ai(g,n.customObjects!=null?n.customObjects:{});w.setFastWeightInitDuringBuild(r),i[y]=w,g.inboundNodes.forEach(v=>{if(!(v instanceof Array))throw new V(`Corrupted configuration, expected array for nodeData: ${v}`);a(w,v)})}const c=n.name,h=n.layers;for(const g of h)u(g);for(;!$fe(o);)for(const g of h){const y=i[g.name];if(y.name in o){const w=o[y.name];delete o[y.name];for(const x of w)l(y,x)}}const d=[],f=[],p=n.inputLayers;for(const g of p){const y=g[0],w=g[1],x=g[2];Ci(y in i);const b=i[y].inboundNodes[w].outputTensors;d.push(b[x])}const m=n.outputLayers;for(const g of m){const y=g[0],w=g[1],x=g[2];Ci(y in i);const b=i[y].inboundNodes[w].outputTensors;f.push(b[x])}return new e({inputs:d,outputs:f,name:c})}get stateful(){if(this._stateful)throw new V("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){W(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ame(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(r=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const r=[];return e.forEach(i=>{i in t?r.push(t[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function hj(t,e){return ame(t,e,"classWeight")}async function dj(t,e,n,s){if(e!=null||s!=null)throw new Error("Support sampleWeight is not implemented yet");if(n!=null){const r=W(()=>{if(t.shape.length===1)return Ui(t);if(t.shape.length===2){if(t.shape[1]>1)return fu(t,1);if(t.shape[1]===1)return L(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());$e(r);const o=[];return i.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),$n(o,"float32")}else return null}function lme(t,e){return P(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ume=32;function fj(t,e){let n,s;const r=e;n=r.xs,s=r.ys,C(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=CP("input",t.inputNames,n),o=CP("output",t.outputNames,s),a=i[0].shape[0];C(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),C(o.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)C(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<o.length;l++)C(o[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:o}}function CP(t,e,n){if(n instanceof Qe)return[n];if(Array.isArray(n))return C(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const r of e){if(n[r]==null)throw new V(`The feature data generated by the dataset lacks the required ${t} key '${r}'.`);s.push(n[r])}return s}}function cme(t){if(t.length===3)throw new Oe("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function hme(t,e,n){const s=n.batchesPerEpoch!=null;if(C(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),C(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),C(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),C(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),C(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const r=n.validationData!=null;let i,o;if(r)if(EP(n.validationData))C(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const g=cme(n.validationData);i=g.xs,o=g.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(g=>"val_"+g)):u=l.slice();const c=sj(n.callbacks,n.yieldEvery),h=n.verbose==null?1:n.verbose,{callbackList:d,history:f}=rj(c,h,n.epochs,null,null,dme(e,n),null,r,u);d.setModel(t),t.history=f,await d.onTrainBegin(),t.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,m=await e.iterator();for(;p<n.epochs;){const g={};await d.onEpochBegin(p);let y=0,w=0;for(s||(m=await e.iterator());!s||y<n.batchesPerEpoch;){const x=await m.next();if(s&&x.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(x.value!=null){const{xs:v,ys:b}=fj(t,x.value),S={};S.batch=w,S.size=v[0].shape[0],await d.onBatchBegin(w,S);const T=[];if(n.classWeight!=null){const N=hj(n.classWeight,t.outputNames);for(let $=0;$<N.length;++$)T.push(await dj(b[$],null,N[$]))}const _=v.concat(b).concat(T),E=a(_);$e(_);for(let N=0;N<l.length;++N){const $=l[N],A=E[N];S[$]=A,on(A)}await d.onBatchEnd(w,S),ZW(S),w++,y++}if(s?y>=n.batchesPerEpoch:x.done){if(r){let v;EP(n.validationData)?v=st(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):v=st(t.evaluate(i,o,{batchSize:n.validationBatchSize==null?ume:n.validationBatchSize,verbose:0}));for(let b=0;b<t.metricsNames.length;++b)g[`val_${t.metricsNames[b]}`]=v[b]}break}if(t.stopTraining_)break}if(await d.onEpochEnd(p,g),p++,t.stopTraining_)break}return await d.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function dme(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function EP(t){return typeof t.iterator=="function"}function fme(t){return typeof t.next=="function"}async function pme(t,e,n){n=n||{};const s=n.batches!=null,r=t.testFunction;let i=[];if(n.verbose>0)throw new Oe("Verbose mode is not implemented yet.");C(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=fme(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const u=await o.next();if(i=W(()=>{if(u.value){const{xs:c,ys:h}=fj(t,u.value),d=c.concat(h),f=W(()=>r(d));if($e(d),l===0)for(let m=0;m<f.length;++m)i.push(Te(0));const p=d[0].shape[0];for(let m=0;m<f.length;++m){const g=f[m],y=i[m];i[m]=W(()=>Y(i[m],P(p,g))),l>0&&$e(y)}$e(f),a+=p,++l}return i}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const c=i[u];i[u]=be(i[u],a),$e(c)}return xs(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function YI(t){C(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function hf(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>Kl(s,e,n-e)):Kl(t,e,n-e)}function u_(t,e){return W(()=>t==null?null:Array.isArray(t)?t.map(n=>u_(n,e)):KW(t,e.dtype==="int32"?e:re(e,"int32")))}function JI(t,e){const n=[];let s=0,r=null;for(;s<t;)r=s+e,r>=t&&(r=t),n.push([s,r]),s=r;return n}function pj(t){const e=[];t instanceof Qe&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(ay(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function qr(t,e){if(t==null)return;const n=[];if(e instanceof Qe)n.push(e.id);else if(Array.isArray(e))e.forEach(r=>n.push(r.id));else if(e!=null)for(const r in e){const i=e[r];n.push(i.id)}const s=[];if(t instanceof Qe)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(r=>{n.indexOf(r.id)===-1&&s.push(r)});else if(t!=null)for(const r in t){const i=t[r];n.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mme(t){return t instanceof Qe}function c_(t){return Array.isArray(t)}function kP(t){return!mme(t)&&!c_(t)}function NP(t,e,n,s=!0,r=""){if(e==null||e.length===0){if(t!=null){let o=!1;if(c_(t)&&t.length>0)o=!0;else if(kP(t)){for(const a in t)if(t.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new V(`Error when checking model ${r} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(o=>null);let i;if(kP(t)){t=t,i=[];for(const o of e){if(t[o]==null)throw new V(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(t[o])}}else if(c_(t)){if(t=t,t.length!==e.length)throw new V(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,e.length>1)throw new V(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=pj(i),n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new V(`Error when checking ${r}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],c=n[o][l];if(c!=null&&c>=0&&u!==c)throw new V(`${r} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function gme(t,e,n){const s=$a(t.map(i=>i.shape[0]));s.sort();const r=$a(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new V(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(r.length>1)throw new V(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!We(s,r))throw new V(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function yme(t,e,n){const s=[Xu,Cb,Zp];for(let r=0;r<t.length;++r){const i=t[r],o=e[r],a=n[r];if(o!=null){if(o===Zp&&i.shape[i.shape.length-1]===1)throw new V(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let c=0;c<l.length;++c){const h=l[c],d=u[c];if(d!=null&&h!==d)throw new V(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function $P(t,e,n,s=!0,r=""){let i;if(Array.isArray(t)){if(t.length!==e.length)throw new V(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(e.length>1)throw new V(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new V(`Error when checking ${r}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],c=n[o][l];if(c!=null&&c!==u)throw new V(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function wme(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const r of e){let i=n.hasOwnProperty(r)?n[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const vme="layers-model";class vo extends Kr{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new V("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");tme(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=eme(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Wo))throw new V("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new V(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(QI(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new V(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>QI(a))}else{const o=QI(e.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ql("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=wme(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};ql("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(u=>{const c="";let h,d,f;for(const p of u){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const g=this.internalOutputShapes[o];g[g.length-1]===1||this.lossFunctions[o]===Cb?["accuracy","acc"].indexOf(p)!==-1?d=E$:["crossentropy","ce"].indexOf(p)!==-1&&(d=aj):this.lossFunctions[o]===Jw?["accuracy","acc"].indexOf(p)!==-1?d=lj:["crossentropy","ce"].indexOf(p)!==-1&&(d=uj):["accuracy","acc"].indexOf(p)!==-1?d=k$:["crossentropy","ce"].indexOf(p)!==-1&&(d=N$);let y;["accuracy","acc"].indexOf(p)!==-1?y="acc":["crossentropy","ce"].indexOf(p)!==-1&&(y="ce"),f=d,h=c+y}else f=Zpe(p),h=c+s0(p);let m;ql(h,()=>{m=f}),i(o,h,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const r=s.batchSize==null?32:s.batchSize;YI(r);const o=this.standardizeUserDataXY(e,n,!0,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return xs(u)}finally{qr(o[0],e),qr(o[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),pme(this,e,n)}checkNumSamples(e,n,s,r="steps"){let i;if(s!=null){if(i=null,n!=null)throw new V(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new V(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new V("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),r=s?n:[n],i=this.retrieveSymbolicTensors(r),o=new pa;if(e instanceof Qe&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new V(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new V(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=Nf(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const n=xu(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(n[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw n.forEach((i,o)=>{i==null&&r.push(e[o])}),new V(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return n}predictLoop(e,n=32,s=!1){return W(()=>{const r=this.checkNumSamples(e);if(s)throw new Oe("Verbose predictLoop() is not implemented yet.");const i=JI(r,n),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)W(()=>{const u=i[a][0],c=i[a][1],h=hf(e,u,c),d=[];if(Array.isArray(h))for(let p=0;p<h.length;++p)d.push({key:this.inputs[p],value:h[p]});else d.push({key:this.inputs[0],value:h});const f=new pa(d);return Nf(this.outputs,f)}).forEach((u,c)=>o[c].push(u));return xs(o.map(a=>Bt(a,0)))})}predict(e,n={}){const s=pj(e);$P(s,this.inputNames,this.feedInputShapes,!1);try{const r=n.batchSize==null?32:n.batchSize;return YI(r),this.predictLoop(s,r)}finally{qr(s,e)}}predictOnBatch(e){$P(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,r){if(this.optimizer_==null)throw new Pr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===Jw?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=NP(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=NP(n,this.feedOutputNames,i,!1,"target"),gme(e,n),yme(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new V(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,n,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const c=hj(r,this.outputNames);u=[];for(let h=0;h<c.length;++h)u.push(await dj(l[h],null,c[h]))}return[a,l,u]}testLoop(e,n,s,r=0,i){return W(()=>{const o=this.checkNumSamples(n,s,i,"steps"),a=[];if(r>0)throw new Oe("Verbose mode is not implemented yet.");if(i!=null)throw new Oe("steps mode in testLoop() is not implemented yet");{const l=JI(o,s),u=$n(pi(0,o));for(let c=0;c<l.length;++c){const h=l[c][0],d=l[c][1],f=Kl(u,h,d-h),p=u_(n,f),m=e(p);if(c===0)for(let g=0;g<m.length;++g)a.push(Te(0));for(let g=0;g<m.length;++g){const y=m[g];a[g]=Y(a[g],P(d-h,y))}}for(let c=0;c<a.length;++c)a[c]=be(a[c],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(pP(e,r)>1){const o=pP(e.slice(0,s),r);i+=`_${o}`}n.push(i)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const h=[];for(let m=0;m<this.inputs.length;++m)h.push({key:this.inputs[m],value:s[m]});const d=new pa(h),f=Nf(this.outputs,d,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){const g=this.lossFunctions[m];let y=g(r[m],f[m]);i[m]!=null&&(y=lme(y,i[m]));const w=$t(y);n.push(w),m===0?p=y:p=Y(p,y)}for(let m=0;m<this.metricsTensors.length;++m){let g;if(this.outputs.length>1&&m<this.outputs.length)g=n[m];else{const y=this.metricsTensors[m][0],w=this.metricsTensors[m][1];g=$t(y(r[w],f[w]))}on(g),o.push(g)}return p=$t(p),this.calculateLosses().forEach(m=>{p=Y(p,m)}),p},l=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>W(()=>{const n=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:r[u]});const a=new pa(o),l=Nf(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const c=this.lossFunctions[u],h=$t(c(i[u],l[u]));u===0?s=h:s=Y(s,h),n.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const c=this.metricsTensors[u][0],h=this.metricsTensors[u][1],d=$t(c(i[h],l[h]));n.push(d)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,u,c,h,d;try{const f=s.batchSize==null?32:s.batchSize;YI(f);const m=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,!1,f);r=m[0],i=m[1],d=m[2];let g=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(g=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new Oe("validationData including sample weights is not supported yet."):new V(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const N=await this.standardizeUserData(l,u,null,null,!0,f);c=N[0],h=N[1],y=c.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){g=!0;const E=Math.floor(r[0].shape[0]*(1-s.validationSplit)),N=r[0].shape[0];c=hf(r,E,N),o=r,r=hf(r,0,E),h=hf(i,E,N),a=i,i=hf(i,0,E),y=c.concat(h)}else s.validationSteps!=null&&(g=!0);const w=r.concat(i).concat(d);this.checkTrainableWeightsConsistency();const x=this.makeTrainFunction(),v=this.getDedupedMetricsNames();let b,S;g?(this.makeTestFunction(),b=this.testFunction,S=v.slice().concat(v.map(E=>"val_"+E))):(b=null,y=[],S=v.slice());const T=sj(s.callbacks,s.yieldEvery);return await this.fitLoop(x,w,v,f,s.epochs,s.verbose,T,b,y,s.shuffle,S,s.initialEpoch,null,null)}finally{this.isTraining=!1,qr(r,e),qr(i,n),qr(o,e),qr(a,n),qr(c,l),qr(h,u),d!=null&&$e(d)}}async fitLoop(e,n,s,r,i,o,a,l,u,c,h,d,f,p){r==null&&(r=32),i==null&&(i=1),c==null&&(c=!0),d==null&&(d=0);let m=!1;if(l!=null&&u!=null&&(m=!0),p!=null&&(m=!0,f==null))throw new V("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(n,r,f,"steps_per_epoch");let y;g!=null&&(y=pi(0,g)),o==null&&(o=1);const{callbackList:w,history:x}=rj(a,o,i,d,g,f,r,m,h);w.setModel(this),this.history=x,await w.onTrainBegin(),this.stopTraining_=!1;for(let v=d;v<i;++v){await w.onEpochBegin(v);const b={};if(f!=null)throw new Oe("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new Oe("batch shuffling is not implemneted yet");c&&ZE(y);const S=$n(y),T=JI(g,r);for(let _=0;_<T.length;++_){const E={};if(await w.onBatchBegin(_,E),W(()=>{const N=T[_][0],$=T[_][1],A=Kl(S,N,$-N);E.batch=_,E.size=$-N;const D=u_(n,A),F=e(D);for(let B=0;B<s.length;++B){const z=s[B],H=F[B];E[z]=H,on(H)}if(_===T.length-1&&m){const B=this.testLoop(l,u,r);for(let z=0;z<s.length;++z){const H=s[z],M=B[z];on(M),b["val_"+H]=M}}}),await w.onBatchEnd(_,E),ZW(E),this.stopTraining_)break}S.dispose()}if(await w.onEpochEnd(v,b),this.stopTraining_)break}return await w.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return hme(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const u of a){const c=await u.data();l.push(c[0])}return $e(a),qr(s[0],e),qr(s[1],n),xs(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||n.push({name:r[o].originalName,tensor:i[o]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=Ww().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-Ww().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=oo(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>oo(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const r of n)if(typeof s[r]=="string")e[r]=oo(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[oo(s0(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>oo(s0(e)));{const e={};for(const n in this.metrics)e[n]=oo(s0(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=em(e.optimizer_config),s=ai(n);let r;if(typeof e.loss=="string")r=Tl(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>Tl(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=Tl(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>Tl(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=Tl(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,n){if(typeof e=="string"){const u=R4(e);if(u.length===0)throw new V(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new V(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new V("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await GS(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:vme,generatedBy:`TensorFlow.js tfjs-layers v${Eb}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:c,specs:h}=await GS(await this.optimizer.getWeights(),u);s.specs.push(...h),s.data=$4([s.data,c])}return this.userDefinedMetadata!=null&&(_P(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){_P(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}vo.className="Model";ee(vo);class mj extends vo{}mj.className="Functional";ee(mj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function xme(t,e){"modelTopology"in t||(t={modelTopology:t}),t=t;let n=t.modelTopology;n.model_config!=null&&(n=n.model_config);const s=em(n),r=ai(s,e);if(t.weightsManifest!=null){const i=await KU(t.weightsManifest,t.pathPrefix,r.weights.map(a=>a.originalName)),o={};for(const a of r.weights)o[a.originalName]=i[a.originalName];r.loadWeights(o),$e(i)}return r}async function bme(t,e){if(e==null&&(e={}),typeof t=="string"){const n=D4(t,e);if(n.length===0)n.push(YU(t,e));else if(n.length>1)throw new V(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return Ime(t,void 0,e)}async function Ime(t,e,n){if(n==null&&(n={}),t.load==null)throw new V("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await t.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const i=n.strict==null?!0:n.strict,o=s.weightData!=null&&s.weightSpecs!=null&&i,a=ai(em(r),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new V("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:c}=Tme(s.weightData,s.weightSpecs);a.loadWeights(u,i),a.optimizer!=null&&c.length>0&&await a.optimizer.setWeights(c),$e(u),$e(c.map(h=>h.tensor))}return a}function Tme(t,e){const n=dk(t,e),s={},r=[];return e.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:n[i.name]}):s[i.name]=n[i.name]}),{modelWeights:s,optimizerWeights:r}}class bu extends vo{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:mb("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new V(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof bu||e instanceof vo;let s;if(n){if(s=e,s.outputs.length!==1)throw new V("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new V("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new V("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=JW({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new V(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new V("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=YW(this.outputs[0])}this.inboundNodes=[],new Sb({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:xu(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(Ze(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new vo({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new Pr("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new Pr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new Pr("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new Pr("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},r=!1){let i,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new V("Legacy serialization format not supported yet.");i=n}else C(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=n.layers,delete n.layers,o=n;const a=new e(o);if(!(a instanceof bu))throw new Oe(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const c=ai(l,void 0,r);r&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(e){if(this.model==null)throw new V("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new V("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}bu.className="Sequential";ee(bu);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sme(t){return new vo(t)}function _me(t){return new bu(t)}function gj(t){return JW(t)}function Cme(t,e){sr.registerCallbackConstructor(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Ds=class extends qu{getConfig(){return{}}};class yj extends Ds{apply(e,n=1){return Gfe(e,n)}}yj.className="elu";ee(yj);class wj extends Ds{apply(e){return j1(e)}}wj.className="selu";ee(wj);class vj extends Ds{apply(e){return xi(e)}}vj.className="relu";ee(vj);class xj extends Ds{apply(e){return W(()=>Ba(6,xi(e)))}}xj.className="relu6";ee(xj);class bj extends Ds{apply(e){return e}}bj.className="linear";ee(bj);class Ij extends Ds{apply(e){return oi(e)}}Ij.className="sigmoid";ee(Ij);class Tj extends Ds{apply(e){return qfe(e)}}Tj.className="hardSigmoid";ee(Tj);class Sj extends Ds{apply(e){return ju(e)}}Sj.className="softplus";ee(Sj);class _j extends Ds{apply(e){return Hfe(e)}}_j.className="softsign";ee(_j);class Cj extends Ds{apply(e){return mu(e)}}Cj.className="tanh";ee(Cj);let $$=class extends Ds{apply(e,n=-1){return ey(e,n)}};$$.className="softmax";ee($$);class Ej extends Ds{apply(e,n=-1){return F1(e,n)}}Ej.className="logSoftmax";ee(Ej);class kj extends Ds{apply(e,n=1){return W(()=>P(oi(P(e,n)),e))}}kj.className="swish";ee(kj);class Nj extends Ds{apply(e){return W(()=>P(e,mu(ju(e))))}}Nj.className="mish";ee(Nj);function Wa(t){return t.getClassName()}function ZI(t,e={}){return oy(t,or.getMap().classNameMap,e,"activation")}function ja(t){if(t==null){const e={};return e.className="linear",e.config={},ZI(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},ZI(e)}else return t instanceof Ds?t:ZI(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function A$(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class $j extends qu{}class hy extends $j{constructor(e){super(),A$(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return W(()=>{let n=Qt([1]);return this.hasL1&&(n=Y(n,ge(P(this.l1,Kt(e))))),this.hasL2&&(n=Y(n,ge(P(this.l2,ly(e))))),L(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}hy.className="L1L2";ee(hy);function Eme(t){return A$(t),new hy({l1:t!=null?t.l1:null,l2:0})}function kme(t){return A$(t),new hy({l2:t!=null?t.l2:null,l1:0})}const AP={l1l2:"L1L2"};function ct(t){return c$(t)}function RP(t,e={}){return oy(t,or.getMap().classNameMap,e,"regularizer")}function Ct(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in AP?AP[t]:t,config:{}};return RP(n)}else return t instanceof $j?t:RP(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class R$ extends Ue{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=Ee(e);let s=xi(e);return this.maxValue!=null&&(s=Es(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}R$.className="ReLU";ee(R$);class D$ extends Ue{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Ee(e);return jg(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}D$.className="LeakyReLU";ee(D$);class O$ extends Ue{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=_t(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Ct(e.alphaRegularizer),this.alphaConstraint=cn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new V(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Ze(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)n[r-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new Yt({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=Ee(e),Yg(e,this.alpha.read())}getConfig(){const e={alphaInitializer:At(this.alphaInitializer),alphaRegularizer:ct(this.alphaRegularizer),alphaConstraint:un(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}O$.className="PReLU";ee(O$);let P$=class extends Ue{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Oe(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Ee(e);return $d(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};P$.className="ELU";ee(P$);class F$ extends Ue{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=Ee(e);return P(s,re(gs(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}F$.className="ThresholdedReLU";ee(F$);class L$ extends Ue{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new $$().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return W(()=>{let s=Ee(e);const r=n.mask;if(r!=null){const i=P(pe(Is(s.shape),re(r,s.dtype)),Te(-1e9));s=Y(s,i)}return this.axis instanceof Array?this.axis.length>1?ks(pe(s,Hg(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}L$.className="Softmax";ee(L$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Uc(t,e,n){if(typeof t=="number")return xu(t,e);if(t.length!==e)throw new V(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const r=t[s];if(!Bfe(r))throw new V(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${r}`)}return t}function li(t,e,n,s,r=1){if(t==null)return t;const i=e+(e-1)*(r-1);let o;return n==="same"?o=t:o=t-i+1,Math.floor((o+s-1)/s)}function Ei(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+Ua([n-e,0]);else if(s==="same")t=t*e;else throw new V(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function M$(t,e){return W(()=>(Ht(e),e==="channelsFirst"?je(t,[0,2,3,1]):t))}function Aj(t,e){return W(()=>(Ht(e),e==="channelsFirst"?je(t,[0,2,3,4,1]):t))}function Nme(t,e,n,s=1,r="valid",i,o=1){return W(()=>{if(i==null&&(i=mi()),Ht(i),t.shape.length!==3)throw new V(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new V(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new V(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(i==="channelsFirst"&&(t=je(t,[0,2,1])),r==="causal")throw new Oe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=$1(t,e,s,r==="same"?"same":"valid","NWC",o);return n!=null&&(a=bi(a,n)),a})}function DP(t,e,n,s=[1,1],r="valid",i,o,a=null){return W(()=>{if(i==null&&(i=mi()),Ht(i),t.rank!==3&&t.rank!==4)throw new V(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new V(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=M$(t,i);if(r==="causal")throw new Oe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=OU({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),i==="channelsFirst"&&(l=je(l,[0,3,1,2])),l})}function $me(t,e,n,s=[1,1,1],r="valid",i,o){return W(()=>{if(i==null&&(i=mi()),Ht(i),t.rank!==4&&t.rank!==5)throw new V(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new V(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=Aj(t,i);if(r==="causal")throw new Oe("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=Lk(a,e,s,r==="same"?"same":"valid","NDHWC",o),n!=null&&(a=bi(a,n)),i==="channelsFirst"&&(a=je(a,[0,4,1,2,3])),a})}class kb extends Ue{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",kb.verifyArgs(n),this.rank=e,gn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Oe(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Uc(n.kernelSize,e,"kernelSize"),this.strides=Uc(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,Tr(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Ht(this.dataFormat),this.activation=ja(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=_t(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=cn(n.biasConstraint),this.biasRegularizer=Ct(n.biasRegularizer),this.activityRegularizer=Ct(n.activityRegularizer),this.dilationRate=Uc(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new V(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new V(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new V(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Ci("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!h$(e.kernelSize,"number",1,3))throw new V(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Wa(this.activation),useBias:this.useBias,biasInitializer:At(this.biasInitializer),biasRegularizer:ct(this.biasRegularizer),activityRegularizer:ct(this.activityRegularizer),biasConstraint:un(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class Ld extends kb{constructor(e,n){super(e,n),this.kernel=null,Ld.verifyArgs(n),this.filters=n.filters,gn(this.filters,"filters"),this.kernelInitializer=_t(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=cn(n.kernelConstraint),this.kernelRegularizer=Ct(n.kernelRegularizer)}build(e){e=Ze(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new V(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return W(()=>{e=Ee(e);let s;const r=this.bias==null?null:this.bias.read(),i=UW(this.activation.getClassName());if(i!=null&&this.rank===2)s=DP(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=Nme(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=DP(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=$me(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Oe("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Ze(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=li(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(n),r.push(this.filters)):(r.push(this.filters),r=r.concat(n)),r}getConfig(){const e={filters:this.filters,kernelInitializer:At(this.kernelInitializer),kernelRegularizer:ct(this.kernelRegularizer),kernelConstraint:un(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new V(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Md extends Ld{constructor(e){super(2,e),Md.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!h$(e.kernelSize,"number",1,2))throw new V(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Md.className="Conv2D";ee(Md);class Vd extends Ld{constructor(e){super(3,e),Vd.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new V(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Vd.className="Conv3D";ee(Vd);class V$ extends Md{constructor(e){if(super(e),this.inputSpec=[new Yt({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new V(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ze(e),e.length!==4)throw new V("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new V("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Yt({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return W(()=>{let s=Ee(e);if(s.shape.length!==4)throw new V(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],u=r[a],c=this.kernelSize[0],h=this.kernelSize[1],d=this.strides[0],f=this.strides[1],p=Ei(l,d,c,this.padding),m=Ei(u,f,h,this.padding),g=[i,p,m,this.filters];this.dataFormat!=="channelsLast"&&(s=je(s,[0,2,3,1]));let y=A1(s,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=je(y,[0,3,1,2])),this.bias!=null&&(y=bi(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(e){e=Ze(e);const n=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return n[s]=this.filters,n[r]=Ei(n[r],l,o,this.padding),n[i]=Ei(n[i],u,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}V$.className="Conv2DTranspose";ee(V$);class z$ extends Vd{constructor(e){if(super(e),this.inputSpec=[new Yt({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new V(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ze(e),e.length!==5)throw new V("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new V("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Yt({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return W(()=>{let s=Ee(e);if(s.shape.length!==5)throw new V(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=r[l],c=r[o],h=r[a],d=this.kernelSize[0],f=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],g=this.strides[1],y=this.strides[2],w=Ei(u,m,d,this.padding),x=Ei(c,g,f,this.padding),v=Ei(h,y,p,this.padding),b=[i,w,x,v,this.filters];this.dataFormat!=="channelsLast"&&(s=je(s,[0,2,3,4,1]));let S=Mk(s,this.kernel.read(),b,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(S=je(S,[0,4,1,2,3])),this.bias!==null&&(S=bi(S,this.bias.read(),this.dataFormat)),this.activation!==null&&(S=this.activation.apply(S)),S})}computeOutputShape(e){e=Ze(e);const n=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],h=this.strides[1],d=this.strides[2];return n[s]=this.filters,n[r]=Ei(n[r],c,a,this.padding),n[i]=Ei(n[i],h,l,this.padding),n[o]=Ei(n[o],d,u,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}z$.className="Conv3DTranspose";ee(z$);class Rj extends Ld{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new V("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new V("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new V(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=_t(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Ct(n.depthwiseRegularizer),this.depthwiseConstraint=cn(n.depthwiseConstraint),this.pointwiseInitializer=_t(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Ct(n.pointwiseRegularizer),this.pointwiseConstraint=cn(n.pointwiseConstraint)}build(e){if(e=Ze(e),e.length<this.rank+2)throw new V(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new V(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Yt({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return W(()=>{e=Ee(e);let s;if(this.rank===1)throw new Oe("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=je(e,[0,2,3,1])),s=G1(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=bi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=je(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=At(this.depthwiseInitializer),e.pointwiseInitializer=At(this.pointwiseInitializer),e.depthwiseRegularizer=ct(this.depthwiseRegularizer),e.pointwiseRegularizer=ct(this.pointwiseRegularizer),e.depthwiseConstraint=un(this.depthwiseConstraint),e.pointwiseConstraint=un(this.pointwiseConstraint),e}}Rj.className="SeparableConv";class B$ extends Rj{constructor(e){super(2,e)}}B$.className="SeparableConv2D";ee(B$);class dy extends Ld{constructor(e){super(1,e),dy.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!h$(e.kernelSize,"number",1,1))throw new V(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}dy.className="Conv1D";ee(dy);class U$ extends Ue{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return W(()=>{if(e=Ee(e),this.dataFormat==="channelsLast"){const s=n0(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return n0(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=n0(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return n0(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}U$.className="Cropping2D";ee(U$);class W$ extends Ue{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Ht(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Mfe(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return W(()=>{let s=Ee(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=je(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Or.resizeNearestNeighbor(s,[i,o]):Or.resizeBilinear(s,[i,o]);return je(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Or.resizeNearestNeighbor(s,[i,o]):Or.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}W$.className="UpSampling2D";ee(W$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ame(t,e,n=[1,1],s="valid",r,i){return W(()=>{r==null&&(r=mi()),Ht(r);let o=M$(t,r);if(t.rank!==4)throw new V(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new V(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=Nd(o,e,n,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=je(o,[0,3,1,2])),o})}class j$ extends kb{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=_t(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=cn(e.depthwiseConstraint),this.depthwiseRegularizer=Ct(e.depthwiseRegularizer)}build(e){if(e=Ze(e),e.length<4)throw new V(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new V(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return W(()=>{e=Ee(e);let s=Ame(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=bi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Ze(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=li(n,this.kernelSize[0],this.padding,this.strides[0]),o=li(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=At(this.depthwiseInitializer),e.depthwiseRegularizer=ct(this.depthwiseRegularizer),e.depthwiseConstraint=un(this.depthwiseRegularizer),e}}j$.className="DepthwiseConv2D";ee(j$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Dj(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new V("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),n=r(n),{inputs:t,initialState:e,constants:n}}function Oj(t,e,n,s=!1,r,i,o=!1,a=!1){return W(()=>{const l=e.shape.length;if(l<3)throw new V(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(pi(2,l));if(e=je(e,u),i!=null)throw new Oe("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=re(re(r,"bool"),"float32"),r.rank===l-1&&(r=En(r,-1)),r=je(r,u)),s&&(e=vr(e,0),r!=null&&(r=vr(r,0)));const c=[];let h,d=n;const f=e.shape[0],p=xr(e);let m;r!=null&&(m=xr(r));for(let y=0;y<f;++y){const w=p[y],x=W(()=>t(w,d));if(r==null)h=x[0],d=x[1];else{const v=W(()=>{const b=m[y],S=pe(Js(b),b),T=Y(P(x[0],b),P(d[0],S)),_=d.map((E,N)=>Y(P(x[1][N],b),P(E,S)));return{output:T,newStates:_}});h=v.output,d=v.newStates}a&&c.push(h)}let g;return a&&(g=fs(c,1)),[h,g,d]})}class Ii extends Ue{constructor(e){super(e);let n;if(e.cell==null)throw new V("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new Ab({cells:e.cell}):n=e.cell,n.stateSize==null)throw new V("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Yt({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return pi(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){i_(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of n)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,n){return W(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Oe("Constants support is not implemented in RNN yet.");i_(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Yt({shape:[n,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!We(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new V(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new Yt({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){W(()=>{if(!this.stateful)throw new _i("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new V("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Qt([s,r])):this.states_=[Qt([s,this.cell.stateSize])];else if(e==null)$e(this.states_),this.keptStates!=null&&($e(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Qt([s,r])):this.states_[0]=Qt([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new V(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):$e(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!We(i.shape,a))throw new V(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>on(r.clone()))})}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const i=Dj(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){n.initialState=s,o=o.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new Yt({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(n.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof gi){const u=[e].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const d=super.apply(u,n);return this.inputSpec=h,d}else return super.apply(e,n)}call(e,n){return W(()=>{const s=n==null?null:n.mask,r=n==null?null:n.training;let i=n==null?null:n.initialState;e=Ee(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new V(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=Oj((p,m)=>{const g=this.cell.call([p].concat(m),a);return[g[0],g.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),c=u[0],h=u[1],d=u[2];this.stateful&&this.resetStates(d,r);const f=this.returnSequences?h:c;return this.returnState?[f].concat(d):f})}getInitialState(e){return W(()=>{let n=Qt(e.shape);return n=ge(n,[1,2]),n=ay(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?s_(n,[1,s]):n):this.cell.stateSize>1?[s_(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Ii.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const r=n.cell,i=ai(r,s);return new e(Object.assign(n,{cell:i}))}}Ii.className="RNN";ee(Ii);class fy extends Ue{}class Nb extends fy{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,gn(this.units,"units"),this.activation=ja(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=_t(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_t(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_t(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ct(e.kernelRegularizer),this.recurrentRegularizer=Ct(e.recurrentRegularizer),this.biasRegularizer=Ct(e.biasRegularizer),this.kernelConstraint=cn(e.kernelConstraint),this.recurrentConstraint=cn(e.recurrentConstraint),this.biasConstraint=cn(e.biasConstraint),this.dropout=ph([1,Ua([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ph([1,Ua([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ze(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return W(()=>{if(e=e,e.length!==2)throw new V(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ga({ones:()=>Js(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ga({ones:()=>Js(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Gi(P(e,o),this.kernel.read()):i=Gi(e,this.kernel.read()),this.bias!=null&&(i=bi(i,this.bias.read())),a!=null&&(s=P(s,a));let l=Y(i,Gi(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Wa(this.activation),useBias:this.useBias,kernelInitializer:At(this.kernelInitializer),recurrentInitializer:At(this.recurrentInitializer),biasInitializer:At(this.biasInitializer),kernelRegularizer:ct(this.kernelRegularizer),recurrentRegularizer:ct(this.recurrentRegularizer),biasRegularizer:ct(this.biasRegularizer),activityRegularizer:ct(this.activityRegularizer),kernelConstraint:un(this.kernelConstraint),recurrentConstraint:un(this.recurrentConstraint),biasConstraint:un(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}Nb.className="SimpleRNNCell";ee(Nb);class G$ extends Ii{constructor(e){e.cell=new Nb(e),super(e)}call(e,n){return W(()=>{this.cell.dropoutMask!=null&&($e(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&($e(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return new e(n)}}G$.className="SimpleRNN";ee(G$);class $b extends fy{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new V("GRUCell does not support reset_after parameter set to true.");this.units=e.units,gn(this.units,"units"),this.activation=ja(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ja(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=_t(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_t(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_t(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ct(e.kernelRegularizer),this.recurrentRegularizer=Ct(e.recurrentRegularizer),this.biasRegularizer=Ct(e.biasRegularizer),this.kernelConstraint=cn(e.kernelConstraint),this.recurrentConstraint=cn(e.recurrentConstraint),this.biasConstraint=cn(e.biasConstraint),this.dropout=ph([1,Ua([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ph([1,Ua([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ze(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return W(()=>{if(e=e,e.length!==2)throw new V(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ga({ones:()=>Js(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ga({ones:()=>Js(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=P(e,i[0]));let c=Gi(e,this.kernel.read());this.useBias&&(c=bi(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=P(r,o[0]));const h=this.recurrentKernel.read(),[d,f]=Ss(h,[2*this.units,this.units],h.rank-1),p=Gi(r,d),[m,g,y]=Ss(c,3,c.rank-1),[w,x]=Ss(p,2,p.rank-1);a=this.recurrentActivation.apply(Y(m,w)),l=this.recurrentActivation.apply(Y(g,x));const v=Gi(P(l,r),f);u=this.activation.apply(Y(y,v));const b=Y(P(a,r),P(Y(1,pt(a)),u));return[b,b]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Wa(this.activation),recurrentActivation:Wa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:At(this.kernelInitializer),recurrentInitializer:At(this.recurrentInitializer),biasInitializer:At(this.biasInitializer),kernelRegularizer:ct(this.kernelRegularizer),recurrentRegularizer:ct(this.recurrentRegularizer),biasRegularizer:ct(this.biasRegularizer),activityRegularizer:ct(this.activityRegularizer),kernelConstraint:un(this.kernelConstraint),recurrentConstraint:un(this.recurrentConstraint),biasConstraint:un(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}$b.className="GRUCell";ee($b);class H$ extends Ii{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new $b(e),super(e)}call(e,n){return W(()=>{this.cell.dropoutMask!=null&&($e(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&($e(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}H$.className="GRU";ee(H$);class py extends fy{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,gn(this.units,"units"),this.activation=ja(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ja(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=_t(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_t(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_t(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Ct(e.kernelRegularizer),this.recurrentRegularizer=Ct(e.recurrentRegularizer),this.biasRegularizer=Ct(e.biasRegularizer),this.kernelConstraint=cn(e.kernelConstraint),this.recurrentConstraint=cn(e.recurrentConstraint),this.biasConstraint=cn(e.biasConstraint),this.dropout=ph([1,Ua([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ph([1,Ua([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=Ze(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(n=class extends Wr{apply(l,u){const c=i.apply([o]),h=new yb().apply([o]),d=i.apply([o*2]);return gP(gP(c,h),d)}},n.className="CustomInit",n)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return W(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new V(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ga({ones:()=>Js(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ga({ones:()=>Js(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,c,h;0<this.dropout&&this.dropout<1&&(e=P(e,o[0]));let d=Gi(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=P(r,a[0])),d=Y(d,Gi(r,this.recurrentKernel.read())),this.useBias&&(d=bi(d,this.bias.read()));const[f,p,m,g]=Ss(d,4,d.rank-1);l=this.recurrentActivation.apply(f),u=this.recurrentActivation.apply(p),c=Y(P(u,i),P(l,this.activation.apply(m))),h=this.recurrentActivation.apply(g);const y=P(h,this.activation.apply(c));return[y,y,c]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Wa(this.activation),recurrentActivation:Wa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:At(this.kernelInitializer),recurrentInitializer:At(this.recurrentInitializer),biasInitializer:At(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ct(this.kernelRegularizer),recurrentRegularizer:ct(this.recurrentRegularizer),biasRegularizer:ct(this.biasRegularizer),activityRegularizer:ct(this.activityRegularizer),kernelConstraint:un(this.kernelConstraint),recurrentConstraint:un(this.recurrentConstraint),biasConstraint:un(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}py.className="LSTMCell";ee(py);class q$ extends Ii{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new py(e),super(e)}call(e,n){return W(()=>{this.cell.dropoutMask!=null&&($e(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&($e(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}q$.className="LSTM";ee(q$);class Ab extends fy{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return W(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,n),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){i_(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,r)=>{ql(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,n,s={}){const r=[];for(const i of n.cells)r.push(ai(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return o_(e)}setWeights(e){const n=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)n.push([s.weights[o],i[o]])}x$(n)}}Ab.className="StackedRNNCells";ee(Ab);function Ga(t){const{ones:e,rate:n,training:s=!1,count:r=1,dropoutFunc:i}=t,o=()=>i!=null?i(e(),n):XW(e(),n),a=()=>uy(o,e,s);return!r||r<=1?on(a().clone()):Array(r).fill(void 0).map(a).map(u=>on(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var Rme=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n};class Pj extends Ii{constructor(e){if(e.unroll)throw new Oe("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Oe("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Yt({ndim:5})]}call(e,n){return W(()=>{if(this.cell.dropoutMask!=null&&($e(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&($e(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new V("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return W(()=>{const{stateSize:n}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=Qt(i);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(e,n=!1){W(()=>{if(!this.stateful)throw new _i("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new V("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Qt(i)):this.states_=[Qt(i)];else if(e==null)$e(this.states_),this.keptStates!=null&&($e(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Qt(i)):this.states_[0]=Qt(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new V(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):$e(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!We(l.shape,u))throw new V(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>on(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=n==="channelsFirst",u=e[l?3:2],c=e[l?4:3],h=li(u,r[0],i,o[0],a[0]),d=li(c,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,h,d]:[h,d,s]]}}Pj.className="ConvRNN2D";class Rb extends py{constructor(e){const{filters:n,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,gn(this.filters,"filters"),this.kernelSize=Uc(s,2,"kernelSize"),this.kernelSize.forEach(l=>gn(l,"kernelSize")),this.strides=Uc(r||1,2,"strides"),this.strides.forEach(l=>gn(l,"strides")),this.padding=i||"valid",Tr(this.padding),this.dataFormat=o||"channelsLast",Ht(this.dataFormat),this.dilationRate=Uc(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>gn(l,"dilationRate"))}build(e){var n;e=Ze(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new V(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,c=this.filters;l=new(n=class extends Wr{apply(d,f){const p=u.apply([c]),m=Is([c]),g=u.apply([c*2]);return d$([p,m,g])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return W(()=>{if(e.length!==3)throw new V(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ga({ones:()=>Js(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(K,X,Z)=>!X||!X[Z]?K:P(X[Z],K);let c=u(r,l,0),h=u(r,l,1),d=u(r,l,2),f=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ga({ones:()=>Js(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=u(i,p,0),g=u(i,p,1),y=u(i,p,2),w=u(i,p,3);const x=3,[v,b,S,T]=Ss(this.kernel.read(),a,x),[_,E,N,$]=this.useBias?Ss(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,v,_,this.padding),h=this.inputConv(h,b,E,this.padding),d=this.inputConv(d,S,N,this.padding),f=this.inputConv(f,T,$,this.padding);const[A,D,F,B]=Ss(this.recurrentKernel.read(),a,x);m=this.recurrentConv(m,A),g=this.recurrentConv(g,D),y=this.recurrentConv(y,F),w=this.recurrentConv(w,B);const z=this.recurrentActivation.apply(Y(c,m)),H=this.recurrentActivation.apply(Y(h,g)),M=Y(P(H,o),P(z,this.activation.apply(Y(d,y)))),j=P(this.recurrentActivation.apply(Y(f,w)),this.activation.apply(M));return[j,j,M]})}getConfig(){const e=super.getConfig(),n=Rme(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),s)}inputConv(e,n,s,r){const i=Ao(e,n,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?bi(i,s,this.dataFormat):i}recurrentConv(e,n){return Ao(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Rb.className="ConvLSTM2DCell";ee(Rb);class K$ extends Pj{constructor(e){const n=new Rb(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}K$.className="ConvLSTM2D";ee(K$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Db extends Ue{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?n[r]:this.noiseShape[r]);return s}call(e,n){return W(()=>{this.invokeCallHook(e,n);const s=Ee(e);if(0<this.rate&&this.rate<1){const r=n.training==null?!1:n.training,i=this.getNoiseShape(s);return uy(()=>XW(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}Db.className="Dropout";ee(Db);class X$ extends Db{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}X$.className="SpatialDropout1D";ee(X$);class Q$ extends Ue{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,gn(this.units,"units"),this.activation=ja(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=_t(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=_t(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=cn(e.kernelConstraint),this.biasConstraint=cn(e.biasConstraint),this.kernelRegularizer=Ct(e.kernelRegularizer),this.biasRegularizer=Ct(e.biasRegularizer),this.activityRegularizer=Ct(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Ze(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=Ze(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return W(()=>{this.invokeCallHook(e,n);const s=Ee(e),r=UW(this.activation.getClassName());let i;return r!=null?i=Gi(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Gi(s,this.kernel.read()),this.bias!=null&&(i=bi(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:Wa(this.activation),useBias:this.useBias,kernelInitializer:At(this.kernelInitializer),biasInitializer:At(this.biasInitializer),kernelRegularizer:ct(this.kernelRegularizer),biasRegularizer:ct(this.biasRegularizer),activityRegularizer:ct(this.activityRegularizer),kernelConstraint:un(this.kernelConstraint),biasConstraint:un(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}Q$.className="Dense";ee(Q$);class Y$ extends Ue{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ze(e);for(const n of e.slice(1))if(n==null)throw new V(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Aa(e,1)]}call(e,n){return W(()=>{this.invokeCallHook(e,n);let s=Ee(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=je(s,r)}return jfe(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}Y$.className="Flatten";ee(Y$);class J$ extends Ue{constructor(e){super(e),this.supportsMasking=!0,this.activation=ja(e.activation)}call(e,n){return W(()=>{this.invokeCallHook(e,n);const s=Ee(e);return this.activation.apply(s)})}getConfig(){const e={activation:Wa(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}J$.className="Activation";ee(J$);class Z$ extends Ue{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return W(()=>(e=Ee(e),Ufe(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}Z$.className="RepeatVector";ee(Z$);class e2 extends Ue{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",r=n.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(o===null)o=l;else throw new V("Can only specifiy one unknown dimension.");else i*=u}const a=Aa(e);if(o!==null){if(i===0||a%i!==0)throw new V(s);r[o]=a/i}else if(a!==i)throw new V(s);return r}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return W(()=>{this.invokeCallHook(e,n);const s=Ee(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return L(s,i)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}e2.className="Reshape";ee(e2);class t2 extends Ue{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=pi(1,e.dims.length+1);if(!We(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Yt({ndim:this.dims.length+1})]}computeOutputShape(e){e=Ze(e);const n=e.slice();return this.dims.forEach((s,r)=>{n[r+1]=e[s]}),n}call(e,n){return je(Ee(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}t2.className="Permute";ee(t2);class n2 extends Ue{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=Ee(e);return Xp(yu(s,this.maskValue),-1)}call(e,n){return W(()=>{this.invokeCallHook(e,n);const s=Ee(e),o=Xp(yu(s,this.maskValue),-1,!0);return P(s,re(o,s.dtype))})}}n2.className="Masking";ee(n2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class s2 extends Ue{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(st(e.inputLength))}this.inputDim=e.inputDim,gn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,gn(this.outputDim,"outputDim"),this.embeddingsInitializer=_t(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Ct(e.embeddingsRegularizer),this.activityRegularizer=Ct(e.activityRegularizer),this.embeddingsConstraint=cn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return W(()=>this.maskZero?(e=Ee(e),yu(e,He(e))):null)}computeOutputShape(e){if(e=Ze(e),this.inputLength==null)return[...e,this.outputDim];const n=st(this.inputLength);if(n.length!==e.length-1)throw new V(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<n.length;++r){const i=n[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new V(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(n[s]=o),s++}}return[e[0],...n,this.outputDim]}call(e,n){return W(()=>{this.invokeCallHook(e,n);let s=Ee(e);s.dtype!=="int32"&&(s=ji(s,"int32"));const r=KW(this.embeddings.read(),L(s,[s.size]));return L(r,Ze(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:At(this.embeddingsInitializer),embeddingsRegularizer:ct(this.embeddingsRegularizer),activityRegularizer:ct(this.activityRegularizer),embeddingsConstraint:un(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}s2.className="Embedding";ee(s2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Qu extends Ue{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Oe}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let r=0;r<n.length;++r){const i=e[e.length-n.length+r],o=n[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new V("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Ze(e)]),e=e,e.length<2)throw new V(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const i of e)i!=null&&i[0]!==null&&n.push(i[0]);if(n=$a(n),n.length>1)throw new V(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&$a(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return W(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=Ua(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=ay(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const c=l.shape,h=c[0],d=c.slice(1).concat([h]);let f=L(l,[h].concat(Aa(c.slice(1))));f=je(f,[1,0]),f=L(f,d),s.push(f),i=!0}else if(u>1){const c=pi(1,u).concat([0]);s.push(je(l,c)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,c=l[u-1],h=[c].concat(l.slice(0,l.length-1));o=L(je(L(o,[-1,c]),[1,0]),h)}else if(a>1){const l=[a-1].concat(pi(0,a-1));o=je(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=$a(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return W(()=>{if(n==null)return null;if(!Array.isArray(n))throw new V("`mask` should be an Array");if(!Array.isArray(e))throw new V("`inputs` should be an Array");if(n.length!==e.length)throw new V(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(r=>r==null))return null;n=n.map(r=>r==null?r:En(r,0));let s=n[0];for(let r=1;r<n.length-1;++r)s=zr(s,n[r]);return s})}}class r2 extends Qu{constructor(e){super(e)}mergeFunction(e){return W(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=Y(n,e[s]);return n})}}r2.className="Add";ee(r2);class i2 extends Qu{constructor(e){super(e)}mergeFunction(e){return W(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=P(n,e[s]);return n})}}i2.className="Multiply";ee(i2);class o2 extends Qu{constructor(e){super(e)}mergeFunction(e){return W(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=Y(n,e[s]);return P(1/e.length,n)})}}o2.className="Average";ee(o2);class a2 extends Qu{constructor(e){super(e)}mergeFunction(e){return W(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Ji(n,e[s]);return n})}}a2.className="Maximum";ee(a2);class l2 extends Qu{constructor(e){super(e)}mergeFunction(e){return W(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Ba(n,e[s]);return n})}}l2.className="Minimum";ee(l2);class u2 extends Qu{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new V("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const r of e)if(r!=null){n=!1;break}if(n)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(We(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new V("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return W(()=>d$(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new V("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of n.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new V("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new V("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new V(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return W(()=>{let s=!0;if(n.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)n[o]==null?r.push(re(Js(e[o]),"bool")):n[o].rank<e[o].rank?r.push(En(n[o],-1)):r.push(n[o]);const i=Bt(r,this.axis);return N1(i,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}u2.className="Concatenate";ee(u2);function df(t,e){for(;t<0;)t+=e;return t}function Dme(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Oe("batchDot is not implemented for tensors of 4D or higher rank yet");if(C(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),C(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new Oe("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,r=e.shape.length;n==null&&(n=[s-1,r-2]);const i=n;return W(()=>{let o;if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);e=L(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);t=L(t,t.shape.concat(l))}else o=0;let a;if(t.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=ge(P(t,e),i[0]):a=ge(P(je(t,[1,0]),e),i[1]);else{const l=i[0]!==t.shape.length-1,u=i[1]===e.shape.length-1;a=ze(t,e,l,u)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let c=l;c<l+o;++c)u.push(c);a=ll(a,u)}return a.shape.length===1&&(a=En(a,1)),a})}class c2 extends Qu{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){C(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new Oe("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);if(n[r[0]]!==s[r[1]])throw new V(`Dimension incompatibility: ${n[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new V(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>df(i,e[o].shape.length)):r=[df(this.axes,n.shape.length),df(this.axes,s.shape.length)],this.normalize&&(n=Yw(n,r[0]),s=Yw(s,r[1])),Dme(n,s,r)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[df(this.axes,e.length),df(this.axes,n.length)],s}computeOutputShape(e){C(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new Oe("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);n.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=n.concat(s);return i.length===1&&i.push(1),i}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}c2.className="Dot";ee(c2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class h2 extends Ue{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return W(()=>{this.invokeCallHook(e,n);const s=Ee(e);return uy(()=>Y(gb(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}h2.className="GaussianNoise";ee(h2);class d2 extends Ue{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return W(()=>{this.invokeCallHook(e,n);const s=Ee(e);return this.rate>0&&this.rate<1?uy(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return P(s,gb(s.shape,1,i))},()=>s,n.training||!1):s})}}d2.className="GaussianDropout";ee(d2);class f2 extends Ue{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Ee(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return W(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return uy(()=>{const i=Ee(e),l=-1.6732632423543772*1.0507009873554805;let u=zo(al(s),this.rate);u=ji(u,"float32");const c=((1-this.rate)*(1+this.rate*l**2))**-.5,h=-c*l*this.rate,d=Y(P(i,u),P(Y(u,-1),l));return Y(P(d,c),h)},()=>Ee(e),n.training||!1)}return e})}}f2.className="AlphaDropout";ee(f2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tm(t,e,n,s,r,i=.001){let o;if(t.rank===2)o=Ek(t,e,n,s,r,i);else if(t.rank===3)o=kk(t,e,n,s,r,i);else if(t.rank===4)o=Nk(t,e,n,s,r,i);else throw new Oe(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return o}function Ome(t,e,n,s,r=.001){return W(()=>{const i=Xg(t,s),o=i.mean,a=i.variance;return[tm(t,o,a,n,e,r),o,a]})}function Pme(t,e,n,s,r=.001){return W(()=>{const i=Xg(t,s),o=i.mean,a=i.variance,l=[];for(const p of pi(0,t.rank))s.indexOf(p)!==-1?l.push(1):l.push(t.shape[p]);const u=L(o,l),c=L(a,l),h=e==null?null:L(e,l),d=n==null?null:L(n,l);return[tm(t,u,c,d,h,r),o,a]})}function Fme(t,e,n,s,r=.001){return We(s.slice().sort(),pi(0,t.rank-1))?Ome(t,e,n,s,r):Pme(t,e,n,s,r)}class p2 extends Ue{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=_t(e.betaInitializer||"zeros"),this.gammaInitializer=_t(e.gammaInitializer||"ones"),this.movingMeanInitializer=_t(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=_t(e.movingVarianceInitializer||"ones"),this.betaConstraint=cn(e.betaConstraint),this.gammaConstraint=cn(e.gammaConstraint),this.betaRegularizer=Ct(e.betaRegularizer),this.gammaRegularizer=Ct(e.gammaRegularizer)}build(e){e=Ze(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new V(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Yt({ndim:e.length,axes:{[n]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return W(()=>{const s=n.training==null?!1:n.training,r=Ee(e),i=r.shape,o=i.length,a=pi(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=xu(1,o);u[l]=i[l];const c=a.slice();c.sort();const h=!We(c,pi(0,o).slice(0,o-1)),d=()=>{if(h){const w=L(this.movingMean.read(),u),x=L(this.movingVariance.read(),u),v=this.center?L(this.beta.read(),u):null,b=this.scale?L(this.gamma.read(),u):null;return tm(r,w,x,v,b,this.epsilon)}else return tm(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return d();const[f,p,m]=Fme(r,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(w,x,v)=>{W(()=>{const b=1-v,S=w.read(),T=P(pe(S,x),b);w.write(pe(S,T))})};return(()=>{g(this.movingMean,p,this.momentum),g(this.movingVariance,m,this.momentum)})(),f})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:At(this.betaInitializer),gammaInitializer:At(this.gammaInitializer),movingMeanInitializer:At(this.movingMeanInitializer),movingVarianceInitializer:At(this.movingVarianceInitializer),betaRegularizer:ct(this.betaRegularizer),gammaRegularizer:ct(this.gammaRegularizer),betaConstraint:un(this.betaConstraint),gammaConstraint:un(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}p2.className="BatchNormalization";ee(p2);class m2 extends Ue{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=_t(e.betaInitializer||"zeros"),this.gammaInitializer=_t(e.gammaInitializer||"ones"),this.betaRegularizer=Ct(e.betaRegularizer),this.gammaRegularizer=Ct(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Ze(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=n);for(const i of this.axis)if(i<0||i>=n)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==$a(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,n){const s=Ee(e),r=s.shape,i=r.length;return W(()=>{let{mean:a,variance:l}=Xg(s,this.axis,!0);const u=xu(1,i);for(const m of this.axis)u[m]=r[m];const c=m=>m!=null&&m.shape.length!==i?L(m,u):m;let h=this.scale?c(this.gamma.read()):null,d=this.center?c(this.beta.read()):null;const f=[],p=[];for(let m=0;m<i;++m)this.axis.indexOf(m)!==-1?(f.push(r[m]),p.push(1)):(f.push(1),p.push(r[m]));return a=cr(a,f),l=cr(l,f),h!=null&&(h=cr(h,p)),d!=null&&(d=cr(d,p)),tm(s,a,l,d,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:At(this.betaInitializer),gammaInitializer:At(this.gammaInitializer),betaRegularizer:ct(this.betaRegularizer),gammaRegularizer:ct(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}m2.className="LayerNormalization";ee(m2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lme(t,e,n){return W(()=>{if(t.rank!==4)throw new V(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new V("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=mi()),n!=="channelsLast"&&n!=="channelsFirst")throw new V(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],Bo(t,s)})}class g2 extends Ue{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?mi():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new V(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new V(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new V(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new Yt({ndim:4})]}computeOutputShape(e){e=Ze(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return W(()=>Lme(Ee(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}g2.className="ZeroPadding2D";ee(g2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ob(t,e,n,s,r,i){return W(()=>{Ht(r),jW(i),Tr(s),n==null&&(n=[1,1]),s==null&&(s="valid"),r==null&&(r=mi()),i==null&&(i="max"),t=M$(t,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=Kg(t,e,n,a):o=zg(t,e,n,a),r==="channelsFirst"&&(o=je(o,[0,3,1,2])),o})}function Fj(t,e,n,s,r,i){return W(()=>{Ht(r),jW(i),Tr(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),r==null&&(r=mi()),i==null&&(i="max"),t=Aj(t,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=Zk(t,e,n,a):o=Ck(t,e,n,a),r==="channelsFirst"&&(o=je(o,[0,4,1,2,3])),o})}class Lj extends Ue{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new V(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(gn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new V(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Tr(this.padding),this.inputSpec=[new Yt({ndim:3})]}computeOutputShape(e){e=Ze(e);const n=li(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return W(()=>{this.invokeCallHook(e,n),e=ay(Ee(e),2);const s=this.poolingFunction(Ee(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return ll(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class y2 extends Lj{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Ht(i),Tr(r),Ob(e,n,s,r,i,"max")}}y2.className="MaxPooling1D";ee(y2);class w2 extends Lj{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Ht(i),Tr(r),Ob(e,n,s,r,i,"avg")}}w2.className="AveragePooling1D";ee(w2);class Mj extends Ue{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new V(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];gn(this.poolSize,"poolSize"),gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Ht(this.dataFormat),Tr(this.padding),this.inputSpec=[new Yt({ndim:4})]}computeOutputShape(e){e=Ze(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=li(n,this.poolSize[0],this.padding,this.strides[0]),s=li(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return W(()=>(this.invokeCallHook(e,n),this.poolingFunction(Ee(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class v2 extends Mj{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Ht(i),Tr(r),Ob(e,n,s,r,i,"max")}}v2.className="MaxPooling2D";ee(v2);class x2 extends Mj{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Ht(i),Tr(r),Ob(e,n,s,r,i,"avg")}}x2.className="AveragePooling2D";ee(x2);class Vj extends Ue{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new V(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];gn(this.poolSize,"poolSize"),gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Ht(this.dataFormat),Tr(this.padding),this.inputSpec=[new Yt({ndim:5})]}computeOutputShape(e){e=Ze(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=li(n,this.poolSize[0],this.padding,this.strides[0]),s=li(s,this.poolSize[1],this.padding,this.strides[1]),r=li(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,r]:[e[0],n,s,r,e[4]]}call(e,n){return W(()=>(this.invokeCallHook(e,n),this.poolingFunction(Ee(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class b2 extends Vj{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Ht(i),Tr(r),Fj(e,n,s,r,i,"max")}}b2.className="MaxPooling3D";ee(b2);class I2 extends Vj{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Ht(i),Tr(r),Fj(e,n,s,r,i,"avg")}}I2.className="AveragePooling3D";ee(I2);class zj extends Ue{constructor(e){super(e),this.inputSpec=[new Yt({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new Oe}}class T2 extends zj{constructor(e){super(e||{})}call(e,n){return W(()=>{const s=Ee(e);return $t(s,1)})}}T2.className="GlobalAveragePooling1D";ee(T2);class S2 extends zj{constructor(e){super(e||{})}call(e,n){return W(()=>{const s=Ee(e);return gr(s,1)})}}S2.className="GlobalMaxPooling1D";ee(S2);class Bj extends Ue{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Ht(this.dataFormat),this.inputSpec=[new Yt({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new Oe}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class _2 extends Bj{call(e,n){return W(()=>{const s=Ee(e);return this.dataFormat==="channelsLast"?$t(s,[1,2]):$t(s,[2,3])})}}_2.className="GlobalAveragePooling2D";ee(_2);class C2 extends Bj{call(e,n){return W(()=>{const s=Ee(e);return this.dataFormat==="channelsLast"?gr(s,[1,2]):gr(s,[2,3])})}}C2.className="GlobalMaxPooling2D";ee(C2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Uj extends Ue{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const r=n.layer,i=ai(r,s);delete n.layer;const o={layer:i};return Object.assign(o,n),new e(o)}}class E2 extends Uj{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Ze(e),e.length<3)throw new V(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Ze(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,n){return W(()=>(e=Ee(e),Oj((o,a)=>[Ee(this.layer.call(o,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}E2.className="TimeDistributed";ee(E2);function Mme(t){Ku(Lfe,"BidirectionalMergeMode",t)}const Vme="concat";class k2 extends Uj{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=ai(s),n.goBackwards=n.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=n,this.backwardLayer=ai(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?Vme:e.mergeMode,Mme(this.mergeMode),e.weights)throw new Oe("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,r,i;return this.returnState&&(i=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):xs(r)}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const i=Dj(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,n);const o=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new V("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,o.push(...s);const c=s.map(h=>new Yt({shape:h.shape}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),a.push(...c)}if(r!=null)throw new Oe("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof gi;for(const u of o)if(u instanceof gi!==l)throw new V("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const d=super.apply(u,n);return this.inputSpec=h,d}else return super.apply(e,n)}call(e,n){return W(()=>{const s=n.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,n),i=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(n,{initialState:u}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=vr(i,1));let a;return this.mergeMode==="concat"?a=d$([r,i]):this.mergeMode==="sum"?a=Y(r,i):this.mergeMode==="ave"?a=P(.5,Y(r,i)):this.mergeMode==="mul"?a=P(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ql(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ql(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=ai(n.layer);if(delete n.layer,n.numConstants!=null)throw new Oe("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=n;return r.layer=s,new e(r)}}k2.className="Bidirectional";ee(k2);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class N2 extends Ue{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return W(()=>(e=Ee(e),e.dtype!=="float32"&&(e=ji(e,"float32")),Y(P(e,this.scale),this.offset)))}}N2.className="Rescaling";ee(N2);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:zme,cropAndResize:Bme}=Or;class $2 extends Ue{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,r,i,o,a,l){return W(()=>{let u,c=!1;const h=n/o,d=s/a,f=(r+n)/o,p=(i+s)/a,m=[h,d,f,p],g=[];e.rank===3?(c=!0,u=fs([e])):u=e;for(let b=0;b<u.shape[0];b++)g.push(m);const y=Xs(g,[g.length,4]),w=wu(0,g.length,1,"int32"),v=Bme(u,y,w,[r,i],"nearest");return ji(c?Ee(xr(v)):v,l)})}upsize(e,n,s,r){return W(()=>{const i=zme(e,[n,s]);return ji(i,r)})}call(e,n){return W(()=>{const s=Ee(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Ze(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}$2.className="CenterCrop";ee($2);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ume(t,e,n,s){let r=Ee(t);if(r.dtype!=="int32"&&(r=ji(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=En(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=En(r,-1)),r.rank>2)throw new V(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=Gw(a,s,n,o):l=Gw(a,[],n,o),e!=="tfIdf")return l;if(s)return P(l,s);throw new V("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class A2 extends Ue{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=Ze(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return W(()=>{e=Ee(e),e.dtype!=="int32"&&(e=ji(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new V(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=Ee(n.countWeights)}const r=gr(e),i=lh(e),o=gs(this.numTokens,r).bufferSync().get(0),a=zo(i,0).bufferSync().get(0);if(!(o&&a))throw new V(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return Ume(e,this.outputMode,this.numTokens,s)})}}A2.className="CategoryEncoding";ee(A2);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Wme=["bilinear","nearest"],OP=new Set(Wme);class R2 extends Ue{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(OP.has(e.interpolation))this.interpolation=e.interpolation;else throw new V(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Ze(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return W(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Or.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Or.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...OP]} are supported`)})}}R2.className="Resizing";ee(R2);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Wj{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}Wj.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class jj extends Ue{constructor(e){super(e),this.randomGenerator=new Wj(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}jj.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jme=["bilinear","nearest"],PP=new Set(jme);class D2 extends jj{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new V(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new V(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new V(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(PP.has(s))this.interpolation=s;else throw new V(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Ze(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return W(()=>{const s=Ee(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=al([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Or.resizeBilinear(e,o);case"nearest":return Or.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...PP]} are supported`)}})}}D2.className="RandomWidth";ee(D2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Gme(t){return new Pd(t)}function Hme(t){return new P$(t)}function qme(t){return new R$(t)}function Kme(t){return new D$(t)}function Xme(t){return new O$(t)}function Qme(t){return new L$(t)}function Yme(t){return new F$(t)}function Jme(t){return new dy(t)}function Zme(t){return new Md(t)}function ege(t){return new V$(t)}function tge(t){return new Vd(t)}function nge(t){return new z$(t)}function sge(t){return new B$(t)}function rge(t){return new U$(t)}function ige(t){return new W$(t)}function oge(t){return new j$(t)}function age(t){return new J$(t)}function lge(t){return new Q$(t)}function uge(t){return new Db(t)}function cge(t){return new X$(t)}function hge(t){return new Y$(t)}function dge(t){return new Z$(t)}function fge(t){return new e2(t)}function pge(t){return new t2(t)}function mge(t){return new s2(t)}function gge(t){return new r2(t)}function yge(t){return new o2(t)}function wge(t){return new u2(t)}function vge(t){return new a2(t)}function xge(t){return new l2(t)}function bge(t){return new i2(t)}function Ige(t){return new c2(t)}function Tge(t){return new p2(t)}function Sge(t){return new m2(t)}function _ge(t){return new g2(t)}function O2(t){return new w2(t)}function Cge(t){return O2(t)}function Ege(t){return O2(t)}function P2(t){return new x2(t)}function kge(t){return P2(t)}function Nge(t){return P2(t)}function F2(t){return new I2(t)}function $ge(t){return F2(t)}function Age(t){return F2(t)}function Rge(t){return new T2(t)}function Dge(t){return new _2(t)}function Gj(t){return new S2(t)}function Hj(t){return new C2(t)}function qj(t){return new y2(t)}function Kj(t){return new v2(t)}function Oge(t){return new b2(t)}function Pge(t){return new H$(t)}function Fge(t){return new $b(t)}function Lge(t){return new q$(t)}function Mge(t){return new py(t)}function Vge(t){return new G$(t)}function zge(t){return new Nb(t)}function Bge(t){return new K$(t)}function Uge(t){return new Rb(t)}function Wge(t){return new Ii(t)}function jge(t){return new Ab(t)}function Gge(t){return new k2(t)}function Hge(t){return new E2(t)}const qge=Gj,Kge=Hj,Xge=qj,Qge=Kj;function Yge(t){return new h2(t)}function Jge(t){return new d2(t)}function Zge(t){return new f2(t)}function eye(t){return new n2(t)}function tye(t){return new N2(t)}function nye(t){return new $2(t)}function sye(t){return new R2(t)}function rye(t){return new A2(t)}function iye(t){return new D2(t)}const oye=Object.freeze(Object.defineProperty({__proto__:null,Layer:Ue,RNN:Ii,RNNCell:fy,activation:age,add:gge,alphaDropout:Zge,average:yge,averagePooling1d:O2,averagePooling2d:P2,averagePooling3d:F2,avgPool1d:Cge,avgPool2d:kge,avgPool3d:$ge,avgPooling1d:Ege,avgPooling2d:Nge,avgPooling3d:Age,batchNormalization:Tge,bidirectional:Gge,categoryEncoding:rye,centerCrop:nye,concatenate:wge,conv1d:Jme,conv2d:Zme,conv2dTranspose:ege,conv3d:tge,conv3dTranspose:nge,convLstm2d:Bge,convLstm2dCell:Uge,cropping2D:rge,dense:lge,depthwiseConv2d:oge,dot:Ige,dropout:uge,elu:Hme,embedding:mge,flatten:hge,gaussianDropout:Jge,gaussianNoise:Yge,globalAveragePooling1d:Rge,globalAveragePooling2d:Dge,globalMaxPool1d:qge,globalMaxPool2d:Kge,globalMaxPooling1d:Gj,globalMaxPooling2d:Hj,gru:Pge,gruCell:Fge,input:gj,inputLayer:Gme,layerNormalization:Sge,leakyReLU:Kme,lstm:Lge,lstmCell:Mge,masking:eye,maxPool1d:Xge,maxPool2d:Qge,maxPooling1d:qj,maxPooling2d:Kj,maxPooling3d:Oge,maximum:vge,minimum:xge,multiply:bge,permute:pge,prelu:Xme,randomWidth:iye,reLU:qme,repeatVector:dge,rescaling:tye,reshape:fge,resizing:sye,rnn:Wge,separableConv2d:sge,simpleRNN:Vge,simpleRNNCell:zge,softmax:Qme,spatialDropout1d:cge,stackedRNNCells:jge,thresholdedReLU:Yme,timeDistributed:Hge,upSampling2d:ige,zeroPadding2d:_ge},Symbol.toStringTag,{value:"Module"}));function aye(t,e){return E$(t,e)}function lye(t,e){return aj(t,e)}function uye(t,e){return lj(t,e)}function cye(t,e){return k$(t,e)}function hye(t,e){return N$(t,e)}function dye(t,e){return oj(t,e)}function fye(t,e){return Gpe(t,e)}function pye(t,e){return C$(t,e)}function mye(t,e){return _b(t,e)}function gye(t,e){return Fd(t,e)}function yye(t,e){return Fd(t,e)}function wye(t,e){return Fd(t,e)}function vye(t,e){return Xu(t,e)}function xye(t,e){return Xu(t,e)}function bye(t,e){return Xu(t,e)}const Iye=Object.freeze(Object.defineProperty({__proto__:null,MAPE:yye,MSE:xye,binaryAccuracy:aye,binaryCrossentropy:lye,categoricalAccuracy:cye,categoricalCrossentropy:hye,cosineProximity:pye,mape:wye,meanAbsoluteError:mye,meanAbsolutePercentageError:gye,meanSquaredError:vye,mse:bye,precision:dye,recall:fye,sparseCategoricalAccuracy:uye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Tye=Object.freeze(Object.defineProperty({__proto__:null,modelFromJSON:xme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sye(t){return new hy(t)}function _ye(t){return Eme(t)}function Cye(t){return kme(t)}const Eye=Object.freeze(Object.defineProperty({__proto__:null,l1:_ye,l1l2:Sye,l2:Cye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Xj extends mh{constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof vo))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}function r0(t,e){return t<e}function FP(t,e){return t>e}class Qj extends Xj{constructor(e){if(super(),e==null&&(e={}),e.restoreBestWeights)throw new Oe("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,["auto","min","max"].indexOf(this.mode)===-1&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.mode==="min"?this.monitorFunc=r0:this.mode==="max"?this.monitorFunc=FP:this.monitor.indexOf("acc")!==-1?this.monitorFunc=FP:this.monitorFunc=r0,this.monitorFunc===r0&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===r0?1/0:-1/0}async onEpochEnd(e,n){await Zo(n);const s=this.getMonitorValue(n);s!=null&&(this.monitorFunc(s-this.minDelta,this.best)?(this.best=s,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(e){e==null&&(e={});const n=e[this.monitor];return n==null&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: ${Object.keys(e)}`),n}}function kye(t){return new Qj(t)}const Nye={earlyStopping:kye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ye=U();$ye.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Ps;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(Ps||(Ps={}));var LP;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(LP||(LP={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L2={};function Aye(t,e){const n={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e};L2[t]=n}function Yj(t){return L2[t]}function Rye(t){delete L2[t]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I(t,e,n,s,r){const i=e.inputParams[t];if(i&&i.inputIndexStart!==void 0){const a=i.inputIndexStart,l=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?a+1:i.inputIndexEnd,u=a<0?e.inputNames.length+a:a;if(i.type==="tensor")return kn(e.inputNames[u],n,s,r);if(i.type==="tensors"){const d=e.inputs.slice(a,l);return e.inputNames.slice(a,l).filter((p,m)=>{var g;return((g=d[m])===null||g===void 0?void 0:g.op)!=="NoOp"}).map(p=>kn(p,n,s,r))}const c=kn(e.inputNames[u],n,s,r),h=c.dataSync();return i.type==="number"?h[0]:mr(c.shape,h)}const o=e.attrParams[t];return o&&o.value}function kn(t,e,n,s){const[r,i]=Ls(t,n);if(s!=null){const a=s.getHashTableHandleByName(r);if(a!=null)return a}const o=n.currentContextIds.find(a=>!!e[nv(r,a)]);return o!==void 0?e[nv(r,o)][i]:void 0}function MP(t,e,n){return e[nv(t,n.currentContextId)]}function ao(t,e){const[n,s,r]=Ls(t,e);return[nv(n,e&&e.currentContextId),s,r]}function nv(t,e){return e?`${t}-${e}`:t}function Ls(t,e){if(t==="")return["",0,void 0];const n=e!=null&&e.parseNodeNameCache!=null;if(n){const i=e.parseNodeNameCache.get(t);if(i!=null)return i}const s=t.split(":");let r;if(s.length===1)r=[t,0,void 0];else{const i=s[0],o=s.length===3?s[1]:void 0,a=Number(s[s.length-1]);r=[i,a,o]}return n&&e.parseNodeNameCache.set(t,r),r}function P0(t,e,n){let s=I("pad",t,e,n);if(s==="explicit"){s=I("explicitPaddings",t,e,n);const r=[[0,0],[0,0],[0,0],[0,0]];for(let i=0;i<4;i++)r[i][0]=s[i*2],r[i][1]=s[i*2+1];return r}return s}function lo(t){return t.kept?t:Ui(t)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dye=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Oye=Object.freeze(Object.defineProperty({__proto__:null,json:Dye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pye=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Fye=Object.freeze(Object.defineProperty({__proto__:null,json:Pye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lye=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],Mye=Object.freeze(Object.defineProperty({__proto__:null,json:Lye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vye=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],zye=Object.freeze(Object.defineProperty({__proto__:null,json:Vye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bye=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],Uye=Object.freeze(Object.defineProperty({__proto__:null,json:Bye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wye=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],jye=Object.freeze(Object.defineProperty({__proto__:null,json:Wye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gye=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],Hye=Object.freeze(Object.defineProperty({__proto__:null,json:Gye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qye=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Kye=Object.freeze(Object.defineProperty({__proto__:null,json:qye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xye=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Qye=Object.freeze(Object.defineProperty({__proto__:null,json:Xye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yye=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Jye=Object.freeze(Object.defineProperty({__proto__:null,json:Yye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zye=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],e0e=Object.freeze(Object.defineProperty({__proto__:null,json:Zye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t0e=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],n0e=Object.freeze(Object.defineProperty({__proto__:null,json:t0e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s0e=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],r0e=Object.freeze(Object.defineProperty({__proto__:null,json:s0e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i0e=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],o0e=Object.freeze(Object.defineProperty({__proto__:null,json:i0e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a0e=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],l0e=Object.freeze(Object.defineProperty({__proto__:null,json:a0e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u0e=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],c0e=Object.freeze(Object.defineProperty({__proto__:null,json:u0e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h0e=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],d0e=Object.freeze(Object.defineProperty({__proto__:null,json:h0e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f0e=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],p0e=Object.freeze(Object.defineProperty({__proto__:null,json:f0e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m0e=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],g0e=Object.freeze(Object.defineProperty({__proto__:null,json:m0e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VP{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[Oye,Fye,Mye,zye,Uye,jye,Hye,Kye,Qye,Jye,e0e,n0e,r0e,o0e,l0e,c0e,d0e,p0e,g0e],n=[].concat(...e.map(s=>s.json));this.opMappers=n.reduce((s,r)=>(s[r.tfOpName]=r,s),{})}transformGraph(e,n={}){const s=e.node,r=[],i=[],o=[],a=s.reduce((m,g)=>(m[g.name]=this.mapNode(g),g.op.startsWith("Placeholder")?r.push(m[g.name]):g.op==="Const"?i.push(m[g.name]):(g.input==null||g.input.length===0)&&o.push(m[g.name]),m),{});let l=[];const u=[];let c={},h={};n!=null&&(c=this.mapSignatureEntries(n.inputs),h=this.mapSignatureEntries(n.outputs));const d=Object.keys(a);d.forEach(m=>{const g=a[m];g.inputNames.forEach((y,w)=>{const[x,,v]=ao(y),b=a[x];if(b.outputs!=null){const S=b.outputs.indexOf(v);if(S!==-1){const T=`${x}:${S}`;g.inputNames[w]=T}}g.inputs.push(b),b.children.push(g)})}),Object.keys(h).length===0?d.forEach(m=>{const g=a[m];g.children.length===0&&u.push(g)}):Object.keys(h).forEach(m=>{const[g]=ao(m),y=a[g];y!=null&&(y.signatureKey=h[m],u.push(y))}),Object.keys(c).length>0?Object.keys(c).forEach(m=>{const[g]=ao(m),y=a[g];y&&(y.signatureKey=c[m],l.push(y))}):l=r;let f={};e.library!=null&&e.library.function!=null&&(f=e.library.function.reduce((m,g)=>(m[g.signature.name]=this.mapFunction(g),m),{}));const p={nodes:a,inputs:l,outputs:u,weights:i,placeholders:r,signature:n,functions:f};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(e){return Object.keys(e||{}).reduce((n,s)=>(n[e[s].name]=s,n),{})}mapNode(e){const n=Yj(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:n.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:n.outputs};return n.inputs!=null&&(s.inputParams=n.inputs.reduce((r,i)=>(r[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},r),{})),n.attrs!=null&&(s.attrParams=n.attrs.reduce((r,i)=>{const o=i.type;let a;switch(i.type){case"string":a=h_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=h_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":a=w_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=w_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":a=f_(e.attr,i.tfName,i.defaultValue||0),a===void 0&&i.tfDeprecatedName&&(a=f_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":a=y_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=y_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":a=d_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=d_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":a=x_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=x_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":a=g_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=g_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":a=v_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=v_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":a=p_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=p_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":a=m_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=m_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":a=zP(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=zP(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${i.type} for op: ${e.op}`)}return r[i.name]={value:a,type:o},r},{})),s}mapFunction(e){const n=e.nodeDef,s=[],r=[];let i={};n!=null&&(i=n.reduce((h,d)=>(h[d.name]=this.mapNode(d),d.op==="Const"&&r.push(h[d.name]),h),{}));const o=[],a=[];e.signature.inputArg.forEach(h=>{const[d]=ao(h.name),f={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:M2(h.type),type:"dtype"}},children:[]};f.signatureKey=h.name,o.push(f),i[d]=f}),Object.keys(i).forEach(h=>{const d=i[h];d.inputNames.forEach((f,p)=>{const[m,,g]=ao(f),y=i[m];if(y.outputs!=null){const w=y.outputs.indexOf(g);if(w!==-1){const x=`${m}:${w}`;d.inputNames[p]=x}}d.inputs.push(y),y.children.push(d)})});const u=e.ret;e.signature.outputArg.forEach(h=>{const[d,f]=ao(u[h.name]),p=i[d];p!=null&&(p.defaultOutput=f,a.push(p))});const c=this.mapArgsToSignature(e);return{nodes:i,inputs:o,outputs:a,weights:r,placeholders:s,signature:c}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s),n),{}),outputs:e.signature.outputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s,e.ret),n),{})}}mapArgToTensorInfo(e,n){let s=e.name;return n!=null&&(s=n[s]),{name:s,dtype:e.type}}}function y0e(t){const e=U().global;if(typeof e.atob<"u")return e.atob(t);if(typeof Buffer<"u")return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function Jj(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):y0e(t);return e?n:n.toLowerCase()}function h_(t,e,n,s=!1){const r=t[e];return r!=null?Jj(r.s,s):n}function d_(t,e,n){const s=t[e];return s?s.b:n}function f_(t,e,n){const s=t[e]||{},r=s.i!=null?s.i:s.f!=null?s.f:n;return typeof r=="number"?r:parseInt(r,10)}function M2(t){switch(typeof t=="string"&&(t=Ps[t]),t){case Ps.DT_FLOAT:case Ps.DT_HALF:return"float32";case Ps.DT_INT32:case Ps.DT_INT64:case Ps.DT_INT8:case Ps.DT_UINT8:return"int32";case Ps.DT_BOOL:return"bool";case Ps.DT_DOUBLE:return"float32";case Ps.DT_STRING:return"string";case Ps.DT_COMPLEX64:case Ps.DT_COMPLEX128:return"complex64";default:return null}}function zP(t,e,n){const s=t[e];return s&&s.func?s.func.name:n}function p_(t,e,n){const s=t[e];return s&&s.type?M2(s.type):n}function m_(t,e,n){const s=t[e];return s&&s.list&&s.list.type?s.list.type.map(r=>M2(r)):n}function Zj(t){if(!t.unknownRank)return t.dim!=null?t.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function g_(t,e,n){const s=t[e];return s&&s.shape?Zj(s.shape):n}function y_(t,e,n){const s=t[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(r=>typeof r=="number"?r:parseInt(r,10)):n}function w_(t,e,n,s=!1){const r=t[e];return r&&r.list&&r.list.s?r.list.s.map(i=>Jj(i,s)):n}function v_(t,e,n){const s=t[e];return s&&s.list&&s.list.shape?s.list.shape.map(r=>Zj(r)):n}function x_(t,e,n){const s=t[e];return s&&s.list&&s.list.b?s.list.b:n}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w0e{constructor(e,n,s){this.node=e,this.tensorMap=n,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,i)=>(r[i]=this.getAttr(i),r),{}))}getInput(e){return kn(e,this.tensorMap,this.context)}getAttr(e,n){const s=this.node.rawAttrs[e];if(s.tensor!=null)return kn(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return f_(this.node.rawAttrs,e,n);if(s.s!=null)return h_(this.node.rawAttrs,e,n);if(s.b!=null)return d_(this.node.rawAttrs,e,n);if(s.shape!=null)return g_(this.node.rawAttrs,e,n);if(s.type!=null)return p_(this.node.rawAttrs,e,n);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return y_(this.node.rawAttrs,e,n);if(s.list.s!=null)return w_(this.node.rawAttrs,e,n);if(s.list.shape!=null)return v_(this.node.rawAttrs,e,n);if(s.list.b!=null)return x_(this.node.rawAttrs,e,n);if(s.list.type!=null)return m_(this.node.rawAttrs,e,n)}return n}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bn=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:uk,abs:Kt,acos:yk,acosh:wk,add:Y,addN:B4,all:N1,any:Xp,argMax:fu,argMin:vk,asin:xk,asinh:bk,atan:Ik,atan2:Tk,atanh:Sk,avgPool:zg,avgPool3d:Ck,basicLSTMCell:U4,batchNorm:kd,batchNorm2d:Ek,batchNorm3d:kk,batchNorm4d:Nk,batchToSpaceND:Bg,bincount:$k,bitwiseAnd:W4,booleanMaskAsync:kU,broadcastArgs:j4,broadcastTo:Hl,buffer:Fe,cast:re,ceil:Ak,clipByValue:Es,clone:Ui,complex:$o,concat:Bt,concat1d:Rk,concat2d:Dk,concat3d:Ok,concat4d:Pk,conv1d:$1,conv2d:Ao,conv2dTranspose:A1,conv3d:Lk,conv3dTranspose:Mk,cos:Ug,cosh:R1,cosineWindow:tb,cumprod:Jp,cumsum:D1,denseBincount:Gw,depthToSpace:Vk,depthwiseConv2d:Nd,diag:H4,dilation2d:zk,div:be,divNoNan:Bk,dot:Uk,dropout:SN,einsum:Il,elu:$d,enclosingPowerOfTwo:_N,ensureShape:q4,equal:Qs,erf:Wk,euclideanNorm:Gk,exp:ks,expandDims:En,expm1:Hk,eye:O1,fft:ty,fill:Wu,floor:Rd,floorDiv:k1,fused:LU,gather:Dd,gatherND:RU,greater:gs,greaterEqual:zo,ifft:fh,imag:Wg,image:Or,inTopKAsync:DU,irfft:X1,isFinite:qk,isInf:Kk,isNaN:Xk,leakyRelu:jg,less:uh,lessEqual:ol,linalg:kN,linspace:Q4,localResponseNormalization:Qk,log:Ys,log1p:Gg,logSigmoid:Yk,logSoftmax:F1,logSumExp:Hg,logicalAnd:zr,logicalNot:qg,logicalOr:L1,logicalXor:Jk,losses:jU,lowerBound:J4,matMul:ze,max:gr,maxPool:Kg,maxPool3d:Zk,maxPoolWithArgmax:Z4,maximum:Ji,mean:$t,meshgrid:eU,min:lh,minimum:Ba,mirrorPad:eN,mod:tN,moments:Xg,movingAverage:NU,mul:P,multiRNNCell:tU,multinomial:nU,neg:pt,norm:Ad,notEqual:yu,oneHot:ch,ones:Is,onesLike:Js,op:O,outerProduct:sU,pad:Bo,pad1d:rU,pad2d:iU,pad3d:oU,pad4d:aU,pool:nN,pow:Ro,prelu:Yg,print:gk,prod:sN,raggedGather:lU,raggedRange:uU,raggedTensorToTensor:cU,rand:hU,randomGamma:mU,randomNormal:z1,randomStandardNormal:gU,randomUniform:al,randomUniformInt:yU,range:wu,real:hh,reciprocal:pN,relu:xi,relu6:B1,reshape:L,reverse:vr,reverse1d:wU,reverse2d:vU,reverse3d:xU,reverse4d:bU,rfft:ny,round:U1,rsqrt:W1,scalar:Te,scatterND:$U,searchSorted:M1,selu:j1,separableConv2d:G1,setdiff1dAsync:IU,sigmoid:oi,sign:mN,signal:WU,sin:H1,sinh:q1,slice:Ge,slice1d:Jg,slice2d:K1,slice3d:Zg,slice4d:dh,softmax:ey,softplus:ju,spaceToBatchND:Qg,sparse:GU,sparseToDense:AU,spectral:UU,split:Ss,sqrt:Pn,square:ot,squaredDifference:Q1,squeeze:ll,stack:fs,step:Hu,stridedSlice:gN,string:HU,sub:pe,sum:ge,tan:yN,tanh:mu,tensor:Xs,tensor1d:$n,tensor2d:Na,tensor3d:wN,tensor4d:TU,tensor5d:SU,tensor6d:_U,tensorScatterUpdate:CU,tile:cr,topk:xN,transpose:je,truncatedNormal:J1,unique:bN,unsortedSegmentSum:Z1,unstack:xr,upperBound:EU,variable:IN,where:wn,whereAsync:TN,zeros:Qt,zerosLike:He},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v0e=(t,e,n,s=Bn)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[s.add(I("a",t,e,n),I("b",t,e,n))];case"AddN":return[s.addN(I("tensors",t,e,n))];case"FloorMod":case"Mod":return[s.mod(I("a",t,e,n),I("b",t,e,n))];case"Mul":return[s.mul(I("a",t,e,n),I("b",t,e,n))];case"RealDiv":case"Div":return[s.div(I("a",t,e,n),I("b",t,e,n))];case"DivNoNan":return[s.divNoNan(I("a",t,e,n),I("b",t,e,n))];case"FloorDiv":return[s.floorDiv(I("a",t,e,n),I("b",t,e,n))];case"Sub":return[s.sub(I("a",t,e,n),I("b",t,e,n))];case"Minimum":return[s.minimum(I("a",t,e,n),I("b",t,e,n))];case"Maximum":return[s.maximum(I("a",t,e,n),I("b",t,e,n))];case"Pow":return[s.pow(I("a",t,e,n),I("b",t,e,n))];case"SquaredDifference":return[s.squaredDifference(I("a",t,e,n),I("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x0e=(t,e,n,s=Bn)=>{switch(t.op){case"Abs":case"ComplexAbs":return[s.abs(I("x",t,e,n))];case"Acos":return[s.acos(I("x",t,e,n))];case"Acosh":return[s.acosh(I("x",t,e,n))];case"Asin":return[s.asin(I("x",t,e,n))];case"Asinh":return[s.asinh(I("x",t,e,n))];case"Atan":return[s.atan(I("x",t,e,n))];case"Atan2":return[s.atan2(I("x",t,e,n),I("y",t,e,n))];case"Atanh":return[s.atanh(I("x",t,e,n))];case"Ceil":return[s.ceil(I("x",t,e,n))];case"Complex":return[s.complex(I("real",t,e,n),I("imag",t,e,n))];case"Cos":return[s.cos(I("x",t,e,n))];case"Cosh":return[s.cosh(I("x",t,e,n))];case"Elu":return[s.elu(I("x",t,e,n))];case"Erf":return[s.erf(I("x",t,e,n))];case"Exp":return[s.exp(I("x",t,e,n))];case"Expm1":return[s.expm1(I("x",t,e,n))];case"Floor":return[s.floor(I("x",t,e,n))];case"Log":return[s.log(I("x",t,e,n))];case"Log1p":return[s.log1p(I("x",t,e,n))];case"Imag":return[s.imag(I("x",t,e,n))];case"Neg":return[s.neg(I("x",t,e,n))];case"Reciprocal":return[s.reciprocal(I("x",t,e,n))];case"Real":return[s.real(I("x",t,e,n))];case"Relu":return[s.relu(I("x",t,e,n))];case"Round":return[s.round(I("x",t,e,n))];case"Selu":return[s.selu(I("x",t,e,n))];case"Sigmoid":return[s.sigmoid(I("x",t,e,n))];case"Sin":return[s.sin(I("x",t,e,n))];case"Sign":return[s.sign(I("x",t,e,n))];case"Sinh":return[s.sinh(I("x",t,e,n))];case"Softplus":return[s.softplus(I("x",t,e,n))];case"Sqrt":return[s.sqrt(I("x",t,e,n))];case"Square":return[s.square(I("x",t,e,n))];case"Tanh":return[s.tanh(I("x",t,e,n))];case"Tan":return[s.tan(I("x",t,e,n))];case"ClipByValue":return[s.clipByValue(I("x",t,e,n),I("clipValueMin",t,e,n),I("clipValueMax",t,e,n))];case"Relu6":return[s.relu6(I("x",t,e,n))];case"Rsqrt":return[s.rsqrt(kn(t.inputNames[0],e,n))];case"LeakyRelu":return[s.leakyRelu(I("x",t,e,n),I("alpha",t,e,n))];case"Prelu":return[s.prelu(I("x",t,e,n),I("alpha",t,e,n))];case"IsNan":return[s.isNaN(kn(t.inputNames[0],e,n))];case"IsInf":return[s.isInf(kn(t.inputNames[0],e,n))];case"IsFinite":return[s.isFinite(kn(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cr(t,e,n=""){if(!(typeof t=="number"||typeof e=="number")){C(t.length===e.length,()=>n+` Shapes ${t} and ${e} must match`);for(let s=0;s<t.length;s++){const r=t[s],i=e[s];C(r<0||i<0||r===i,()=>n+` Shapes ${t} and ${e} must match`)}}}function BP(t){return!(typeof t=="number"||t.some(e=>e<0))}function ff(t,e,n){let s=b_(t,n);const r=!BP(s);if(r&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(r&&e.forEach(i=>{s=b_(i.shape,s)}),!BP(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function b_(t,e){if(typeof t=="number")return e;if(typeof e=="number")return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let s=0;s<t.length;++s){const r=t[s],i=e[s];if(r>=0&&i>=0&&r!==i)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[s]=r>=0?r:i}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b0e{constructor(e,n,s,r,i,o,a){this.name=e,this.dtype=n,this.maxSize=s,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=Te(0),on(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.tensor.id))&&n.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const n=this.tensors[e];if(n.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(n.cleared=!0),n.read=!0,n.tensor}readMany(e){return e.map(n=>this.read(n))}write(e,n){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(n.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${n.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=n.shape),Cr(this.elementShape,n.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=n,on(n),s.written=!0,this.tensors[e]=s}writeMany(e,n){if(e.length!==n.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${n.length}.`);e.forEach((s,r)=>this.write(s,n[r]))}gather(e,n){if(n&&n!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${n}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return Xs([],[0].concat(this.elementShape));const s=this.readMany(e);return Cr(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),fs(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return Xs([],[0].concat(this.elementShape));const n=[];for(let r=0;r<this.size();r++)n.push(r);const s=this.readMany(n);return Cr(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),Bt(s,0)}scatter(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,xr(n,0))}split(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);let s=0;const r=e.map(l=>(s+=l,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const i=s===0?0:n.size/s,o=[];W(()=>{n=L(n,[1,s,i]);for(let l=0;l<e.length;++l){const c=[0,l===0?0:r[l-1],0],h=[1,e[l],i];o[l]=L(Ge(n,c,h),this.elementShape)}return o});const a=[];for(let l=0;l<e.length;l++)a[l]=l;this.writeMany(a,o)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iu{get id(){return this.idTensor.id}constructor(e,n,s,r=-1){this.tensors=e,this.elementShape=n,this.elementDtype=s,e!=null&&e.forEach(i=>{if(s!==i.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${i.dtype}`);Cr(n,i.shape,"TensorList shape mismatch: "),on(i)}),this.idTensor=Te(0),this.maxNumElements=r,on(this.idTensor)}copy(){return new Iu([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,n,s=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);Cr(e,this.elementShape,"TensorList shape mismatch: ");const r=ff(this.elementShape,this.tensors,e);return W(()=>{const i=this.tensors.map(o=>L(o,r));return fs(i,0)})}popBack(e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=ff(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,Cr(r.shape,e,"TensorList shape mismatch: "),L(r,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(Cr(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");on(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const n=new Iu([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)n.tensors[s]=this.tensors[s];return n}getItem(e,n,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);Cr(this.tensors[e].shape,n,"TensorList shape mismatch: ");const r=ff(this.elementShape,this.tensors,n);return L(this.tensors[e],r)}setItem(e,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);Cr(this.elementShape,n.shape,"TensorList shape mismatch: "),on(n),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=n}gather(e,n,s){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);Cr(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=ff(this.elementShape,this.tensors,s);return e.length===0?Xs([],[0].concat(r)):W(()=>{const i=e.map(o=>L(this.tensors[o],r));return fs(i,0)})}concat(e,n){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);Cr(this.elementShape,n,"TensorList shape mismatch: ");const s=ff(this.elementShape,this.tensors,n);return this.size()===0?Xs([],[0].concat(s)):W(()=>{const r=this.tensors.map(i=>L(i,s));return Bt(r,0)})}}function I0e(t,e,n){const s=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);const r=t.shape.slice(1);Cr(r,e,"TensorList shape mismatch: ");const i=xr(t);return new Iu(i,e,s)}function T0e(t,e,n,s){return new Iu([],t,e,s)}function S0e(t,e,n,s){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const r=Math.max(...e);if(s!=null&&s!==-1&&r>=s)throw new Error(`Max index must be < array size (${r}  vs. ${s})`);const i=new Iu([],n,t.dtype,s),o=xr(t,0);return e.forEach((a,l)=>{i.setItem(a,o[l])}),i}function _0e(t,e,n){let s=0;const r=e.map(c=>(s+=c,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);const i=t.shape.slice(1),o=b_(i,n),a=s===0?0:t.size/s,l=W(()=>{const c=[];t=L(t,[1,s,a]);for(let h=0;h<e.length;++h){const f=[0,h===0?0:r[h-1],0],p=[1,e[h],a];c[h]=L(Ge(t,f,p),o)}return t.dispose(),c}),u=new Iu([],n,t.dtype,e.length);for(let c=0;c<l.length;c++)u.setItem(c,l[c]);return u}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C0e=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const s=I("thenBranch",t,e,n),r=I("elseBranch",t,e,n),i=I("cond",t,e,n),o=I("args",t,e,n);return(await i.data())[0]?n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const s=I("body",t,e,n),r=I("cond",t,e,n),i=I("args",t,e,n),o=await n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap),a=i.map(c=>c.id);let l=await o[0].data();o.forEach(c=>{!c.kept&&a.indexOf(c.id)===-1&&c.dispose()});let u=i;for(;l[0];){const c=u;u=await n.functionMap[s].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);const h=u.map(f=>f.id);c.forEach(f=>{!f.kept&&a.indexOf(f.id)===-1&&h.indexOf(f.id)===-1&&f.dispose()});const d=await n.functionMap[r].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);l=await d[0].data(),d.forEach(f=>{!f.kept&&a.indexOf(f.id)===-1&&h.indexOf(f.id)===-1&&f.dispose()})}return u}case"LoopCond":{const s=I("pred",t,e,n);return[lo(s)]}case"Switch":{const s=I("pred",t,e,n);let r=I("data",t,e,n);return r.kept||(r=lo(r)),(await s.data())[0]?[void 0,r]:[r,void 0]}case"Merge":{const s=t.inputNames.find(r=>kn(r,e,n)!==void 0);if(s){const r=kn(s,e,n);return[lo(r)]}return}case"Enter":{const s=I("frameName",t,e,n),r=I("tensor",t,e,n);return n.enterFrame(s),[lo(r)]}case"Exit":{const s=I("tensor",t,e,n);return n.exitFrame(),[lo(s)]}case"NextIteration":{const s=I("tensor",t,e,n);return n.nextIteration(),[lo(s)]}case"TensorArrayV3":{const s=I("size",t,e,n),r=I("dtype",t,e,n),i=I("elementShape",t,e,n),o=I("dynamicSize",t,e,n),a=I("clearAfterRead",t,e,n),l=I("identicalElementShapes",t,e,n),u=I("name",t,e,n),c=new b0e(u,r,s,i,l,o,a);return n.addTensorArray(c),[c.idTensor,Te(1)]}case"TensorArrayWriteV3":{const s=I("tensorArrayId",t,e,n),r=I("index",t,e,n),i=I("tensor",t,e,n),o=n.getTensorArray(s.id);return o.write(r,i),[o.idTensor]}case"TensorArrayReadV3":{const s=I("tensorArrayId",t,e,n),r=I("index",t,e,n);return[n.getTensorArray(s.id).read(r)]}case"TensorArrayGatherV3":{const s=I("tensorArrayId",t,e,n),r=I("indices",t,e,n),i=I("dtype",t,e,n);return[n.getTensorArray(s.id).gather(r,i)]}case"TensorArrayScatterV3":{const s=I("tensorArrayId",t,e,n),r=I("indices",t,e,n),i=I("tensor",t,e,n),o=n.getTensorArray(s.id);return o.scatter(r,i),[o.idTensor]}case"TensorArrayConcatV3":{const s=I("tensorArrayId",t,e,n),r=n.getTensorArray(s.id),i=I("dtype",t,e,n);return[r.concat(i)]}case"TensorArraySplitV3":{const s=I("tensorArrayId",t,e,n),r=I("tensor",t,e,n),i=I("lengths",t,e,n),o=n.getTensorArray(s.id);return o.split(i,r),[o.idTensor]}case"TensorArraySizeV3":{const s=I("tensorArrayId",t,e,n),r=n.getTensorArray(s.id);return[Te(r.size(),"int32")]}case"TensorArrayCloseV3":{const s=I("tensorArrayId",t,e,n),r=n.getTensorArray(s.id);return r.clearAndClose(),[r.idTensor]}case"TensorListSetItem":{const s=I("tensorListId",t,e,n),r=I("index",t,e,n),i=I("tensor",t,e,n),o=n.getTensorList(s.id);return o.setItem(r,i),[o.idTensor]}case"TensorListGetItem":{const s=I("tensorListId",t,e,n),r=I("index",t,e,n),i=I("elementShape",t,e,n),o=I("elementDType",t,e,n);return[n.getTensorList(s.id).getItem(r,i,o)]}case"TensorListScatterV2":case"TensorListScatter":{const s=I("indices",t,e,n),r=I("tensor",t,e,n),i=I("elementShape",t,e,n),o=I("numElements",t,e,n),a=S0e(r,s,i,o);return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=I("elementShape",t,e,n),r=I("elementDType",t,e,n);let i;t.op==="TensorListReserve"?i="numElements":i="maxNumElements";const o=I(i,t,e,n),a=t.op==="TensorListReserve"?-1:o,l=T0e(s,r,o,a);return n.addTensorList(l),[l.idTensor]}case"TensorListGather":{const s=I("tensorListId",t,e,n),r=I("indices",t,e,n),i=I("elementShape",t,e,n),o=I("elementDType",t,e,n);return[n.getTensorList(s.id).gather(r,o,i)]}case"TensorListStack":{const s=I("tensorListId",t,e,n),r=I("elementShape",t,e,n),i=I("elementDType",t,e,n),o=I("numElements",t,e,n);return[n.getTensorList(s.id).stack(r,i,o)]}case"TensorListFromTensor":{const s=I("tensor",t,e,n),r=I("elementShape",t,e,n),i=I("elementDType",t,e,n),o=I0e(s,r,i);return n.addTensorList(o),[o.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=I("tensorListId",t,e,n),r=n.getTensorList(s.id),i=I("dtype",t,e,n),o=I("elementShape",t,e,n);return[r.concat(i,o)]}case"TensorListPushBack":{const s=I("tensorListId",t,e,n),r=I("tensor",t,e,n),i=n.getTensorList(s.id);return i.pushBack(r),[i.idTensor]}case"TensorListPopBack":{const s=I("tensorListId",t,e,n),r=I("elementShape",t,e,n),i=I("elementDType",t,e,n);return[n.getTensorList(s.id).popBack(r,i)]}case"TensorListSplit":{const s=I("tensor",t,e,n),r=I("elementShape",t,e,n),i=I("lengths",t,e,n),o=_0e(s,i,r);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const s=I("tensorListId",t,e,n),r=n.getTensorList(s.id);return[Te(r.size(),"int32")]}case"TensorListResize":{const s=I("tensorListId",t,e,n),r=I("size",t,e,n),o=n.getTensorList(s.id).resize(r);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UP(t,e,n){const[s,r]=I("fusedOps",t,e,n),i=s==="biasadd",o=!i,a=r==="prelu",l=s==="fusedbatchnorm",u=I("numArgs",t,e,n);if(i){if(a&&u!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&i&&u!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const c=I("strides",t,e,n),h=P0(t,e,n),d=I("dataFormat",t,e,n).toUpperCase(),f=I("dilations",t,e,n);let[p,m]=I("args",t,e,n);o&&(m=p,p=void 0);const g=I("leakyreluAlpha",t,e,n);return{stride:c,pad:h,dataFormat:d,dilations:f,biasArg:p,preluArg:m,activationFunc:r,leakyreluAlpha:g}}const E0e=(t,e,n,s=Bn)=>{switch(t.op){case"Conv1D":{const r=I("stride",t,e,n),i=I("pad",t,e,n),o=I("dataFormat",t,e,n).toUpperCase(),a=I("dilation",t,e,n);return[s.conv1d(I("x",t,e,n),I("filter",t,e,n),r,i,o,a)]}case"Conv2D":{const r=I("strides",t,e,n),i=P0(t,e,n),o=I("dataFormat",t,e,n).toUpperCase(),a=I("dilations",t,e,n);return[s.conv2d(I("x",t,e,n),I("filter",t,e,n),[r[1],r[2]],i,o,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:u,activationFunc:c,leakyreluAlpha:h}=UP(t,e,n);return[s.fused.conv2d({x:I("x",t,e,n),filter:I("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:c,preluActivationWeights:u,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:u,activationFunc:c,leakyreluAlpha:h}=UP(t,e,n);return[s.fused.depthwiseConv2d({x:I("x",t,e,n),filter:I("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:c,preluActivationWeights:u,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=I("outputShape",t,e,n),i=I("strides",t,e,n),o=P0(t,e,n);return[s.conv2dTranspose(I("x",t,e,n),I("filter",t,e,n),r,[i[1],i[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=I("strides",t,e,n),i=P0(t,e,n),o=I("dilations",t,e,n),a=I("dataFormat",t,e,n).toUpperCase();return[s.depthwiseConv2d(I("input",t,e,n),I("filter",t,e,n),[r[1],r[2]],i,a,[o[1],o[2]])]}case"Conv3D":{const r=I("strides",t,e,n),i=I("pad",t,e,n),o=I("dataFormat",t,e,n).toUpperCase(),a=I("dilations",t,e,n);return[s.conv3d(I("x",t,e,n),I("filter",t,e,n),[r[1],r[2],r[3]],i,o,[a[1],a[2],a[3]])]}case"AvgPool":{const r=I("strides",t,e,n),i=I("pad",t,e,n),o=I("kernelSize",t,e,n);return[s.avgPool(I("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=I("strides",t,e,n),i=I("pad",t,e,n),o=I("kernelSize",t,e,n);return[s.maxPool(I("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=I("strides",t,e,n),i=I("pad",t,e,n),o=I("kernelSize",t,e,n),a=I("includeBatchInIndex",t,e,n),{result:l,indexes:u}=s.maxPoolWithArgmax(I("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i,a);return[l,u]}case"AvgPool3D":{const r=I("strides",t,e,n),i=I("pad",t,e,n),o=I("kernelSize",t,e,n);return[s.avgPool3d(I("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=I("strides",t,e,n),i=I("pad",t,e,n),o=I("kernelSize",t,e,n);return[s.maxPool3d(I("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=I("strides",t,e,n),i=I("pad",t,e,n),o=I("dilations",t,e,n),a=r[1],l=r[2],u=o[1],c=o[2];return[s.dilation2d(I("x",t,e,n),I("filter",t,e,n),[a,l],i,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k0e=(t,e,n,s=Bn)=>{switch(t.op){case"Fill":{const r=I("shape",t,e,n),i=I("dtype",t,e,n),o=I("value",t,e,n);return[s.fill(r,o,i)]}case"LinSpace":{const r=I("start",t,e,n),i=I("stop",t,e,n),o=I("num",t,e,n);return[s.linspace(r,i,o)]}case"Multinomial":{const r=I("logits",t,e,n),i=I("numSamples",t,e,n),o=I("seed",t,e,n);return[s.multinomial(r,i,o)]}case"OneHot":{const r=I("indices",t,e,n),i=I("depth",t,e,n),o=I("onValue",t,e,n),a=I("offValue",t,e,n),l=I("dtype",t,e,n);return[s.oneHot(r,i,o,a,l)]}case"Ones":return[s.ones(I("shape",t,e,n),I("dtype",t,e,n))];case"OnesLike":return[s.onesLike(I("x",t,e,n))];case"RandomStandardNormal":return[s.randomStandardNormal(I("shape",t,e,n),I("dtype",t,e,n),I("seed",t,e,n))];case"RandomUniform":return[s.randomUniform(I("shape",t,e,n),I("minval",t,e,n),I("maxval",t,e,n),I("dtype",t,e,n))];case"RandomUniformInt":return[s.randomUniformInt(I("shape",t,e,n),I("minval",t,e,n),I("maxval",t,e,n),I("seed",t,e,n))];case"Range":{const r=I("start",t,e,n),i=I("stop",t,e,n),o=I("step",t,e,n);return[s.range(r,i,o,I("dtype",t,e,n))]}case"TruncatedNormal":{const r=I("shape",t,e,n),i=I("mean",t,e,n),o=I("stdDev",t,e,n),a=I("seed",t,e,n);return[s.truncatedNormal(r,i,o,I("dtype",t,e,n),a)]}case"Zeros":return[s.zeros(I("shape",t,e,n),I("dtype",t,e,n))];case"ZerosLike":return[s.zerosLike(I("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eT(t,e,n){const s=I("boxes",t,e,n),r=I("scores",t,e,n),i=I("maxOutputSize",t,e,n),o=I("iouThreshold",t,e,n),a=I("scoreThreshold",t,e,n),l=I("softNmsSigma",t,e,n);return{boxes:s,scores:r,maxOutputSize:i,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}}const N0e=async(t,e,n,s,r=Bn)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u,softNmsSigma:c}=eT(t,e,n),h=await r.image.nonMaxSuppressionWithScoreAsync(i,o,a,l,u,c);return[h.selectedIndices,h.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=eT(t,e,n),c=I("padToMaxOutputSize",t,e,n),h=await r.image.nonMaxSuppressionPaddedAsync(i,o,a,l,u,c);return[h.selectedIndices,h.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=eT(t,e,n);return[await r.image.nonMaxSuppressionAsync(i,o,a,l,u)]}case"Where":{const i=r.cast(I("condition",t,e,n),"bool"),o=[await r.whereAsync(i)];return i.dispose(),o}case"ListDiff":return r.setdiff1dAsync(I("x",t,e,n),I("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $0e=(t,e,n,s=Bn)=>{switch(t.op){case"LowerBound":{const r=I("sortedSequence",t,e,n),i=I("values",t,e,n);return[s.lowerBound(r,i)]}case"TopKV2":{const r=I("x",t,e,n),i=I("k",t,e,n),o=I("sorted",t,e,n),a=s.topk(r,i,o);return[a.values,a.indices]}case"UpperBound":{const r=I("sortedSequence",t,e,n),i=I("values",t,e,n);return[s.upperBound(r,i)]}case"Unique":{const r=I("x",t,e,n),i=s.unique(r);return[i.values,i.indices]}case"UniqueV2":{const r=I("x",t,e,n),i=I("axis",t,e,n),o=s.unique(r,i);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A0e=(t,e,n,s=Bn)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=I("default",t,e,n);return[kn(t.name,e,n)||r];case"Placeholder":return[kn(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const c=I("x",t,e,n);return[lo(c)]}case"IdentityN":return I("x",t,e,n).map(c=>lo(c));case"Snapshot":const i=I("x",t,e,n);return[lo(i)];case"Shape":return[s.tensor1d(I("x",t,e,n).shape,"int32")];case"ShapeN":return I("x",t,e,n).map(c=>s.tensor1d(c.shape));case"Size":return[s.scalar(I("x",t,e,n).size,"int32")];case"Rank":return[s.scalar(I("x",t,e,n).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const o=I("x",t,e,n),a=I("data",t,e,n),l=I("message",t,e,n),u=I("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let c=0;c<a.length;c++)console.log(Array.prototype.slice.call(a[c].dataSync()).slice(0,u));return[o];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R0e{get id(){return this.handle.id}constructor(e,n){this.keyDType=e,this.valueDType=n,this.handle=Te(0),this.tensorMap=new Map,on(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Te(this.size(),"int32")}async import(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),W(()=>{const r=xr(n),i=s.length,o=r.length;C(i===o,()=>`The number of elements doesn't match, keys has ${i} elements, the values has ${o} elements.`);for(let a=0;a<i;a++){const l=s[a],u=r[a];on(u),this.tensorMap.set(l,u)}return this.handle})}async find(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return W(()=>{const r=[];for(let i=0;i<s.length;i++){const o=s[i],a=this.findWithDefault(o,n);r.push(a)}return fs(r)})}findWithDefault(e,n){const s=this.tensorMap.get(e);return s??n}checkKeyAndValueTensor(e,n){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(n.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${n.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D0e=async(t,e,n,s)=>{switch(t.op){case"HashTable":case"HashTableV2":{const r=s.getHashTableHandleByName(t.name);if(r!=null)return[r];{const i=I("keyDType",t,e,n),o=I("valueDType",t,e,n),a=new R0e(i,o);return s.addHashTable(t.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const r=I("tableHandle",t,e,n,s),i=I("keys",t,e,n),o=I("values",t,e,n);return[await s.getHashTableById(r.id).import(i,o)]}case"LookupTableFind":case"LookupTableFindV2":{const r=I("tableHandle",t,e,n,s),i=I("keys",t,e,n),o=I("defaultValue",t,e,n);return[await s.getHashTableById(r.id).find(i,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const r=I("tableHandle",t,e,n,s);return[s.getHashTableById(r.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O0e=(t,e,n,s=Bn)=>{switch(t.op){case"ResizeBilinear":{const r=I("images",t,e,n),i=I("size",t,e,n),o=I("alignCorners",t,e,n),a=I("halfPixelCenters",t,e,n);return[s.image.resizeBilinear(r,[i[0],i[1]],o,a)]}case"ResizeNearestNeighbor":{const r=I("images",t,e,n),i=I("size",t,e,n),o=I("alignCorners",t,e,n),a=I("halfPixelCenters",t,e,n);return[s.image.resizeNearestNeighbor(r,[i[0],i[1]],o,a)]}case"CropAndResize":{const r=I("image",t,e,n),i=I("boxes",t,e,n),o=I("boxInd",t,e,n),a=I("cropSize",t,e,n),l=I("method",t,e,n),u=I("extrapolationValue",t,e,n);return[s.image.cropAndResize(r,i,o,a,l,u)]}case"ImageProjectiveTransformV3":{const r=I("images",t,e,n),i=I("transforms",t,e,n),o=I("outputShape",t,e,n),a=I("fillValue",t,e,n),l=I("interpolation",t,e,n),u=I("fillMode",t,e,n);return[s.image.transform(r,i,l.toLowerCase(),u.toLowerCase(),a,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P0e=(t,e,n,s=Bn)=>{switch(t.op){case"Equal":return[s.equal(I("a",t,e,n),I("b",t,e,n))];case"NotEqual":return[s.notEqual(I("a",t,e,n),I("b",t,e,n))];case"Greater":return[s.greater(I("a",t,e,n),I("b",t,e,n))];case"GreaterEqual":return[s.greaterEqual(I("a",t,e,n),I("b",t,e,n))];case"Less":return[s.less(I("a",t,e,n),I("b",t,e,n))];case"LessEqual":return[s.lessEqual(I("a",t,e,n),I("b",t,e,n))];case"LogicalAnd":return[s.logicalAnd(I("a",t,e,n),I("b",t,e,n))];case"LogicalNot":return[s.logicalNot(I("a",t,e,n))];case"LogicalOr":return[s.logicalOr(I("a",t,e,n),I("b",t,e,n))];case"Select":case"SelectV2":return[s.where(I("condition",t,e,n),I("a",t,e,n),I("b",t,e,n))];case"BitwiseAnd":return[s.bitwiseAnd(I("a",t,e,n),I("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F0e=(t,e,n,s=Bn)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul(I("a",t,e,n),I("b",t,e,n),I("transposeA",t,e,n),I("transposeB",t,e,n))];case"Einsum":return[s.einsum(I("equation",t,e,n),...I("tensors",t,e,n))];case"Transpose":return[s.transpose(I("x",t,e,n),I("perm",t,e,n))];case"_FusedMatMul":const[r,i]=I("fusedOps",t,e,n),o=r==="biasadd",a=i==="prelu",l=I("numArgs",t,e,n),u=I("leakyreluAlpha",t,e,n);if(o){if(a&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,h]=I("args",t,e,n);return[s.fused.matMul({a:I("a",t,e,n),b:I("b",t,e,n),transposeA:I("transposeA",t,e,n),transposeB:I("transposeB",t,e,n),bias:c,activation:i,preluActivationWeights:h,leakyreluAlpha:u})];case"MatrixBandPart":return[s.linalg.bandPart(I("a",t,e,n),I("numLower",t,e,n),I("numUpper",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L0e=(t,e,n,s=Bn)=>{switch(t.op){case"EuclideanNorm":return[s.euclideanNorm(I("x",t,e,n),I("axis",t,e,n),I("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm(I("x",t,e,n),I("mean",t,e,n),I("variance",t,e,n),I("offset",t,e,n),I("scale",t,e,n),I("epsilon",t,e,n))];case"FusedBatchNormV3":return[s.batchNorm(I("x",t,e,n),I("mean",t,e,n),I("variance",t,e,n),I("offset",t,e,n),I("scale",t,e,n),I("epsilon",t,e,n))];case"LRN":return[s.localResponseNormalization(I("x",t,e,n),I("radius",t,e,n),I("bias",t,e,n),I("alpha",t,e,n),I("beta",t,e,n))];case"Softmax":return[s.softmax(I("x",t,e,n))];case"LogSoftmax":return[s.logSoftmax(I("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M0e=(t,e,n,s=Bn)=>{switch(t.op){case"RaggedGather":{const{outputNestedSplits:r,outputDenseValues:i}=s.raggedGather(I("paramsNestedSplits",t,e,n),I("paramsDenseValues",t,e,n),I("indices",t,e,n),I("outputRaggedRank",t,e,n));return r.concat(i)}case"RaggedRange":{const{rtNestedSplits:r,rtDenseValues:i}=s.raggedRange(I("starts",t,e,n),I("limits",t,e,n),I("splits",t,e,n));return[r,i]}case"RaggedTensorToTensor":return[s.raggedTensorToTensor(I("shape",t,e,n),I("values",t,e,n),I("defaultValue",t,e,n),I("rowPartitionTensors",t,e,n),I("rowPartitionTypes",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V0e=(t,e,n,s=Bn)=>{switch(t.op){case"Max":{const a=I("axis",t,e,n),l=I("keepDims",t,e,n);return[s.max(I("x",t,e,n),a,l)]}case"Mean":{const a=I("axis",t,e,n),l=I("keepDims",t,e,n);return[s.mean(I("x",t,e,n),a,l)]}case"Min":{const a=I("axis",t,e,n),l=I("keepDims",t,e,n);return[s.min(I("x",t,e,n),a,l)]}case"Sum":{const a=I("axis",t,e,n),l=I("keepDims",t,e,n);return[s.sum(I("x",t,e,n),a,l)]}case"All":{const a=I("axis",t,e,n),l=I("keepDims",t,e,n);return[s.all(I("x",t,e,n),a,l)]}case"Any":{const a=I("axis",t,e,n),l=I("keepDims",t,e,n);return[s.any(I("x",t,e,n),a,l)]}case"ArgMax":{const a=I("axis",t,e,n);return[s.argMax(I("x",t,e,n),a)]}case"ArgMin":{const a=I("axis",t,e,n);return[s.argMin(I("x",t,e,n),a)]}case"Prod":{const a=I("axis",t,e,n),l=I("keepDims",t,e,n);return[s.prod(I("x",t,e,n),a,l)]}case"Cumprod":{const a=I("axis",t,e,n),l=I("exclusive",t,e,n),u=I("reverse",t,e,n);return[s.cumprod(I("x",t,e,n),a,l,u)]}case"Cumsum":{const a=I("axis",t,e,n),l=I("exclusive",t,e,n),u=I("reverse",t,e,n);return[s.cumsum(I("x",t,e,n),a,l,u)]}case"Bincount":const r=I("x",t,e,n),i=I("weights",t,e,n),o=I("size",t,e,n);return[s.bincount(r,i,o)];case"DenseBincount":{const a=I("x",t,e,n),l=I("weights",t,e,n),u=I("size",t,e,n),c=I("binaryOutput",t,e,n);return[s.denseBincount(a,l,u,c)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z0e=(t,e,n,s=Bn)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=I("n",t,e,n),i=I("axis",t,e,n);let o=I("tensors",t,e,n);return o=o.slice(0,r),[s.concat(o,i)]}case"Gather":{const r=I("x",t,e,n),i=I("indices",t,e,n);return[s.gather(r,s.cast(i,"int32"),0)]}case"GatherV2":{const r=I("axis",t,e,n),i=I("batchDims",t,e,n),o=I("x",t,e,n),a=I("indices",t,e,n);return[s.gather(o,s.cast(a,"int32"),r,i)]}case"Reverse":{const r=I("dims",t,e,n),i=[];for(let a=0;a<r.length;a++)r[a]&&i.push(a);const o=I("x",t,e,n);return[s.reverse(o,i)]}case"ReverseV2":{const r=I("axis",t,e,n),i=I("x",t,e,n);return[s.reverse(i,r)]}case"Slice":{const r=I("begin",t,e,n),i=I("size",t,e,n);return[s.slice(I("x",t,e,n),r,i)]}case"StridedSlice":{const r=I("begin",t,e,n),i=I("end",t,e,n),o=I("strides",t,e,n),a=I("beginMask",t,e,n),l=I("endMask",t,e,n),u=I("ellipsisMask",t,e,n),c=I("newAxisMask",t,e,n),h=I("shrinkAxisMask",t,e,n),d=I("x",t,e,n);return[s.stridedSlice(d,r,i,o,a,l,u,c,h)]}case"Pack":return W(()=>{const r=I("axis",t,e,n),i=I("tensors",t,e,n),o=i[0].shape,a=s.squeeze(i[0]).shape,l=i.map(u=>{const c=We(u.shape,o);if(!c&&!We(s.squeeze(u).shape,a))throw new Error("the input tensors shape does not match");return c?u:s.reshape(u,o)});return[s.stack(l,r)]});case"Unpack":{const r=I("axis",t,e,n),i=I("tensor",t,e,n);return s.unstack(i,r)}case"Tile":{const r=I("reps",t,e,n);return[s.tile(I("x",t,e,n),r)]}case"Split":case"SplitV":{const r=I("axis",t,e,n),i=I("numOrSizeSplits",t,e,n),o=I("x",t,e,n);return s.split(o,i,r)}case"ScatterNd":{const r=I("indices",t,e,n),i=I("values",t,e,n),o=I("shape",t,e,n);return[s.scatterND(r,i,o)]}case"GatherNd":{const r=I("x",t,e,n),i=I("indices",t,e,n);return[s.gatherND(r,i)]}case"SparseToDense":{const r=I("sparseIndices",t,e,n),i=I("outputShape",t,e,n),o=I("sparseValues",t,e,n),a=I("defaultValue",t,e,n);return[s.sparseToDense(r,o,i,o.dtype===a.dtype?a:s.cast(a,o.dtype))]}case"TensorScatterUpdate":{const r=I("indices",t,e,n),i=I("values",t,e,n),o=I("tensor",t,e,n);return[s.tensorScatterUpdate(o,r,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B0e=(t,e,n,s=Bn)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:i,emptyRowIndicator:o,reverseIndexMap:a}=s.sparse.sparseFillEmptyRows(I("indices",t,e,n),I("values",t,e,n),I("denseShape",t,e,n),I("defaultValue",t,e,n));return[r,i,o,a]}case"SparseReshape":{const{outputIndices:r,outputShape:i}=s.sparse.sparseReshape(I("inputIndices",t,e,n),I("inputShape",t,e,n),I("newShape",t,e,n));return[r,i]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean(I("data",t,e,n),I("indices",t,e,n),I("segmentIds",t,e,n))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum(I("data",t,e,n),I("indices",t,e,n),I("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U0e=(t,e,n,s=Bn)=>{switch(t.op){case"FFT":return[s.fft(I("x",t,e,n))];case"IFFT":return[s.ifft(I("x",t,e,n))];case"RFFT":return[s.rfft(I("x",t,e,n))];case"IRFFT":return[s.irfft(I("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W0e=(t,e,n,s=Bn)=>{switch(t.op){case"StaticRegexReplace":return[s.string.staticRegexReplace(I("input",t,e,n),I("pattern",t,e,n),I("rewrite",t,e,n),I("replaceGlobal",t,e,n))];case"StringNGrams":{const{nGrams:r,nGramsSplits:i}=s.string.stringNGrams(I("data",t,e,n),I("dataSplits",t,e,n),I("separator",t,e,n),I("nGramWidths",t,e,n),I("leftPad",t,e,n),I("rightPad",t,e,n),I("padWidth",t,e,n),I("preserveShortSequences",t,e,n));return[r,i]}case"StringSplit":{const{indices:r,values:i,shape:o}=s.string.stringSplit(I("input",t,e,n),I("delimiter",t,e,n),I("skipEmpty",t,e,n));return[r,i,o]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast(I("input",t,e,n),I("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j0e=(t,e,n,s=Bn)=>{switch(t.op){case"Cast":return[s.cast(I("x",t,e,n),I("dtype",t,e,n))];case"ExpandDims":{const r=I("axis",t,e,n);return[s.expandDims(I("x",t,e,n),r)]}case"Squeeze":{const r=I("axis",t,e,n);return[s.squeeze(I("x",t,e,n),r)]}case"Reshape":return[s.reshape(I("x",t,e,n),I("shape",t,e,n))];case"EnsureShape":return[s.ensureShape(I("x",t,e,n),I("shape",t,e,n))];case"MirrorPad":return[s.mirrorPad(I("x",t,e,n),I("padding",t,e,n),I("mode",t,e,n))];case"PadV2":case"Pad":return[s.pad(I("x",t,e,n),I("padding",t,e,n),I("constantValue",t,e,n))];case"SpaceToBatchND":{const r=I("blockShape",t,e,n),i=I("paddings",t,e,n);return[s.spaceToBatchND(I("x",t,e,n),r,i)]}case"BatchToSpaceND":{const r=I("blockShape",t,e,n),i=I("crops",t,e,n);return[s.batchToSpaceND(I("x",t,e,n),r,i)]}case"DepthToSpace":{const r=I("blockSize",t,e,n),i=I("dataFormat",t,e,n).toUpperCase();return[s.depthToSpace(I("x",t,e,n),r,i)]}case"BroadcastTo":return[s.broadcastTo(I("x",t,e,n),I("shape",t,e,n))];case"BroadcastArgs":return[s.broadcastArgs(I("s0",t,e,n),I("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WP(t,e,n,s,r=W){const i=((o,a,l)=>{switch(o.category){case"arithmetic":return r(()=>v0e(o,a,l));case"basic_math":return r(()=>x0e(o,a,l));case"control":return C0e(o,a,l);case"convolution":return r(()=>E0e(o,a,l));case"creation":return r(()=>k0e(o,a,l));case"dynamic":return N0e(o,a,l);case"evaluation":return r(()=>$0e(o,a,l));case"image":return r(()=>O0e(o,a,l));case"graph":return r(()=>A0e(o,a,l));case"logical":return r(()=>P0e(o,a,l));case"matrices":return r(()=>F0e(o,a,l));case"normalization":return r(()=>L0e(o,a,l));case"ragged":return r(()=>M0e(o,a,l));case"reduction":return r(()=>V0e(o,a,l));case"slice_join":return r(()=>z0e(o,a,l));case"sparse":return r(()=>B0e(o,a,l));case"spectral":return r(()=>U0e(o,a,l));case"string":return r(()=>W0e(o,a,l));case"transformation":return r(()=>j0e(o,a,l));case"hash_table":return D0e(o,a,l,s);case"custom":const u=Yj(o.op);if(u&&u.customExecutor)return u.customExecutor(new w0e(o,a,l));throw TypeError(`Custom op ${o.op} is not registered.`);default:throw TypeError(`Unknown op '${o.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return Eo(i)?i.then(o=>[].concat(o)):[].concat(i)}class jP{constructor(e={},n={},s={},r={},i){this.weightMap=e,this.tensorArrayMap=n,this.tensorListMap=s,this.functionMap=r,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,n){return{id:e,frameName:n,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let n=0;n<this.contexts.length-1;n++){const s=this.contexts.slice(0,this.contexts.length-n);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(n=>n.id===0&&n.iterationId===0?"":`${n.frameName}-${n.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const n in this.tensorArrayMap)this.tensorArrayMap[n].clearAndClose(e);for(const n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GP(t,e,n,s){const r=new Set,i=[];let o=null,a=null;const l=new Set,u=new Set(Object.keys(t).map(d=>Ls(d)[0]));s=s||[];const c=new Set(s.map(d=>Ls(d.name)[0])),h=[...e];for(;h.length>0;){const d=h.pop();if((Sl(d)||J0e(d)||Z0e(d))&&o==null&&(o=d,a=o.children.map(f=>f.name).filter(f=>r.has(f))),r.add(d.name),n[d.name]==null&&!u.has(d.name)&&!c.has(d.name)){if(d.inputs.length===0){i.push(d.name);continue}d.inputs.forEach(f=>{l.has(f.name)||(l.add(f.name),h.push(f))})}}return{inputs:t,outputs:e,usedNodes:r,missingInputs:i,dynamicNode:o,syncInputs:a}}function G0e(t,e){const{usedNodes:n,inputs:s}=e,r=Object.keys(s).map(g=>Ls(g)[0]).map(g=>t.nodes[g]),i=t.initNodes||[],o=g=>n.has(typeof g=="string"?g:g.name);function a(g){return[...new Map(g.map(y=>[y.name,y])).values()]}const l=a([...r,...t.weights,...i]).filter(o),u=a([...l,...Object.values(t.nodes)]).filter(o),c=new Map(u.map(g=>[g.name,g])),h={};for(const g of u){h[g.name]=h[g.name]||0;for(const y of g.children)o(y)||(h[y.name]=Number.POSITIVE_INFINITY),h[y.name]=(h[y.name]||0)+1}const d=Object.entries(h).filter(([,g])=>g===0).map(([g])=>g),f=[...d];for(;d.length>0;){const g=d.pop(),y=c.get(g);for(const w of y.children.filter(o))--h[w.name]===0&&(f.push(w.name),d.push(w.name))}const p=f.map(g=>c.get(g)),m=H0e(p,l);return q0e(m,l),m}function H0e(t,e){const n=new Map(t.map(o=>[o.name,o])),s=e.map(o=>o.name),r=new Set(s);for(;s.length>0;){const o=s.pop(),a=n.get(o);for(const l of a.children)!n.has(l.name)||r.has(l.name)||(r.add(l.name),s.push(l.name))}return t.filter(o=>r.has(o.name))}class i0 extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function q0e(t,e){const n=new Map(t.map((a,l)=>[a.name,l])),s=new Set(e.map(a=>a.name)),r=a=>s.has(typeof a=="string"?a:a.name),i=new Set(t.map(a=>a.name)),o=a=>i.has(typeof a=="string"?a:a.name);for(const a of t){for(const l of a.children.filter(o)){if(!n.has(l.name))throw new i0(`Child ${l.name} of node ${a.name} is unreachable.`);if(n.get(a.name)>n.get(l.name))throw new i0(`Node ${a.name} is scheduled to run after its child ${l.name}.`)}if(!r(a))for(const l of a.inputs){if(!n.has(l.name))throw new i0(`Input ${l.name} of node ${a.name} is unreachable.`);if(n.get(l.name)>n.get(a.name))throw new i0(`Node ${a.name} is scheduled to run before its input ${l.name}.`)}}}function K0e(t){const e=new Map(t.map((a,l)=>[a.name,l])),n=Number.MAX_SAFE_INTEGER,s=t.map((a,l)=>Sl(a)?n:l),r=a=>{const l=s[e.get(a.name)];return l??-1},i=t.map((a,l)=>a.children.map(r).reduce((u,c)=>Math.max(u,c),s[l])),o=new Map;for(let a=0;a<t.length;++a){const l=i[a];if(l===n)continue;const u=t[a],c=t[l];o.has(c.name)||o.set(c.name,[]),o.get(c.name).push(u)}return o}const X0e=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),Q0e=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),Y0e=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Sl(t){return X0e.has(t.op)}function J0e(t){return Q0e.has(t.op)}function Z0e(t){return Y0e.has(t.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sv{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const n=Object.keys(e).map(s=>e[s].map(r=>r.id));this._weightIds=[].concat(...n),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const n=e.signatureKey||e.name;return e.defaultOutput?`${n}:${e.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((e,n)=>(e[n]=this._functions[n].signature,e),{})}constructor(e,n){this.graph=e,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new sv(e.functions[s],this)})}getCompilationKey(e,n){const s=e.map(i=>i.name).sort(),r=n.map(i=>i.name).sort();return s.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,n){const s=GP(e,n,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:o}=s;if(i!=null)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const u=n.map(h=>h.name),c=Object.keys(e);throw new Error(`Cannot compute the outputs [${u}] from the provided inputs [${c}]. Missing the following inputs: [${r}]`)}const a=G0e(this.graph,s),l=K0e(a);return{orderedNodes:a,nodeLiveUntilMap:l}}cloneAndKeepTensor(e){if(e==null)return null;const n=e.clone();return on(n),n}cloneTensorList(e){return e?e.map(s=>this.cloneAndKeepTensor(s)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([n,s])=>[n,this.cloneTensorList(s)]))}execute(e,n){this.disposeIntermediateTensors(),e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n);const r=s.map(d=>this.graph.nodes[Ls(d)[0]]),i=n.map(d=>Ls(d)[0]),o=new Set(i);let a=i.map(d=>this.graph.nodes[d]);a.length===0&&(a=this._outputs);const l=this.getCompilationKey(r,a);let u=this.compiledMap.get(l);u==null&&(u=this.compile(e,a),this.compiledMap.set(l,u));try{this.keepIntermediateTensors=U().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}const c={},h={};return W(()=>{const d=new jP(this.weightMap,c,h,this.functionExecutorMap,this.parseNodeNameCache),f=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(y=>{const[w,x]=Ls(y,d),v=[];v[x]=e[y],f[w]=v,this.keepIntermediateTensors&&(this.clonedTensorsMap[w]=this.cloneTensorList(v))});const p=this.getFrozenTensorIds(f),{orderedNodes:m,nodeLiveUntilMap:g}=u;for(const y of m){if(f[y.name])continue;const w=WP(y,f,d,this._resourceManager);if(Eo(w))throw new Error(`The execution of the op '${y.op}' returned a promise. Please use model.executeAsync() instead.`);f[y.name]=w,this.keepIntermediateTensors&&(this.clonedTensorsMap[y.name]=this.cloneTensorList(w)),this.checkTensorForDisposalWithNodeLiveUntilInfo(y,f,d,p,o,g.get(y.name))}return this.parent==null&&d.dispose(p),n.map(y=>kn(y,f,d))})}getFrozenTensorIds(e){const n=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(r=>r.id)));return new Set(n)}checkTensorForDisposal(e,n,s,r,i,o,a){if(!(Sl(n)||o.has(e))){for(const l of s[e])l!=null&&(a[l.id]=(a[l.id]||0)+n.children.length);for(const l of n.inputs){if(Sl(l))continue;const u=MP(l.name,s,r);if(u!=null)for(const c of u){if(!c||c.kept||i.has(c.id))continue;const h=a[c.id];h===1?(c.dispose(),delete a[c.id]):h!=null&&a[c.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,n,s,r,i,o){function a(l){return Sl(l)||i.has(l.name)}if(!(Sl(e)||o==null))for(const l of o){if(a(l))continue;const u=MP(l.name,n,s);for(const c of u)!c||c.kept||r.has(c.id)||c.dispose()}}async executeAsync(e,n){return this._executeAsync(e,n)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const n of e)n&&!n.isDisposed&&n.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,n,s=!1,r={},i={}){this.disposeIntermediateTensors(),s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=U().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}const o=new jP(this.weightMap,r,i,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const a=await this.executeWithControlFlow(e,o,n,s),l=n.map(d=>kn(d,a,o)),u=l.map(d=>d.id),c=Object.keys(e).map(d=>e[d].id),h=new Set([...u,...c,...this.weightIds]);return Object.values(a).forEach(d=>{d.forEach(f=>{f&&!f.isDisposed&&!h.has(f.id)&&f.dispose()})}),this.parent==null&&o.dispose(h),l}async executeFunctionAsync(e,n,s){const r=e.reduce((i,o,a)=>(i[this.inputs[a].name]=o,i),{});return this._executeAsync(r,this.outputNodes,!0,n,s)}async executeWithControlFlow(e,n,s,r){const i=Object.keys(e),o=i.map(v=>this.graph.nodes[Ls(v)[0]]),a=s.map(v=>Ls(v)[0]),l=new Set(a);let u=a.map(v=>this.graph.nodes[v]);u.length===0&&(u=this._outputs);const{usedNodes:c,missingInputs:h,dynamicNode:d,syncInputs:f}=GP(e,u,this.weightMap,this._initNodes),p=[...o,...this.graph.weights,...this._initNodes||[]].map(v=>({node:v,contexts:n.currentContext})),m=Object.assign({},this.weightMap);Object.keys(e).forEach(v=>{const[b,S]=Ls(v),T=[];T[S]=e[v],m[b]=T});const g={},y=this.getFrozenTensorIds(m),w={};for(;p.length>0;){const v=this.processStack(o,p,n,m,w,y,l,g,c);await Promise.all(v)}d==null&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const x=u.filter(v=>!Sl(v)&&!kn(v.name,m,n)).map(v=>v.name);if(x.length>0){let v="";throw d!=null&&(v=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${x}] from the provided inputs [${i}]. Consider providing the following inputs: [${h}]. ${v}`)}return m}processStack(e,n,s,r,i,o,a,l,u){const c=[];for(;n.length>0;){const h=n.pop();s.currentContext=h.contexts;let d="";if(h.node.op==="Enter"&&I("isConstant",h.node,r,s)&&([d]=ao(h.node.name,s)),r[h.node.name]==null){const f=WP(h.node,r,s,this._resourceManager);d||([d]=ao(h.node.name,s));const p=s.currentContext;Eo(f)?c.push(f.then(m=>(r[d]=m,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(m)),s.currentContext=p,this.checkTensorForDisposal(d,h.node,r,s,o,a,l),this.processChildNodes(h.node,n,s,r,i,u),m))):(r[d]=f,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(f)),this.checkTensorForDisposal(d,h.node,r,s,o,a,l),this.processChildNodes(h.node,n,s,r,i,u))}else this.processChildNodes(h.node,n,s,r,i,u)}return c}processChildNodes(e,n,s,r,i,o){e.children.forEach(a=>{const[l]=ao(a.name,s);i[l]||!o.has(a.name)||(a.op==="Merge"?a.inputNames.some(u=>!!kn(u,r,s))&&(i[l]=!0,n.push({contexts:s.currentContext,node:a})):a.inputNames.every(u=>!!kn(u,r,s))&&(i[l]=!0,n.push({contexts:s.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(n=>n.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(n=>{const s=e[n],[r]=Ls(n),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const o=i.attrParams.shape.value,a=o.length===s.shape.length&&s.shape.every((l,u)=>o[u]===-1||o[u]===l);C(a,()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${o}], but was [${s.shape}]`)}i.attrParams.dtype&&i.attrParams.dtype.value&&C(s.dtype===i.attrParams.dtype.value,()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){var n,s;const r={};for(const i in e){const o=(s=(n=this._signature)===null||n===void 0?void 0:n.inputs)===null||s===void 0?void 0:s[i];o!=null?r[o.name]=e[i]:r[i]=e[i]}return r}checkInputs(e){const n=Object.keys(e).filter(s=>{const[r]=Ls(s);return this.graph.nodes[r]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(e){return e.map(n=>{var s,r;const i=(r=(s=this._signature)===null||s===void 0?void 0:s.outputs)===null||r===void 0?void 0:r[n];return i!=null?i.name:n},{})}checkOutputs(e){e.forEach(n=>{const[s]=Ls(n);if(!this.graph.nodes[s])throw new Error(`The output '${n}' is not found in the graph`)})}}class ewe{constructor(e={},n={}){this.hashTableNameToHandle=e,this.hashTableMap=n}addHashTable(e,n){this.hashTableNameToHandle[e]=n.handle,this.hashTableMap[n.id]=n}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const twe="?tfjs-format=file",nwe="model.json";class V2{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,n={},s=LN){this.modelUrl=e,this.loadOptions=n,this.version="n/a",this.io=s,n==null&&(this.loadOptions={}),this.resourceManager=new ewe}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const n=this.io.getLoadHandlers(e,this.loadOptions);if(n.length===0)n.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(n.length>1)throw new Error(`Found more than one (${n.length}) load handlers for URL '${[e]}'`);this.handler=n[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return Eo(e)?e.then(n=>n.getWeightStream==null?this.loadSync(n):this.loadStreaming(n)):this.loadSync(e)}loadSync(e){const n=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,n)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");const n=await N4(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,n)}loadWithWeightMap(e,n){this.artifacts=e;const s=this.artifacts.modelTopology;let r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const i=this.artifacts.userDefinedMetadata;i.signature!=null&&(r=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}if(this.signature=r,this.version=`${s.versions.producer}.${s.versions.minConsumer}`,this.executor=new sv(VP.Instance.transformGraph(s,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const i=VP.Instance.transformGraph(e.modelInitializer);this.initializer=new sv(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,n){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const n=e instanceof Qe?[e]:e,s={};return n.forEach((r,i)=>s[this.structuredOutputKeys[i]]=r),s}return e}predict(e,n){const s=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(s)}async predictAsync(e,n){const s=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(s)}normalizeInputs(e){var n;if(!(e instanceof Qe)&&!Array.isArray(e)){const i=(n=this.signature)===null||n===void 0?void 0:n.inputs;if(i!=null)for(const o in i){const a=i[o];a.resourceId!=null&&(e[o]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];const s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-s} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((i,o)=>{var a,l,u;const c=(u=(l=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||l===void 0?void 0:l[o])===null||u===void 0?void 0:u.resourceId;return c!=null?i[o]=this.resourceIdToCapturedInput[c]:i[o]=e[r++],i},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const n=this.initializerSignature.outputs,s=Object.keys(n);for(let r=0;r<s.length;r++){const i=s[r],o=n[i];this.resourceIdToCapturedInput[o.resourceId]=e[r]}}}execute(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=this.executor.execute(e,n);return s.length>1?s:s[0]}async executeAsync(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=await this.executor.executeAsync(e,n);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((n,s)=>(n[s]=[e[s]],n),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&$e(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function swe(t,e={},n=LN){if(t==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof t=="string"&&(t=iwe(t));const s=new V2(t,e,n);return await s.load(),s}function rwe(t){if(t==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let e;if(t instanceof Array){const[s,r]=t;if(!s)throw new Error("modelJSON must be the first element of the array");if(!r||!(r instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in s))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in s))throw new Error("Model JSON is missing 'weightsManifest'");const i=jw(s.weightsManifest),o=pk(s,i,r);e=Hw(o)}else if("load"in t)e=t;else if("modelTopology"in t&&"weightSpecs"in t&&"weightData"in t)e=Hw(t);else throw new Error("Unknown model format");const n=new V2(e);return n.load(),n}function iwe(t){return t.endsWith("/")||(t=t+"/"),`${t}${nwe}${twe}`}/** @license See the LICENSE file. */const eG="4.17.0";var z2={exports:{}};z2.exports;(function(t){(function(e,n,s){function r(l){var u=this,c=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var c=new r(l),h=u&&u.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,c),d.state=function(){return i(c,{})}),d}function a(){var l=4022871197,u=function(c){c=String(c);for(var h=0;h<c.length;h++){l+=c.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.alea=o})(Pe,t,!1)})(z2);var owe=z2.exports,B2={exports:{}};B2.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xor128=o})(Pe,t,!1)})(B2);var awe=B2.exports,U2={exports:{}};U2.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xorwow=o})(Pe,t,!1)})(U2);var lwe=U2.exports,W2={exports:{}};W2.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.x,h=l.i,d,f;return d=c[h],d^=d>>>7,f=d^d<<24,d=c[h+1&7],f^=d^d>>>10,d=c[h+3&7],f^=d^d>>>3,d=c[h+4&7],f^=d^d<<7,d=c[h+7&7],d=d^d<<13,f^=d^d<<9,c[h]=f,l.i=h+1&7,f};function u(c,h){var d,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[d&7]=f[d&7]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xorshift7=o})(Pe,t,!1)})(W2);var uwe=W2.exports,j2={exports:{}};j2.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.w,h=l.X,d=l.i,f,p;return l.w=c=c+1640531527|0,p=h[d+34&127],f=h[d=d+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=h[d]=p^f,l.i=d,p+(c^c>>>16)|0};function u(c,h){var d,f,p,m,g,y=[],w=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,w=Math.max(w,h.length)),p=0,m=-32;m<w;++m)h&&(f^=h.charCodeAt((m+32)%h.length)),m===0&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(g=g+1640531527|0,d=y[m&127]^=f+g,p=d==0?p+1:0);for(p>=128&&(y[(h&&h.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=y[p+34&127],d=y[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,y[p]=f^d;c.w=g,c.X=y,c.i=p}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xor4096=o})(Pe,t,!1)})(j2);var cwe=j2.exports,G2={exports:{}};G2.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.b,d=l.c,f=l.d,p=l.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-f|0,l.d=f<<16^d>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.tychei=o})(Pe,t,!1)})(G2);var hwe=G2.exports,tG={exports:{}};(function(t){(function(e,n,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),c=u*2,h=r-1,d;function f(v,b,S){var T=[];b=b==!0?{entropy:!0}:b||{};var _=y(g(b.entropy?[v,x(n)]:v??w(),3),T),E=new p(T),N=function(){for(var $=E.g(i),A=l,D=0;$<u;)$=($+D)*r,A*=r,D=E.g(1);for(;$>=c;)$/=2,A/=2,D>>>=1;return($+D)/A};return N.int32=function(){return E.g(4)|0},N.quick=function(){return E.g(4)/4294967296},N.double=N,y(x(E.S),n),(b.pass||S||function($,A,D,F){return F&&(F.S&&m(F,E),$.state=function(){return m(E,{})}),D?(s[a]=$,A):$})(N,_,"global"in b?b.global:this==s,b.state)}function p(v){var b,S=v.length,T=this,_=0,E=T.i=T.j=0,N=T.S=[];for(S||(v=[S++]);_<r;)N[_]=_++;for(_=0;_<r;_++)N[_]=N[E=h&E+v[_%S]+(b=N[_])],N[E]=b;(T.g=function($){for(var A,D=0,F=T.i,B=T.j,z=T.S;$--;)A=z[F=h&F+1],D=D*r+z[h&(z[F]=z[B=h&B+A])+(z[B]=A)];return T.i=F,T.j=B,D})(r)}function m(v,b){return b.i=v.i,b.j=v.j,b.S=v.S.slice(),b}function g(v,b){var S=[],T=typeof v,_;if(b&&T=="object")for(_ in v)try{S.push(g(v[_],b-1))}catch{}return S.length?S:T=="string"?v:v+"\0"}function y(v,b){for(var S=v+"",T,_=0;_<S.length;)b[h&_]=h&(T^=b[h&_]*19)+S.charCodeAt(_++);return x(b)}function w(){try{var v;return d&&(v=d.randomBytes)?v=v(r):(v=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(v)),x(v)}catch{var b=e.navigator,S=b&&b.plugins;return[+new Date,e,S,e.screen,x(n)]}}function x(v){return String.fromCharCode.apply(0,v)}if(y(s.random(),n),t.exports){t.exports=f;try{d=V1}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:Pe,[],Math)})(tG);var dwe=tG.exports,fwe=owe,pwe=awe,mwe=lwe,gwe=uwe,ywe=cwe,wwe=hwe,Yu=dwe;Yu.alea=fwe;Yu.xor128=pwe;Yu.xorwow=mwe;Yu.xorshift7=gwe;Yu.xor4096=ywe;Yu.tychei=wwe;var nG=Yu;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function vwe(t,e){return rv(t,e)}function rv(t,e,n=new Map,s=new Set){if(t==null)return null;if(typeof Blob=="function"&&t instanceof Blob)return t.slice();if(s.has(t))throw new Error("Circular references are not supported.");if(n.has(t))return n.get(t);const r=e(t);if(r.recurse&&r.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(r.recurse)if(gh(t)){const i=Array.isArray(t)?[]:{};s.add(t);for(const o in t){const a=t[o],l=rv(a,e,n,s);i[o]=l}return s.delete(t),t.__proto__&&(i.__proto__=t.__proto__),i}else throw new Error(`Can't recurse into non-iterable type: ${t}`);else return n.set(t,r.value),r.value}function xwe(t,e=rG){return sG(t,e)}function sG(t,e,n=new Set){const s=t[0];if(n.has(s))throw new Error("Circular references are not supported.");const r=e(t);if(r.recurse&&r.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(r.recurse)if(gh(s)){const i=Array.isArray(s)?[]:{};n.add(s);for(const o in s){const a=t.map(u=>u[o]),l=sG(a,e,n);i[o]=l}return n.delete(s),i}else throw new Error(`Can't recurse into non-iterable type: ${s}`);else return r.value}function rG(t){return t===null?null:gh(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}async function iG(t,e){const n=new Map;rv(t,e,n);for(const r of Array.from(n.keys())){const i=n.get(r);if(Eo(i)){const o=await i;n.set(r,o)}}return rv(t,e,n)}function gh(t){let e=!1;if(U().get("IS_BROWSER"))e=t instanceof TextDecoder;else{const{StringDecoder:n}=require("string_decoder");e=t instanceof n}return t!=null&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||typeof t=="object"&&!(t instanceof Qe)&&!(t instanceof Promise)&&!e)}function bwe(t){return t==null||Iwe(t)||Array.isArray(t)||typeof t=="object"&&t instanceof Qe||nn(t)}function Iwe(t){return t===null||typeof t!="object"&&typeof t!="function"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function Twe(t){return vwe(t,Swe)}function Swe(t){return t instanceof Qe?{value:t.clone(),recurse:!1}:gh(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class oG{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,n){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=n}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const n of e)this.push(n)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const n=this.wrap(this.begin+e),s=this.get(n);return this.set(n,this.pop()),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class Pb extends oG{constructor(){super(Pb.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=this.capacity*2,n=new Array(e),s=this.length();for(let r=0;r<s;r++)n[r]=this.get(this.wrap(this.begin+r));this.data=n,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=s}}Pb.INITIAL_CAPACITY=32;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function aG(t){return new Ewe(t)}function H2(t){return new kwe(t)}function _we(t,e){return new lG(t,e)}function Cwe(t,e=ma.FAIL){return new Lwe(t,e)}class xn{async toArray(){const e=[];let n=await this.next();for(;!n.done;)e.push(n.value),n=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),n=[];let s=await e.next();for(;!s.done;)n.push(s.value),s=await e.next();return n}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let n=await this.next(),s=e(n.value);for(;!n.done&&s;)n=await this.next(),s=e(n.value)}handleErrors(e){return new Pwe(this,e)}filter(e){return new Dwe(this,e)}map(e){return new Owe(this,e)}mapAsync(e){return new HP(this,e)}serialMapAsync(e){return new HP(this,e).serial()}flatmap(e){return new Fwe(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(n=>n===!0)}rowMajorBatch(e,n=!0){return new Rwe(this,e,n)}columnMajorBatch(e,n=!0,s=rG){return this.rowMajorBatch(e,n).map(i=>xwe(i,s))}concatenate(e,n){return new lG(aG([this,e]),n)}take(e){return e<0||e==null?this:new Awe(this,e)}skip(e){return e<0||e==null?this:new $we(this,e)}prefetch(e){return new uG(this,e)}shuffle(e,n){return new Mwe(this,e,n)}serial(){return new Nwe(this)}}class Ewe extends xn{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:Twe(e),done:!1}}}class kwe extends xn{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}}class Nwe extends xn{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class $we extends xn{constructor(e,n){super(),this.upstream=e,this.maxCount=n,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;$e(e.value)}return this.upstream.next()}}class Awe extends xn{constructor(e,n){super(),this.upstream=e,this.maxCount=n,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class Rwe extends xn{constructor(e,n,s=!0){super(),this.upstream=e,this.batchSize=n,this.enableSmallLastBatch=s,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const n=await this.upstream.next();if(n.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(n.value)}return{value:e,done:!1}}}class Dwe extends xn{constructor(e,n){super(),this.upstream=e,this.predicate=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;$e(e.value)}}}class Owe extends xn{constructor(e,n){super(),this.upstream=e,this.transform=n}summary(){return`${this.upstream.summary()} -> Map`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const n=No(e.value),s=this.transform(e.value),r=No(s);for(const i of n)E1(i,r)||i.dispose();return{value:s,done:!1}}}class Pwe extends xn{constructor(e,n){super(),this.upstream=e,this.handler=n,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class HP extends xn{constructor(e,n){super(),this.upstream=e,this.transform=n}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const n=No(e.value),s=await this.transform(e.value),r=No(s);for(const i of n)E1(i,r)||i.dispose();return{value:s,done:!1}}}class q2 extends xn{constructor(){super(),this.outputQueue=new Pb,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class Fwe extends q2{constructor(e,n){super(),this.upstream=e,this.transform=n}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const e=await this.upstream.next();if(e.done)return!1;const n=No(e.value),s=this.transform(e.value),r=No(s);this.outputQueue.pushAll(s);for(const i of n)E1(i,r)||i.dispose();return!0}}class lG extends xn{constructor(e,n){super(),this.baseErrorHandler=n,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,this.iterator==null){const s=await this.moreIterators.next();if(s.done)return{value:null,done:!0};this.iterator=s.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const n=await this.iterator.next();return n.done?(this.iterator=null,this.readFromChain(e)):n}}var ma;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(ma||(ma={}));class Lwe extends xn{constructor(e,n=ma.FAIL){super(),this.iterators=e,this.mismatchMode=n,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let n=0,s=0;function r(o){return o instanceof xn?{value:o.next().then(l=>(n++,l.done&&s++,l.value)),recurse:!1}:{value:null,recurse:!0}}const i=await iG(this.iterators,r);if(n===s)return{value:null,done:!0};if(s>0)switch(this.mismatchMode){case ma.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case ma.SHORTEST:return{value:null,done:!0};case ma.LONGEST:}return this.count++,{value:i,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class uG extends xn{constructor(e,n){super(),this.upstream=e,this.bufferSize=n,this.buffer=new oG(n)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class Mwe extends uG{constructor(e,n,s){super(e,n),this.upstream=e,this.windowSize=n,this.upstreamExhausted=!1,this.random=nG.alea(s||Cn().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),n=await this.buffer.shuffleExcise(e);if(n.done)this.upstreamExhausted=!0;else return this.refill(),n}return{value:null,done:!0}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class zd{constructor(){this.size=null}batch(e,n=!0){const s=this;C(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let r;return this.size===1/0||this.size==null?r=this.size:n?r=Math.ceil(this.size/e):r=Math.floor(this.size/e),Fs(async()=>(await s.iterator()).columnMajorBatch(e,n,Bwe),r)}concatenate(e){const n=this;let s;return this.size===1/0||e.size===1/0?s=1/0:this.size!=null&&e.size!=null?s=this.size+e.size:s=null,Fs(async()=>(await n.iterator()).concatenate(await e.iterator()),s)}filter(e){const n=this;let s;return this.size===1/0?s=1/0:s=null,Fs(async()=>(await n.iterator()).filter(r=>W(()=>e(r))),s)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const n=this;return Fs(async()=>(await n.iterator()).map(s=>W(()=>e(s))),this.size)}mapAsync(e){const n=this;return Fs(async()=>(await n.iterator()).mapAsync(e),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const n=this;return Fs(async()=>(await n.iterator()).prefetch(e),this.size)}repeat(e){const n=this;let s;return this.size!=null&&e>0?s=this.size*e:e===0?s=0:this.size!=null&&(e===void 0||e<0)?s=1/0:s=null,Fs(async()=>{const r=H2(async()=>({value:await n.iterator(),done:!1}));return _we(r.take(e))},s)}skip(e){const n=this;let s;return this.size!=null&&e>=0&&this.size>=e?s=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?s=0:s=null,Fs(async()=>(await n.iterator()).skip(e),s)}shuffle(e,n,s=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const r=this,i=nG.alea(n||Cn().toString());return Fs(async()=>{let o=i.int32();return s&&(o+=i.int32()),(await r.iterator()).shuffle(e,o.toString())},this.size)}take(e){const n=this;let s;return this.size!=null&&this.size>e?s=e:this.size!=null&&this.size<=e?s=this.size:s=null,Fs(async()=>(await n.iterator()).take(e),s)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}zd.MAX_BUFFER_SIZE=1e4;function Fs(t,e=null){return new class extends zd{constructor(){super(...arguments),this.size=e}async iterator(){return t()}}}function Vwe(t){return Fs(async()=>aG(t),t.length)}function zwe(t){if(!gh(t))throw new Error("The argument to zip() must be an object or array.");let e;if(Array.isArray(t))for(let n=0;n<t.length;n++)e=e==null?t[n].size:Math.min(e,t[n].size);else if(t instanceof Object)for(const n in t)e=e==null?t[n].size:Math.min(e,t[n].size);return Fs(async()=>{const n=await iG(t,s=>{if(s instanceof zd)return{value:s.iterator(),recurse:!1};if(gh(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")});return Cwe(n,ma.SHORTEST)},e)}function Bwe(t){if(t===null)return null;const e=t[0];return bwe(e)?{value:Uwe(t),recurse:!1}:{value:null,recurse:!0}}function Uwe(t){if(t.length===0)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof Qe?fs(t):Xs(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class cG extends zd{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split(`
`).map(r=>(r.endsWith("\r")&&(r=r.slice(0,-1)),r))}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */const o0='"',pf=Symbol("out"),qP=Symbol("field"),a0=Symbol("quote"),tT=Symbol("quoteafterquote"),KP=Symbol("quoteinquote");class hG extends zd{async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){const e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&C(e.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=e);const n=this.fullColumnNames.reduce((r,i)=>(r[i]=r[i]+1||1,r),{}),s=Object.keys(n).filter(r=>n[r]>1);if(C(s.length===0,()=>"Duplicate column names found: "+s.toString()),this.columnConfigs){for(const r of Object.keys(this.columnConfigs))if(this.fullColumnNames.indexOf(r)===-1)throw new Error('The key "'+r+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){const n=await(await this.base.iterator()).next();if(n.done)throw new Error("No data was found for CSV parsing.");const s=n.value;return this.parseRow(s,!1)}else return null}constructor(e,n){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new cG(e),n||(n={}),this.hasHeader=n.hasHeader!==!1,this.fullColumnNames=n.columnNames,this.columnConfigs=n.columnConfigs,this.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(C(n.delimiter==null,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=n.delimiter?n.delimiter:","}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map(n=>this.makeDataElement(n))}makeDataElement(e){const n=this.parseRow(e),s={},r={};for(let i=0;i<this.fullColumnNames.length;i++){const o=this.fullColumnNames[i],a=this.columnConfigs?this.columnConfigs[o]:null;if(!(this.configuredColumnsOnly&&!a)){const l=n[i];let u=null;if(l==="")if(a&&a.default!==void 0)u=a.default;else{if(a&&(a.required||a.isLabel))throw new Error(`Required column ${o} is empty in this line: ${e}`);u=void 0}else{const c=Number(l);if(isNaN(c))a&&a.dtype==="bool"?u=this.getBoolean(l):u=l;else if(!a||!a.dtype)u=c;else switch(a.dtype){case"float32":u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(l);break;default:u=c}}a&&a.isLabel?r[o]=u:s[o]=u}}return Object.keys(r).length===0?s:{xs:s,ys:r}}getBoolean(e){return e==="1"||e.toLowerCase()==="true"?1:0}parseRow(e,n=!0){const s=[];let r=0;const i=e.length;let o=pf;for(let a=0;a<i;a++)switch(o){case pf:switch(e.charAt(a)){case o0:r=a+1,o=a0;break;case this.delimiter:if(r=a+1,this.delimiter===" "&&this.delimWhitespace)break;s.push(""),o=pf;break;default:o=qP,r=a;break}break;case qP:switch(e.charAt(a)){case this.delimiter:s.push(e.substring(r,a)),o=pf,r=a+1;break}break;case a0:switch(e.charAt(a)){case o0:o=tT;break}break;case tT:switch(e.charAt(a)){case this.delimiter:s.push(e.substring(r,a-1)),o=pf,r=a+1;break;case o0:o=a0;break;default:o=KP;break}break;case KP:switch(e.charAt(a)){case o0:o=a0;break}break}if(o===tT?s.push(e.substring(r,i-1)):s.push(e.substring(r)),n&&s.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${s}`);return s}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class K2 extends xn{constructor(e){super(),this.microphoneConfig=e,this.isClosed=!1,this.fftSize=e.fftSize||1024;const n=Math.log2(this.fftSize);if(this.fftSize<0||n<4||n>14||!Number.isInteger(n))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=e.numFramesPerSpectrogram||43,this.sampleRateHz=e.sampleRateHz,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.audioTrackConstraints=e.audioTrackConstraints,this.smoothingTimeConstant=e.smoothingTimeConstant||0,this.includeSpectrogram=e.includeSpectrogram!==!1,this.includeWaveform=e.includeWaveform===!0,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(e={}){if(!U().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");const n=new K2(e);return await n.start(),n}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})}catch(s){throw new Error(`Error thrown while initializing video stream: ${s.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");const e=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new e,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`);const n=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let e,n;const s=await this.getAudioData();if(this.includeSpectrogram){const r=this.flattenQueue(s.freqDataQueue);e=this.getTensorFromAudioDataArray(r,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){const r=this.flattenQueue(s.timeDataQueue);n=this.getTensorFromAudioDataArray(r,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:e,waveform:n},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){const e=[],n=[];let s=0;return new Promise(r=>{const i=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&r({freqDataQueue:e,timeDataQueue:n}),e.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),n.push(this.timeData.slice())),++s===this.numFrames&&(clearInterval(i),r({freqDataQueue:e,timeDataQueue:n}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(e){const n=e[0].length,s=new Float32Array(e.length*n);return e.forEach((r,i)=>s.set(r,i*n)),s}getTensorFromAudioDataArray(e,n){const s=new Float32Array(G(n));return s.set(e,s.length-e.length),Xs(s,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class X2 extends xn{constructor(e,n){if(super(),this.webcamVideoElement=e,this.webcamConfig=n,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=$n([0],"int32"),this.webcamConfig.centerCrop){const s=this.webcamConfig.resizeWidth*1/this.webcamVideoElement.width,r=this.webcamConfig.resizeHeight*1/this.webcamVideoElement.height,i=(1-s)/2,o=(1-r)/2,a=i+s,l=r+o;this.cropBox=Na([o,i,l,a],[1,4])}else this.cropBox=Na([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(e,n={}){if(!U().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=n.resizeWidth,e.height=n.resizeHeight}const s=new X2(e,n);return await s.start(),s}async start(){this.webcamConfig.facingMode&&C(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(e){throw e.message=`Error thrown while initializing video stream: ${e.message}`,e}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(e){console.log(e),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(e=>{this.webcamVideoElement.onloadedmetadata=()=>{e()}})}async next(){if(this.isClosed)return{value:null,done:!0};let e;try{e=tW(this.webcamVideoElement)}catch(n){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(n)}`)}if(this.resize)try{return{value:this.cropAndResizeFrame(e),done:!1}}catch(n){throw new Error(`Error thrown cropping the video: ${n.message}`)}finally{e.dispose()}else return{value:e,done:!1}}needToResize(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))}cropAndResizeFrame(e){return W(()=>{const n=En(re(e,"float32"),0);let s;s=Or.cropAndResize(n,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");const r=s.shape;return L(s,r.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(n=>n.stop());try{this.webcamVideoElement.srcObject=null}catch(n){console.log(n),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class dG{}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class fG extends xn{split(e){return new Wwe(this,e)}}class Wwe extends fG{constructor(e,n){super(),this.upstream=e,this.impl=new jwe(e,n)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class jwe extends q2{constructor(e,n){super(),this.upstream=e,this.separator=n,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){const e=await this.upstream.next();if(e.done)return this.carryover===""?!1:(this.outputQueue.push(this.carryover),this.carryover="",!0);const n=e.value.split(this.separator);n[0]=this.carryover+n[0];for(const s of n.slice(0,-1))this.outputQueue.push(s);return this.carryover=n[n.length-1],!0}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class Gwe extends xn{decodeUTF8(){return new Hwe(this)}}class Hwe extends fG{constructor(e){super(),this.upstream=e,this.impl=new qwe(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class qwe extends q2{constructor(e){if(super(),this.upstream=e,U().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{const{StringDecoder:n}=require("string_decoder");this.decoder=new n("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){const e=await this.upstream.next();let n;if(e.done)return!1;n=e.value;let s;return U().get("IS_BROWSER")?s=this.decoder.decode(n,{stream:!0}):s=this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(s),!0}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class pG extends Gwe{constructor(e,n={}){super(),this.file=e,this.options=n,C(e instanceof Uint8Array||(U().get("IS_BROWSER")?e instanceof File||e instanceof Blob:!1),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=n.offset||0,this.chunkSize=n.chunkSize||1024*1024}summary(){return`FileChunks ${this.file}`}async next(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:await new Promise((n,s)=>{const r=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)n(new Uint8Array(this.file.slice(this.offset,r)));else{const i=new FileReader;i.onload=a=>{let l=i.result;if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),!(l instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));n(l)},i.onabort=a=>s(new Error("Aborted")),i.onerror=a=>s(new Error(a.type));const o=this.file.slice(this.offset,r);i.readAsArrayBuffer(o)}this.offset=r}),done:!1}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */async function Kwe(t,e={},n){let s,r;typeof t=="string"?s=t:(s=t.url,r=Xwe(t));const i=await(n||v4)(s,r);if(i.ok){const o=new Uint8Array(await i.arrayBuffer());return new pG(o,e)}else throw new Error(i.statusText)}const Xwe=t=>({method:t.method,headers:t.headers,body:t.body,mode:t.mode,credentials:t.credentials,cache:t.cache,redirect:t.redirect,referrer:t.referrer,integrity:t.integrity});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function mG(t){return typeof t=="string"&&t.slice(0,7)==="file://"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class gG extends dG{constructor(e,n={}){super(),this.input=e,this.options=n}async iterator(){if(mG(this.input)&&U().get("IS_NODE")){const e=require("fs");this.input=e.readFileSync(this.input.slice(7))}return new pG(this.input,this.options)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class yG extends dG{constructor(e,n={}){super(),this.url=e,this.fileOptions=n}async iterator(){return mG(this.url)?new gG(this.url,this.fileOptions).iterator():Kwe(this.url,this.fileOptions)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function Qwe(t,e={}){return new hG(new yG(t),e)}function Ywe(t){const e=H2(t);return Fs(async()=>e)}function Jwe(t){return Fs(async()=>{const e=await t();return H2(()=>e.next())})}async function Zwe(t,e){return X2.create(t,e)}async function eve(t){return K2.create(t)}/** @license See the LICENSE file. */const wG="4.17.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tve=Object.freeze(Object.defineProperty({__proto__:null,CSVDataset:hG,Dataset:zd,FileDataSource:gG,TextLineDataset:cG,URLDataSource:yG,array:Vwe,csv:Qwe,func:Ywe,generator:Jwe,microphone:eve,version_data:wG,webcam:Zwe,zip:zwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function we(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&C(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nve=eb;class my extends yx{nextDataId(){return my.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new JE(this,Qr())}write(e,n,s){this.firstUse&&(this.firstUse=!1,U().get("IS_NODE")&&ir(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&Ri(s[0])){const i=s.map(o=>Bi(o));r=this.write(i,e,n)}else r=this.write(s,e,n);return{dataId:r,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,r,i){this.data.set(e,{values:n,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return Do(r,i)}return s4(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>ko(r));return Fe(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Fe(e.shape,e.dtype,n)}makeOutput(e,n,s){return Qr().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=Cn();return e(),{kernelMs:Cn()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){we([e],"where");const n=this.readSync(e.dataId);return nve(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}my.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vG(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const sve=t=>{const{x:e}=t.inputs,n=t.backend;we(e,"abs");let s=new Float32Array(G(e.shape));const r=n.data.get(e.dataId).values;return s=vG(r),n.makeOutput(s,e.shape,e.dtype)},rve={kernelName:Om,backendName:"cpu",kernelFunc:sve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qt(t){return(e,n,s,r,i)=>{const o=Ae(e,n),a=o.length,l=Ie(o),u=G(o),c=vn(i,u),h=e.length,d=n.length,f=Ie(e),p=Ie(n),m=gu(e,o),g=gu(n,o);if(m.length+g.length===0)for(let y=0;y<c.length;++y)c[y]=t(s[y%s.length],r[y%r.length]);else for(let y=0;y<c.length;++y){const w=zu(y,a,l),x=w.slice(-h);m.forEach(T=>x[T]=0);const v=ii(x,h,f),b=w.slice(-d);g.forEach(T=>b[T]=0);const S=ii(b,d,p);c[y]=t(s[v],r[S])}return[c,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zs(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",i),imag:n.makeTensorInfo(r.shape,"float32",o)},a}const ive={kernelName:Cx,backendName:"cpu",kernelFunc:zs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iv(t,e,n="float32"){if(n==="complex64"){const r=iv(t,e,"float32"),i=iv(t,e,"float32");return zs({inputs:{real:r,imag:i},backend:t})}const s=On(G(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yi(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const ove={kernelName:Zh,backendName:"cpu",kernelFunc:Yi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tu(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.real,i=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,i)}const ave={kernelName:i1,backendName:"cpu",kernelFunc:Tu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xG(t,e,n,s){if(s==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(s==="bool"){const r=nl([0],n),[i,o]=qt((a,l)=>a!==l?1:0)(e,[],t,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function Ha(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Yi({inputs:{x:r},backend:n});const c=iv(n,r.shape,r.dtype),h=Ha({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),d=zs({inputs:{real:h,imag:c},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),d}if(r.dtype==="complex64"){const c=Tu({inputs:{input:r},backend:n}),h=Ha({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),h}if(!tk(r.dtype,i)){const c=Yi({inputs:{x:r},backend:n});return{dataId:c.dataId,shape:c.shape,dtype:i}}const o=n.data.get(r.dataId).values,[a,l,u]=xG(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,u)}const lve={kernelName:zh,backendName:"cpu",kernelFunc:Ha};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dn(t,e,n,s){return n==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;we([o,a],t);const u=l.data.get(o.dataId).values,c=l.data.get(a.dataId).values,h=o.dtype==="string"?Oo(u):u,d=o.dtype==="string"?Oo(c):c,f=s||o.dtype,[p,m]=e(o.shape,a.shape,h,d,f);return l.makeTensorInfo(m,f,p)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=Ha({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),c=l.data.get(u.dataId),h=c.complexTensorInfos.real,d=c.complexTensorInfos.imag,f=l.data.get(h.dataId).values,p=l.data.get(d.dataId).values,m=Ha({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(m.dataId),y=g.complexTensorInfos.real,w=g.complexTensorInfos.imag,x=l.data.get(y.dataId).values,v=l.data.get(w.dataId).values,[b,S,T]=n(o.shape,a.shape,f,p,x,v),_=l.makeTensorInfo(T,"float32",b),E=l.makeTensorInfo(T,"float32",S),N=zs({inputs:{real:_,imag:E},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(_),l.disposeIntermediateTensorInfo(E),N}else{const u=l.data.get(o.dataId).values,c=l.data.get(a.dataId).values,h=s||o.dtype,[d,f]=e(o.shape,a.shape,u,c,h);return l.makeTensorInfo(f,h,d)}}}function Q2(t){return(e,n,s,r,i,o)=>{const a=Ae(e,n),l=G(a),u=a.length,c=Ie(a),h=vn("float32",l),d=vn("float32",l),f=gu(e,a),p=gu(n,a),m=Do(s,r),g=Do(i,o),y=e.length,w=Ie(e),x=n.length,v=Ie(n);if(f.length+p.length===0)for(let b=0;b<h.length;b++){const S=b%m.length,T=b%g.length,_=t(m[S*2],m[S*2+1],g[T*2],g[T*2+1]);h[b]=_.real,d[b]=_.imag}else for(let b=0;b<h.length;b++){const S=zu(b,u,c),T=S.slice(-y);f.forEach(A=>T[A]=0);const _=ii(T,y,w),E=S.slice(-x);p.forEach(A=>E[A]=0);const N=ii(E,x,v),$=t(m[_*2],m[_*2+1],g[N*2],g[N*2+1]);h[b]=$.real,d[b]=$.imag}return[h,d,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bG=qt((t,e)=>t+e),uve=Q2((t,e,n,s)=>({real:t+n,imag:e+s})),yh=dn(Bu,bG,uve),cve={kernelName:Bu,backendName:"cpu",kernelFunc:yh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y2(t,e,n,s,r){const i=G(s),o=On(r,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function IG(t,e,n,s=!1){const r=t.shape[0],i=t.shape[1],o=Fe([r,n],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const u=t.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=n||(s?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TG=qt((t,e)=>t&e),hve=dn(Um,TG),dve={kernelName:Um,backendName:"cpu",kernelFunc:hve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zi(t){return(e,n,s)=>{const r=Ft(n,e.length);for(let i=0;i<e.length;++i)r[i]=t(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rt(t,e,n){const s=Zi(e);return cl(t,s,n)}function cl(t,e,n){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;we(o,t);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Oo(l)}else u=l;const c=n||o.dtype,h=e(u,c,r);return a.makeTensorInfo(o.shape,c,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SG=Zi(t=>Math.ceil(t)),fve=cl(Bh,SG),pve={kernelName:Bh,backendName:"cpu",kernelFunc:fve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _G(t,e,n,s){const r=Ft(n,G(e));if(s&&n!=="string"){let i=0;t.forEach(o=>{const a=G(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;t.forEach(o=>{const a=n==="string"?Oo(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const c=u*e[1]+i;for(let h=0;h<o.shape[1];++h)r[c+h]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CG=qt((t,e)=>t===e?1:0),EG=dn(Ym,CG,null,"bool"),mve={kernelName:Ym,backendName:"cpu",kernelFunc:EG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kG=Zi(t=>Math.exp(t)),NG=cl(Kh,kG,"float32"),gve={kernelName:Kh,backendName:"cpu",kernelFunc:NG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $G=Zi(t=>Math.expm1(t)),yve=cl(Xh,$G),wve={kernelName:Xh,backendName:"cpu",kernelFunc:yve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG=Zi(t=>Math.floor(t)),vve=cl(Qh,AG),xve={kernelName:Qh,backendName:"cpu",kernelFunc:vve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RG=qt((t,e)=>Math.floor(t/e)),bve=dn(Yh,RG,null,"int32"),Ive={kernelName:Yh,backendName:"cpu",kernelFunc:bve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DG(t,e,n,s,r,i,o,a,l){const u=Fe([s,i],n);for(let c=0;c<s;c++){const h=[];let d=0;for(let f=0;f<r;f++){const p=t[c*r+f];d+=p*o[f],h.push(p)}if(d<0||d>=l/i)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let f=0;f<i;f++)u.values[c*i+f]=e.get(...e.indexToLoc(d*i+f))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OG(t,e,n){const s=Fe(n,t.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const c=t.locToIndex(o);0<=c&&c<t.values.length&&(s.values[r]=t.values[c])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG=qt((t,e)=>t>e?1:0),Tve=dn(tg,PG,null,"bool"),Sve={kernelName:tg,backendName:"cpu",kernelFunc:Tve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG=qt((t,e)=>t>=e?1:0),_ve=dn(Jh,FG,null,"bool"),Cve={kernelName:Jh,backendName:"cpu",kernelFunc:_ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LG=qt((t,e)=>t<e?1:0),Eve=dn(sg,LG,null,"bool"),kve={kernelName:sg,backendName:"cpu",kernelFunc:Eve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG=qt((t,e)=>t<=e?1:0),Nve=dn(rg,MG,null,"bool"),$ve={kernelName:rg,backendName:"cpu",kernelFunc:Nve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VG(t,e,n){const s=(e-t)/(n-1),r=On(n,"float32");r[0]=t;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zG=Zi(t=>Math.log(t)),Ave=cl(sd,zG),Rve={kernelName:sd,backendName:"cpu",kernelFunc:Ave};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BG(t,e,n,s){const r=vn(s,G(n));for(let i=0;i<r.length;++i){const o=i*e;let a=t[o];for(let l=0;l<e;++l){const u=t[o+l];(Number.isNaN(u)||u>a)&&(a=u)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG=qt((t,e)=>Math.max(t,e)),Dve=dn(id,UG),Ove={kernelName:id,backendName:"cpu",kernelFunc:Dve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG=qt((t,e)=>Math.min(t,e)),Pve=dn(od,WG),Fve={kernelName:od,backendName:"cpu",kernelFunc:Pve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J2=qt((t,e)=>t*e),Lve=Q2((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),Fb=dn(ld,J2,Lve),Mve={kernelName:ld,backendName:"cpu",kernelFunc:Fb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jG(t,e,n){const s=Lo(-1,n);return J2([],e,s,t,n)}function Vve(t){const{inputs:e,backend:n}=t,{x:s}=e;we(s,"neg");const r=n.data.get(s.dataId).values,[i,o]=jG(r,s.shape,s.dtype);return n.makeTensorInfo(o,s.dtype,i)}const zve={kernelName:mg,backendName:"cpu",kernelFunc:Vve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GG=qt((t,e)=>t!==e?1:0),Bve=dn(gg,GG,null,"bool"),Uve={kernelName:gg,backendName:"cpu",kernelFunc:Bve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z2(t,e,n,s,r){const i=e.length,o=G(e),a=Ie(e),l=Ie(r),u=vn(n,G(r));for(let c=0;c<o;++c){const h=zu(c,i,a),d=new Array(h.length);for(let p=0;p<d.length;p++)d[p]=h[s[p]];const f=ii(d,i,l);u[f]=t[c]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $s(t){const{inputs:e,attrs:n,backend:s}=t,{x:r}=e,{perm:i}=n;we(r,"transpose");const o=r.shape.length,a=new Array(o);for(let h=0;h<a.length;h++)a[h]=r.shape[i[h]];const l=s.data.get(r.dataId).values,u=Z2(l,r.shape,r.dtype,i,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const Wve={kernelName:Gl,backendName:"cpu",kernelFunc:$s};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HG(t,e,n,s){const[r,i]=In(t,s),o=_s(e,"int32"),a=On(G(r),o),l=G(i);for(let u=0;u<a.length;++u){const c=u*l;let h=1;for(let d=0;d<l;++d)h*=n[c+d];a[u]=h}return{outVals:a,outShape:r,outDtype:o}}function jve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;we(r,"prod");const a=r.shape.length,l=Be(i,r.shape),u=Dt(l,a);let c=l,h=r;const d=[];u!=null&&(h=$s({inputs:{x:r},backend:n,attrs:{perm:u}}),d.push(h),c=Gt(c.length,a));const f=n.data.get(h.dataId).values,{outVals:p,outShape:m,outDtype:g}=HG(h.shape,h.dtype,f,c);let y=m;return o&&(y=jt(m,l)),d.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(y,g,p)}const Gve={kernelName:Ig,backendName:"cpu",kernelFunc:jve};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hve(t,e,n){t.forEach((s,r)=>{if(s<0||s>=n){const i=zu(r,e.length,Ie(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${n})`)}})}function qve(t,e){for(let n=0;n<t.length;++n){const s=t[n],r=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function Kve(t,e,n,s){const r=[];let i=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);qve(n,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const c=e[u+1];for(let h=1;h<l+1;++h)a[u].push(h*c)}for(let u=0;u<t.length;++u){let c=t[u],h=t[u]+1;for(let d=0;d<n.length;++d){const f=n[d],p=d+e.length-1;if(p>=0){const m=a[p],g=m[m.length-1]-f[c];for(let y=c;y<h;++y)a[p].push(f[y+1]+g)}c=f[c],h=f[h]}h!==c&&(r.push([c,h]),i+=h-c)}return{outSplits:a,valueSlices:r,numValues:i}}function Xve(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,r=Ft("int32",s);e.push(r),t[n].forEach((i,o)=>r[o]=i)}return e}function XP(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function Qve(t,e,n,s,r,i){const o=XP(e,2)[1],a=XP(i,2)[1];let l=0;for(const u of n)for(let c=u[0];c<u[1];++c){for(let h=0;h<s;++h)r[l*a+h]=t[c*o+h];++l}}function Yve(t,e,n,s,r){const i=e.slice();i[0]=r;const o=Ft(n,G(i)),a=t.length,l=a===0?0:a/e[0];return Qve(t,e,s,l,o,i),[o,i]}function qG(t,e,n,s,r,i,o,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(Hve(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:c,valueSlices:h,numValues:d}=Kve(i,o,t,u),f=Xve(c),p=Yve(n,s,r,h,d);return[f,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QP=2147483647;function KG(t,e,n,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=o.length===0,c=[];a||c.push(e[0]),l||c.push(r[0]),u||c.push(o[0]);for(let g=1;g<c.length;++g)if(c[g]!==c[g-1])throw new Error("starts, limits, and deltas must have the same shape");const h=c.length===0?1:c[0],d=Ft("int32",h+1);d[0]=0;for(let g=0;g<h;++g){const y=a?t[0]:t[g],w=l?s[0]:s[g],x=u?i[0]:i[g];if(x===0)throw new Error("Requires delta != 0");let v;if(x>0&&w<y||x<0&&w>y)v=0;else if(v=Math.ceil(Math.abs((w-y)/x)),v>QP)throw new Error(`Requires ((limit - start) / delta) <= ${QP}`);d[g+1]=d[g]+v}const f=d[h],p=Ft(n,f);let m=0;for(let g=0;g<h;++g){const y=d[g+1]-d[g];let w=a?t[0]:t[g];const x=u?i[0]:i[g];for(let v=0;v<y;++v)p[m++]=w,w+=x}return[d,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var _r=ei;class ov{constructor(e,n,s,r,i,o,a,l,u,c){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=pW(c),this.raggedRank=mW(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===_r.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===_r.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case _r.VALUE_ROWIDS:return ov.getMaxWidthValueRowID(n);case _r.ROW_SPLITS:return ov.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${_r[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let r=0;r<n-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<n;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(n-s,i)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return JP(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;gW(s,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=fW(this.raggedRank,r,n);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,n,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=n)i.push(o);for(let a=r;a<e;++a)i.push(-1);return C(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,n,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),c=n[a];c===-1&&(u=0);for(let h=0;h<u;++h)o.push(c),c+=s;for(let h=0;h<l-u;++h)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,n,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let u=n[l];o.push(u);for(let c=1;c<i;++c){const h=e[c];if(h===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=h,h>=n.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${n.length}`);u=n[h]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,n,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case _r.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,n,s,r);case _r.ROW_SPLITS:if(i.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(i,n,s,r);default:throw new Error(`Unsupported partition type: ${_r[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case _r.FIRST_DIM_SIZE:return e[0];case _r.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case _r.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${_r[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=JP(s,!1),o=Ft(this.valuesDType,G(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,n,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=G(a),u=n.length;let c=this.defaultValue;if(c.length!==l&&c.length!==1){const p=this.defaultValueShape;W(()=>{const m=L(c,p);c=Hl(m,a).dataSync()})}let h=0,d=0,f=0;for(let p=0;p<=u;++p){let m=p<u?n[p]:-1;if(m===f){++f;continue}if(d<f){const g=i.subarray(h*l),y=o.subarray(d*l),w=(f-d)*l;YP(y,g,w)}if(p>=u){const g=s.length;m=Math.floor(g/l)}if(m>f)if(this.defaultValue.length===1)o.subarray(f*l,m*l).fill(this.defaultValue[0]),f=m;else for(;m>f;){const g=o.slice(f*l);YP(g,c,l),++f}m<0?(h=p+1,d=f):(h=p,d=f,f=d+1)}}}function YP(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function JP(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function XG(t,e,n,s,r,i,o,a,l,u){return new ov(t,e,n,s,r,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QG(t,e,n,s){const r=t===e,i=t<e&&n<0,o=e<t&&n>1;if(r||i||o)return On(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=On(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let u=1;u<l.length;u++)l[u]=l[u-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YG=Zi(t=>1/Math.sqrt(t)),Jve=cl(pd,YG),Zve={kernelName:pd,backendName:"cpu",kernelFunc:Jve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fl(t,e,n,s,r,i,o,a,l,u){const c=[s/r,r],h=t.values,d=e.values;if(s===0)return Fe(n,e.dtype);const f=l instanceof Jt?l:Fe(c,e.dtype);typeof l=="string"||typeof l=="number"?f.values.fill(l):typeof l=="boolean"&&f.values.fill(+l);for(let p=0;p<i;p++){const m=[];let g=0;for(let y=0;y<o;y++){const w=h[p*o+y];m.push(w),g+=w*a[y]}if(g<0||g>=s/r)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let y=0;y<r;y++)u?f.values[g*r+y]+=d[p*r+y]:f.values[g*r+y]=e.rank===0?d[0]:d[p*r+y]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const exe=Zi(t=>1/(1+Math.exp(-t))),JG=rt(vd,t=>1/(1+Math.exp(-t))),txe={kernelName:vd,backendName:"cpu",kernelFunc:JG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZG(t,e,n,s,r){const i=zN(s,e,n),o=G(n),a=Ie(s);if(i){const h=BN(e,a);return r==="string"?t.slice(h,h+o):t.subarray(h,h+o)}const l=r==="string"?Oo(t):t,u=Fe(s,r,l),c=Fe(n,r);for(let h=0;h<c.size;++h){const d=c.indexToLoc(h),f=d.map((p,m)=>p+e[m]);c.set(u.get(...f),...d)}return r==="string"?FW(c.values):c.values}function Su(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s;we(r,"slice");const[a,l]=hb(r,i,o);MN(r,a,l);const u=n.data.get(r.dataId).values,c=ZG(u,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,c)}const nxe={kernelName:kg,backendName:"cpu",kernelFunc:Su};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eH(t,e,n,s,r,i,o){const a=e[0],l=i[0],u=new Array(l),c=new Array(a),h=e[1];if(l===0){if(a!==0)throw new Error(TW(a));const g=Ft(n,0),y=Ft(r,0);return[g,[0,h],y,u,c]}let d=!0,f=0;const p=new Array(l).fill(0);for(let g=0;g<a;++g){const y=t[g*h];if(y<0)throw new Error(SW(g,y));if(y>=l)throw new Error(_W(g,y,l));++p[y],d=d&&y>=f,f=y}let m=!0;for(let g=0;g<l;++g){const y=p[g]===0;u[g]=y,m=m&&!y,p[g]=Math.max(p[g],1),g>0&&(p[g]+=p[g-1])}if(m&&d){const g=t,y=s;for(let w=0;w<a;++w)c[w]=w;return[g,[a,h],y,u,c]}else{const g=p[l-1],y=Ft(n,g*h),w=Ft(r,g),x=new Array(l).fill(0);for(let v=0;v<a;++v){const b=t[v*h],S=x[b],T=(b===0?0:p[b-1])+S;x[b]++;for(let _=0;_<h;++_)y[T*h+_]=t[v*h+_];w[T]=s[v],c[v]=T}for(let v=0;v<l;++v)if(x[v]===0){const S=v===0?0:p[v-1];y[S*h+0]=v;for(let T=1;T<h;++T)y[S*h+T]=0;w[S]=o}return[y,[g,h],w,u,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tH(t,e,n,s,r){const i=G(s),o=e[0],a=r.length,l=[];let u=1,c=-1;for(let g=0;g<a;++g){const y=r[g];if(y===-1){if(c!==-1)throw new Error(CW(c,g));c=g,l.push(1)}else{if(y<0)throw new Error(EW(g,y));u*=y,l.push(y)}}if(c!==-1){if(u<=0)throw new Error(kW());const g=Math.trunc(i/u);if(u*g!==i)throw new Error(NW(s,l));l[c]=g}if(G(l)!==i)throw new Error($W(s,l));const d=s.length,f=[];if(d>0){f[d-1]=1;for(let g=d-2;g>=0;--g)f[g]=f[g+1]*s[g+1]}const p=[];if(a>0){p[a-1]=1;for(let g=a-2;g>=0;--g)p[g]=p[g+1]*l[g+1]}const m=Ft(n,o*a);for(let g=0;g<o;++g){let y=0;for(let w=0;w<d;++w)y+=t[g*d+w]*f[w];for(let w=0;w<a;++w)m[g*a+w]=Math.trunc(y/p[w]),y%=p[w]}return[m,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eA(t,e,n,s,r,i=!1,o=0){const a=s.length,l=[e[0],t.length/e[0]],u=l[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(t_());const d=e.slice();d[0]=h;const f=d.reduce((x,v)=>x*v,1),p=Ft(n,f);if(a===0)return h>0&&p.fill(o),[p,d];if(h<=0)throw new Error(t_());let m=0,g=1,y=0,w=r[m];for(;;){let x=0;if(g<a){if(x=r[g],w===x){++g;continue}if(w>=x)throw new Error(AW())}if(w<0||w>=h)throw new Error(RW(w,h));w>y&&p.fill(o,y*u,w*u);for(let v=m;v<g;++v){const b=s[v];if(b<0||b>=l[0])throw new Error(DW(v,s[v],l[0]));for(let S=0;S<u;S++)p[w*u+S]+=t[b*u+S]}if(i)for(let v=0;v<u;v++)p[w*u+v]/=g-m;if(m=g,++g,y=w+1,w=x,g>a)break}return y<h&&p.fill(o,y*u,h*u),[p,d]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sxe=Zi(t=>Math.sqrt(t)),rxe=rt(bd,t=>Math.sqrt(t)),ixe={kernelName:bd,backendName:"cpu",kernelFunc:rxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nH=qt((t,e)=>{const n=t-e;return n*n}),oxe=dn(Id,nH),axe={kernelName:Id,backendName:"cpu",kernelFunc:oxe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sH=Zi((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:r}=e;return t.replace(new RegExp(n,s?"g":""),r)}),lxe=cl(Dg,sH),uxe={kernelName:Dg,backendName:"cpu",kernelFunc:lxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rH(t,e,n,s){const r=Fe(t,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*n[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cxe{constructor(e,n,s,r,i,o){this.separator=Bi(e),this.nGramWidths=n,this.leftPad=Bi(s),this.rightPad=Bi(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),c=Math.max(0,l-(i-(a+1))),h=o-(u+c),d=n+(u>0?0:a-l);let f=0;f+=u*this.leftPad.length;for(let w=0;w<h;++w)f+=e[d+w].length;f+=c*this.rightPad.length;const p=u+c+h-1;f+=p*this.separator.length,s[r+a]=new Uint8Array(f);const m=s[r+a];let g=0;const y=w=>w.forEach(x=>m[g++]=x);for(let w=0;w<u;++w)y(this.leftPad),y(this.separator);for(let w=0;w<h-1;++w)y(e[d+w]),y(this.separator);if(h>0){y(e[d+h-1]);for(let w=0;w<c;++w)y(this.separator),y(this.rightPad)}else{for(let w=0;w<c-1;++w)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,n){const s=e.length,r=n.length;if(r>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let c=n[u]>=l;if(c=c&&n[u]<=s,!c)throw new Error(`Invalid split value ${n[u]}, must be in [${l}, ${s}]`);l=n[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=Ft("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=n[l]-n[l-1];let c=0;this.nGramWidths.forEach(h=>{c+=this.getNumNGrams(u,h)}),this.preserveShort&&u>0&&c===0&&(c=1),o[l]=o[l-1]+c}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=n[l];let c=o[l];if(this.nGramWidths.forEach(h=>{const d=n[l+1]-n[l],f=this.getNumNGrams(d,h);this.createNGrams(e,u,a,c,f,h),c+=f}),this.preserveShort&&c===o[l]){const h=n[l+1]-n[l];if(h===0)continue;const d=h+2*this.padWidth;this.createNGrams(e,u,a,c,1,d)}}return[a,o]}}function iH(t,e,n,s,r,i,o,a){return new cxe(n,s,r,i,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hxe(t,e,n,s){if(!t.length)return;if(e.length===0){for(let i=0;i<t.length;++i)s.push(t.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=t.indexOf(i);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&s.push(a),t=t.subarray(o+1),o=t.indexOf(i)}(!n||t.length!==0)&&s.push(t);return}let r=0;for(let i=0;i<t.length+1;i++)if(i===t.length||e.indexOf(t[i])!==-1){const o=t.subarray(r,i);(!n||o.length!==0)&&s.push(o),r=i+1}}function oH(t,e,n){const s=t.length,r=[];let i=0,o=0;const a=new Array(s);for(let d=0;d<s;++d){const f=r.length;hxe(t[d],e,n,r);const p=r.length-f;a[d]=p,i+=p,o=Math.max(o,p)}const l=Ft("int32",i*2),u=new Array(i),c=[s,o];let h=0;for(let d=0;d<s;++d)for(let f=0;f<a[d];++f)l[h*2]=d,l[h*2+1]=f,u[h]=r[h],++h;return[l,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aH(t,e){const n=Ft("int32",t.length);for(let s=0;s<t.length;++s)n[s]=w4(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lH=qt((t,e)=>t-e),dxe=Q2((t,e,n,s)=>({real:t-n,imag:e-s})),tA=dn(Td,lH,dxe),fxe={kernelName:Td,backendName:"cpu",kernelFunc:tA};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uH(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const s=Fe(n,t.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(t.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%t.shape[l];const a=t.locToIndex(o);s.values[r]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $f=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function cH(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(a-c)/a)*Math.sign(l-a/2),d=Math.max(n,Math.floor(e-l*c/a+h)),f=Math.min(s,Math.floor(e+(a-l)*c/a+h));cH(t,e,d,f)}const r=t[e];let i=n,o=s;for(uo(t,n,e),$f(t[s],r)>0&&uo(t,n,s);i<o;){for(uo(t,i,o),i++,o--;$f(t[i],r)<0;)i=i+1;for(;$f(t[o],r)>0;)o=o-1}$f(t[n],r)===0?uo(t,n,o):(o=o+1,uo(t,o,s)),o<=e&&(n=o+1),e<=o&&(s=o-1)}}function hH(t,e,n,s,r){const i=e[e.length-1],[o,a]=[t.length/i,i],l=vn(n,o*s),u=vn("int32",o*s);for(let h=0;h<o;h++){const d=h*a,f=t.subarray(d,d+a);let p=new Array(f.length);f.forEach((w,x)=>p[x]={value:w,index:x}),s<p.length&&(cH(p,s),p=p.slice(0,s)),r&&p.sort($f);const m=h*s,g=l.subarray(m,m+s),y=u.subarray(m,m+s);for(let w=0;w<s;w++)g[w]=p[w].value,y[w]=p[w].index}const c=e.slice();return c[c.length-1]=s,[Fe(c,n,l),Fe(c,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dH(t,e,n,s){const r=Be(e,n)[0],i=[1,n[0],1];for(let p=0;p<r;p++)i[0]*=n[p];i[1]=n[r];for(let p=r+1;p<n.length;p++)i[2]*=n[p];const o=new Map,a=new Int32Array(n[r]),l=new Jt(i,s,t),u=[],c=i[0]===1&&i[2]===1;for(let p=0;p<n[r];p++){let m;if(c)m=t[p].toString();else{const y=[];for(let w=0;w<i[0];w++)for(let x=0;x<i[2];x++)y.push(l.get(w,p,x));m=y.join(",")}const g=o.get(m);if(g!=null)a[p]=g;else{const y=o.size;o.set(m,y),a[p]=y,u.push(p)}}const h=i.slice();h[1]=o.size;const d=new Jt(h,s);u.forEach((p,m)=>{for(let g=0;g<i[0];g++)for(let y=0;y<i[2];y++)d.set(l.get(g,p,y),g,m,y)});const f=n.slice();return f[r]=h[1],{outputValues:d.values,outputShape:f,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fH=Object.freeze(Object.defineProperty({__proto__:null,addImpl:bG,bincountImpl:Y2,bincountReduceImpl:IG,bitwiseAndImpl:TG,castImpl:xG,ceilImpl:SG,concatImpl:_G,equalImpl:CG,expImpl:kG,expm1Impl:$G,floorDivImpl:RG,floorImpl:AG,gatherNdImpl:DG,gatherV2Impl:OG,greaterEqualImpl:FG,greaterImpl:PG,lessEqualImpl:MG,lessImpl:LG,linSpaceImpl:VG,logImpl:zG,maxImpl:BG,maximumImpl:UG,minimumImpl:WG,multiplyImpl:J2,negImpl:jG,notEqualImpl:GG,prodImpl:HG,raggedGatherImpl:qG,raggedRangeImpl:KG,raggedTensorToTensorImpl:XG,rangeImpl:QG,rsqrtImpl:YG,scatterImpl:Fl,sigmoidImpl:exe,simpleAbsImpl:vG,sliceImpl:ZG,sparseFillEmptyRowsImpl:eH,sparseReshapeImpl:tH,sparseSegmentReductionImpl:eA,sqrtImpl:sxe,squaredDifferenceImpl:nH,staticRegexReplaceImpl:sH,stridedSliceImpl:rH,stringNGramsImpl:iH,stringSplitImpl:oH,stringToHashBucketFastImpl:aH,subImpl:lH,tileImpl:uH,topKImpl:hH,transposeImpl:Z2,uniqueImpl:dH},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const pH="4.17.0";/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ck("cpu",()=>new my,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mH=rt(Hh,t=>t>=0?t:Math.exp(t)-1),pxe={kernelName:Hh,backendName:"cpu",kernelFunc:mH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gH(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s;we([r],"leakyRelu");const o=G(r.shape),a=n.data.get(r.dataId).values,l=vn("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return n.makeTensorInfo(r.shape,"float32",l)}const mxe={kernelName:ng,backendName:"cpu",kernelFunc:gH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gxe=qt((t,e)=>t<0?e*t:t);function yH(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e;we([s,r],"prelu");const i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,[a,l]=gxe(s.shape,r.shape,i,o,"float32");return n.makeTensorInfo(l,"float32",a)}const yxe={kernelName:bg,backendName:"cpu",kernelFunc:yH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wH=rt(hd,t=>Math.max(0,t)),wxe={kernelName:hd,backendName:"cpu",kernelFunc:wH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vH=rt(dd,t=>Math.min(Math.max(0,t),6)),vxe={kernelName:dd,backendName:"cpu",kernelFunc:vH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function av(t,e,n,s,r){if(n==="linear")return Yi({inputs:{x:e},backend:t});if(n==="relu")return wH({inputs:{x:e},backend:t});if(n==="elu")return mH({inputs:{x:e},backend:t});if(n==="relu6")return vH({inputs:{x:e},backend:t});if(n==="prelu")return yH({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return gH({inputs:{x:e},backend:t,attrs:{alpha:r}});if(n==="sigmoid")return JG({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mt(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:i}=s,o=G(r.shape),a=ek(i,o),l=G(a);C(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(r.dataId);const u=n.data.get(r.dataId);if(u.complexTensorInfos!=null){const c=u.complexTensorInfos.real,h=u.complexTensorInfos.imag;c.shape=a,h.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const xxe={kernelName:Tg,backendName:"cpu",kernelFunc:mt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xH(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;we([r,i],"matMul");const l=r.shape.length,u=i.shape.length,c=o?r.shape[l-2]:r.shape[l-1],h=a?i.shape[u-1]:i.shape[u-2],d=o?r.shape[l-1]:r.shape[l-2],f=a?i.shape[u-2]:i.shape[u-1],p=r.shape.slice(0,-2),m=i.shape.slice(0,-2),g=G(p),y=G(m),x=Ae(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,f]);C(c===h,()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const v=o?[g,c,d]:[g,d,c],b=a?[y,f,h]:[y,h,f],S=mt({inputs:{x:r},backend:n,attrs:{shape:v}}),T=mt({inputs:{x:i},backend:n,attrs:{shape:b}}),_=o?S.shape[1]:S.shape[2],E=o?S.shape[2]:S.shape[1],N=a?T.shape[1]:T.shape[2],$=Math.max(g,y),A=n.data.get(S.dataId).values,D=n.data.get(T.dataId).values,F=Ie(S.shape),B=Ie(T.shape),[z,H,M]=o?[F[0],1,F[1]]:[F[0],F[1],1],[j,K,X]=a?[1,B[1],B[0]]:[B[1],1,B[0]],Z=E*N,te=Fe([$,E,N],S.dtype),ie=te.values,se=n.blockSize;for(let ce=0;ce<$;ce++){const xe=ce%g,Ce=ce%y;for(let _e=0;_e<E;_e+=se){const Le=Math.min(_e+se,E);for(let Ve=0;Ve<N;Ve+=se){const nt=Math.min(Ve+se,N);for(let ht=0;ht<_;ht+=se){const Ot=Math.min(ht+se,_);for(let dt=_e;dt<Le;dt++)for(let it=Ve;it<nt;it++){let Et=0;for(let xt=ht;xt<Ot;xt++){const eo=A[xe*z+dt*H+xt*M],Tn=D[xt*j+it*K+Ce*X];Et+=eo*Tn}ie[ce*Z+(dt*N+it)]+=Et}}}}}return n.disposeIntermediateTensorInfo(S),n.disposeIntermediateTensorInfo(T),n.makeTensorInfo(x,te.dtype,te.values)}const bxe={kernelName:zm,backendName:"cpu",kernelFunc:xH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ixe(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=s;let d,f,p;const m=[];d=xH({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:u},backend:n}),o&&(f=yh({inputs:{a:d,b:o},backend:n}),m.push(d),d=f),c&&(p=av(n,d,c,a,h),m.push(d),d=p);for(const y of m)n.disposeIntermediateTensorInfo(y);return d}const Txe={kernelName:Up,backendName:"cpu",kernelFunc:Ixe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sxe=rt(Dh,t=>Math.acos(t)),_xe={kernelName:Dh,backendName:"cpu",kernelFunc:Sxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cxe=rt(Oh,t=>Math.acosh(t)),Exe={kernelName:Oh,backendName:"cpu",kernelFunc:Cxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kxe(t){const{inputs:e,backend:n}=t,s=e;we(e,"addN");const r=s.map(a=>n.data.get(a.dataId).values),i=Fe(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}const Nxe={kernelName:Pm,backendName:"cpu",kernelFunc:kxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $xe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;we(r,"all");const a=Be(i,r.shape);let l=a;const u=Dt(l,r.shape.length);let c=r;u!=null&&(c=$s({inputs:{x:r},backend:n,attrs:{perm:u}}),l=Gt(l.length,r.shape.length)),zn("all",l,c.shape.length);const[h,d]=In(c.shape,l),f=G(d),p=On(G(h),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const w=y*f;let x=m[w];for(let v=0;v<f;++v){const b=m[w+v];x=x&&b}p[y]=x}u!=null&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(h,c.dtype,p);if(o){const y=jt(h,a),w=mt({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),w}return g}const Axe={kernelName:xx,backendName:"cpu",kernelFunc:$xe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;we(r,"any");const a=Be(i,r.shape);let l=a;const u=Dt(l,r.shape.length);let c=r;u!=null&&(c=$s({inputs:{x:r},backend:n,attrs:{perm:u}}),l=Gt(l.length,r.shape.length)),zn("any",l,c.shape.length);const[h,d]=In(c.shape,l),f=G(d),p=On(G(h),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const w=y*f;let x=m[w];for(let v=0;v<f;++v){const b=m[w+v];x=x||b}p[y]=x}u!=null&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(h,c.dtype,p);if(o){const y=jt(h,a),w=mt({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),w}return g}const Dxe={kernelName:bx,backendName:"cpu",kernelFunc:Rxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;we(r,"argMax");let o=Be(i,r.shape);const a=Dt(o,r.shape.length);let l=r;const u=[];a!=null&&(l=$s({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=Gt(o.length,l.shape.length)),o=[o[0]],zn("argMax",o,l.shape.length);const[c,h]=In(l.shape,o),d=G(c),f=On(d,"int32"),p=G(h),m=n.data.get(l.dataId).values;for(let g=0;g<f.length;++g){const y=g*p;let w=m[y],x=0;for(let v=0;v<p;++v){const b=m[y+v];b>w&&(w=b,x=v)}f[g]=x}return u.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(c,"int32",f)}const Pxe={kernelName:Fm,backendName:"cpu",kernelFunc:Oxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;we(r,"argMin");let o=Be(i,r.shape);const a=Dt(o,r.shape.length);let l=r;const u=[];a!=null&&(l=$s({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=Gt(o.length,l.shape.length)),o=[o[0]],zn("argMin",o,l.shape.length);const[c,h]=In(l.shape,o),d=G(c),f=On(d,"int32"),p=G(h),m=n.data.get(l.dataId).values;for(let g=0;g<f.length;++g){const y=g*p;let w=m[y],x=0;for(let v=0;v<p;++v){const b=m[y+v];b<w&&(w=b,x=v)}f[g]=x}return u.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(c,"int32",f)}const Lxe={kernelName:Lm,backendName:"cpu",kernelFunc:Fxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mxe=rt(Ph,t=>Math.asin(t)),Vxe={kernelName:Ph,backendName:"cpu",kernelFunc:Mxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zxe=rt(Fh,t=>Math.asinh(t)),Bxe={kernelName:Fh,backendName:"cpu",kernelFunc:zxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uxe=rt(Lh,t=>Math.atan(t)),Wxe={kernelName:Lh,backendName:"cpu",kernelFunc:Uxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jxe=qt((t,e)=>Math.atan2(t,e)),Gxe=dn(Vh,jxe),Hxe={kernelName:Vh,backendName:"cpu",kernelFunc:Gxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qxe=rt(Mh,t=>Math.atanh(t)),Kxe={kernelName:Mh,backendName:"cpu",kernelFunc:qxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nA(t,e,n,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,p=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Fe(r.outShape,n),g=m.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],w=r.outShape[2]*r.outShape[3],x=r.outShape[3];for(let v=0;v<r.batchSize;++v){const b=v*y,S=v*s[0];for(let T=0;T<r.inChannels;++T)for(let _=0;_<r.outHeight;++_){const E=_*o-d,N=Math.max(0,E),$=Math.min(r.inHeight,c+E),A=b+_*w;for(let D=0;D<r.outWidth;++D){const F=D*a-f,B=Math.max(0,F),z=Math.min(r.inWidth,h+F);let H=p,M=0,j=0;for(let X=N;X<$;X+=l){const Z=S+X*s[1];for(let te=B;te<z;te+=u){const ie=Z+te*s[2],se=t[ie+T];i==="max"&&se>H?H=se:i==="avg"&&(M+=se,j++)}if(isNaN(H))break}const K=A+D*x+T;g[K]=i==="avg"?M/j:H}}}return m}function bH(t,e,n,s,r=!1,i=!1){const o=Fe(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,c=s.dilationWidth,h=s.effectiveFilterHeight,d=s.effectiveFilterWidth,f=s.padInfo.top,p=s.padInfo.left,m=Fe(e,n,t);for(let g=0;g<s.batchSize;++g)for(let y=0;y<s.inChannels;++y)for(let w=0;w<s.outHeight;++w){const x=w*a-f;let v=x;for(;v<0;)v+=u;const b=Math.min(s.inHeight,h+x);for(let S=0;S<s.outWidth;++S){const T=S*l-p;let _=T;for(;_<0;)_+=c;const E=Math.min(s.inWidth,d+T);let N=Number.NEGATIVE_INFINITY,$=-1;for(let A=v;A<b;A+=u){const D=A-x;for(let F=_;F<E;F+=c){const B=F-T,z=m.get(g,A,F,y);z>N&&(N=z,r?$=i?((g*s.inHeight+A)*s.inWidth+F)*s.inChannels+y:(A*s.inWidth+F)*s.inChannels+y:$=D*d+B)}}o.set($,g,w,S,y)}}return o}function IH(t,e,n,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,g=r.padInfo.top,y=r.padInfo.left,w=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=Fe(r.outShape,n),v=x.values,b=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],S=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],_=r.outShape[4];for(let E=0;E<r.batchSize;++E){const N=E*b,$=E*s[0];for(let A=0;A<r.inChannels;++A)for(let D=0;D<r.outDepth;++D){const F=D*o-m;let B=F;for(;B<0;)B+=u;const z=Math.min(r.inDepth,d+F),H=N+D*S;for(let M=0;M<r.outHeight;++M){const j=M*a-g;let K=j;for(;K<0;)K+=c;const X=Math.min(r.inHeight,f+j),Z=H+M*T;for(let te=0;te<r.outWidth;++te){const ie=te*l-y;let se=ie;for(;se<0;)se+=h;const ce=Math.min(r.inWidth,p+ie),xe=Z+te*_;let Ce=w,_e=0,Le=0;for(let nt=B;nt<z;nt+=u){const ht=$+nt*s[1];for(let Ot=K;Ot<X;Ot+=c){const dt=ht+Ot*s[2];for(let it=se;it<ce;it+=h){const Et=dt+it*s[3],xt=t[Et+A];if(i==="max"&&xt>Ce?Ce=xt:i==="avg"&&(_e+=xt,Le++),isNaN(Ce))break}if(isNaN(Ce))break}if(isNaN(Ce))break}const Ve=xe+A;v[Ve]=i==="avg"?_e/Math.max(Le,1):Ce}}}}return x}function Xxe(t,e){const n=Fe(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let y=0;y<e.outDepth;++y){const w=y*s-d;let x=w;for(;x<0;)x+=o;const v=Math.min(e.inDepth,u+w);for(let b=0;b<e.outHeight;++b){const S=b*r-f;let T=S;for(;T<0;)T+=a;const _=Math.min(e.inHeight,c+S);for(let E=0;E<e.outWidth;++E){const N=E*i-p;let $=N;for(;$<0;)$+=l;const A=Math.min(e.inWidth,h+N);let D=Number.NEGATIVE_INFINITY,F=-1;for(let B=x;B<v;B+=o){const z=B-w;for(let H=T;H<_;H+=a){const M=H-S;for(let j=$;j<A;j+=l){const K=j-N,X=t.get(m,B,H,j,g);X>=D&&(D=X,F=z*c*h+M*c+K)}}}n.set(F,m,y,b,E,g)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;we(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;C(Vn(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=Ur(r.shape,i,o,u,a,l);let h;if(c.filterWidth===1&&c.filterHeight===1&&We(c.inShape,c.outShape))h=Yi({inputs:{x:r},backend:n});else{const d=n.data.get(r.dataId).values,f=Ie(r.shape),p=nA(d,r.shape,r.dtype,f,c,"avg");h=n.makeTensorInfo(c.outShape,r.dtype,p.values)}return h}const Yxe={kernelName:Mm,backendName:"cpu",kernelFunc:Qxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;we(r,"avgPool3d");const c=Mo(r.shape,i,o,1,a,l,u),h=n.data.get(r.dataId).values,d=IH(h,r.shape,r.dtype,Ie(r.shape),c,"avg");return n.makeTensorInfo(d.shape,"float32",d.values)}const Zxe={kernelName:Vm,backendName:"cpu",kernelFunc:Jxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e1e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;we([r,i],"avgPool3DGrad");const c=Mo(i.shape,o,a,1,l,u),h=c.strideDepth,d=c.strideHeight,f=c.strideWidth,p=c.filterDepth,m=c.filterHeight,g=c.filterWidth,y=c.dilationDepth,w=c.dilationHeight,x=c.dilationWidth,v=c.effectiveFilterDepth,b=c.effectiveFilterHeight,S=c.effectiveFilterWidth,T=v-1-c.padInfo.front,_=S-1-c.padInfo.left,E=b-1-c.padInfo.top,N=Fe(i.shape,"float32"),$=1/(p*m*g),A=n.bufferSync(r);for(let D=0;D<c.batchSize;++D)for(let F=0;F<c.inChannels;++F)for(let B=0;B<c.inDepth;++B)for(let z=0;z<c.inHeight;++z)for(let H=0;H<c.inWidth;++H){const M=B-T,j=z-E,K=H-_;let X=0;for(let Z=0;Z<v;Z+=y){const te=(M+Z)/h;if(!(te<0||te>=c.outDepth||Math.floor(te)!==te))for(let ie=0;ie<b;ie+=w){const se=(j+ie)/d;if(!(se<0||se>=c.outHeight||Math.floor(se)!==se))for(let ce=0;ce<S;ce+=x){const xe=(K+ce)/f;if(xe<0||xe>=c.outWidth||Math.floor(xe)!==xe)continue;const Ce=A.get(D,te,se,xe,F);X+=Ce}}}N.set(X*$,D,B,z,H,F)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}const t1e={kernelName:Tx,backendName:"cpu",kernelFunc:e1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n1e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;we([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,c=Ur(o.shape,a,l,1,u),h=c.strideHeight,d=c.strideWidth,f=c.filterHeight,p=c.filterWidth,m=c.dilationHeight,g=c.dilationWidth,y=c.effectiveFilterHeight,w=c.effectiveFilterWidth,x=w-1-c.padInfo.left,v=y-1-c.padInfo.top,b=Fe(o.shape,"float32"),S=1/(f*p),T=n.data.get(r.dataId).values,_=Fe(r.shape,"float32",T);for(let E=0;E<c.batchSize;++E)for(let N=0;N<c.inChannels;++N)for(let $=0;$<c.inHeight;++$)for(let A=0;A<c.inWidth;++A){const D=$-v,F=A-x;let B=0;for(let z=0;z<y;z+=m){const H=(D+z)/h;if(!(H<0||H>=c.outHeight||Math.floor(H)!==H))for(let M=0;M<w;M+=g){const j=(F+M)/d;if(j<0||j>=c.outWidth||Math.floor(j)!==j)continue;const K=_.get(E,H,j,N);B+=K}}b.set(B*S,E,$,A,N)}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const s1e={kernelName:Ix,backendName:"cpu",kernelFunc:n1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,scale:i,offset:o,mean:a,variance:l}=e;C(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),C(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),C(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),we([r,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const c=n.data.get(r.dataId).values,h=n.data.get(a.dataId).values,d=n.data.get(l.dataId).values,f=i?n.data.get(i.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),g=p.length,y=f.length,w=d.length,x=h.length;let v=0,b=0,S=0,T=0;for(let _=0;_<c.length;++_)m[_]=p[v++]+(c[_]-h[b++])*f[S++]/Math.sqrt(d[T++]+u),v>=g&&(v=0),b>=x&&(b=0),S>=y&&(S=0),T>=w&&(T=0);return n.makeTensorInfo(r.shape,r.dtype,m)}const i1e={kernelName:Zm,backendName:"cpu",kernelFunc:r1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;we([r],"batchToSpaceND");const a=i.reduce((y,w)=>y*w),l=sy(r.shape,i,a),u=ry(l.length,i.length),c=iy(r.shape,i,a),h=qN(o,i.length),d=KN(c,o,i.length),f=mt({inputs:{x:r},backend:n,attrs:{shape:l}}),p=$s({inputs:{x:f},backend:n,attrs:{perm:u}}),m=mt({inputs:{x:p},backend:n,attrs:{shape:c}}),g=Su({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const a1e={kernelName:Bm,backendName:"cpu",kernelFunc:o1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,u=Y2(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}const u1e={kernelName:Sx,backendName:"cpu",kernelFunc:l1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c1e(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,a=Ae(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const h1e={kernelName:_x,backendName:"cpu",kernelFunc:c1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d1e=rt(Uh,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),f1e={kernelName:Uh,backendName:"cpu",kernelFunc:d1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p1e=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(G(e.shape)),r=n.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const c=a[u],h=l[u];s[u]=Math.hypot(c,h)}return n.makeOutput(s,e.shape,"float32")},m1e={kernelName:Wm,backendName:"cpu",kernelFunc:p1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wh(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.imag,i=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,i)}const g1e={kernelName:Gx,backendName:"cpu",kernelFunc:wh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vh(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=Be(r,e[0].shape)[0],o=e.map(m=>m.shape);jN(o,i);let a=Wi(e.map(m=>m.shape),i);if(G(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(m=>G(m.shape)>0);if(l.length===1)return Yi({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const m=l.map(v=>Tu({inputs:{input:v},backend:n})),g=l.map(v=>wh({inputs:{input:v},backend:n})),y=vh({inputs:m,backend:n,attrs:{axis:i}}),w=vh({inputs:g,backend:n,attrs:{axis:i}}),x=zs({inputs:{real:y,imag:w},backend:n});return m.forEach(v=>n.disposeIntermediateTensorInfo(v)),g.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(w),x}const u=l.map(m=>{const y=[-1,G(m.shape.slice(i))];return mt({inputs:{x:m},backend:n,attrs:{shape:y}})}),c=u.map(m=>({vals:n.data.get(m.dataId).values,shape:m.shape}));a=Wi(u.map(m=>m.shape),1);const h=u[0].shape[0]===1,d=_G(c,a,e[0].dtype,h),f=Wi(l.map(m=>m.shape),i),p=n.makeTensorInfo(f,e[0].dtype,d);return u.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const y1e={kernelName:jm,backendName:"cpu",kernelFunc:vh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TH(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=s;we([r,i],"conv2d");const h=Vo(l),d=bn(r.shape,i.shape,o,u,a,c,!1,h),f=d.filterHeight,p=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo.left,w=d.padInfo.top,x=d.dataFormat==="channelsLast",v=new Jt(d.outShape,r.dtype),b=Ie(r.shape),S=Ie(i.shape),T=b[0],_=x?b[1]:b[2],E=x?b[2]:1,N=x?1:b[1],$=v.strides[0],A=x?v.strides[1]:v.strides[2],D=x?v.strides[2]:1,F=x?1:v.strides[1],B=n.data.get(r.dataId).values,z=n.data.get(i.dataId).values,H=v.values;for(let M=0;M<d.batchSize;++M){const j=M*T,K=M*$;for(let X=0;X<d.outHeight;++X){const Z=K+X*A,te=X*d.strideHeight-w;for(let ie=0;ie<f;++ie){const se=te+ie*m;if(se<0||se>=d.inHeight)continue;const ce=ie*S[0],xe=j+se*_;for(let Ce=0;Ce<d.outWidth;++Ce){const _e=Z+Ce*D,Le=Ce*d.strideWidth-y;for(let Ve=0;Ve<p;++Ve){const nt=Le+Ve*g;if(nt<0||nt>=d.inWidth)continue;const ht=ce+Ve*S[1],Ot=xe+nt*E;let dt=ht;for(let it=0;it<d.inChannels;++it){const Et=B[Ot+it*N];for(let xt=0;xt<d.outChannels;++xt)H[_e+xt*F]+=Et*z[dt+xt];dt+=d.outChannels}}}}}}return n.makeTensorInfo(v.shape,v.dtype,H)}const w1e={kernelName:Gm,backendName:"cpu",kernelFunc:TH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=s;we([r,i],"conv2dBackpropFilter");const h=Vo(l),d=bn(r.shape,c,o,1,a,u,!1,h),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:g}=d,y=d.dataFormat==="channelsLast",w=new Jt(d.filterShape,"float32"),x=d.padInfo.left,v=d.padInfo.top,b=n.data.get(r.dataId).values,S=n.data.get(i.dataId).values,T=new Jt(r.shape,r.dtype,b),_=new Jt(i.shape,i.dtype,S);for(let E=0;E<m;++E){const N=Math.max(0,Math.ceil((v-E)/f)),$=Math.min(d.outHeight,(d.inHeight+v-E)/f);for(let A=0;A<g;++A){const D=Math.max(0,Math.ceil((x-A)/p)),F=Math.min(d.outWidth,(d.inWidth+x-A)/p);for(let B=0;B<d.inChannels;++B)for(let z=0;z<d.outChannels;++z){let H=0;for(let M=0;M<d.batchSize;++M)for(let j=N;j<$;++j){const K=E+j*f-v;for(let X=D;X<F;++X){const Z=A+X*p-x;y?H+=T.get(M,K,Z,B)*_.get(M,j,X,z):H+=T.get(M,B,K,Z)*_.get(M,z,j,X)}}w.set(H,E,A,B,z)}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const x1e={kernelName:Ex,backendName:"cpu",kernelFunc:v1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b1e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=s;we([r,i],"conv2dBackpropInput");const h=Ie(i.shape),d=Ie(r.shape);let f=Vo(u);const p=bn(o,i.shape,a,1,l,c,!1,f),m=new Jt(p.inShape,"float32"),g=m.values,y=n.data.get(r.dataId).values,w=n.data.get(i.dataId).values,[x,v,b]=h,{batchSize:S,filterHeight:T,filterWidth:_,inChannels:E,inHeight:N,inWidth:$,outChannels:A,outHeight:D,outWidth:F,strideHeight:B,strideWidth:z}=p;f=p.dataFormat;const H=T-1-p.padInfo.top,M=_-1-p.padInfo.left,j=f==="channelsLast",K=m.strides[0],X=j?m.strides[1]:m.strides[2],Z=j?m.strides[2]:1,te=j?1:m.strides[1],ie=d[0],se=j?d[1]:d[2],ce=j?d[2]:1,xe=j?1:d[1];for(let Ce=0;Ce<S;++Ce)for(let _e=0;_e<E;++_e)for(let Le=0;Le<N;++Le){const Ve=Le-H,nt=Math.max(0,Math.ceil(Ve/B)),ht=Math.min(D,(T+Ve)/B);for(let Ot=0;Ot<$;++Ot){const dt=Ot-M,it=Math.max(0,Math.ceil(dt/z)),Et=Math.min(F,(_+dt)/z);let xt=0;for(let Tn=nt;Tn<ht;++Tn){const Go=Tn*B-Ve;for(let nr=it;nr<Et;++nr){const dl=nr*z-dt,Gr=ie*Ce+se*Tn+ce*nr,to=x*(T-1-Go)+v*(_-1-dl)+b*_e;for(let Ho=0;Ho<A;++Ho){const qo=y[Gr+xe*Ho],Ko=w[to+Ho];xt+=qo*Ko}}}const eo=K*Ce+X*Le+Z*Ot+te*_e;g[eo]=xt}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const I1e={kernelName:Hm,backendName:"cpu",kernelFunc:b1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;we([r,i],"conv3d");const u=rl(r.shape,i.shape,o,l,a),{filterDepth:c,filterHeight:h,filterWidth:d,dilationDepth:f,dilationHeight:p,dilationWidth:m,padInfo:g}=u,y=g.front,w=g.left,x=g.top,v=new Jt(u.outShape,r.dtype),b=n.data.get(r.dataId).values,S=n.data.get(i.dataId).values,T=v.values,_=Ie(r.shape),E=Ie(i.shape);for(let N=0;N<u.batchSize;++N){const $=N*_[0],A=N*v.strides[0];for(let D=0;D<u.outDepth;++D){const F=A+D*v.strides[1],B=D*u.strideDepth-y;for(let z=0;z<c;++z){const H=B+z*f;if(H<0||H>=u.inDepth)continue;const M=z*E[0],j=$+H*_[1];for(let K=0;K<u.outHeight;++K){const X=F+K*v.strides[2],Z=K*u.strideHeight-x;for(let te=0;te<h;++te){const ie=Z+te*p;if(ie<0||ie>=u.inHeight)continue;const se=M+te*E[1],ce=j+ie*_[2];for(let xe=0;xe<u.outWidth;++xe){const Ce=X+xe*u.outChannels,_e=xe*u.strideWidth-w;for(let Le=0;Le<d;++Le){const Ve=_e+Le*m;if(Ve<0||Ve>=u.inWidth)continue;const nt=se+Le*E[2],ht=ce+Ve*u.inChannels;let Ot=nt;for(let dt=0;dt<u.inChannels;++dt){const it=b[ht+dt];for(let Et=0;Et<u.outChannels;++Et)T[Ce+Et]+=it*S[Ot+Et];Ot+=u.outChannels}}}}}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const S1e={kernelName:qm,backendName:"cpu",kernelFunc:T1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;we([r,i],"conv3dBackpropFilterV2");const u=Ie(r.shape),c=Ie(i.shape),h=rl(r.shape,l,o,1,a),d=h.strideDepth,f=h.strideHeight,p=h.strideWidth,m=h.filterDepth,g=h.filterHeight,y=h.filterWidth,w=new Jt(h.filterShape,"float32"),x=w.values,[v,b,S,T]=w.strides,_=n.data.get(i.dataId).values,[E,N,$,A]=c,D=n.data.get(r.dataId).values,[F,B,z,H]=u,M=h.padInfo.front,j=h.padInfo.left,K=h.padInfo.top;for(let X=0;X<m;++X){const Z=Math.max(0,Math.ceil((M-X)/d)),te=Math.min(h.outDepth,(h.inDepth+M-X)/d),ie=X*v;for(let se=0;se<g;++se){const ce=Math.max(0,Math.ceil((K-se)/f)),xe=Math.min(h.outHeight,(h.inHeight+K-se)/f),Ce=se*b+ie;for(let _e=0;_e<y;++_e){const Le=Math.max(0,Math.ceil((j-_e)/p)),Ve=Math.min(h.outWidth,(h.inWidth+j-_e)/p),nt=_e*S+Ce;for(let ht=0;ht<h.inChannels;++ht){const Ot=ht*T+nt;for(let dt=0;dt<h.outChannels;++dt){let it=0;for(let Et=0;Et<h.batchSize;++Et){const xt=Et*F,eo=Et*E;for(let Tn=Z;Tn<te;++Tn){const nr=(X+Tn*d-M)*B+xt,dl=Tn*N+eo;for(let Gr=ce;Gr<xe;++Gr){const Ho=(se+Gr*f-K)*z+nr,qo=Gr*$+dl;for(let Ko=Le;Ko<Ve;++Ko){const Wb=(_e+Ko*p-j)*H+Ho,jb=Ko*A+qo;it+=D[Wb+ht]*_[jb+dt]}}}}x[Ot+dt]=it}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const C1e={kernelName:kx,backendName:"cpu",kernelFunc:_1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E1e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;we([r],"conv3dBackpropInputV2");const u=Ie(r.shape),c=Ie(i.shape),h=rl(l,i.shape,a,1,o),d=new Jt(h.inShape,"float32"),f=d.values,[p,m,g,y]=d.strides,w=n.data.get(r.dataId).values,[x,v,b,S]=u,T=n.data.get(i.dataId).values,[_,E,N,$]=c,{batchSize:A,filterDepth:D,filterHeight:F,filterWidth:B,inChannels:z,inDepth:H,inHeight:M,inWidth:j,outChannels:K,outDepth:X,outHeight:Z,outWidth:te,strideDepth:ie,strideHeight:se,strideWidth:ce}=h,xe=D-1-h.padInfo.front,Ce=F-1-h.padInfo.top,_e=B-1-h.padInfo.left;for(let Le=0;Le<A;++Le)for(let Ve=0;Ve<z;++Ve)for(let nt=0;nt<H;++nt){const ht=nt-xe,Ot=Math.max(0,Math.ceil(ht/ie)),dt=Math.min(X,(D+ht)/ie);for(let it=0;it<M;++it){const Et=it-Ce,xt=Math.max(0,Math.ceil(Et/se)),eo=Math.min(Z,(F+Et)/se);for(let Tn=0;Tn<j;++Tn){const Go=Tn-_e,nr=Math.max(0,Math.ceil(Go/ce)),dl=Math.min(te,(B+Go)/ce);let Gr=0;for(let to=Ot;to<dt;++to){const Ho=to*ie-ht;for(let qo=xt;qo<eo;++qo){const Ko=qo*se-Et;for(let Qd=nr;Qd<dl;++Qd){const Wb=Qd*ce-Go,jb=x*Le+v*to+b*qo+S*Qd,hq=_*(D-1-Ho)+E*(F-1-Ko)+N*(B-1-Wb)+$*Ve;for(let Ty=0;Ty<K;++Ty){const dq=w[jb+Ty],fq=T[hq+Ty];Gr+=dq*fq}}}}f[p*Le+m*nt+g*it+y*Tn+Ve]=Gr}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}const k1e={kernelName:Nx,backendName:"cpu",kernelFunc:E1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N1e=rt(Wh,t=>Math.cos(t)),$1e={kernelName:Wh,backendName:"cpu",kernelFunc:N1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A1e=rt(jh,t=>Math.cosh(t)),R1e={kernelName:jh,backendName:"cpu",kernelFunc:A1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D1e(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[c,h,d,f]=r.shape,p=i.shape[0],[m,g]=a,y=Fe([p,m,g,f],"float32"),w=n.data.get(i.dataId).values,x=n.data.get(o.dataId).values,v=n.data.get(r.dataId).values,b=Ie(r.shape),S=Ie(y.shape);for(let T=0;T<p;T++){const _=T*4,E=w[_],N=w[_+1],$=w[_+2],A=w[_+3],D=x[T];if(D>=c)continue;const F=m>1?($-E)*(h-1)/(m-1):0,B=g>1?(A-N)*(d-1)/(g-1):0;for(let z=0;z<m;z++){const H=m>1?E*(h-1)+z*F:.5*(E+$)*(h-1);if(H<0||H>h-1){for(let M=0;M<g;M++)for(let j=0;j<f;j++){const K=j+M*S[2]+z*S[1]+T*S[0];y.values[K]=u}continue}if(l==="bilinear"){const M=Math.floor(H),j=Math.ceil(H),K=H-M;for(let X=0;X<g;X++){const Z=g>1?N*(d-1)+X*B:.5*(N+A)*(d-1);if(Z<0||Z>d-1){for(let ce=0;ce<f;ce++){const xe=ce+X*S[2]+z*S[1]+T*S[0];y.values[xe]=u}continue}const te=Math.floor(Z),ie=Math.ceil(Z),se=Z-te;for(let ce=0;ce<f;ce++){let xe=ce+te*b[2]+M*b[1]+D*b[0];const Ce=v[xe];xe=ce+ie*b[2]+M*b[1]+D*b[0];const _e=v[xe];xe=ce+te*b[2]+j*b[1]+D*b[0];const Le=v[xe];xe=ce+ie*b[2]+j*b[1]+D*b[0];const Ve=v[xe],nt=Ce+(_e-Ce)*se,ht=Le+(Ve-Le)*se;xe=ce+X*S[2]+z*S[1]+T*S[0],y.values[xe]=nt+(ht-nt)*K}}}else for(let M=0;M<g;++M){const j=g>1?N*(d-1)+M*B:.5*(N+A)*(d-1);if(j<0||j>d-1){for(let Z=0;Z<f;Z++){const te=Z+M*S[2]+z*S[1]+T*S[0];y.values[te]=u}continue}const K=Math.round(j),X=Math.round(H);for(let Z=0;Z<f;Z++){const te=Z+K*b[2]+X*b[1]+D*b[0],ie=Z+M*S[2]+z*S[1]+T*S[0];y.values[ie]=v[te]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const O1e={kernelName:Ax,backendName:"cpu",kernelFunc:D1e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;we(r,"cumprod");const l=Dt([i],r.shape.length);let u=r;l!=null&&(u=$s({inputs:{x:r},backend:n,attrs:{perm:l}}));const c=Gt(1,r.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=_s(u.dtype,"int32"),d=vx(G(u.shape),h),f=n.data.get(u.dataId).values,p=u.shape[u.shape.length-1],m=a?(y,w)=>y+p-w-1:(y,w)=>y+w;for(let y=0;y<f.length;y+=p)for(let w=0;w<p;w++){const x=m(y,w);if(w===0)d[x]=o?1:f[x];else{const v=m(y,w-1);d[x]=o?f[v]*d[v]:f[x]*d[v]}}const g=n.makeTensorInfo(u.shape,h,d);if(l!=null){const y=il(l),w=$s({inputs:{x:g},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(u),w}return g}const F1e={kernelName:$x,backendName:"cpu",kernelFunc:P1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;we(r,"cumsum");const l=Dt([i],r.shape.length);let u=r;l!=null&&(u=$s({inputs:{x:r},backend:n,attrs:{perm:l}}));const c=Gt(1,r.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=_s(u.dtype,"int32"),d=On(G(u.shape),h),f=n.data.get(u.dataId).values,p=u.shape[u.shape.length-1],m=a?(y,w)=>y+p-w-1:(y,w)=>y+w;for(let y=0;y<f.length;y+=p)for(let w=0;w<p;w++){const x=m(y,w);if(w===0)d[x]=o?0:f[x];else{const v=m(y,w-1);d[x]=o?f[v]+d[v]:f[x]+d[v]}}const g=n.makeTensorInfo(u.shape,h,d);if(l!=null){const y=il(l),w=$s({inputs:{x:g},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(u),w}return g}const M1e={kernelName:Km,backendName:"cpu",kernelFunc:L1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,c=Y2(l,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}else if(r.shape.length===2){const l=n.bufferSync(r),u=n.bufferSync(i),c=IG(l,u,o,a);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const z1e={kernelName:Rx,backendName:"cpu",kernelFunc:V1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s;C(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],c=r.shape[3],h=l*i,d=u*i,f=c/(i*i),p=n.data.get(r.dataId).values,m=new Float32Array(a*h*d*f);let g=0;for(let y=0;y<a;++y)for(let w=0;w<h;++w){const x=Math.floor(w/i),v=w%i;for(let b=0;b<d;++b){const S=Math.floor(b/i),T=b%i,_=(v*i+T)*f;for(let E=0;E<f;++E){const $=E+_+c*(S+u*(x+l*y));m[g++]=p[$]}}}return n.makeTensorInfo([a,h,d,f],r.dtype,m)}const U1e={kernelName:Dx,backendName:"cpu",kernelFunc:B1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SH(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;we([r,i],"depthwiseConv2DNative");const c=Ie(r.shape),h=Ie(i.shape);let d=l;d==null&&(d=[1,1]),C(Vn(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const f=bn(r.shape,i.shape,o,d,a,u,!0),{filterHeight:p,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:w}=f,x=w.left,v=w.top,b=f.outChannels/f.inChannels,S=new Jt(f.outShape,r.dtype),T=n.data.get(r.dataId).values,_=n.data.get(i.dataId).values,E=S.values;for(let N=0;N<f.batchSize;++N){const $=N*c[0],A=N*S.strides[0];for(let D=0;D<f.outHeight;++D){const F=A+D*S.strides[1],B=D*f.strideHeight-v;for(let z=0;z<p;++z){const H=B+z*g;if(H<0||H>=f.inHeight)continue;const M=z*h[0],j=$+H*c[1];for(let K=0;K<f.outWidth;++K){const X=F+K*S.strides[2],Z=K*f.strideWidth-x;for(let te=0;te<m;++te){const ie=Z+te*y;if(ie<0||ie>=f.inWidth)continue;const se=M+te*h[1],ce=j+ie*f.inChannels;let xe=X,Ce=se;for(let _e=0;_e<f.inChannels;++_e){const Le=T[ce+_e];for(let Ve=0;Ve<b;++Ve)E[xe+Ve]+=Le*_[Ce+Ve];xe+=b,Ce+=b}}}}}}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const W1e={kernelName:Xm,backendName:"cpu",kernelFunc:SH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=s;we([r,i],"depthwiseConv2dNativeBackpropFilter");const h=bn(r.shape,c,o,a,l,u,!0),{strideHeight:d,strideWidth:f,filterHeight:p,filterWidth:m}=h,g=new Jt(h.filterShape,"float32"),y=h.padInfo.left,w=h.padInfo.top,x=h.outChannels/h.inChannels,v=n.data.get(r.dataId).values,b=new Jt(r.shape,r.dtype,v),S=n.data.get(i.dataId).values,T=new Jt(i.shape,i.dtype,S);for(let _=0;_<p;++_){const E=Math.max(0,Math.ceil((w-_)/d)),N=Math.min(h.outHeight,(h.inHeight+w-_)/d);for(let $=0;$<m;++$){const A=Math.max(0,Math.ceil((y-$)/f)),D=Math.min(h.outWidth,(h.inWidth+y-$)/f);for(let F=0;F<h.outChannels;++F){const B=Math.trunc(F/x),z=F%x;let H=0;for(let M=0;M<h.batchSize;++M)for(let j=E;j<N;++j){const K=_+j*d-w;for(let X=A;X<D;++X){const Z=$+X*f-y;H+=b.get(M,K,Z,B)*T.get(M,j,X,F)}}g.set(H,_,$,B,z)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const G1e={kernelName:Ox,backendName:"cpu",kernelFunc:j1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H1e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=s;we([r,i],"depthwiseConv2DNativeBackpropInput");const h=Ie(r.shape),d=Ie(i.shape),f=bn(c,i.shape,o,a,l,u,!0),p=new Jt(f.inShape,"float32"),m=p.values,[g,y,w]=p.strides,x=n.data.get(r.dataId).values,[v,b,S]=h,T=n.data.get(i.dataId).values,[_,E,N]=d,{batchSize:$,filterHeight:A,filterWidth:D,inChannels:F,inHeight:B,inWidth:z,outChannels:H,outHeight:M,outWidth:j,strideHeight:K,strideWidth:X}=f,Z=A-1-f.padInfo.top,te=D-1-f.padInfo.left,ie=H/F;for(let se=0;se<$;++se)for(let ce=0;ce<F;++ce)for(let xe=0;xe<B;++xe){const Ce=xe-Z,_e=Math.max(0,Math.ceil(Ce/K)),Le=Math.min(M,(A+Ce)/K);for(let Ve=0;Ve<z;++Ve){const nt=Ve-te,ht=Math.max(0,Math.ceil(nt/X)),Ot=Math.min(j,(D+nt)/X);let dt=0;for(let it=_e;it<Le;++it){const Et=it*K-Ce;for(let xt=ht;xt<Ot;++xt){const eo=xt*X-nt,Tn=v*se+b*it+S*xt,Go=_*(A-1-Et)+E*(D-1-eo)+N*ce;for(let nr=0;nr<ie;++nr){const dl=ce*ie+nr,Gr=x[Tn+dl],to=T[Go+nr];dt+=Gr*to}}}m[g*se+y*xe+w*Ve+ce]=dt}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const q1e={kernelName:Px,backendName:"cpu",kernelFunc:H1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K1e(t){const{inputs:e,backend:n}=t,{x:s}=e,r=G(s.shape),i=n.data.get(s.dataId).values,o=Fe([r,r],s.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*r+u]=i[u];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,o.dtype,o.values)}const X1e={kernelName:Fx,backendName:"cpu",kernelFunc:K1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q1e={kernelName:Qm,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r}=t,{strides:i,pad:o,dilations:a}=n,l=e,u=l.data.get(s.dataId).values,c=s.shape.length,h=l.data.get(r.dataId).values,d=r.shape.length,{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:y,outWidth:w,padInfo:x,strideHeight:v,strideWidth:b,filterHeight:S,filterWidth:T,dilationHeight:_,dilationWidth:E,outShape:N}=Vg(s.shape,r.shape,i,o,"NHWC",a),$=G(N),A=N.length,D=Ft(s.dtype,$);for(let B=0;B<f;++B)for(let z=0;z<y;++z){const H=z*v-x.top;for(let M=0;M<w;++M){const j=M*b-x.left;for(let K=0;K<g;++K){let X=Number.MIN_SAFE_INTEGER;for(let te=0;te<S;++te){const ie=H+te*_;if(ie>=0&&ie<p)for(let se=0;se<T;++se){const ce=j+se*E;if(ce>=0&&ce<m){const xe=ii([B,ie,ce,K],c,Ie(s.shape)),Ce=ii([te,se,K],d,Ie(r.shape)),_e=u[xe]+h[Ce];_e>X&&(X=_e)}}}const Z=ii([B,z,M,K],A,Ie(N));D[Z]=X}}}return{dataId:l.write(nl(D,s.dtype),N,s.dtype),shape:N,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y1e={kernelName:Vw,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:i}=t,{strides:o,pad:a,dilations:l}=n,u=e,c=mr(s.shape,u.data.get(s.dataId).values),h=mr(r.shape,u.data.get(r.dataId).values),{batchSize:d,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:y,padInfo:w,strideHeight:x,strideWidth:v,filterHeight:b,filterWidth:S,dilationHeight:T,dilationWidth:_,outShape:E}=Vg(s.shape,r.shape,o,a,"NHWC",l);C(i.rank===E.length,()=>`Error in ${Vw}, dy must have the same rank as output ${E.length}, but got ${i.rank}`);const N=mr(E,u.data.get(i.dataId).values),$=nk(r.shape,r.dtype);for(let D=0;D<d;++D)for(let F=0;F<g;++F){const B=F*x-w.top;for(let z=0;z<y;++z){const H=z*v-w.left;for(let M=0;M<m;++M){let j=Number.MIN_SAFE_INTEGER,K=0,X=0;for(let Z=0;Z<b;++Z){const te=B+Z*T;if(te>=0&&te<f)for(let ie=0;ie<S;++ie){const se=H+ie*_;if(se>=0&&se<p){const ce=c[D][te][se][M]+h[Z][ie][M];ce>j&&(j=ce,K=Z,X=ie)}}}$[K][X][M]+=N[D][F][z][M]}}}return{dataId:u.write(nl($,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J1e={kernelName:Mw,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:i}=t,{strides:o,pad:a,dilations:l}=n,u=e,c=mr(s.shape,u.data.get(s.dataId).values),h=mr(r.shape,u.data.get(r.dataId).values),{batchSize:d,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:y,padInfo:w,strideHeight:x,strideWidth:v,filterHeight:b,filterWidth:S,dilationHeight:T,dilationWidth:_,outShape:E}=Vg(s.shape,r.shape,o,a,"NHWC",l);C(i.rank===E.length,()=>`Error in ${Mw}, dy must have the same rank as output ${E.length}, but got ${i.rank}`);const N=mr(E,u.data.get(i.dataId).values),$=nk(s.shape,s.dtype);for(let D=0;D<d;++D)for(let F=0;F<g;++F){const B=F*x-w.top;for(let z=0;z<y;++z){const H=z*v-w.left;for(let M=0;M<m;++M){let j=Number.MIN_SAFE_INTEGER,K=B<0?0:B,X=H<0?0:H;for(let Z=0;Z<b;++Z){const te=B+Z*T;if(te>=0&&te<f)for(let ie=0;ie<S;++ie){const se=H+ie*_;if(se>=0&&se<p){const ce=c[D][te][se][M]+h[Z][ie][M];ce>j&&(j=ce,K=te,X=se)}}}$[D][K][X][M]+=N[D][F][z][M]}}}return{dataId:u.write(nl($,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z1e(t){const{inputs:e,backend:n,attrs:s}=t,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,c=(a==null?void 0:a.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=i.getContext(c,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${c} type.`);const[d,f]=r.shape.slice(0,2),p=r.shape.length===2?1:r.shape[2],m=n.data.get(r.dataId).values,g=r.dtype==="float32"?255:1,y=new Uint8ClampedArray(f*d*4);for(let x=0;x<d*f;++x){const v=[0,0,0,255*u];for(let S=0;S<p;S++){const T=m[x*p+S];if(r.dtype==="float32"){if(T<0||T>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${T}.`)}else if(r.dtype==="int32"&&(T<0||T>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${T}.`);p===1?(v[0]=T*g,v[1]=T*g,v[2]=T*g):v[S]=T*g}const b=x*4;y[b+0]=Math.round(v[0]),y[b+1]=Math.round(v[1]),y[b+2]=Math.round(v[2]),y[b+3]=Math.round(v[3])}i.width=f,i.height=d;const w=new ImageData(y,f,d);return h.putImageData(w,0,0),r}const ebe={kernelName:Lx,backendName:"cpu",kernelFunc:Z1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gy(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;we(r,"sum");let a;r.dtype==="bool"?a=Ha({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):a=Yi({inputs:{x:r},backend:n});const l=a.shape.length,u=Be(i,a.shape),c=Dt(u,l);let h=u,d=a;c!=null&&(d=$s({inputs:{x:a},backend:n,attrs:{perm:c}}),h=Gt(h.length,l)),zn("sum",h,d.shape.length);const[f,p]=In(d.shape,h),m=_s(d.dtype,"int32");let g=iv(n,f,m);const y=G(p),w=n.data.get(g.dataId).values,x=n.data.get(d.dataId).values;for(let v=0;v<w.length;++v){const b=v*y;let S=0;for(let T=0;T<y;++T)S+=x[b+T];w[v]=S}if(o){const v=jt(g.shape,u),b=g;g=mt({inputs:{x:g},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(b)}return n.disposeIntermediateTensorInfo(a),c!=null&&n.disposeIntermediateTensorInfo(d),g}const tbe={kernelName:Ng,backendName:"cpu",kernelFunc:gy};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nbe(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=n$(r,i.length);r$(o.length,l,i);const{path:u,steps:c}=i$(a,l),h=c.length;let d=null,f=o.length;const p=[];for(let m=0;m<h;++m){for(const g of c[m]){const{permutationIndices:y,expandDims:w}=s$(f,l[g]);let x;o$(y)?x=i[g]:(x=$s({inputs:{x:i[g]},backend:n,attrs:{perm:y}}),p.push(x));const v=x.shape.slice();for(let b=0;b<w.length;++b)v.splice(w[b],0,1);We(x.shape,v)||(x=mt({inputs:{x},backend:n,attrs:{shape:v}}),p.push(x)),d===null?d=x:(d=Fb({inputs:{a:x,b:d},backend:n}),p.push(d))}m<h-1&&(u[m]>=0&&(d=gy({inputs:{x:d},backend:n,attrs:{axis:u[m]-(o.length-f),keepDims:!1}}),p.push(d)),f--)}for(const m of p)m!==d&&n.disposeIntermediateTensorInfo(m);return d}const sbe={kernelName:Mx,backendName:"cpu",kernelFunc:nbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rbe(t){const{inputs:e,backend:n}=t,{dy:s,y:r}=e;we([s,r],"eluGrad");const i=new Float32Array(G(r.shape)),o=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return n.makeTensorInfo(r.shape,"float32",i)}const ibe={kernelName:Vx,backendName:"cpu",kernelFunc:rbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const obe=XN,abe=QN,lbe=YN,ube=JN,cbe=ZN,hbe=e$,dbe=rt(qh,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+obe*n);return e*(1-((((hbe*s+cbe)*s+ube)*s+lbe)*s+abe)*s*Math.exp(-n*n))}),fbe={kernelName:qh,backendName:"cpu",kernelFunc:dbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lv(t){const{inputs:e,backend:n,attrs:s}=t,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(C(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),mt({inputs:{x:r},backend:n,attrs:{shape:a}})}const pbe={kernelName:Jm,backendName:"cpu",kernelFunc:lv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mbe=qt((t,e)=>t/e),sA=dn(Gh,mbe),I_={kernelName:Gh,backendName:"cpu",kernelFunc:sA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _H(t,e,n){const s=t.shape,r=s[0],i=s[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[r,i],c=G(u),h=vn("float32",c),d=vn("float32",c);for(let g=0;g<r;g++){const y=Su({inputs:{x:a},backend:n,attrs:{begin:[g,0],size:[1,i]}}),w=Su({inputs:{x:l},backend:n,attrs:{begin:[g,0],size:[1,i]}}),x=zs({inputs:{real:y,imag:w},backend:n}),{real:v,imag:b}=gbe(x,e,n),S=Do(v,b);for(let T=0;T<i;T++){const _=t$(S,T);h[g*i+T]=_.real,d[g*i+T]=_.imag}n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(x)}const f=n.makeTensorInfo(u,"float32",h),p=n.makeTensorInfo(u,"float32",d),m=zs({inputs:{real:f,imag:p},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}function gbe(t,e,n){const s=G(t.shape),r=n.data.get(t.dataId),i=n.data.get(r.complexTensorInfos.real.dataId).values,o=n.data.get(r.complexTensorInfos.imag.dataId).values;if(ybe(s)){const a=T_(i,o,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const u=n.makeTensorInfo(l,"float32",a.real),c=n.makeTensorInfo(l,"float32",a.imag),h=n.makeTensorInfo([],"float32",Lo(s,"float32")),d=Yi({inputs:{x:h},backend:n}),f=I_.kernelFunc({inputs:{a:u,b:h},backend:n}),p=I_.kernelFunc({inputs:{a:c,b:d},backend:n}),m=n.data.get(f.dataId).values,g=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),{real:m,imag:g}}return a}else{const a=Do(i,o),l=wbe(a,s,e);return yW(l)}}function ybe(t){return(t&t-1)===0}function T_(t,e,n,s,r){if(n===1)return{real:t,imag:e};const i=Do(t,e),o=n/2,a=wW(i),l=a.real,u=a.imag,c=[l.length],h=r.makeTensorInfo(c,"float32",l),d=r.makeTensorInfo(c,"float32",u),f=zs({inputs:{real:h,imag:d},backend:r}),p=vW(i),m=p.real,g=p.imag,y=[m.length],w=r.makeTensorInfo(y,"float32",m),x=r.makeTensorInfo(y,"float32",g),v=zs({inputs:{real:w,imag:x},backend:r}),b=T_(l,u,o,s,r),S=b.real,T=b.imag,_=[S.length],E=r.makeTensorInfo(_,"float32",S),N=r.makeTensorInfo(_,"float32",T),$=zs({inputs:{real:E,imag:N},backend:r}),A=T_(m,g,o,s,r),D=A.real,F=A.imag,B=[D.length],z=r.makeTensorInfo(B,"float32",D),H=r.makeTensorInfo(B,"float32",F),M=zs({inputs:{real:z,imag:H},backend:r}),j=bW(n,s),K=[j.real.length],X=r.makeTensorInfo(K,"float32",j.real),Z=r.makeTensorInfo(K,"float32",j.imag),te=zs({inputs:{real:X,imag:Z},backend:r}),ie=Fb({inputs:{a:te,b:M},backend:r}),se=yh({inputs:{a:$,b:ie},backend:r}),ce=tA({inputs:{a:$,b:ie},backend:r}),xe=Tu({inputs:{input:se},backend:r}),Ce=Tu({inputs:{input:ce},backend:r}),_e=wh({inputs:{input:se},backend:r}),Le=wh({inputs:{input:ce},backend:r}),Ve=vh({inputs:[xe,Ce],backend:r,attrs:{axis:0}}),nt=vh({inputs:[_e,Le],backend:r,attrs:{axis:0}}),ht=r.data.get(Ve.dataId).values,Ot=r.data.get(nt.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(E),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(z),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(M),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(Z),r.disposeIntermediateTensorInfo(te),r.disposeIntermediateTensorInfo(ie),r.disposeIntermediateTensorInfo(se),r.disposeIntermediateTensorInfo(ce),r.disposeIntermediateTensorInfo(xe),r.disposeIntermediateTensorInfo(_e),r.disposeIntermediateTensorInfo(Ce),r.disposeIntermediateTensorInfo(Le),r.disposeIntermediateTensorInfo(Ve),r.disposeIntermediateTensorInfo(nt),{real:ht,imag:Ot}}function wbe(t,e,n){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=IW(r*a,e,n),u=t$(t,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}n&&(i/=e,o/=e),xW(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vbe(t){const{inputs:e,backend:n}=t,{input:s}=e,r=G(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=mt({inputs:{x:s},backend:n,attrs:{shape:[o,i]}}),l=_H(a,!1,n),u=mt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const xbe={kernelName:zx,backendName:"cpu",kernelFunc:vbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rA(t){const{backend:e,attrs:n}=t,{shape:s,value:r,dtype:i}=n,o=i||Vu(r),a=Ft(o,G(s));return Ibe(a,r,o),e.makeTensorInfo(s,o,a)}const bbe={kernelName:Bx,backendName:"cpu",kernelFunc:rA};function Ibe(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tbe={kernelName:Ux,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,r=n,i=vn(s.dtype,G(s.shape)),[o,a,l,u]=s.shape,c=r.data.get(s.dataId).values;for(let d=0;d<o;d++){const f=d*l*a*u;for(let p=0;p<a;p++){const m=p*(l*u);for(let g=0;g<l;g++){const y=g*u;for(let w=0;w<u;w++){const x=Math.round(l-g-1),v=f+m+y+w;let b=c[v];if(x>=0&&x<l){const S=x*u,T=f+m+S+w;b=c[T]}i[v]=b}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=s;let m=TH({inputs:{x:r,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const g=m;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const y=mt({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=yh({inputs:{a:m,b:y},backend:n}),n.disposeIntermediateTensorInfo(y)}else m=yh({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(g)}if(f){const g=m;if(c==="NCHW"&&f==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=mt({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=av(n,m,f,y,p),n.disposeIntermediateTensorInfo(y)}else m=av(n,m,f,a,p);n.disposeIntermediateTensorInfo(g)}return m}const _be={kernelName:Wp,backendName:"cpu",kernelFunc:Sbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=s;let m=SH({inputs:{x:r,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const g=m;m=yh({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(g)}if(f){const g=m;m=av(n,m,f,a,p),n.disposeIntermediateTensorInfo(g)}return m}const Ebe={kernelName:jp,backendName:"cpu",kernelFunc:Cbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kbe(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=G(s.shape),o=r.shape,a=o[o.length-1],[l,u,c,h]=cb(s,r);if(u===0)return n.makeTensorInfo(l,s.dtype,[]);const d=n.data.get(r.dataId).values,f=n.bufferSync(s),p=DG(d,f,s.dtype,u,a,c,h,s.shape,i);return n.makeTensorInfo(l,s.dtype,p.values)}const Nbe={kernelName:Wx,backendName:"cpu",kernelFunc:kbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $be(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;we([r,i],"gatherV2");const l=Be(o,r.shape)[0],u=n.data.get(i.dataId).values,c=r.shape[l];for(let v=0;v<u.length;++v){const b=u[v];C(b<=c-1&&b>=0,()=>`GatherV2: the index value ${b} is not in [0, ${c-1}]`)}let h=a;a==null&&(h=0);const d=G(i.shape),f=l$(r,i,l,h),p=mt({inputs:{x:r},backend:n,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),m=mt({inputs:{x:i},backend:n,attrs:{shape:[f.batchSize,d/f.batchSize]}}),g=[f.batchSize,f.outerSize,d/f.batchSize,f.sliceSize],y=n.bufferSync(m),w=n.bufferSync(p),x=OG(w,y,g);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(f.outputShape,x.dtype,x.values)}const Abe={kernelName:eg,backendName:"cpu",kernelFunc:$be};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rbe(t){const{inputs:e,backend:n}=t,{input:s}=e,r=G(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=mt({inputs:{x:s},backend:n,attrs:{shape:[o,i]}}),l=_H(a,!0,n),u=mt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const Dbe={kernelName:jx,backendName:"cpu",kernelFunc:Rbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Obe=rt(ed,t=>Number.isFinite(t)?1:0,"bool"),Pbe={kernelName:ed,backendName:"cpu",kernelFunc:Obe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fbe=rt(td,t=>Math.abs(t)===1/0?1:0,"bool"),Lbe={kernelName:td,backendName:"cpu",kernelFunc:Fbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mbe=rt(nd,t=>Number.isNaN(t)?1:0,"bool"),Vbe={kernelName:nd,backendName:"cpu",kernelFunc:Mbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zbe(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=VG(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const Bbe={kernelName:Hx,backendName:"cpu",kernelFunc:zbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ube=rt(rd,t=>Math.log1p(t)),Wbe={kernelName:rd,backendName:"cpu",kernelFunc:Ube};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jbe=qt((t,e)=>t&&e),Gbe=dn(ig,jbe,null,"bool"),Hbe={kernelName:ig,backendName:"cpu",kernelFunc:Gbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qbe=rt(og,t=>t?0:1,"bool"),Kbe={kernelName:og,backendName:"cpu",kernelFunc:qbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xbe=qt((t,e)=>t||e),Qbe=dn(ag,Xbe,null,"bool"),Ybe={kernelName:ag,backendName:"cpu",kernelFunc:Qbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;we(r,"LRN");const u=r.shape[3],c=u-1,h=n.data.get(r.dataId).values,d=G(r.shape),f=new Float32Array(d);function p(m){const g=m%u;let y=m-g+Math.max(0,g-i);const w=m-g+Math.min(g+i,c);let x=0;for(;y<=w;y++){const v=h[y];x+=v*v}return x}for(let m=0;m<d;m++){const g=p(m),y=h[m]*Math.pow(o+a*g,-l);f[m]=y}return n.makeTensorInfo(r.shape,r.dtype,f)}const Zbe={kernelName:lg,backendName:"cpu",kernelFunc:Jbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=s;we(o,"LRNGrad");const h=G(o.shape),d=o.shape[3],f=n.data.get(o.dataId).values,p=n.data.get(r.dataId).values,m=n.data.get(i.dataId).values,g=new Float32Array(h),y=h;for(let w=0;w<y;w++){const x=w%d,v=w-x+Math.max(0,x-a),b=w-x+Math.min(d,x+a+1);let S=0;for(let T=v;T<b;T++)S+=Math.pow(p[T],2);S=u*S+l;for(let T=v;T<b;T++){let _=-2*u*c*p[T]*m[w]/S;w===T&&(_+=Math.pow(S,-c)),_*=f[w],g[T]+=_}}return n.makeTensorInfo(o.shape,r.dtype,g)}const tIe={kernelName:qx,backendName:"cpu",kernelFunc:eIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CH(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=n;let l=r.shape;const u=l.length,c=Be(i,l);let h=c;const d=Dt(h,u);let f=a.data.get(r.dataId).values;if(d!=null){const v=new Array(u);for(let b=0;b<v.length;b++)v[b]=l[d[b]];f=Z2(f,l,r.dtype,d,v),h=Gt(h.length,u),l=v}we(r,"max"),zn("max",h,u);const[p,m]=In(l,h),g=G(m),y=BG(f,g,p,r.dtype),w=a.write(y,p,r.dtype);let x=p;return o&&(x=jt(p,c)),{dataId:w,shape:x,dtype:r.dtype}}const nIe={kernelName:ug,backendName:"cpu",kernelFunc:CH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;we(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;C(Vn(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=Ur(r.shape,i,o,u,a,l);let h;if(c.filterWidth===1&&c.filterHeight===1&&We(c.inShape,c.outShape))h=Yi({inputs:{x:r},backend:n});else{const d=n.data.get(r.dataId).values,f=Ie(r.shape),p=nA(d,r.shape,r.dtype,f,c,"max");h=n.makeTensorInfo(c.outShape,r.dtype,p.values)}return h}const rIe={kernelName:cg,backendName:"cpu",kernelFunc:sIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;we(r,"maxPool3d");const c=Mo(r.shape,i,o,1,a,l,u),h=n.data.get(r.dataId).values,d=IH(h,r.shape,r.dtype,Ie(r.shape),c,"max");return n.makeTensorInfo(d.shape,"float32",d.values)}const oIe={kernelName:hg,backendName:"cpu",kernelFunc:iIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aIe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;we([r,i],"maxPool3DGrad");const c=Mo(i.shape,o,a,1,l,u),h=n.bufferSync(i),d=Xxe(h,c),f=c.strideDepth,p=c.strideHeight,m=c.strideWidth,g=c.dilationDepth,y=c.dilationHeight,w=c.dilationWidth,x=c.effectiveFilterDepth,v=c.effectiveFilterHeight,b=c.effectiveFilterWidth,S=x-1-c.padInfo.front,T=b-1-c.padInfo.left,_=v-1-c.padInfo.top,E=Fe(i.shape,"float32"),N=n.bufferSync(r);for(let $=0;$<c.batchSize;++$)for(let A=0;A<c.inChannels;++A)for(let D=0;D<c.inDepth;++D)for(let F=0;F<c.inHeight;++F)for(let B=0;B<c.inWidth;++B){const z=D-S,H=F-_,M=B-T;let j=0;for(let K=0;K<x;K+=g){const X=(z+K)/f;if(!(X<0||X>=c.outDepth||Math.floor(X)!==X))for(let Z=0;Z<v;Z+=y){const te=(H+Z)/p;if(!(te<0||te>=c.outHeight||Math.floor(te)!==te))for(let ie=0;ie<b;ie+=w){const se=(M+ie)/m;if(se<0||se>=c.outWidth||Math.floor(se)!==se)continue;const ce=x*v*b-1-d.get($,X,te,se,A),xe=K*v*b+Z*b+ie,Ce=ce===xe?1:0;if(Ce===0)continue;const _e=N.get($,X,te,se,A);j+=_e*Ce}}}E.set(j,$,D,F,B,A)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}const lIe={kernelName:Xx,backendName:"cpu",kernelFunc:aIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uIe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;we([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=s,d=Ur(a.shape,l,u,1,c,h),f=n.data.get(a.dataId).values,p=Fe(d.outShape,a.dtype,bH(f,a.shape,a.dtype,d).values),m=d.strideHeight,g=d.strideWidth,y=d.dilationHeight,w=d.dilationWidth,x=d.effectiveFilterHeight,v=d.effectiveFilterWidth,b=v-1-d.padInfo.left,S=x-1-d.padInfo.top,T=Fe(a.shape,"float32"),_=n.data.get(r.dataId).values,E=Fe(r.shape,"float32",_);for(let N=0;N<d.batchSize;++N)for(let $=0;$<d.inChannels;++$)for(let A=0;A<d.inHeight;++A)for(let D=0;D<d.inWidth;++D){const F=A-S,B=D-b;let z=0;for(let H=0;H<x;H+=y){const M=(F+H)/m;if(!(M<0||M>=d.outHeight||Math.floor(M)!==M))for(let j=0;j<v;j+=w){const K=(B+j)/g;if(K<0||K>=d.outWidth||Math.floor(K)!==K)continue;const X=x*v-1-p.get(N,M,K,$),Z=H*v+j,te=X===Z?1:0;if(te===0)continue;const ie=E.get(N,M,K,$);z+=ie*te}}T.set(z,N,A,D,$)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}const cIe={kernelName:Kx,backendName:"cpu",kernelFunc:uIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hIe(t,e,n,s,r){const i=Ie(e),o=nA(t,e,n,i,r,"max"),a=bH(t,e,n,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dIe={kernelName:Qx,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;we(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,c=Ur(s.shape,r,i,[1,1],o),[h,d]=hIe(u,s.shape,s.dtype,a,c),f=l.write(h,c.outShape,s.dtype),p=l.write(d,c.outShape,s.dtype);return[{dataId:f,shape:c.outShape,dtype:s.dtype},{dataId:p,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=Be(i,r.shape),u=In(r.shape,a)[1],c=G(u),h=[],d=n.makeTensorInfo([],"float32",new Float32Array([c]));h.push(d);const f=Ha({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});h.push(f);const p=sA({inputs:{a:f,b:d},backend:n});h.push(p);const m=gy({inputs:{x:p},backend:n,attrs:{axis:i,keepDims:o}});return h.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const pIe={kernelName:dg,backendName:"cpu",kernelFunc:fIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;we(r,"min");const a=Be(i,r.shape);let l=a;const u=Dt(l,r.shape.length);let c=r;u!=null&&(c=$s({inputs:{x:r},backend:n,attrs:{perm:u}}),l=Gt(l.length,r.shape.length)),zn("min",l,c.shape.length);const[h,d]=In(c.shape,l),f=G(d),p=On(G(h),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const w=y*f;let x=m[w];for(let v=0;v<f;++v){const b=m[w+v];(Number.isNaN(b)||b<x)&&(x=b)}p[y]=x}u!=null&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(h,c.dtype,p);if(o){const y=jt(h,a),w=mt({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),w}return g}const gIe={kernelName:fg,backendName:"cpu",kernelFunc:mIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,mode:o}=s;we(r,"mirrorPad");const a=i.map((x,v)=>x[0]+r.shape[v]+x[1]),l=i.map(x=>x[0]),u=i.map((x,v)=>x[0]+r.shape[v]),c=o==="reflect"?0:1,h=n.data.get(r.dataId).values,d=r.shape.length,f=Ie(r.shape),p=G(a),m=a.length,g=Ie(a),y=vn(r.dtype,p);for(let x=0;x<p;x++){let v=zu(x,m,g);for(let S=0;S<m;S++)v[S]<l[S]?v[S]=l[S]*2-v[S]-c:v[S]>=u[S]&&(v[S]=(u[S]-1)*2-v[S]+c);v=v.map((S,T)=>S-l[T]);const b=ii(v,d,f);y[x]=h[b]}return{dataId:n.write(y,a,r.dtype),shape:a,dtype:r.dtype}}const wIe={kernelName:pg,backendName:"cpu",kernelFunc:yIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vIe=qt((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),xIe=dn(ad,vIe),bIe={kernelName:ad,backendName:"cpu",kernelFunc:xIe};var iA={exports:{}};iA.exports;(function(t){(function(e,n,s){function r(l){var u=this,c=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var c=new r(l),h=u&&u.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,c),d.state=function(){return i(c,{})}),d}function a(){var l=4022871197,u=function(c){c=String(c);for(var h=0;h<c.length;h++){l+=c.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.alea=o})(Pe,t,!1)})(iA);var IIe=iA.exports,oA={exports:{}};oA.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xor128=o})(Pe,t,!1)})(oA);var TIe=oA.exports,aA={exports:{}};aA.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xorwow=o})(Pe,t,!1)})(aA);var SIe=aA.exports,lA={exports:{}};lA.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.x,h=l.i,d,f;return d=c[h],d^=d>>>7,f=d^d<<24,d=c[h+1&7],f^=d^d>>>10,d=c[h+3&7],f^=d^d>>>3,d=c[h+4&7],f^=d^d<<7,d=c[h+7&7],d=d^d<<13,f^=d^d<<9,c[h]=f,l.i=h+1&7,f};function u(c,h){var d,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[d&7]=f[d&7]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xorshift7=o})(Pe,t,!1)})(lA);var _Ie=lA.exports,uA={exports:{}};uA.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.w,h=l.X,d=l.i,f,p;return l.w=c=c+1640531527|0,p=h[d+34&127],f=h[d=d+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=h[d]=p^f,l.i=d,p+(c^c>>>16)|0};function u(c,h){var d,f,p,m,g,y=[],w=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,w=Math.max(w,h.length)),p=0,m=-32;m<w;++m)h&&(f^=h.charCodeAt((m+32)%h.length)),m===0&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(g=g+1640531527|0,d=y[m&127]^=f+g,p=d==0?p+1:0);for(p>=128&&(y[(h&&h.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=y[p+34&127],d=y[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,y[p]=f^d;c.w=g,c.X=y,c.i=p}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xor4096=o})(Pe,t,!1)})(uA);var CIe=uA.exports,cA={exports:{}};cA.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.b,d=l.c,f=l.d,p=l.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-f|0,l.d=f<<16^d>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.tychei=o})(Pe,t,!1)})(cA);var EIe=cA.exports,EH={exports:{}};(function(t){(function(e,n,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),c=u*2,h=r-1,d;function f(v,b,S){var T=[];b=b==!0?{entropy:!0}:b||{};var _=y(g(b.entropy?[v,x(n)]:v??w(),3),T),E=new p(T),N=function(){for(var $=E.g(i),A=l,D=0;$<u;)$=($+D)*r,A*=r,D=E.g(1);for(;$>=c;)$/=2,A/=2,D>>>=1;return($+D)/A};return N.int32=function(){return E.g(4)|0},N.quick=function(){return E.g(4)/4294967296},N.double=N,y(x(E.S),n),(b.pass||S||function($,A,D,F){return F&&(F.S&&m(F,E),$.state=function(){return m(E,{})}),D?(s[a]=$,A):$})(N,_,"global"in b?b.global:this==s,b.state)}function p(v){var b,S=v.length,T=this,_=0,E=T.i=T.j=0,N=T.S=[];for(S||(v=[S++]);_<r;)N[_]=_++;for(_=0;_<r;_++)N[_]=N[E=h&E+v[_%S]+(b=N[_])],N[E]=b;(T.g=function($){for(var A,D=0,F=T.i,B=T.j,z=T.S;$--;)A=z[F=h&F+1],D=D*r+z[h&(z[F]=z[B=h&B+A])+(z[B]=A)];return T.i=F,T.j=B,D})(r)}function m(v,b){return b.i=v.i,b.j=v.j,b.S=v.S.slice(),b}function g(v,b){var S=[],T=typeof v,_;if(b&&T=="object")for(_ in v)try{S.push(g(v[_],b-1))}catch{}return S.length?S:T=="string"?v:v+"\0"}function y(v,b){for(var S=v+"",T,_=0;_<S.length;)b[h&_]=h&(T^=b[h&_]*19)+S.charCodeAt(_++);return x(b)}function w(){try{var v;return d&&(v=d.randomBytes)?v=v(r):(v=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(v)),x(v)}catch{var b=e.navigator,S=b&&b.plugins;return[+new Date,e,S,e.screen,x(n)]}}function x(v){return String.fromCharCode.apply(0,v)}if(y(s.random(),n),t.exports){t.exports=f;try{d=V1}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:Pe,[],Math)})(EH);var kIe=EH.exports,NIe=IIe,$Ie=TIe,AIe=SIe,RIe=_Ie,DIe=CIe,OIe=EIe,Ju=kIe;Ju.alea=NIe;Ju.xor128=$Ie;Ju.xorwow=AIe;Ju.xorshift7=RIe;Ju.xor4096=DIe;Ju.tychei=OIe;var PIe=Ju;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kH(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=Be([a],r.shape),u=CH({inputs:{x:r},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),c=jt(u.shape,l),h=mt({inputs:{x:u},backend:n,attrs:{shape:c}}),d=tA({inputs:{a:r,b:h},backend:n}),f=NG({inputs:{x:d},backend:n}),p=gy({inputs:{x:f},backend:n,attrs:{axis:l,keepDims:!1}}),m=mt({inputs:{x:p},backend:n,attrs:{shape:c}}),g=sA({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const FIe={kernelName:Rg,backendName:"cpu",kernelFunc:kH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LIe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;we(r,"multinomial");const l=a?r:kH({inputs:{logits:r},backend:n,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],h=n.data.get(l.dataId).values,d=[u,i],f=On(G(d),"int32");for(let p=0;p<u;++p){const m=p*c,g=new Float32Array(c-1);g[0]=h[m];for(let x=1;x<g.length;++x)g[x]=g[x-1]+h[m+x];const y=PIe.alea(o.toString()),w=p*i;for(let x=0;x<i;++x){const v=y();f[w+x]=g.length;for(let b=0;b<g.length;b++)if(v<g[b]){f[w+x]=b;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",f)}const MIe={kernelName:Yx,backendName:"cpu",kernelFunc:LIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VIe=ob;function zIe(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;we(r,"NonMaxSuppression");const u=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,{selectedIndices:h}=VIe(u,c,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const BIe={kernelName:Jx,backendName:"cpu",kernelFunc:zIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UIe=ab;function WIe(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;we(r,"NonMaxSuppressionPadded");const c=n.data.get(r.dataId).values,h=n.data.get(i.dataId).values,{selectedIndices:d,validOutputs:f}=UIe(c,h,o,a,l,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const jIe={kernelName:Zx,backendName:"cpu",kernelFunc:WIe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GIe=lb;function HIe(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;we(r,"NonMaxSuppressionWithScore");const c=n.data.get(r.dataId).values,h=n.data.get(i.dataId).values,d=o,f=a,p=l,m=u,{selectedIndices:g,selectedScores:y}=GIe(c,h,d,f,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const qIe={kernelName:e1,backendName:"cpu",kernelFunc:HIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KIe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;we(r,"oneHot");const u=G(r.shape),c=new Float32Array(u*o);c.fill(l);const h=n.data.get(r.dataId).values;for(let d=0;d<u;++d)h[d]>=0&&h[d]<o&&(c[d*o+h[d]]=a);return n.makeTensorInfo([...r.shape,o],i,c)}const XIe={kernelName:wg,backendName:"cpu",kernelFunc:KIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uv(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Tu({inputs:{input:s},backend:n}),i=uv({inputs:{x:r},backend:n}),o=wh({inputs:{input:s},backend:n}),a=uv({inputs:{x:o},backend:n}),l=zs({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return rA({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const QIe={kernelName:Fg,backendName:"cpu",kernelFunc:uv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NH(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Tu({inputs:{input:s},backend:n}),i=NH({inputs:{x:r},backend:n}),o=wh({inputs:{input:s},backend:n}),a=uv({inputs:{x:o},backend:n}),l=zs({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return rA({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const YIe={kernelName:yg,backendName:"cpu",kernelFunc:NH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $H(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return lv({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(c=>{Mn(i,c.shape,"All tensors passed to stack must have matching shapes"),C(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const h=lv({inputs:{input:c},backend:n,attrs:{dim:r}});return a.push(h),h}),u=vh({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const JIe={kernelName:vg,backendName:"cpu",kernelFunc:$H};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;we(r,"pad");const a=i.map((w,x)=>w[0]+r.shape[x]+w[1]),l=i.map(w=>w[0]),u=n.data.get(r.dataId).values,c=G(r.shape),h=r.shape.length,d=Ie(r.shape),f=G(a),p=a.length,m=Ie(a),g=vn(r.dtype,f);o!==0&&g.fill(o);for(let w=0;w<c;w++){const v=zu(w,h,d).map((S,T)=>S+l[T]),b=ii(v,p,m);g[b]=u[w]}return{dataId:n.write(g,a,r.dtype),shape:a,dtype:r.dtype}}const AH={kernelName:xg,backendName:"cpu",kernelFunc:ZIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eTe=qt((t,e)=>Math.pow(t,e)),tTe=dn(ud,eTe),nTe={kernelName:ud,backendName:"cpu",kernelFunc:tTe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sTe(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,a=r.map(g=>n.data.get(g.dataId).values),l=r.map(g=>g.shape),u=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values,[h,d,f]=qG(a,l,u,i.shape,i.dtype,c,o.shape),p=h.map(g=>n.makeTensorInfo([g.length],"int32",g)),m=n.makeTensorInfo(f,i.dtype,d);return p.concat([m])}const rTe={kernelName:t1,backendName:"cpu",kernelFunc:sTe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iTe(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:i}=e,o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[u,c]=KG(o,s.shape,s.dtype,a,r.shape,l,i.shape),h=n.makeTensorInfo([u.length],"int32",u),d=n.makeTensorInfo([c.length],s.dtype,c);return[h,d]}const oTe={kernelName:n1,backendName:"cpu",kernelFunc:iTe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aTe(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values,d=a.map(g=>n.data.get(g.dataId).values),f=a.map(g=>g.shape),[p,m]=XG(u,r.shape,c,i.shape,i.dtype,h,o.shape,d,f,l);return n.makeTensorInfo(p,i.dtype,m)}const lTe={kernelName:s1,backendName:"cpu",kernelFunc:aTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uTe(t){const{backend:e,attrs:n}=t,{start:s,stop:r,dtype:i,step:o}=n,a=QG(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const cTe={kernelName:r1,backendName:"cpu",kernelFunc:uTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hTe=rt(cd,t=>1/t),dTe={kernelName:cd,backendName:"cpu",kernelFunc:hTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fTe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;we(r,"resizeBilinear");const l=Ie(r.shape),[u,c]=a,[h,d,f,p]=r.shape,m=n.data.get(r.dataId).values,g=new Float32Array(G([h,u,c,p])),y=[i&&u>1?d-1:d,i&&c>1?f-1:f],w=[i&&u>1?u-1:u,i&&c>1?c-1:c];let x=0;const v=y[0]/w[0],b=y[1]/w[1];for(let S=0;S<h;S++)for(let T=0;T<u;T++){let _;o?_=v*(T+.5)-.5:_=v*T;const E=Math.max(0,Math.floor(_)),N=_-E,$=Math.min(d-1,Math.ceil(_)),A=S*l[0]+E*l[1],D=S*l[0]+$*l[1];for(let F=0;F<c;F++){let B;o?B=b*(F+.5)-.5:B=b*F;const z=Math.max(0,Math.floor(B)),H=B-z,M=Math.min(f-1,Math.ceil(B)),j=A+z*l[2],K=D+z*l[2],X=A+M*l[2],Z=D+M*l[2];for(let te=0;te<p;te++){const ie=m[j+te],se=m[K+te],ce=m[X+te],xe=m[Z+te],Ce=ie+(ce-ie)*H,_e=se+(xe-se)*H,Le=Ce+(_e-Ce)*N;g[x++]=Le}}}return n.makeTensorInfo([h,u,c,p],"float32",g)}const pTe={kernelName:_g,backendName:"cpu",kernelFunc:fTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mTe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s;we([i,r],"resizeBilinearGrad");const a=Ie(r.shape),[l,u,c,h]=r.shape,[,d,f]=i.shape,p=new Float32Array(l*u*c*h),m=[o&&d>1?u-1:u,o&&f>1?c-1:c],g=[o&&d>1?d-1:d,o&&f>1?f-1:f],y=m[0]/g[0],w=m[1]/g[1],x=n.data.get(i.dataId).values;let v=0;for(let b=0;b<l;b++){const S=b*a[0];for(let T=0;T<d;T++){const _=T*y,E=Math.floor(_),N=Math.min(Math.ceil(_),u-1),$=S+E*a[1],A=S+N*a[1],D=_-E,F=1-D;for(let B=0;B<f;B++){const z=B*w,H=Math.floor(z),M=Math.min(Math.ceil(z),c-1),j=z-H,K=1-j,X=$+H*a[2],Z=$+M*a[2],te=A+H*a[2],ie=A+M*a[2],se=F*K,ce=F*j,xe=D*K,Ce=D*j;for(let _e=0;_e<h;_e++){const Le=x[v++];p[X+_e]+=Le*se,p[Z+_e]+=Le*ce,p[te+_e]+=Le*xe,p[ie+_e]+=Le*Ce}}}}return n.makeTensorInfo([l,c,u,h],"float32",p)}const gTe={kernelName:a1,backendName:"cpu",kernelFunc:mTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yTe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;we(r,"resizeNearestNeighbor");const l=Ie(r.shape),[u,c]=a,[h,d,f,p]=r.shape,m=n.data.get(r.dataId).values,g=new Float32Array(h*u*c*p),y=[i&&u>1?d-1:d,i&&c>1?f-1:f],w=[i&&u>1?u-1:u,i&&c>1?c-1:c],x=y[0]/w[0],v=y[1]/w[1];let b=0;for(let S=0;S<h;S++){const T=S*l[0];for(let _=0;_<u;_++){const E=o?x*(_+.5):x*_;let N=Math.min(d-1,i?Math.round(E):Math.floor(E));o&&(N=Math.max(0,N));const $=T+N*l[1];for(let A=0;A<c;A++){const D=o?v*(A+.5):v*A;let F=Math.min(f-1,i?Math.round(D):Math.floor(D));o&&(F=Math.max(0,F));const B=$+F*l[2];for(let z=0;z<p;z++){const H=m[B+z];g[b++]=H}}}}return n.makeTensorInfo([h,u,c,p],r.dtype,g)}const wTe={kernelName:Sg,backendName:"cpu",kernelFunc:yTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vTe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s;we([i,r],"resizeNearestNeighborGrad");const a=Ie(r.shape),l=Ie(i.shape),[u,c,h,d]=r.shape,[,f,p]=i.shape,m=new Float32Array(u*c*h*d),g=n.data.get(i.dataId).values,y=[o&&f>1?c-1:c,o&&p>1?h-1:h],w=[o&&f>1?f-1:f,o&&p>1?p-1:p],x=y[0]/w[0],v=y[1]/w[1],b=1/x,S=1/v,T=Math.ceil(b)*2+2,_=Math.ceil(S)*2+2;for(let E=0;E<u;E++){const N=E*a[0];for(let $=0;$<c;$++){const A=N+$*a[1],D=Math.floor($*b),F=Math.floor(D-T/2);for(let B=0;B<h;B++){const z=A+B*a[2],H=Math.floor(B*S),M=Math.floor(H-_/2);for(let j=0;j<d;j++){let K=0;for(let X=0;X<T;X++){const Z=X+F;if(Z<0||Z>=f)continue;const te=N+Z*l[1],ie=Z*x,se=Math.min(c-1,o?Math.round(ie):Math.floor(ie));if($===se)for(let ce=0;ce<_;ce++){const xe=ce+M;if(xe<0||xe>=p)continue;const Ce=te+xe*l[2],_e=xe*v,Le=Math.min(h-1,o?Math.round(_e):Math.floor(_e));B===Le&&(K+=g[Ce+j])}}m[z+j]=K}}}}return n.makeTensorInfo(r.shape,r.dtype,m)}const xTe={kernelName:o1,backendName:"cpu",kernelFunc:vTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s;we(r,"reverse");const o=r.shape.length,a=Be(i,r.shape);if(o===0)return Yi({inputs:{x:r},backend:n});const l=new Jt(r.shape,r.dtype),u=n.bufferSync(r);for(let c=0;c<l.size;c++){const h=l.indexToLoc(c),d=h.slice();a.forEach(f=>d[f]=r.shape[f]-1-d[f]),l.set(u.get(...d),...h)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const ITe={kernelName:Cg,backendName:"cpu",kernelFunc:bTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TTe={kernelName:S1,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=vn(s.dtype,G(s.shape)),[u,c,h,d]=s.shape,[f,p]=HN(o,c,h),m=255,g=Math.sin(r),y=Math.cos(r),w=a.data.get(s.dataId).values;for(let v=0;v<u;v++){const b=v*h*c*d;for(let S=0;S<c;S++){const T=S*(h*d);for(let _=0;_<h;_++){const E=_*d;for(let N=0;N<d;N++){const $=[u,S,_,N],A=$[2],D=$[1];let F=(A-f)*y-(D-p)*g,B=(A-f)*g+(D-p)*y;F=Math.round(F+f),B=Math.round(B+p);let z=i;if(typeof i!="number"&&(N===3?z=m:z=i[N]),F>=0&&F<h&&B>=0&&B<c){const M=B*(h*d),j=F*d,K=b+M+j+N;z=w[K]}const H=b+T+E+N;l[H]=z}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const STe=rt(fd,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),_Te={kernelName:fd,backendName:"cpu",kernelFunc:STe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CTe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=ul(i,r,o),d=!0,f=n.bufferSync(r),p=n.bufferSync(i),m=Fl(f,p,o,h,u,l,a,c,0,d);return n.makeTensorInfo(o,m.dtype,m.values)}const ETe={kernelName:l1,backendName:"cpu",kernelFunc:CTe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kTe(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<e?n=r+1:s=r;return s}function NTe(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<=e?n=r+1:s=r;return s}function $Te(t,e,n,s,r,i){const o=Ft("int32",n*r);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),u=a*r;for(let c=0;c<r;++c)o[u+c]=i==="left"?kTe(l,e[c+u]):NTe(l,e[c+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ATe(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,u=$Te(a,l,r.shape[0],r.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",u)}const RTe={kernelName:c1,backendName:"cpu",kernelFunc:ATe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DTe(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e;we([s,r,i],"select");const o=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,c=_s(r.dtype,i.dtype),h=On(G(r.shape),c);let d=0;const f=o===0||o>1||r.shape.length===1?1:G(r.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<f;m++)a[p]===1?h[d++]=l[p]:h[d++]=u[p];return n.makeTensorInfo(r.shape,c,h)}const OTe={kernelName:Eg,backendName:"cpu",kernelFunc:DTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PTe=fb,FTe=pb,LTe=rt(md,t=>t>=0?FTe*t:PTe*(Math.exp(t)-1)),MTe={kernelName:md,backendName:"cpu",kernelFunc:LTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VTe=rt(wd,t=>t<0?-1:t>0?1:0),zTe={kernelName:wd,backendName:"cpu",kernelFunc:VTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BTe=rt(gd,t=>Math.sin(t)),UTe={kernelName:gd,backendName:"cpu",kernelFunc:BTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WTe=rt(yd,t=>Math.sinh(t)),jTe={kernelName:yd,backendName:"cpu",kernelFunc:WTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GTe=11920928955078125e-23,ZP=Math.log(GTe)+2,HTe=rt(xd,t=>{const e=t>-ZP,n=t<ZP,s=Math.exp(t);let r;return n?r=s:e?r=t:r=Math.log(1+s),r}),qTe={kernelName:xd,backendName:"cpu",kernelFunc:HTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;we([r],"spaceToBatchND");const a=G(i),l=[[0,0]];l.push(...o);for(let S=1+i.length;S<r.shape.length;++S)l.push([0,0]);const u=AH.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),c=sy(u.shape,i,a,!1),h=ry(c.length,i.length,!1),d=iy(u.shape,i,a,!1),m=mt({inputs:{x:u},backend:n,attrs:{shape:c}}),w=$s({inputs:{x:m},backend:n,attrs:{perm:h}}),b=mt({inputs:{x:w},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(w),b}const XTe={kernelName:$g,backendName:"cpu",kernelFunc:KTe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QTe(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values[0],[h,d,f,p,m]=eH(a,s.shape,s.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(d,s.dtype,h),n.makeTensorInfo([d[0]],r.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const YTe={kernelName:h1,backendName:"cpu",kernelFunc:QTe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JTe(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.data.get(r.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(i.dataId).values),[u,c,h]=tH(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(c,s.dtype,u),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const ZTe={kernelName:d1,backendName:"cpu",kernelFunc:JTe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eSe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[u,c]=eA(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(c,s.dtype,u)}const tSe={kernelName:f1,backendName:"cpu",kernelFunc:eSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nSe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[u,c]=eA(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(c,s.dtype,u)}const sSe={kernelName:p1,backendName:"cpu",kernelFunc:nSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rSe(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=ul(i,r,a),f=!1,p=n.bufferSync(r);let m;switch(i.dtype){case"bool":{const g=n.bufferSync(i),y=!!n.data.get(o.dataId).values[0];m=Fl(p,g,a,d,c,u,l,h,y,f);break}case"float32":{const g=n.bufferSync(i),y=n.data.get(o.dataId).values[0];m=Fl(p,g,a,d,c,u,l,h,y,f);break}case"int32":{const g=n.bufferSync(i),y=n.data.get(o.dataId).values[0];m=Fl(p,g,a,d,c,u,l,h,y,f);break}case"string":{const g=n.bufferSync(i),y=ko(n.data.get(o.dataId).values[0]);m=Fl(p,g,a,d,c,u,l,h,y,f);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return n.makeTensorInfo(a,m.dtype,m.values)}const iSe={kernelName:m1,backendName:"cpu",kernelFunc:rSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=Be(o,r.shape)[0],l=a$(r,i,a),u=new Array(r.shape.length).fill(0),c=r.shape.slice();return l.map(h=>{const d=[...c];d[a]=h;const f=Su({inputs:{x:r},backend:n,attrs:{begin:u,size:d}});return u[a]+=h,f})}const aSe={kernelName:Ag,backendName:"cpu",kernelFunc:oSe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lSe={kernelName:g1,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;we(n,"square");const r=s.data.get(n.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uSe=rt(Ed,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),cSe={kernelName:Ed,backendName:"cpu",kernelFunc:uSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=s;we(r,"stridedSlice");const{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:w,end:x,strides:v}=UN(r.shape,i,o,a,l,u,c,h,d);let b;if(m)b=mt({inputs:{x:r},backend:n,attrs:{shape:p}});else if(g||y){C(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const S=VN(w,x,v),T=Su({inputs:{x:r},backend:n,attrs:{begin:w,size:S}});b=mt({inputs:{x:T},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(T)}else{const S=n.bufferSync(r),T=rH(f,S,v,w);b=n.makeTensorInfo(p,T.dtype,T.values)}return b}const dSe={kernelName:y1,backendName:"cpu",kernelFunc:hSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fSe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:c,dataSplits:h}=e,d=n.data.get(c.dataId).values,f=n.data.get(h.dataId).values,[p,m]=iH(d,f,r,i,o,a,l,u);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",m)]}const pSe={kernelName:w1,backendName:"cpu",kernelFunc:fSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mSe(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],[u,c,h]=oH(a,l,r),d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const gSe={kernelName:v1,backendName:"cpu",kernelFunc:mSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ySe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(i.dataId).values,a=aH(o,r);return n.makeTensorInfo(i.shape,"int32",a)}const wSe={kernelName:x1,backendName:"cpu",kernelFunc:ySe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vSe=rt(Sd,t=>Math.tan(t)),xSe={kernelName:Sd,backendName:"cpu",kernelFunc:vSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bSe=rt(_d,t=>Math.tanh(t)),ISe={kernelName:_d,backendName:"cpu",kernelFunc:bSe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TSe(t){const{inputs:e,backend:n}=t,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:c}=ul(i,r,s.shape),h=!1,d=n.bufferSync(r),f=n.bufferSync(i),p=n.bufferSync(s),m=Fl(d,f,s.shape,c,l,a,o,u,p,h);return n.makeTensorInfo(s.shape,m.dtype,m.values)}const SSe={kernelName:u1,backendName:"cpu",kernelFunc:TSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Se(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;we(r,"tile");const o=uH(n.bufferSync(r),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const CSe={kernelName:Cd,backendName:"cpu",kernelFunc:_Se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ESe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s;we(r,"topk");const a=n.data.get(r.dataId).values,[l,u]=hH(a,r.shape,r.dtype,i,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}const kSe={kernelName:b1,backendName:"cpu",kernelFunc:ESe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NSe(t){const{inputs:e,attrs:n,backend:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=n,[c,h,d,f]=r.shape,[p,m]=u??[h,d],g=[c,p,m,f],y=Ie(r.shape),w=y[0],x=y[1],v=y[2],b=Ie(g),S=b[0],T=b[1],_=b[2],E=vn(r.dtype,G(g));E.fill(l);const N=s.data.get(r.dataId).values,$=s.data.get(i.dataId).values;for(let D=0;D<c;++D){const F=i.shape[0]===1?$:$.subarray(D*8,D*8+8);for(let B=0;B<p;++B)for(let z=0;z<m;++z)for(let H=0;H<f;++H){let M;const j=F[6]*z+F[7]*B+1;if(j===0)continue;const K=(F[0]*z+F[1]*B+F[2])/j,X=(F[3]*z+F[4]*B+F[5])/j,Z=eF(K,d,a),te=eF(X,h,a);switch(o){case"nearest":M=PSe(N,h,d,w,x,v,D,te,Z,H,l);break;case"bilinear":M=FSe(N,h,d,w,x,v,D,te,Z,H,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const ie=D*S+B*T+z*_+H;E[ie]=M}return s.makeTensorInfo(g,r.dtype,E)}return{dataId:s.write(E,g,r.dtype),shape:r.shape,dtype:r.dtype}}const $Se={kernelName:I1,backendName:"cpu",kernelFunc:NSe};function eF(t,e,n){switch(n){case"reflect":return ASe(t,e);case"wrap":return RSe(t,e);case"nearest":return OSe(t,e);case"constant":default:return DSe(t)}}function ASe(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return La(0,n,e-1)}function RSe(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return La(0,n,e-1)}function DSe(t,e){return t}function OSe(t,e){return La(0,t,e-1)}function Af(t,e,n,s,r,i,o,a,l,u,c){const h=o*s+a*r+l*i+u;return 0<=a&&a<e&&0<=l&&l<n?t[h]:c}function PSe(t,e,n,s,r,i,o,a,l,u,c){const h=Math.round(a),d=Math.round(l);return Af(t,e,n,s,r,i,o,h,d,u,c)}function FSe(t,e,n,s,r,i,o,a,l,u,c){const h=Math.floor(a),d=Math.floor(l),f=h+1,p=d+1,m=(p-l)*Af(t,e,n,s,r,i,o,h,d,u,c)+(l-d)*Af(t,e,n,s,r,i,o,h,p,u,c),g=(p-l)*Af(t,e,n,s,r,i,o,f,d,u,c)+(l-d)*Af(t,e,n,s,r,i,o,f,p,u,c);return(f-a)*m+(a-h)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LSe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:i}=e;we(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=dH(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const MSe={kernelName:T1,backendName:"cpu",kernelFunc:LSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VSe(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let u=0;for(let f=0;f<o;f++)f!==i&&(l[u++]=r.shape[f]);const c=new Array(o).fill(0),h=r.shape.slice();h[i]=1;const d=new Array(a);for(let f=0;f<d.length;f++){c[i]=f;const p=Su({inputs:{x:r},backend:n,attrs:{begin:c,size:h}});d[f]=mt({inputs:{x:p},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(p)}return d}const zSe={kernelName:Og,backendName:"cpu",kernelFunc:VSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s;we(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,u=[],c=[],h=a-l;let d=i;for(let p=0;p<h;++p){const m=lv({inputs:{input:d},backend:n,attrs:{dim:p+1}});d=m,c.push(m)}for(let p=0;p<o;++p){const m=Lo(p,"int32"),g=n.makeTensorInfo([],"int32",m),y=EG({inputs:{a:g,b:d},backend:n}),w=Ha({inputs:{x:y},backend:n,attrs:{dtype:"float32"}}),x=Fb({inputs:{a:w,b:r},backend:n}),v=gy({inputs:{x},backend:n,attrs:{axis:0,keepDims:!1}});u.push(v),c.push(g),c.push(y),c.push(w),c.push(x),c.push(v)}const f=$H({inputs:u,backend:n,attrs:{axis:0}});return c.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const USe={kernelName:Pg,backendName:"cpu",kernelFunc:BSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WSe=[Txe,rve,_xe,Exe,cve,Nxe,Axe,Dxe,Pxe,Lxe,Vxe,Bxe,Wxe,Hxe,Kxe,Yxe,Zxe,t1e,s1e,bxe,i1e,a1e,u1e,dve,h1e,lve,pve,f1e,ive,m1e,y1e,w1e,x1e,I1e,S1e,C1e,k1e,$1e,R1e,O1e,F1e,M1e,z1e,U1e,W1e,G1e,q1e,X1e,Q1e,Y1e,J1e,ebe,sbe,pxe,ibe,mve,fbe,gve,pbe,wve,xbe,bbe,Tbe,xve,Ive,_be,Ebe,Nbe,Abe,Sve,Cve,ove,Dbe,g1e,Pbe,Lbe,Vbe,mxe,kve,$ve,Bbe,Rve,Wbe,Hbe,Kbe,Ybe,Zbe,tIe,nIe,Ove,rIe,oIe,lIe,cIe,dIe,pIe,gIe,Fve,wIe,bIe,MIe,Mve,zve,BIe,jIe,qIe,Uve,XIe,YIe,JIe,AH,nTe,yxe,Gve,rTe,oTe,lTe,cTe,ave,I_,dTe,wxe,vxe,xxe,pTe,gTe,wTe,xTe,ITe,TTe,_Te,Zve,ETe,RTe,OTe,MTe,txe,zTe,UTe,jTe,nxe,FIe,qTe,XTe,YTe,ZTe,tSe,sSe,iSe,aSe,ixe,lSe,axe,uxe,cSe,dSe,pSe,gSe,wSe,fxe,tbe,xSe,ISe,SSe,CSe,kSe,$Se,Wve,MSe,zSe,USe,QIe];for(const t of WSe)_1(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _l={},l0={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function RH(t,e){_l[t]=e}function yi(t,e){if(!(t in _l)||e!=null){const s=GSe(t,e);if(s!==null)_l[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=_l[t];return n==null||n.isContextLost()?(delete _l[t],yi(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),_l[t])}function jSe(t){if(!U().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function GSe(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??jSe(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete _l[t]},!1),U().getBool("SOFTWARE_WEBGL_ENABLED")&&(l0.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",l0)||n.getContext("experimental-webgl",l0):n.getContext("webgl2",l0)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var nm;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(nm||(nm={}));var hr;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(hr||(hr={}));var Nn;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Nn||(Nn={}));function yy(t,e){return[e,t]}function HSe(t,e){return t*e}function u0(t){const e=G(t),n=Math.ceil(e/4);return Pw(n)}function Bd(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function qSe(t,e){const[n,s]=Bd(t,e);return n*s*4}function hA(t,e){const n=t;let s,r,i,o,a,l,u,c,h,d;return U().getNumber("WEBGL_VERSION")===2?(s=n.R32F,r=n.R16F,i=n.RGBA16F,o=n.RGBA32F,a=n.RED,u=4,c=1,h=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(s=t.RGBA,r=t.RGBA,i=t.RGBA,o=n.RGBA,a=t.RGBA,u=4,c=4,h=e!=null?e.HALF_FLOAT_OES:null,d=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function le(t,e){const n=e();return U().getBool("DEBUG")&&KSe(t),n}function KSe(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+OH(t,e))}const XSe=596e-10,QSe=65504;function DH(t){return!!(U().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||XSe<Math.abs(t)&&Math.abs(t)<QSe)}function OH(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Rf(t,e){return jo(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function PH(t,e){const n=jo(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(le(t,()=>t.shaderSource(n,e)),le(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function FH(t,e){const n=jo(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(le(t,()=>t.shaderSource(n,e)),le(t,()=>t.compileShader(n)),U().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw dA(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const YSe=/ERROR: [0-9]+:([0-9]+):/g;function dA(t,e){const n=YSe.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],r=t.split(`
`),i=r.length.toString().length+2,o=r.map((h,d)=>jl((d+1).toString(),i)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const l=o.slice(0,s-1),u=o.slice(s-1,s),c=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${jl(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function LH(t){return jo(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function MH(t,e){if(le(t,()=>t.linkProgram(e)),!U().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function F0(t,e){if(le(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function VH(t,e){const n=jo(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return le(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),le(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function zH(t,e){const n=jo(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return le(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),le(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function JSe(){return U().getNumber("WEBGL_VERSION")===2?1:4}function BH(t){return jo(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function UH(t,e){const n=U().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function WH(t){return jo(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function S_(t,e,n,s,r,i,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(le(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),le(t,()=>t.vertexAttribPointer(a,r,t.FLOAT,!1,i,o)),le(t,()=>t.enableVertexAttribArray(a)),!0)}function jH(t,e,n){XH(t,n),le(t,()=>t.activeTexture(t.TEXTURE0+n)),le(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function ZSe(t,e){XH(t,e),le(t,()=>t.activeTexture(t.TEXTURE0+e)),le(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function GH(t,e,n){return jo(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function HH(t,e,n){return t.getUniformLocation(e,n)}function qH(t,e,n,s){le(t,()=>jH(t,e,s)),le(t,()=>t.uniform1i(n,s))}function e_e(t){le(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),le(t,()=>t.viewport(0,0,t.canvas.width,t.canvas.height)),le(t,()=>t.scissor(0,0,t.canvas.width,t.canvas.height))}function L0(t,e,n){le(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),le(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function __(t,e){le(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),le(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function Df(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+KH(t,e))}function KH(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function jo(t,e,n){const s=le(t,()=>e());if(s==null)throw new Error(n);return s}function XH(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function _u(t,e=2){return G(t.slice(0,t.length-e))}function Cu(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Of(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[_u(t),...Cu(t)]),e}function QH(t,e=!1){let n=U().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=U().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&U().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?wx(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Fo(t).newShape);let r=G(t),i=null;t.length<=1&&r<=n?i=[1,r]:t.length===2&&t[0]<=n&&t[1]<=n?i=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?i=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?i=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?i=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(i=[t[0],t[1]*t[2]*t[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=_u(t);let l=2,u=2;t.length&&([l,u]=Cu(t)),r=a*(l/2)*(u/2),i=Pw(r).map(c=>c*2)}else i=Pw(r);return i}function c0(t){return t%2===0}function sm(t,e){if(t=t.slice(-2),e=e.slice(-2),We(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||c0(n)&&c0(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&c0(t[0])&&c0(e[0])}let M0,V0;function YH(t){if(M0==null){const e=yi(t);M0=e.getParameter(e.MAX_TEXTURE_SIZE)}return M0}function t_e(){M0=null}function n_e(){V0=null}function JH(t){if(V0==null){const e=yi(t);V0=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,V0)}function ZH(t){if(t===0)return 0;let e;const n=yi(t);return dr(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:dr(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function dr(t,e){return t.getExtension(e)!=null}function C_(t){try{if(yi(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function e6(t){if(t===0)return!1;const e=yi(t);if(t===1){if(!dr(e,"OES_texture_float"))return!1}else if(!dr(e,"EXT_color_buffer_float"))return!1;return E_(e)}function t6(t){if(t===0)return!1;const e=yi(t);if(t===1){if(!dr(e,"OES_texture_float")||!dr(e,"WEBGL_color_buffer_float"))return!1}else{if(dr(e,"EXT_color_buffer_float"))return E_(e);const s="EXT_color_buffer_half_float";if(dr(e,s)){const r=e.getExtension(s);return s_e(e,r)}return!1}return E_(e)}function E_(t){const e=hA(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(i),o}function s_e(t,e){const n=hA(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(o),a}function n6(t){return t!==2?!1:yi(t).fenceSync!=null}function Ud(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&C(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}const r_e=Object.freeze(Object.defineProperty({__proto__:null,assertNotComplex:Ud,bindCanvasToFramebuffer:e_e,bindColorTextureToFramebuffer:L0,bindTextureToProgramUniformSampler:qH,bindTextureUnit:jH,bindVertexBufferToProgramAttribute:S_,callAndCheck:le,canBeRepresented:DH,createFragmentShader:FH,createFramebuffer:WH,createProgram:LH,createStaticIndexBuffer:zH,createStaticVertexBuffer:VH,createTexture:BH,createVertexShader:PH,getBatchDim:_u,getExtensionOrThrow:Rf,getFramebufferErrorMessage:KH,getMaxTexturesInShader:JH,getNumChannels:JSe,getProgramUniformLocation:HH,getProgramUniformLocationOrThrow:GH,getRowsCols:Cu,getShapeAs3D:Of,getTextureShapeFromLogicalShape:QH,getWebGLDisjointQueryTimerVersion:ZH,getWebGLErrorMessage:OH,getWebGLMaxTextureSize:YH,hasExtension:dr,isCapableOfRenderingToFloatTexture:e6,isDownloadFloatTextureEnabled:t6,isReshapeFree:sm,isWebGLFenceEnabled:n6,isWebGLVersionEnabled:C_,linkProgram:MH,logShaderSourceAndInfoLog:dA,resetMaxTextureSize:t_e,resetMaxTexturesInShader:n_e,unbindColorTextureFromFramebuffer:__,unbindTextureUnit:ZSe,validateFramebuffer:Df,validateProgram:F0,validateTextureSize:UH},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ve=U();ve.registerFlag("HAS_WEBGL",()=>ve.getNumber("WEBGL_VERSION")>0);ve.registerFlag("WEBGL_VERSION",()=>C_(2)?2:C_(1)?1:0);ve.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ve.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ve.get("WEBGL_VERSION")===2);ve.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ve.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ve.registerFlag("WEBGL_PACK",()=>ve.getBool("HAS_WEBGL"));ve.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_CLIP",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_REDUCE",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_LAZILY_UNPACK",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_CONV_IM2COL",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>YH(ve.getNumber("WEBGL_VERSION")));ve.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>JH(ve.getNumber("WEBGL_VERSION")));ve.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=ve.getNumber("WEBGL_VERSION");return t===0?0:ZH(t)});ve.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ve.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!ak());ve.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>e6(ve.getNumber("WEBGL_VERSION")));ve.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ve.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ve.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ve.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>t6(ve.getNumber("WEBGL_VERSION")));ve.registerFlag("WEBGL_FENCE_API_ENABLED",()=>n6(ve.getNumber("WEBGL_VERSION")));ve.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ve.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ve.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});ve.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>ak()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});ve.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ve.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ve.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ve.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ve.registerFlag("WEBGL_EXP_CONV",()=>!1);ve.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ve.getBool("IS_TEST"));ve.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ve.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ve.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ve.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ys(){let t,e,n,s,r,i,o,a,l,u;return U().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=U().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zu(t,e,n="index"){const s=Ie(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / ${r}`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${r}`:`index -= ${t[i]} * ${r}`;return`${o}; ${a};`}).join("")}function Lb(t,e,n="index"){const s=Ie(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function i_e(t,e){const n=t.length,s=t.map(i=>`${e}[${i}]`),r=new Array(n-1);r[n-2]=s[n-1];for(let i=n-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function o_e(t,e,n="index"){const s=t.map((i,o)=>o),r=i_e(s,e);return r.map((i,o)=>{const a=`int ${t[o]} = ${n} / ${r[o]}`,l=o===r.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${r[o]}`:`index -= ${t[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function fA(t){const e=Ie(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function pA(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const s6=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:r6}=LW;function a_e(t,e,n){const s=[];if(t.forEach(f=>{const p=G(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?s.push(`uniform float ${f.name}${p>1?`[${p}]`:""};`):(s.push(`uniform sampler2D ${f.name};`),s.push(`uniform int offset${f.name};`)),n.enableShapeUniforms){const{uniformShape:m}=mA(n.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(m.length){case 1:s.push(`uniform int ${f.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${f.name}Shape;`);break}s.push(`uniform ivec2 ${f.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(f=>{s.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});const r=s.join(`
`),i=t.map(f=>l_e(f,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=ys(),l=h_e(a);let u,c,h=p_e(a);return e.isPacked?(u=u_e(e.logicalShape,o,n.enableShapeUniforms),c=f_e(a)):(u=c_e(e.logicalShape,o,n.enableShapeUniforms),c=d_e(a)),n.packedInputs&&(h+=w_e),[h,l,c,r,u,i,n.userCode].join(`
`)}function Wd(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return $_e(t,e);case 1:return R_e(t,e);case 2:return O_e(t,e);case 3:return F_e(t,e);case 4:return M_e(t,e);case 5:return V_e(t);case 6:return z_e(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function i6(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return N_e(t);case 1:return A_e(t,e);case 2:return D_e(t,e);case 3:return P_e(t,e);default:return L_e(t,e)}}function l_e(t,e,n=!1,s){let r="";n?r+=i6(t,s):r+=Wd(t,s);const i=t.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(n?r+=B_e(t,e):r+=U_e(t,e)),r}function u_e(t,e,n){switch(t.length){case 0:return o6();case 1:return v_e(t,e,n);case 2:return E_e(t,e,n);case 3:return b_e(t,e,n);default:return T_e(t,e,n)}}function c_e(t,e,n){switch(t.length){case 0:return o6();case 1:return x_e(t,e,n);case 2:return k_e(t,e,n);case 3:return I_e(t,e,n);case 4:return S_e(t,e,n);case 5:return __e(t,e);case 6:return C_e(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function h_e(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function d_e(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function f_e(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function p_e(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${m_e}
    ${g_e}
    ${y_e}
  `}const m_e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,g_e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,y_e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,w_e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function o6(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function v_e(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function x_e(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function b_e(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),i=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function I_e(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Lb(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=Zu(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function T_e(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),i=r*Math.ceil(t[t.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<t.length-1;u++)o*=t[t.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${l});
    }
  `}function S_e(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Lb(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Zu(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function __e(t,e){const n=Zu(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function C_e(t,e){const n=Zu(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function E_e(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(We(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function k_e(t,e,n){return We(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function ec(t){return`offset${t}`}function N_e(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=ys();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function $_e(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[r,i]=t.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=ec(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function A_e(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,i=ys();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function R_e(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${jd(t)}
      }
    `;const r=t.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=ec(n);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${n}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function D_e(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=i[0],a=i[1],l=ys();if(i!=null&&We(n,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function O_e(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape;if(i!=null&&We(n,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const d=i[0],f=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=Fo(n),l=o;if(l.length<n.length){const d=Gd(t,l),f=["row","col"];return`
      ${Wd(d,e)}
      float ${r}(int row, int col) {
        return ${r}(${Hd(f,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${jd(t)}
      }
    `;const u=i[0],c=i[1],h=ec(s);return c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${s}, uv);
  }
`}function P_e(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(n[0]===1){const d=n.slice(1),f=[1,2],p=Gd(t,d),m=["b","row","col"];return`
        ${i6(p,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Hd(m,f)});
        }
      `}const a=ys();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],u=o[1],c=Math.ceil(n[2]/2),h=c*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${h}, ${c}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function F_e(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=Fo(n),u=a;if(u.length<n.length){const m=Gd(t,u),g=["row","col","depth"];return`
        ${Wd(m,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Hd(g,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${jd(t)}
      }
    `;const c=t.shapeInfo.texShape,h=c[0],d=c[1],f=t.shapeInfo.flatOffset;if(d===i&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(d===o&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const p=ec(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${p};
        vec2 uv = uvFromFlat(${h}, ${d}, index);
        return sampleTexture(${s}, uv);
      }
  `}function L_e(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=ys();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const i=t.shapeInfo.logicalShape,o=i.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],c=l[1],h=Math.ceil(i[o-1]/2);let d=h*Math.ceil(i[o-2]/2),f="int b, int row, int col",p=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let m=2;m<o-1;m++)f=`int b${m}, `+f,d*=i[o-m-1],p=`b${m} * ${d} + `+p;return`
    vec4 ${s}(${f}) {
      int index = ${p};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});
      return ${r.texture2D}(${n}, uv);
    }
  `}function M_e(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[3],o=n[2]*i,a=n[1]*o,{newShape:l,keptDims:u}=Fo(n);if(l.length<n.length){const w=Gd(t,l),x=["row","col","depth","depth2"];return`
      ${Wd(w,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Hd(x,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${jd(t)}
      }
    `;const c=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],f=h[1],p=`int stride2 = ${s}Shape[3];`,m=`int stride1 = ${s}Shape[2] * stride2;`,g=`int stride0 = ${s}Shape[1] * stride1;`;if(f===a&&c==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${d}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(f===i&&c==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${d}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=ec(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${d}, ${f}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function V_e(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=Fo(e);if(l.length<e.length){const m=Gd(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${Wd(m)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Hd(g,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${jd(t)}
      }
    `;const c=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],f=h[1];if(f===a&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===r&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=ec(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${p};
      vec2 uv = uvFromFlat(${d}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function z_e(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:i}=Fo(e);if(r.length<e.length){const g=Gd(t,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Wd(g)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Hd(y,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,c=e[1]*u;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${jd(t)}
      }
    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,f=d[0],p=d[1];if(p===c&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===o&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=ec(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${m};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function jd(t){const e=t.name,n=G(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function B_e(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=r6(t.shapeInfo.logicalShape,e.logicalShape),l=ut(o),u=o-i;let c;const h=["x","y","z","w","u","v"];i===0?c="":o<2&&a.length>=1?c="coords = 0;":c=a.map(w=>`coords.${h[w+u]} = 0;`).join(`
`);let d="";o<2&&i>0?d="coords":d=t.shapeInfo.logicalShape.map((w,x)=>`coords.${h[x+u]}`).join(", ");let f="return outputValue;";const m=G(t.shapeInfo.logicalShape)===1,y=G(e.logicalShape)===1;if(i===1&&!m&&!y)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!y)o===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){const w=i-2,x=i-1;a.indexOf(w)>-1&&a.indexOf(x)>-1?f="return vec4(outputValue.x);":a.indexOf(w)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(x)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${s}(${d});
      ${f}
    }
  `}function U_e(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&We(o,i))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const u=ut(l),c=r6(t.shapeInfo.logicalShape,e.logicalShape),h=l-a;let d;const f=["x","y","z","w","u","v"];a===0?d="":l<2&&c.length>=1?d="coords = 0;":d=c.map(m=>`coords.${f[m+h]} = 0;`).join(`
`);let p="";return l<2&&a>0?p="coords":p=t.shapeInfo.logicalShape.map((m,g)=>`coords.${f[g+h]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${d}
      return get${s}(${p});
    }
  `}function ut(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function mA(t,e,n){const{newShape:s,keptDims:r}=Fo(e),i=e.length,o=t&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!t&&i>1&&!We(e,n)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Gd(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Hd(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_e(t,e,n,s){const r=n.map((c,h)=>{const d={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(d.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:d}}),i=r.map(c=>c.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=a_e(r,o,e),l=FH(t.gl,a),u=t.createProgram(l);return U().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},a6(t,e,u)))}function a6(t,e,n){const s=[],r=[];let i,o,a,l=null,u=null;u=t.getUniformLocation(n,"NAN",!1),U().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const c=!1;for(const h of e.variableNames){const d={name:h,uniform:t.getUniformLocation(n,h,c),offset:t.getUniformLocation(n,`offset${h}`,c)};e.enableShapeUniforms&&(d.shape=t.getUniformLocation(n,`${h}Shape`,c),d.texShape=t.getUniformLocation(n,`${h}TexShape`,c)),s.push(d)}if(e.enableShapeUniforms&&(i=t.getUniformLocation(n,"outShape",c),a=t.getUniformLocation(n,"outShapeStrides",c),o=t.getUniformLocation(n,"outTexShape",c)),e.customUniforms)for(const h of e.customUniforms)r.push(t.getUniformLocation(n,h.name,c));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function tF(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const r=n.logicalShape,i=e[s],o=i.shape;if(!We(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(n.isUniform&&i.isUniform)return;const a=n.texShape,l=i.isUniform?null:i.texData.texShape;if(!We(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function j_e(t,e,n,s,r){e.program.enableShapeUniforms||(tF(e.inShapeInfos,n),tF([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):t.setOutputMatrixTexture(i.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),U().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const u=n[l],{uniform:c,offset:h,shape:d,texShape:f}=e.variablesLocations[l];if(d){const{uniformShape:p}=mA(e.program.packedInputs,u.shape,u.texData.texShape);switch(p.length){case 1:t.gl.uniform1iv(d,new Int32Array(p));break;case 2:t.gl.uniform2iv(d,new Int32Array(p));break;case 3:t.gl.uniform3iv(d,new Int32Array(p));break;case 4:t.gl.uniform4iv(d,new Int32Array(p));break}}if(f&&t.gl.uniform2i(f,u.texData.texShape[0],u.texData.texShape[1]),c!=null){if(u.isUniform){if(G(u.shape)<2)t.gl.uniform1f(c,u.uniformValues[0]);else{let p=u.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(c,p)}continue}u.texData.slice!=null&&h!=null&&t.gl.uniform1i(h,u.texData.slice.flatOffset),t.setInputMatrixTexture(u.texData.texture.texture,c,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Ie(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],c=e.customUniformLocations[l],h=r[l];if(u.type==="float")t.gl.uniform1fv(c,h);else if(u.type==="vec2")t.gl.uniform2fv(c,h);else if(u.type==="vec3")t.gl.uniform3fv(c,h);else if(u.type==="vec4")t.gl.uniform4fv(c,h);else if(u.type==="int")t.gl.uniform1iv(c,h);else if(u.type==="ivec2")t.gl.uniform2iv(c,h);else if(u.type==="ivec3")t.gl.uniform3iv(c,h);else if(u.type==="ivec4")t.gl.uniform4iv(c,h);else throw Error(`uniform type ${u.type} is not supported yet.`)}t.executeProgram()}function G_e(t,e,n){let s="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:c,keptDims:h}=mA(t.packedInputs,o.shape,l);let d="",f="",p="";if(c.length===1&&t.packedInputs){const b=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];d=`${b[0]>1}_${b[1]>1}`}else if(c.length===2&&!t.packedInputs)f=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!t.packedInputs){const b=Ie(c);p=`${b[0]===l[1]}_${b[b.length-1]===l[1]}`}const m=o.shape.length,g=c.length===2&&We(o.shape,l),y=G(o.shape)===1,w=gu(o.shape,n.shape),x=!t.packedInputs&&m===n.shape.length&&We(l,n.texData.texShape),v=t.packedInputs||c.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${m}_${x}_${u?h:""}_${c.length}_${y}_${w}_${g}_${d}_${f}_${p}_${v}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=t.userCode;let i=t.constructor.name;return i+="_"+s+"_"+r+`${U().getNumber("WEBGL_VERSION")}`,i}function Jn(t){return U().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H_e{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=nm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=ys();this.outputShape=e,this.enableShapeUniforms=Jn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Lb(["r","c","d"],e):Zu(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q_e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=nm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=ys();this.outputShape=e,this.enableShapeUniforms=Jn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Lb(["r","c","d"],e):Zu(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K_e{constructor(e){this.variableNames=["A"],this.outTexUsage=hr.DOWNLOAD;const n=ys();this.outputShape=e,this.userCode=`
      ${s6}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X_e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=hr.DOWNLOAD;const n=ys();this.outputShape=e,this.userCode=`
      ${s6}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q_e={R:0,G:1,B:2,A:3};class nF{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=ys();this.outputShape=e,this.enableShapeUniforms=Jn(this.outputShape.length);let i="result";n&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${Q_e[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?pA():fA(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y_e{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=ys();this.outputShape=e,this.enableShapeUniforms=Jn(this.outputShape.length);let r="",i="result";n&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?pA():fA(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l6(t){const e=ys(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return PH(t,n)}function u6(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return VH(t,e)}function c6(t){const e=new Uint16Array([0,1,2,2,1,3]);return zH(t,e)}function wy(t,e,n,s,r,i){UH(e,n);const o=BH(t),a=t.TEXTURE_2D;return le(t,()=>t.bindTexture(a,o)),le(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),le(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),le(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),le(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),U().getNumber("WEBGL_VERSION")===1?le(t,()=>t.texImage2D(a,0,s,e,n,0,r,i,null)):le(t,()=>t.texStorage2D(a,1,s,e,n)),le(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[n,e]}}function gA(t){return t.internalFormatFloat}function h6(t,e,n,s){const[r,i]=yy(e,n);return wy(t,r,i,gA(s),s.textureFormatFloat,t.FLOAT)}function yA(t){return t.internalFormatHalfFloat}function d6(t,e,n,s){const[r,i]=yy(e,n);return wy(t,r,i,yA(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function wA(t){return t.downloadTextureFormat}function f6(t,e,n,s){const[r,i]=yy(e,n);return wy(t,r,i,wA(s),t.RGBA,t.UNSIGNED_BYTE)}function vA(t){return t.internalFormatPackedFloat}function p6(t,e,n,s){const[r,i]=Bd(e,n);return wy(t,r,i,vA(s),t.RGBA,t.FLOAT)}function xA(t){return t.internalFormatPackedHalfFloat}function m6(t,e,n,s){const[r,i]=Bd(e,n);return wy(t,r,i,xA(s),t.RGBA,s.textureTypeHalfFloat)}function g6(t,e,n){return le(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),S_(t,e,"clipSpacePos",n,3,20,0)&&S_(t,e,"uv",n,2,20,12)}function y6(t,e,n,s,r,i){le(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*s*4),a=t.FLOAT,l=i.internalFormatPackedFloat),o.set(r),U().getNumber("WEBGL_VERSION")===2?le(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,o)):le(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,o)),le(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function w6(t,e,n){le(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?U().getNumber("WEBGL_VERSION")===2?le(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):le(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):U().getNumber("WEBGL_VERSION")===2?le(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):le(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),le(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function v6(t,e,n,s){const r=t.createBuffer();le(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const a=4*4*e*n;return le(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),le(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),le(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function x6(t,e,n){const s=t,r=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function b6(t,e,n,s){const[r,i]=yy(e,n),o=4,a=new Uint8Array(HSe(e*n,o));return le(t,()=>t.readPixels(0,0,r,i,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function I6(t,e,n,s,r,i,o,a){const l=t,u=new Float32Array(qSe(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function T6(t,e,n){const s=new Float32Array(e*n*4);return le(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}const J_e=Object.freeze(Object.defineProperty({__proto__:null,bindVertexProgramAttributeStreams:g6,createBufferFromOutputTexture:v6,createFloat16MatrixTexture:d6,createFloat16PackedMatrixTexture:m6,createFloat32MatrixTexture:h6,createIndexBuffer:c6,createPackedMatrixTexture:p6,createUnsignedBytesMatrixTexture:f6,createVertexBuffer:u6,createVertexShader:l6,downloadByteEncodedFloatMatrixFromOutputTexture:b6,downloadFloat32MatrixFromBuffer:x6,downloadMatrixFromPackedOutputTexture:T6,downloadPackedMatrixFromBuffer:I6,getInternalFormatForFloat16MatrixTexture:yA,getInternalFormatForFloat16PackedMatrixTexture:xA,getInternalFormatForFloat32MatrixTexture:gA,getInternalFormatForPackedMatrixTexture:vA,getInternalFormatForUnsignedBytesMatrixTexture:wA,uploadDenseMatrixToTexture:y6,uploadPixelDataToTexture:w6},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z0{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=U().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,RH(n,e)):this.gl=yi(n),e=this.gl,U().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>le(i,()=>i.createVertexArray()),this.bindVertexArray=o=>le(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>le(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>le(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>le(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>le(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>le(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>le(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),U().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Rf(this.gl,i),dr(this.gl,o))this.textureHalfFloatExtension=Rf(this.gl,o);else if(U().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),dr(this.gl,r))this.colorBufferHalfFloatExtension=Rf(this.gl,r);else if(U().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",dr(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(dr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=u6(this.gl),this.indexBuffer=c6(this.gl),this.framebuffer=WH(this.gl),this.textureConfig=hA(this.gl,this.textureHalfFloatExtension)}get debug(){return U().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;le(e,()=>e.finish()),le(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),le(e,()=>e.deleteFramebuffer(this.framebuffer)),le(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),le(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),le(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),h6(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),d6(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),f6(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),w6(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,r){this.throwIfDisposed(),y6(this.gl,e,n,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),m6(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),p6(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(__(this.gl,this.framebuffer),this.outputTexture=null),le(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>b6(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,r,i,o){return I6(this.gl,e,n,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return x6(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const r=v6(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(U().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},n=i}else U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>T6(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=l6(n));const s=LH(n);le(n,()=>n.attachShader(s,this.vertexShader)),le(n,()=>n.attachShader(s,e)),MH(n,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&F0(n,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;le(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),g6(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(le(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&F0(this.gl,this.program),le(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?GH(this.gl,e,n):HH(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),le(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),qH(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[r,i]=Bd(n,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,n,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,n)}setOutputPackedMatrixWriteRegion(e,n,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&F0(this.gl,this.program),Df(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}le(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),le(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Rf(this.gl,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await PS(()=>this.disposed||this.isQueryAvailable(e,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=Z_e(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in U().platform&&(s=U().platform.setTimeoutCustom.bind(U().platform)),PS(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),L0(this.gl,e,this.framebuffer),this.debug&&Df(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(L0(this.gl,this.outputTexture,this.framebuffer),this.debug&&Df(this.gl)):__(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const r=this.gl;L0(r,e,this.framebuffer),this.debug&&Df(r),this.outputTexture=e,le(r,()=>r.viewport(0,0,n,s)),le(r,()=>r.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,r){this.throwIfDisposed(),le(this.gl,()=>this.gl.scissor(e,n,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Z_e(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:eCe,bincountImpl:S6,bincountReduceImpl:tCe,bitwiseAndImpl:nCe,castImpl:sCe,ceilImpl:rCe,concatImpl:iCe,equalImpl:oCe,expImpl:aCe,expm1Impl:lCe,floorImpl:uCe,gatherNdImpl:cCe,gatherV2Impl:hCe,greaterImpl:dCe,greaterEqualImpl:fCe,lessImpl:pCe,lessEqualImpl:mCe,linSpaceImpl:gCe,logImpl:yCe,maxImpl:wCe,maximumImpl:vCe,minimumImpl:xCe,multiplyImpl:bCe,negImpl:ICe,notEqualImpl:TCe,prodImpl:SCe,raggedGatherImpl:_Ce,raggedRangeImpl:CCe,raggedTensorToTensorImpl:ECe,rangeImpl:kCe,rsqrtImpl:NCe,scatterImpl:$Ce,sigmoidImpl:ACe,simpleAbsImpl:_6,sliceImpl:RCe,sparseFillEmptyRowsImpl:DCe,sparseReshapeImpl:OCe,sparseSegmentReductionImpl:C6,sqrtImpl:PCe,staticRegexReplaceImpl:FCe,stridedSliceImpl:LCe,stringNGramsImpl:MCe,stringSplitImpl:VCe,stringToHashBucketFastImpl:zCe,subImpl:BCe,tileImpl:UCe,topKImpl:WCe,transposeImpl:bA,uniqueImpl:jCe}=fH;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E6(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function ls(t,e){return e===1?[t]:E6(t,e)}function GCe(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HCe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Jn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=ls("rc",this.rank),s=ut(this.rank),r=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;n.push(i)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k6{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Jn(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${qCe(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?pA():fA(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function qCe(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?o_e(["r","c","d"],"inputShape"):Zu(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KCe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const r=rF(n,s),i=iF(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=sF(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===Nn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Nn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Nn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Nn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Nn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,s,r){if(this.freeTextures==null)return;const i=rF(s,r),o=iF(n,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=sF(n,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=U().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],c=u&&u.indexOf(e);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function XCe(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function sF(t,e,n,s,r){const i=QCe(e,s);let o;if(r){const[l,u]=Bd(t[0],t[1]);o=l*u}else{const[l,u]=yy(t[0],t[1]);o=l*u}const a=XCe(n,i);return o*a}function QCe(t,e){switch(t){case Nn.PACKED_2X2_FLOAT32:return vA(e);case Nn.PACKED_2X2_FLOAT16:return xA(e);case Nn.UNPACKED_FLOAT32:return gA(e);case Nn.UNPACKED_FLOAT16:return yA(e);case Nn.PACKED_4X1_UNSIGNED_BYTE:return wA(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function YCe(t){return U().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Nn.PACKED_2X2_FLOAT32:Nn.UNPACKED_FLOAT32:t?Nn.PACKED_2X2_FLOAT16:Nn.UNPACKED_FLOAT16}function rF(t,e){if(t===hr.UPLOAD)return Nn.PACKED_2X2_FLOAT32;if(t===hr.RENDER||t==null)return YCe(e);if(t===hr.DOWNLOAD||t===hr.PIXELS)return Nn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function iF(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Di{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Jn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const jr="if (isnan(x)) return x;",JCe="return x;",oF="return abs(x);",ZCe="return (x >= 0.0) ? x : (exp(x) - 1.0);",eEe=jr+`
  return (x < 0.0) ? 0.0 : x;
`,tEe=jr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,na="return x;",nEe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sEe="return x;",rEe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,iEe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,oEe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,aEe="return 1.0 / (1.0 + exp(-1.0 * x));";class ga{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Jn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lEe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Jn(this.outputShape.length);const n=e.length,s=ls("rc",n),r=ut(n),i=GCe(n,s),o=s.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uEe=eb,cEe=1e-7,hEe=1e-4,h0={};function dEe(t){return t in h0||(h0[t]={}),h0[t]}const fEe=U().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),pEe=600;function mEe(){return U().global.screen==null?1024:U().global.screen.height*U().global.screen.width*window.devicePixelRatio*pEe/1024/1024}class vy extends yx{nextDataId(){return vy.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!U().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof z0)n=e;else{const s=yi(U().getNumber("WEBGL_VERSION"),e);n=new z0(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=yi(U().getNumber("WEBGL_VERSION"));n=new z0(s),this.binaryCache=dEe(U().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new KCe(this.gpgpu),this.numMBBeforeWarning=mEe(),this.texData=new JE(this,Qr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,r,i,o){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const u=Of(n),c=new nF(u,!1,o),h=this.runWebGLProgram(c,[a],s,[[r,i]]);return h.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,n,s){if((U().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||U().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:s,values:e,usage:hr.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,r,i){if(U().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:n,usage:hr.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=n;if(o!=null){let d;l?d=new ga(a,na):d=new Di(a,na);const f=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:r}],r),p=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),p}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let c;u&&(c=Cn());let h;if(r==="complex64"){const d=this.readSync(i.real.dataId),f=this.readSync(i.imag.dataId);h=Do(d,f)}else h=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=Cn()-c),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(m=>p.push(m))}const n=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=n;if(i!=null){let p;l?p=new ga(r,na):p=new Di(r,na);const m=this.runWebGLProgram(p,[{dataId:e,shape:r,dtype:o}],o),g=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(s!=null)return this.convertAndCacheOnCPU(e);if(U().getBool("DEBUG")&&!U().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&U().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,c;if(o!=="complex64"&&U().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);const p=this.texData.get(c.dataId);u=this.gpgpu.createBufferFromTexture(p.texture.texture,...u0(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],g=p[1];h=Do(m,g)}else if(u==null)h=this.getValuesFromTexture(e);else{const p=G(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(u,p)}if(c!=null&&this.disposeIntermediateTensorInfo(c),u!=null){const p=this.gpgpu.gl;le(p,()=>p.deleteBuffer(u))}const d=this.convertAndCacheOnCPU(e,h),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach(p=>p(d)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Qr().removeDataId(e,this),this.pendingDeletes--),d}readToGPU(e,n={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let f;l?f=new ga(i,na):f=new Di(i,na);const p=this.runWebGLProgram(f,[{dataId:e,shape:i,dtype:a}],a),m=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),m}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,n.customTexShape),h=Qr().makeTensorFromTensorInfo(c),d=this.texData.get(c.dataId);return Object.assign({tensorRef:h},d.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>ko(r));return Fe(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Fe(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!DH(s))throw U().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:r}=this.texData.get(e),i=G(n);if(U().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const d=this.decode(e),f=this.texData.get(d.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,...u0(n)).subarray(0,i);return this.disposeIntermediateTensorInfo(d),p}const o=U().getBool("WEBGL_PACK")&&r===!0,a=o?Of(n):n,l=o?new X_e(a):new K_e(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),c=this.texData.get(u.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),h}timerAvailable(){return U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=Ki(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Ki(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=QB(l),a.getExtraProfileInfo=()=>l.map((u,c)=>({name:o[c],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Cn(),endMs:null}}endTimer(e){return U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Cn(),e)}async getQueryTime(e){if(U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(n,r,i,o)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=fEe){return U().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&G(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){ir("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return uEe(e.shape,n)}packedUnaryOp(e,n,s){const r=new ga(e.shape,n),i=this.compileAndRun(r,[e],s);return Qr().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=_6(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,oF,e.dtype);const n=new Di(e.shape,oF),s=this.compileAndRun(n,[e]);return Qr().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&Ri(s[0])){const i=s.map(o=>Bi(o));r=this.write(i,e,n)}else r=this.write(s,e,n);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:n}}makeOutput(e,n,s){return Qr().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new lEe(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new HCe(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const s=[_u(e.shape),...Cu(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[_u(n),...Cu(n)],o=new k6(i,s),a=!0,l=[s],u=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:u.dataId,shape:n,dtype:u.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(n!=null){const d=G(i),f=n[0]*n[1]*4;C(d<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Of(i);let l;r?l=new q_e(a):l=new H_e(a);const u=!0,c=[n??u0(a)],h=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,c,u,n);return{dtype:o,shape:i,dataId:h.dataId}}runWebGLProgram(e,n,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===nm.DENSE){const y=o??u0(e.outputShape);l.texShape=y.map(w=>w*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),G(a.shape)===0)return l.values=vn(a.dtype,0),a;const u=[],c=n.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let w=this.texData.get(y.dataId);if(w.texture==null){if(!e.packedInputs&&G(y.shape)<=U().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!w.isPacked!=!!e.packedInputs)y=w.isPacked?this.unpackTensor(y):this.packTensor(y),u.push(y),w=this.texData.get(y.dataId);else if(w.isPacked&&!sm(w.shape,y.shape)){const x=y,v=y.shape;y.shape=w.shape,y=this.packedReshape(y,v),u.push(y),w=this.texData.get(y.dataId),x.shape=v}return{shape:y.shape,texData:w,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:l,isUniform:!1},d=G_e(e,c,h),f=this.getAndSaveBinary(d,()=>W_e(this.gpgpu,e,c,h)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),U().get("ENGINE_COMPILE_ONLY")||j_e(this.gpgpu,f,c,h,r),u.forEach(y=>this.disposeIntermediateTensorInfo(y)),p&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)}));const g=U().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){const y=Cn();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!U().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,n,s,r,i=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,r,i)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(U().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=W(()=>{if(!U().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=U().getBool("DEBUG");U().set("DEBUG",!1);const n=this.abs(Te(1e-8)).dataSync()[0];if(U().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?cEe:hEe}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=n;if(o!=null)return;const u=this.activeTimers!=null;let c;u&&(c=Cn());let h=n.texShape;if(h==null&&(h=QH(s,l),n.texShape=h),i!=null){const d=Of(s);let f,p=h[1],m=h[0];const g=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!g)&&([p,m]=Bd(h[0],h[1])),l?f=new Y_e(d,g):f=new nF(d,g);const y=g?[m,p]:h,w=this.makeTensorInfo(y,r),x=this.texData.get(w.dataId);g?x.usage=hr.PIXELS:x.usage=hr.UPLOAD,x.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),p,m,i);const v=[[m,p]],S=this.runWebGLProgram(f,[w],r,v,!0),T=this.texData.get(S.dataId);n.texShape=T.texShape,n.isPacked=T.isPacked,n.usage=T.usage,U().get("ENGINE_COMPILE_ONLY")?this.disposeData(S.dataId):(n.texture=T.texture,n.values=null,this.texData.delete(S.dataId)),this.disposeIntermediateTensorInfo(w),u&&(this.uploadWaitMs+=Cn()-c)}else{const d=this.acquireTexture(h,a,r,l);n.texture=d}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:r}=s;return n!=null&&(s.values=gEe(n,r)),s.values}acquireTexture(e,n,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,r)}computeBytes(e,n){return e[0]*e[1]*Bp(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await WN(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(dA(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=a6(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=Qr().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,n,s,i,o,a);return Qr().makeTensorFromDataId(u,n,s,l)}}vy.nextDataId=0;function gEe(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/** @license See the LICENSE file. */const N6="4.17.0";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $6(){U().set("WEBGL_FORCE_F16_TEXTURES",!0)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */lk()&&ck("webgl",()=>new vy,2);const yEe={forceHalfFloat:$6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IA=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Eu{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=Ae(n,s),this.enableShapeUniforms=Jn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tc=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class qd{constructor(e,n,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ae(n,s);const i=this.outputShape.length;this.enableShapeUniforms=Jn(i);let o="";if(r)if(i===0||G(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${ut(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=ls("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zs(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const wEe={kernelName:Zh,backendName:"webgl",kernelFunc:Zs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hl(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.makeTensorInfo(s.shape,"complex64"),o=n.texData.get(i.dataId),a=Zs({inputs:{x:s},backend:n}),l=Zs({inputs:{x:r},backend:n});return o.complexTensorInfos={real:a,imag:l},i}const vEe={kernelName:Cx,backendName:"webgl",kernelFunc:hl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A6="return (a < 0.) ? b * a : a;",R6=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function xEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s,o=n.makeTensorInfo([],"float32",Lo(i,"float32")),a=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qd(R6,r.shape,o.shape):new Eu(A6,r.shape,o.shape),l=n.runWebGLProgram(a,[r,o],"float32");return n.disposeIntermediateTensorInfo(o),l}const bEe={kernelName:ng,backendName:"webgl",kernelFunc:xEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D6="return (a < 0.) ? b * a : a;",O6=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function IEe(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e,i=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qd(O6,s.shape,r.shape):new Eu(D6,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],"float32")}const TEe={kernelName:bg,backendName:"webgl",kernelFunc:IEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kd="if (isnan(x)) return x;";function Ye({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const h=a.texData.get(o.dataId),d=n(h.values,l);return a.makeTensorInfo(o.shape,l,d)}const u=U().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let c;return u?c=new ga(o.shape,e):c=new Di(o.shape,t),a.runWebGLProgram(c,[o],l)}}function Un({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,c=a;if(s&&l.dtype==="complex64"){const p=c.texData.get(l.dataId),m=c.texData.get(u.dataId),[g,y]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(x=>{const[v,b]=x,S={dataId:v.dataId,dtype:v.dtype,shape:l.shape},T={dataId:b.dataId,dtype:b.dtype,shape:u.shape},_=new Eu(t,l.shape,u.shape);return c.runWebGLProgram(_,[S,T],_s(v.dtype,b.dtype))}),w=hl({inputs:{real:g,imag:y},backend:c});return c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(y),w}const h=i||_s(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||c.shouldExecuteOnCPU([l,u]))&&r!=null){const p=c.texData.get(l.dataId).values,m=c.texData.get(u.dataId).values,g=l.dtype==="string"?Oo(p):p,y=l.dtype==="string"?Oo(m):m,[w,x]=r(l.shape,u.shape,g,y,h),v=c.makeTensorInfo(x,h),b=c.texData.get(v.dataId);return b.values=w,v}const d=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let f;return d?f=new qd(e,l.shape,u.shape,n):f=new Eu(t,l.shape,u.shape),c.runWebGLProgram(f,[l,u],h)}}function rm(t,e=!1){if(t==="linear")return e?sEe:JCe;if(t==="relu")return e?iEe:eEe;if(t==="elu")return e?rEe:ZCe;if(t==="relu6")return e?oEe:tEe;if(t==="prelu")return e?O6:D6;if(t==="leakyrelu")return e?R6:A6;if(t==="sigmoid")return e?aEe:nEe;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P6{constructor(e,n,s,r=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Jn(this.outputShape.length);const c=r?e[1]:e[2],h=Math.ceil(c/2),d=r?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",y="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const w=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let x="rc.x",v="rc.x";e[0]<n[0]?x=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(v=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${x};
        int batchB = ${v};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${d});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${w}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aF={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class lF{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ae(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uF="return a * b;";function TA(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=_s(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),u=new lF(aF.REAL,s.shape,r.shape),c=new lF(aF.IMAG,s.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],d=n.runWebGLProgram(u,h,"float32"),f=n.runWebGLProgram(c,h,"float32"),p=hl({inputs:{real:d,imag:f},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),p}if(n.shouldExecuteOnCPU([s,r])){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),[u,c]=bCe(s.shape,r.shape,a.values,l.values,i),h=n.makeTensorInfo(c,i),d=n.texData.get(h.dataId);return d.values=u,h}let o;return U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new qd(uF,s.shape,r.shape):o=new Eu(uF,s.shape,r.shape),n.runWebGLProgram(o,[s,r],i)}const SEe={kernelName:ld,backendName:"webgl",kernelFunc:TA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ee(t,e,n){const s=[_u(t.shape),...Cu(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},i=[_u(e),...Cu(e)],o=new k6(i,s),a=!0,l=[s],u=n.runWebGLProgram(o,[r],t.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ae(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:i}=s,o=n,a=G(r.shape),l=ek(i,a),u=G(l);C(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const c=o.texData.get(r.dataId);return c.isPacked&&!sm(r.shape,l)&&!(c.texture!==null&&sm(c.shape,l))?_Ee(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const CEe={kernelName:Tg,backendName:"webgl",kernelFunc:ae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cF{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(n!=null){const h=1/n;u=`sumValue += dot(values * ${uu(h)?h.toPrecision(2):h}, ones);`}let c="";i%s>0&&(c=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EEe{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?u="sumValue":n==="prod"?u="prodValue":n==="all"?u="allValue":n==="any"&&(u="anyValue");const c=Math.floor(s/4)*4,h=s%4;let d=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";n==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):n==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${d}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kEe(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=db(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function nc(t,e,n,s){const r=kEe(t.shape);let i=t;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:u}=r[o];let c,h;n==="mean"?c=o===0?new cF({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},a):new cF({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u}):c=new EEe({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},n),h=i,i=s.runWebGLProgram(c,[i],e),h.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(h)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NEe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[n[o]];this.outputShape=s,this.rank=s.length;const r=ut(this.rank),i=$Ee(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function $Ee(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<t.length;r++)s[t[r]]=n[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AEe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let c=0;c<s.length;c++)s[c]=e[n[c]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=ut(this.rank),i=E6("rc",this.rank),o=new Array(this.rank);for(let c=0;c<n.length;c++)o[n[c]]=i[c];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mb(t,e,n){const s=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new AEe(t.shape,e):new NEe(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function REe(t,e,n,s){const r=e,i=t.shape.length,o=Be(r,t.shape);let a=o;const l=Dt(a,i),u=l!=null;let c=t;u&&(c=Mb(t,l,s),a=Gt(a.length,i)),zn("sum",a,i);const[h,d]=In(c.shape,a);let f=h;n&&(f=jt(h,o));const p=G(d),g=G(t.shape)/p,y=ae({inputs:{x:c},attrs:{shape:[g,p]},backend:s}),w=C1(t.dtype),x=nc(y,w,"sum",s),v=ae({inputs:{x},attrs:{shape:f},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(x),u&&s.disposeIntermediateTensorInfo(c),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vb(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;return REe(r,i,o,n)}const DEe={kernelName:Ng,backendName:"webgl",kernelFunc:Vb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ps(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{perm:i}=s,o=n,a=r.shape.length,l=new Array(a);for(let c=0;c<l.length;c++)l[c]=r.shape[i[c]];let u;if(o.shouldExecuteOnCPU([r])){const h=o.texData.get(r.dataId).values,d=bA(h,r.shape,r.dtype,i,l);u=o.makeTensorInfo(l,r.dtype);const f=o.texData.get(u.dataId);f.values=d}else u=Mb(r,i,o);return u}const OEe={kernelName:Gl,backendName:"webgl",kernelFunc:ps};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F6=1e3;function cv({a:t,b:e,transposeA:n,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=t.shape.length,c=e.shape.length,h=n?t.shape[u-2]:t.shape[u-1],d=s?e.shape[c-1]:e.shape[c-2],f=n?t.shape[u-1]:t.shape[u-2],p=s?e.shape[c-2]:e.shape[c-1],m=t.shape.slice(0,-2),g=e.shape.slice(0,-2),y=G(m),w=G(g),v=Ae(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([f,p]);C(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const b=n?[y,h,f]:[y,f,h],S=s?[w,p,d]:[w,d,p],T=ae({inputs:{x:t},backend:r,attrs:{shape:b}}),_=ae({inputs:{x:e},backend:r,attrs:{shape:S}}),E=[T,_],N=Math.max(y,w),$=n?T.shape[1]:T.shape[2],A=i!=null,D=o!=null,F=l==="leakyrelu",B=l!=null?rm(l,!0):null,z=A||D||F||B!=null;let H;if((f===1||p===1)&&$>F6&&z===!1){let j=T,K=_;n&&(j=ps({inputs:{x:T},backend:r,attrs:{perm:[0,2,1]}}),E.push(j)),s&&(K=ps({inputs:{x:_},backend:r,attrs:{perm:[0,2,1]}}),E.push(K));const X=p!==1,Z=p===1;let te=j;X&&(te=ae({inputs:{x:j},backend:r,attrs:{shape:[N,$,1]}}),E.push(te));const ie=p===1?2:1;let se=K;Z&&(se=ae({inputs:{x:K},backend:r,attrs:{shape:[N,1,$]}}),E.push(se));const ce=TA({inputs:{a:te,b:se},backend:r});H=Vb({inputs:{x:ce},backend:r,attrs:{axis:ie,keepDims:!0}}),E.push(ce)}else{const j=_s(t.dtype,e.dtype),K=new P6(b,S,[N,f,p],n,s,A,B,D,F),X=[T,_];if(i!=null&&X.push(i),D&&X.push(o),F){const Z=r.makeTensorInfo([],"float32",Lo(a,"float32"));X.push(Z),E.push(Z)}H=r.runWebGLProgram(K,X,j)}const M=ae({inputs:{x:H},backend:r,attrs:{shape:v}});E.push(H);for(const j of E)r.disposeIntermediateTensorInfo(j);return M}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PEe(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=s;return cv({a:r,b:i,transposeA:l,transposeB:u,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:c})}const FEe={kernelName:Up,backendName:"webgl",kernelFunc:PEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hF="return abs(x);";function LEe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=n.texData.get(s.dataId),o=_6(i.values);return n.makeTensorInfo(s.shape,s.dtype,o)}let r;return U().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ga(s.shape,hF):r=new Di(s.shape,hF),n.runWebGLProgram(r,[s],s.dtype)}const MEe={kernelName:Om,backendName:"webgl",kernelFunc:LEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VEe=jr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,zEe=Ye({opSnippet:VEe}),BEe={kernelName:Dh,backendName:"webgl",kernelFunc:zEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UEe=jr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,WEe=Ye({opSnippet:UEe}),jEe={kernelName:Oh,backendName:"webgl",kernelFunc:WEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dF="return a + b;",GEe=Un({opSnippet:dF,packedOpSnippet:dF,supportsComplex:!0,cpuKernelImpl:eCe}),HEe={kernelName:Bu,backendName:"webgl",kernelFunc:GEe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qEe{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KEe{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B0(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return Zs({inputs:{x:s[0]},backend:n});if(s.length>U().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=B0({inputs:s.slice(0,l),backend:n}),c=B0({inputs:s.slice(l),backend:n});return B0({inputs:[u,c],backend:n})}const r=s.map(l=>l.dtype).reduce((l,u)=>_s(l,u)),i=s.map(l=>l.shape),a=U().getBool("WEBGL_PACK")?new KEe(s[0].shape,i):new qEe(s[0].shape,i);return n.runWebGLProgram(a,s,r)}const XEe={kernelName:Pm,backendName:"webgl",kernelFunc:B0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Be(i,r.shape);let u=l;const c=Dt(u,a);let h=r;c!=null&&(h=ps({inputs:{x:r},backend:n,attrs:{perm:c}}),u=Gt(u.length,a)),zn("all",u,a);const[d,f]=In(h.shape,u),p=G(f),m=ae({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),g=nc(m,m.dtype,"all",n);let y;if(o){const w=jt(d,l);y=ae({inputs:{x:g},backend:n,attrs:{shape:w}})}else y=ae({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),c!=null&&n.disposeIntermediateTensorInfo(h),y}const YEe={kernelName:xx,backendName:"webgl",kernelFunc:QEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Be(i,r.shape);let u=l;const c=Dt(u,a);let h=r;c!=null&&(h=ps({inputs:{x:r},backend:n,attrs:{perm:c}}),u=Gt(u.length,a)),zn("any",u,a);const[d,f]=In(h.shape,u),p=G(f),m=ae({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),g=nc(m,m.dtype,"any",n);let y;if(o){const w=jt(d,l);y=ae({inputs:{x:g},backend:n,attrs:{shape:w}})}else y=ae({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),c!=null&&n.disposeIntermediateTensorInfo(h),y}const ZEe={kernelName:bx,backendName:"webgl",kernelFunc:JEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eke{constructor(e,n,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tke{constructor(e,n,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,C(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=ut(l),c=ls("coords",l);let h,d;if(o===1){d=l+1;const _=ut(d);h=`
        ${_} sourceLocR = ${_}(${c.join()}, 0);
        ++${c[l-1]};
        ${_} sourceLocG = ${_}(${c.join()}, 0);
        ++${c[l-2]};
        ${_} sourceLocA = ${_}(${c.join()}, 0);
        --${c[l-1]};
        ${_} sourceLocB = ${_}(${c.join()}, 0);
        --${c[l-2]};`}else d=l,h=`
        ${u} sourceLocR = coords;
        ++${c[l-1]};
        ${u} sourceLocG = coords;
        ++${c[l-2]};
        ${u} sourceLocA = coords;
        --${c[l-1]};
        ${u} sourceLocB = coords;
        --${c[l-2]};`;const f=["x","y","z","w","u","v"].slice(0,d),p="."+f[d-1],m=f.map(_=>"int "+_),g=ls("sourceLocR",d-1).concat("inIdx.r"),y=ls("sourceLocG",d-1).concat("inIdx.g"),w=ls("sourceLocB",d-1).concat("inIdx.b"),x=ls("sourceLocA",d-1).concat("inIdx.a"),v=s==="max"?"greaterThan":"lessThan",b=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${x.join()})));`,S=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${w.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${x.join()}) : 0.)`,T=r?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${T}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${c[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${c[l-2]} < ${a[l-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${S};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${b}
          vec4 candidate = ${S};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L6(t,e,n,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=db(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new eke(a,n,s==null),u=[e];s!=null&&u.push(s);const c=t.runWebGLProgram(l,u,"int32");if(c.shape[1]===1)return c;const h=L6(t,e,n,c);return t.disposeIntermediateTensorInfo(c),h}function M6(t,e,n,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=db(i),a=new tke(r,o,n,s==null),l=s==null?[e]:[e,s],u=t.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const c=M6(t,e,n,u);return t.disposeIntermediateTensorInfo(u),c}return u}function V6(t,e,n,s){const r=[n];if(zn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!U().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=t.unpackTensor(e),i.push(l));const[u,c]=In(l.shape,r),h=G(c),d=ae({inputs:{x:l},backend:t,attrs:{shape:[-1,h]}});i.push(d);const f=L6(t,d,s);i.push(f);const p=ae({inputs:{x:f},backend:t,attrs:{shape:u}});return i.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}return M6(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=Be(i,r.shape);const a=Dt(o,r.shape.length);let l=r;const u=[];a!=null&&(l=ps({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=Gt(o.length,l.shape.length)),zn("argMax",[o[0]],l.shape.length);const c=V6(n,l,o[0],"max");return u.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const ske={kernelName:Fm,backendName:"webgl",kernelFunc:nke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=Be(i,r.shape);const a=Dt(o,r.shape.length);let l=r;const u=[];a!=null&&(l=ps({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=Gt(o.length,l.shape.length)),zn("argMin",[o[0]],l.shape.length);const c=V6(n,l,o[0],"min");return u.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const ike={kernelName:Lm,backendName:"webgl",kernelFunc:rke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oke=jr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,ake=Ye({opSnippet:oke}),lke={kernelName:Ph,backendName:"webgl",kernelFunc:ake};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uke=jr+"return log(x + sqrt(x * x + 1.0));",cke=Ye({opSnippet:uke}),hke={kernelName:Fh,backendName:"webgl",kernelFunc:cke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dke=jr+`
  return atan(x);
`,fke=Ye({opSnippet:dke}),pke={kernelName:Lh,backendName:"webgl",kernelFunc:fke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mke=IA+`
  return atan(a, b);
`,gke=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+tc+`
  return result;
`,yke=Un({opSnippet:mke,packedOpSnippet:gke}),wke={kernelName:Vh,backendName:"webgl",kernelFunc:yke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vke=jr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,xke=Ye({opSnippet:vke}),bke={kernelName:Mh,backendName:"webgl",kernelFunc:xke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class im{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const m=n==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let w="0.0";if(m||(w="-1.0 / 1e-20"),s){const _=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${_} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?g:y:`wR * ${d} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const x="max";let v=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(v="avgValue / max(count, 1.0)");const b=Math.floor(o/4)*4,S=o%4,T=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${x}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${p});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${b}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${T}
          }

          int xC = xCCorner + ${b};
          if (${S===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${S===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${S===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${T}
          }
        }
        setOutput(${v});
      }
    `}}class SA{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,h=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.front,y=e.padInfo.top,w=e.padInfo.left;this.outputShape=e.outShape;const x=n==="avg";let v="0.0";if(x||(v="-1.0 / 1e-20"),s){const N=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${g}, ${y}, ${w});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${d}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${N} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const b="max";let S=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(S="avgValue / max(count, 1.0)");const T=Math.floor(o/4)*4,_=o%4,E=`
      if (${x}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${g}, ${y}, ${w});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${T}; wC += 4) {
              int xC = xCCorner + wC * ${d};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                getValue(batch, xD, xR, xC + 3 * ${d}, ch)
              );

              ${E}
            }

            int xC = xCCorner + ${T};
            if (${_===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${E}
            } else if (${_===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                initializationValue,
                initializationValue
              );

              ${E}
            } else if (${_===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                initializationValue
              );

              ${E}
            }
          }
        }
        setOutput(${S});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ike(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Ud(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;C(Vn(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=Ur(r.shape,i,o,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&We(c.inShape,c.outShape))return Zs({inputs:{x:r},backend:n});const h=new im(c,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const Tke={kernelName:Mm,backendName:"webgl",kernelFunc:Ike};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ske(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s,c=[1,1,1],h=Mo(r.shape,i,o,c,a,l,u),d=new SA(h,"avg",!1);return n.runWebGLProgram(d,[r],"float32")}const _ke={kernelName:Vm,backendName:"webgl",kernelFunc:Ske};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cke{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=l-1-e.padInfo.top,h=u-1-e.padInfo.left,d=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${h});
      const float avgMultiplier = float(${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Eke{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=h-1-e.padInfo.front,m=d-1-e.padInfo.top,g=f-1-e.padInfo.left,y=1/(n*s*r);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${g});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kke(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,h=[1,1,1],d=Mo(o.shape,a,l,h,u,c),f=new Eke(d);return n.runWebGLProgram(f,[r],o.dtype)}const Nke={kernelName:Tx,backendName:"webgl",kernelFunc:kke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ke(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;Ud([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,c=Ur(o.shape,a,l,1,u),h=new Cke(c);return n.runWebGLProgram(h,[r],o.dtype)}const Ake={kernelName:Ix,backendName:"webgl",kernelFunc:$ke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rke(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return cv({a:r,b:i,transposeA:o,transposeB:a,backend:n})}const Dke={kernelName:zm,backendName:"webgl",kernelFunc:Rke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oke{constructor(e,n,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Ae(e,n),Ae(e,s);let a="0.0";r!=null&&(Ae(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(Ae(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pke{constructor(e,n,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ae(e,n),Ae(e,s);let a="vec4(0.0)";r!=null&&(Ae(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(Ae(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fke=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=t;C(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),C(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),C(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const u=[s,r,i];let c=null;o!=null&&(c=o.shape,u.push(o));let h=null;a!=null&&(h=a.shape,u.push(a));const d=U().getBool("WEBGL_PACK_NORMALIZATION")?new Pke(s.shape,r.shape,i.shape,c,h,l):new Oke(s.shape,r.shape,i.shape,c,h,l);return e.runWebGLProgram(d,u,u[0].dtype)},Lke={kernelName:Zm,backendName:"webgl",kernelFunc:Fke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mke{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=ut(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Vke(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${k_[a]} = start[${a}] + coords.${k_[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const k_=["x","y","z","w","u","v"];function Vke(t){if(t===1)return"sourceLoc";if(t<=6)return k_.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zke{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=ut(this.rank),s=ls("coords",this.rank),r=ls("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((c,h)=>`start[${h}]`).join()});`:e.map((c,h)=>`${r[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bke(t,e,n,s){const r=s.texData.get(t.dataId),i=s.makeTensorInfo(n,t.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=BN(e,Ie(t.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function Xd(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s,[a,l]=hb(r,i,o);if(MN(r,a,l),G(l)===0)return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=n.texData.get(r.dataId),d=RCe(h.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,d)}const{isPacked:u}=n.texData.get(r.dataId),c=zN(r.shape,a,l);if(u||!c){const h=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zke(l):new Mke(l),d=[a];return n.runWebGLProgram(h,[r],r.dtype,d)}return n.uploadToGPU(r.dataId),Bke(r,a,l,n)}const Uke={kernelName:kg,backendName:"webgl",kernelFunc:Xd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wke=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;C(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((w,x)=>w*x),l=sy(r.shape,i,a),u=ry(l.length,i.length),c=iy(r.shape,i,a),h=qN(o,i.length),d=KN(c,o,i.length),f=[],p=ae({inputs:{x:r},backend:n,attrs:{shape:l}}),m=ps({inputs:{x:p},backend:n,attrs:{perm:u}}),g=ae({inputs:{x:m},backend:n,attrs:{shape:c}}),y=Xd({inputs:{x:g},backend:n,attrs:{begin:h,size:d}});return f.push(p),f.push(m),f.push(g),f.forEach(w=>n.disposeIntermediateTensorInfo(w)),y},jke={kernelName:Bm,backendName:"webgl",kernelFunc:Wke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=n.readSync(r.dataId),l=n.readSync(i.dataId),u=S6(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}const Hke={kernelName:Sx,backendName:"webgl",kernelFunc:Gke};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qke=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,Kke=`
  return float(int(a.r) & int(b.r));
`;function Xke(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=U().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=U().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,r])||o===1){const l=n.texData.get(s.dataId).values,u=n.texData.get(r.dataId).values,[c,h]=nCe(s.shape,r.shape,l,u,s.dtype),d=n.makeTensorInfo(h,s.dtype),f=n.texData.get(d.dataId);return f.values=c,d}let a;return i?a=new qd(qke,s.shape,r.shape,!1):a=new Eu(Kke,s.shape,r.shape),n.runWebGLProgram(a,[s,r],s.dtype)}const Qke={kernelName:Um,backendName:"webgl",kernelFunc:Xke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yke(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,i=n.readSync(s.dataId),o=n.readSync(r.dataId),a=Ae(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Jke={kernelName:_x,backendName:"webgl",kernelFunc:Yke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zke="return float(a != b);",z6=Un({opSnippet:Zke,cpuKernelImpl:TCe,dtype:"bool"}),eNe={kernelName:gg,backendName:"webgl",kernelFunc:z6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xy(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return Zs({inputs:{x:r.complexTensorInfos.real},backend:n})}const tNe={kernelName:i1,backendName:"webgl",kernelFunc:xy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nNe="return float(int(x));";function sNe(t,e){const n=new Di(t.shape,nNe),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N_(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Zs({inputs:{x:r},backend:n});const o=Qt(r.shape),a=N_({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=hl({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=xy({inputs:{input:r},backend:n}),a=N_({inputs:{x:o},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(o),a}if(!tk(r.dtype,i)){const o=Zs({inputs:{x:r},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(n.shouldExecuteOnCPU([r])){const o=n.texData.get(r.dataId).values,[a,l,u]=sCe(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,u)}if(i==="int32")return sNe(r,n);if(i==="bool"){const o=n.makeTensorInfo([],"bool",vn("bool",1)),l=z6({inputs:{a:r,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const rNe={kernelName:zh,backendName:"webgl",kernelFunc:N_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fF="return ceil(x);",iNe=Ye({opSnippet:fF,packedOpSnippet:fF,cpuKernelImpl:rCe}),oNe={kernelName:Bh,backendName:"webgl",kernelFunc:iNe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aNe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lNe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;U().getBool("WEBGL_PACK_CLIP")?a=new lNe(r.shape):a=new aNe(r.shape);const l=[[i],[o]];return n.runWebGLProgram(a,[r],r.dtype,l)}const cNe={kernelName:Uh,backendName:"webgl",kernelFunc:uNe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hNe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pF(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function dNe(t){const{inputs:e,backend:n}=t,{x:s}=e,r=n.texData.get(s.dataId),i=new hNe(s.shape),o=[pF(s,r.complexTensorInfos.real),pF(s,r.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}const fNe={kernelName:Wm,backendName:"webgl",kernelFunc:dNe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pNe{constructor(e){this.outputShape=[],this.outputShape=Wi(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];s.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=n.length,i=n[n.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mNe{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Wi(e,n);const s=this.outputShape,r=s.length,i=ut(r),o=ls("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((m,g)=>`T${g}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let m=1;m<l.length;m++)l[m]=l[m-1]+e[m][n];const u=a[n],c=a.slice(-2),h=a.join();let d=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${h}), vec2(${c.join()}));
        }`;for(let m=1;m<l.length;m++){const g=l[m-1];d+=`
        if (${u} < ${l[m]}  && ${u} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${d0(a,u,g)}),
            vec2(${d0(c,u,g)}));
        }`}const f=l.length,p=l[l.length-1];d+=`
        return getChannel(
          getT${f}(${d0(a,u,p)}),
          vec2(${d0(c,u,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${d}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function d0(t,e,n){const s=t.indexOf(e);return t.map((i,o)=>o===s?`${i} - ${n}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zb(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return Zs({inputs:{x:r.complexTensorInfos.imag},backend:n})}const gNe={kernelName:Gx,backendName:"webgl",kernelFunc:zb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pf(t,e,n){const s=t[0].dtype;if(s==="complex64"){const f=t.map(w=>xy({inputs:{input:w},backend:n})),p=t.map(w=>zb({inputs:{input:w},backend:n})),m=Pf(f,e,n),g=Pf(p,e,n),y=hl({inputs:{real:m,imag:g},backend:n});return f.forEach(w=>n.disposeIntermediateTensorInfo(w)),p.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),y}let r=n.shouldExecuteOnCPU(t);if(s==="string"&&(r=!0),r){const f=t.map(v=>{const S=[-1,G(v.shape.slice(e))];return ae({inputs:{x:v},backend:n,attrs:{shape:S}})}),p=f.map(v=>({vals:n.readSync(v.dataId),shape:v.shape})),m=Wi(f.map(v=>v.shape),1),g=f[0].shape[0]===1,y=iCe(p,m,s,g),w=Wi(t.map(v=>v.shape),e),x=n.makeTensorInfo(w,s,y);return f.forEach(v=>n.disposeIntermediateTensorInfo(v)),x}const i=t.filter(f=>G(f.shape)>0),o=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const f=o?new Di(t[0].shape,na):new ga(t[0].shape,na);return n.runWebGLProgram(f,t,s)}const a=U().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const f=[];for(let m=0;m<i.length;m+=a){const g=i.slice(m,m+a);f.push(Pf(g,e,n))}const p=Pf(f,e,n);for(const m of f)n.disposeIntermediateTensorInfo(m);return p}if(o){const f=new mNe(i.map(p=>p.shape),e);return n.runWebGLProgram(f,i,s)}const{tensors2D:l,outShape:u}=yNe(i,e,n),c=new pNe(l.map(f=>f.shape)),h=n.runWebGLProgram(c,l,s);l.forEach(f=>n.disposeIntermediateTensorInfo(f));const d=ae({inputs:{x:h},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(h),d}function yNe(t,e,n){const s=Wi(t.map(i=>i.shape),e);return{tensors2D:t.map(i=>ae({inputs:{x:i},attrs:{shape:[-1,G(i.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=Be(r,e[0].shape)[0],o=e.map(u=>u.shape);jN(o,i);const a=Wi(e.map(u=>u.shape),i);if(G(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>G(u.shape)>0);return l.length===1?Zs({inputs:{x:l[0]},backend:n}):Pf(l,i,n)}const wNe={kernelName:jm,backendName:"webgl",kernelFunc:B6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U6{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,g=e.dataFormat==="channelsLast",y=g?1:2,w=g?2:3,x=g?3:1;let v="",b="";s&&(r?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:v=`
          float activation(float x) {
            ${s}
          }
        `,b="result = activation(result);");const S=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${x}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${w}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${d}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${S}
        ${b}
        setOutput(result);
      }
    `}}class vNe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,h=e.filterDepth,d=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${d}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W6{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Jn(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,c=e.filterWidth,h=c;let d=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<c;g++)d+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;d+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<c;g++)d+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;d+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(h+1)/2;g++){const y=g*2;if(d+=`
           xC = xCCorner + ${y*l};
           `,a===1){if(y<c&&(o%2===1?(d+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,l===1&&y>0?d+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:d+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):d+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<c)){const w=o%2===0?wx(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(d+=`
                   xCOffset = xC + imod(pads[1], 2) + ${w};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,l>1?d+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:d+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):w===1?d+=`
                     xC${y+1} = xTexelC${y};
                     `:d+=`
                     xCOffset = xC + ${w};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<c&&(o%2===1?(d+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<c&&(d+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(d+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<c&&(d+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<c&&(d+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<c&&(d+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}d+=`
     }
   `,d+=`
     }
   `,d+=`
     }
   `;let f="",p="";s&&(r?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:f=`vec4 activation(vec4 x) {
           ${s}
         }`,p="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${d}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xNe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Jn(this.outputShape.length);const{dataFormat:s}=n,r=ys(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)u+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${c};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hv(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function j6({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,u=s.texData.get(t.dataId),c=n.inChannels,h=l[0]*l[1]*l[2],d=n.outChannels,f=n.dataFormat==="channelsLast",p=!1,m=!1;let g;const y=[];if(i!=null){const v=hv(i.shape,f);v!=null&&(i=ae({inputs:{x:i},backend:s,attrs:{shape:v}}),y.push(i))}if(r!=null){const v=hv(r.shape,f);v!=null&&(r=ae({inputs:{x:r},backend:s,attrs:{shape:v}}),y.push(r))}if(!((h===1||d===1)&&c>F6)&&u.isPacked&&f&&u.texture!=null&&l[2]%2!==0&&We(u.shape.slice(-3),l.slice(-3))){const v=l[0]*l[1]*(l[2]+1),b={dataId:t.dataId,shape:[1,v,n.inChannels],dtype:t.dtype},S=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,C(sm(u.shape,b.shape),()=>`packed reshape ${u.shape} to ${b.shape} isn't free`);const T=ae({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(T);const _=cv({a:b,b:T,backend:s,transposeA:p,transposeB:m,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),E=s.texData.get(_.dataId);C(E.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=S,E.shape=n.outShape,g=Zs({inputs:{x:_},backend:s}),g.shape=n.outShape,y.push(_)}else{const v=n.outHeight*n.outWidth,b=ae({inputs:{x:t},backend:s,attrs:{shape:f?[n.batchSize,v,n.inChannels]:[n.batchSize,n.inChannels,v]}}),S=ae({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),T=cv({a:f?b:S,b:f?S:b,transposeA:!f,transposeB:m,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});g=ae({inputs:{x:T},backend:s,attrs:{shape:n.outShape}}),y.push(b),y.push(S),y.push(T)}for(const v of y)s.disposeIntermediateTensorInfo(v);return g}function G6({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:c,outWidth:h,outHeight:d,dataFormat:f}=n,p=f==="channelsLast",m=l*u*c,g=d*h,y=[n.batchSize,m,g],w=!0,x=!1,v=[];if(i!=null){const M=hv(i.shape,p);M!=null&&(i=ae({inputs:{x:i},backend:s,attrs:{shape:M}}),v.push(i))}if(r!=null){const M=hv(r.shape,p);M!=null&&(r=ae({inputs:{x:r},backend:s,attrs:{shape:M}}),v.push(r))}const b=ae({inputs:{x:e},backend:s,attrs:{shape:[1,m,G(e.shape)/m]}});v.push(b);const S=new xNe(y,n),T=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],_=s.runWebGLProgram(S,[t],"float32",T),E=ae({inputs:{x:_},backend:s,attrs:{shape:y}});v.push(_),v.push(E);const N=r!=null,$=i!=null,A=a==="leakyrelu",D=a?rm(a,!0):null,F=new P6(p?E.shape:b.shape,p?b.shape:E.shape,p?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],w,x,N,D,$,A),B=p?[E,b]:[b,E];if(r&&B.push(r),$&&B.push(i),A){const M=s.makeTensorInfo([],"float32",Lo(o,"float32"));B.push(M),v.push(M)}const z=s.runWebGLProgram(F,B,"float32"),H=ae({inputs:{x:z},backend:s,attrs:{shape:n.outShape}});v.push(z);for(const M of v)s.disposeIntermediateTensorInfo(M);return H}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=s,h=Vo(l),d=bn(r.shape,i.shape,o,u,a,c,!1,h);let f;if(d.filterHeight===1&&d.filterWidth===1&&d.dilationHeight===1&&d.dilationWidth===1&&d.strideHeight===1&&d.strideWidth===1&&(d.padInfo.type==="SAME"||d.padInfo.type==="VALID"))f=j6({x:r,filter:i,convInfo:d,backend:n});else if(d.strideWidth<=2&&h==="channelsLast"&&U().getBool("WEBGL_EXP_CONV")){const m=new W6(d),g=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];f=n.runWebGLProgram(m,[r,i],"float32",g)}else if(U().getBool("WEBGL_CONV_IM2COL"))f=G6({x:r,filter:i,convInfo:d,backend:n});else{const m=new U6(d);f=n.runWebGLProgram(m,[r,i],"float32")}const p=ae({inputs:{x:f},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(f),p}const INe={kernelName:Gm,backendName:"webgl",kernelFunc:bNe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TNe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class SNe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,u=o?1:2,c=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class _Ne{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class CNe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,u=s-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ENe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=s,h=Vo(l),d=bn(r.shape,c,o,1,a,u,!1,h),f=new TNe(d);return n.runWebGLProgram(f,[r,i],"float32")}const kNe={kernelName:Ex,backendName:"webgl",kernelFunc:ENe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NNe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Jn(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,r=n-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ne(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=s,h=Vo(u),d=bn(o,i.shape,a,1,l,c,!1,h);if(U().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const f=[[d.strideHeight,d.strideWidth]],p=new NNe(d);return n.runWebGLProgram(p,[r,i],"float32",f)}else{const f=new SNe(d);return n.runWebGLProgram(f,[r,i],"float32")}}const ANe={kernelName:Hm,backendName:"webgl",kernelFunc:$Ne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=rl(r.shape,i.shape,o,l,a),c=new vNe(u);return n.runWebGLProgram(c,[r,i],"float32")}const DNe={kernelName:qm,backendName:"webgl",kernelFunc:RNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ONe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,u=rl(r.shape,l,o,1,a),c=new _Ne(u);return n.runWebGLProgram(c,[r,i],"float32")}const PNe={kernelName:kx,backendName:"webgl",kernelFunc:ONe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FNe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,u=rl(l,i.shape,a,1,o),c=new CNe(u);return n.runWebGLProgram(c,[r,i],"float32")}const LNe={kernelName:Nx,backendName:"webgl",kernelFunc:FNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MNe=Kd+`
  return cos(x);
`,VNe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${tc}
  return result;
`,zNe=Ye({opSnippet:MNe,packedOpSnippet:VNe}),BNe={kernelName:Wh,backendName:"webgl",kernelFunc:zNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UNe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,WNe=Ye({opSnippet:UNe}),jNe={kernelName:jh,backendName:"webgl",kernelFunc:WNe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GNe{constructor(e,n,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[c]=n,[h,d]=s;this.outputShape=[c,h,d,u];const f=r==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${l-1}.0`],[g,y,w]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[x,v,b]=d>1?[`${(l-1)/(d-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${x});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${v};

        float in_y = ${w};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${b};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HNe=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,c=new GNe(r.shape,i.shape,a,l,u);return n.runWebGLProgram(c,[r,i,o],"float32")},qNe={kernelName:Ax,backendName:"webgl",kernelFunc:HNe};var om;(function(t){t.Prod="*",t.Sum="+"})(om||(om={}));class mF{constructor(e,n,s,r){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===om.Prod?"1.0":"0.0",a=s?o:`getX(${gF(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",c="";s?(u=r?`end != ${l-1}`:"end != 0",c=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${ut(i)} coords = getOutputCoords();
        int end = ${yF(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${c};
          ${yF(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${gF(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function gF(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function yF(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H6(t,e,n,s,r,i){const o=e.shape.length,a=Dt([s],o);let l=e;a!=null&&(l=ps({inputs:{x:e},backend:n,attrs:{perm:a}}));const u=Gt(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const c=l.shape[u];let h=Zs({inputs:{x:l},backend:n});for(let d=0;d<=Math.ceil(Math.log2(c))-1;d++){const f=new mF(t,l.shape,!1,i),p=[[d]],m=h;h=n.runWebGLProgram(f,[h],h.dtype,p),n.disposeIntermediateTensorInfo(m)}if(r){const d=new mF(t,l.shape,r,i),f=h;h=n.runWebGLProgram(d,[h],h.dtype),n.disposeIntermediateTensorInfo(f)}if(a!=null){const d=il(a),f=ps({inputs:{x:h},backend:n,attrs:{perm:d}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),f}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return H6(om.Prod,r,n,i,o,a)}const XNe={kernelName:$x,backendName:"webgl",kernelFunc:KNe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return H6(om.Sum,r,n,i,o,a)}const YNe={kernelName:Km,backendName:"webgl",kernelFunc:QNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=n.readSync(r.dataId),u=n.readSync(i.dataId),c=S6(l,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}else if(r.shape.length===2){const l=n.bufferSync(r),u=n.bufferSync(i),c=tCe(l,u,o,a);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const ZNe={kernelName:Rx,backendName:"webgl",kernelFunc:JNe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e$e{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],u=o==="NHWC"?r.shape[2]:r.shape[3],c=o==="NHWC"?r.shape[3]:r.shape[1],h=l*i,d=u*i,f=c/(i*i),p=o==="NHWC"?[a,h,d,f]:[a,f,h,d],m=new e$e(p,i,o);return n.runWebGLProgram(m,[r],r.dtype)}const n$e={kernelName:Dx,backendName:"webgl",kernelFunc:t$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q6{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Jn(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",c="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,c="result = activation(result);");const h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K6{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Jn(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,d=h;let f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<h;y++)f+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;f+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let y=0;y<h;y++)f+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(d+1)/2;y++){const w=y*2;if(f+=`
          xC = xCCorner + ${w*u};
          `,l===1){if(w<h&&(a%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }
              `,u===1&&w>0?f+=`
                xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                  } else {
                    xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xC${w} = xTexelC${w};
                `,w+1<h)){const x=a%2===0?wx(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${x};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                    xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${w+1}.zw = vec2(0.0);
                    }
                    xTexelC${w+1}Ready = 1;
                  }
                  `,u>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                    } else {
                     xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                    }
                    `:f+=`
                    xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                    `):x===1?f+=`
                    xC${w+1} = xTexelC${w};
                    `:f+=`
                    xCOffset = xC + ${x};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                      xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${w+1}.zw = vec2(0.0);
                      }
                      xTexelC${w+1}Ready = 1;
                    }

                    xC${w+1} = xTexelC${w+1};
                    `}}else w<h&&(a%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.0);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
              `,w+1<h&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(
                  xTexelC${w}.xy, xTexelC${w+1}.xy);
              `,w+1<h&&(f+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                `)));w<h&&(f+=`
            wTexel = getW(r, ${w}, d1, q);
            dotProd += xC${w} * vec4(wTexel.xz, wTexel.xz);
          `,w+1<h&&(f+=`
              wTexel = getW(r, ${w+1}, d1, q);
              dotProd += xC${w+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let p="",m="";s&&(r?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:p=`vec4 activation(vec4 x) {
          ${s}
        }`,m="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;let c=l;c==null&&(c=[1,1]),C(Vn(o,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=bn(r.shape,i.shape,o,c,a,u,!0);let d;U().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?d=new K6(h):d=new q6(h);const f=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[r,i],"float32",f)}const r$e={kernelName:Xm,backendName:"webgl",kernelFunc:s$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i$e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class o$e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=s,h=bn(r.shape,c,o,a,l,u,!0),d=new i$e(h);return n.runWebGLProgram(d,[r,i],"float32")}const l$e={kernelName:Ox,backendName:"webgl",kernelFunc:a$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u$e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=s,h=bn(c,i.shape,o,a,l,u,!0),d=new o$e(h);return n.runWebGLProgram(d,[r,i],"float32")}const c$e={kernelName:Px,backendName:"webgl",kernelFunc:u$e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h$e{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d$e(t){const{inputs:e,backend:n}=t,{x:s}=e,r=[...s.shape,...s.shape],i=G(s.shape),o=ae({inputs:{x:s},backend:n,attrs:{shape:[i]}}),a=new h$e(i),l=n.runWebGLProgram(a,[o],o.dtype),u=ae({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),u}const f$e={kernelName:Fx,backendName:"webgl",kernelFunc:d$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p$e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:c}=e,{top:h,left:d}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${h}, ${d});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=Vg(r.shape,i.shape,o,a,"NHWC",l);let c;const h=new p$e(u);c=n.runWebGLProgram(h,[r,i],"float32");const d=ae({inputs:{x:c},backend:n,attrs:{shape:u.outShape}});return n.disposeIntermediateTensorInfo(c),d}const g$e={kernelName:Qm,backendName:"webgl",kernelFunc:m$e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y$e(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=n$(r,i.length);r$(o.length,l,i);const{path:u,steps:c}=i$(a,l),h=c.length;let d=null,f=o.length;const p=[];for(let m=0;m<h;++m){for(const g of c[m]){const{permutationIndices:y,expandDims:w}=s$(f,l[g]);let x;o$(y)?x=i[g]:(x=ps({inputs:{x:i[g]},backend:n,attrs:{perm:y}}),p.push(x));const v=x.shape.slice();for(let b=0;b<w.length;++b)v.splice(w[b],0,1);We(x.shape,v)||(x=ae({inputs:{x},backend:n,attrs:{shape:v}}),p.push(x)),d===null?d=x:(d=TA({inputs:{a:x,b:d},backend:n}),p.push(d))}m<h-1&&(u[m]>=0&&(d=Vb({inputs:{x:d},backend:n,attrs:{axis:u[m]-(o.length-f),keepDims:!1}}),p.push(d)),f--)}for(const m of p)m!==d&&n.disposeIntermediateTensorInfo(m);return d}const w$e={kernelName:Mx,backendName:"webgl",kernelFunc:y$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v$e="return (x >= 0.0) ? x : (exp(x) - 1.0);",x$e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,b$e=Ye({opSnippet:v$e,packedOpSnippet:x$e}),I$e={kernelName:Hh,backendName:"webgl",kernelFunc:b$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T$e="return (b >= 0.0) ? a : a * (b + 1.0);",S$e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,_$e=t=>{const{inputs:e,backend:n}=t,{dy:s,y:r}=e,i=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qd(S$e,s.shape,r.shape):new Eu(T$e,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],s.dtype)},C$e={kernelName:Vx,backendName:"webgl",kernelFunc:_$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E$e=`
  return vec4(equal(a, b));
`,k$e="return float(a == b);",N$e=Un({opSnippet:k$e,packedOpSnippet:E$e,dtype:"bool",cpuKernelImpl:oCe}),$$e={kernelName:Ym,backendName:"webgl",kernelFunc:N$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A$e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${XN};
  float a1 = ${QN};
  float a2 = ${YN};
  float a3 = ${JN};
  float a4 = ${ZN};
  float a5 = ${e$};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,R$e=Ye({opSnippet:A$e}),D$e={kernelName:qh,backendName:"webgl",kernelFunc:R$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O$e=Kd+`
  return exp(x);
`,P$e=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,X6=Ye({opSnippet:O$e,packedOpSnippet:P$e,cpuKernelImpl:aCe,dtype:"float32"}),F$e={kernelName:Kh,backendName:"webgl",kernelFunc:X6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_(t){const{inputs:e,attrs:n,backend:s}=t,{dim:r}=n,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(C(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),ae({inputs:{x:i},backend:s,attrs:{shape:a}})}const L$e={kernelName:Jm,backendName:"webgl",kernelFunc:$_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wF="return exp(x) - 1.0;",M$e=Ye({opSnippet:wF,packedOpSnippet:wF,cpuKernelImpl:lCe}),V$e={kernelName:Xh,backendName:"webgl",kernelFunc:M$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vF{constructor(e,n,s){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(t,e,n){const s=n.texData.get(t.dataId),r=G(t.shape),i=t.shape[t.shape.length-1],o=r/i,a=ae({inputs:{x:t},backend:n,attrs:{shape:[o,i]}}),l=a.shape,u=new vF("real",l,e),c=new vF("imag",l,e),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],d=n.runWebGLProgram(u,h,"float32"),f=n.runWebGLProgram(c,h,"float32"),p=hl({inputs:{real:d,imag:f},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f);const m=ae({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z$e(t){const{inputs:e,backend:n}=t,{input:s}=e;return Q6(s,!1,n)}const B$e={kernelName:zx,backendName:"webgl",kernelFunc:z$e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U$e{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function by(t){const{backend:e,attrs:n}=t,{shape:s,value:r}=n;let{dtype:i}=n;if(i=i||Vu(r),i==="string"){const o=Ft(i,G(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new U$e(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const W$e={kernelName:Bx,backendName:"webgl",kernelFunc:by};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j$e{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G$e={kernelName:Ux,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,r=new j$e(n.shape);return s.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xF="return floor(x);",H$e=Ye({opSnippet:xF,packedOpSnippet:xF,cpuKernelImpl:uCe}),q$e={kernelName:Qh,backendName:"webgl",kernelFunc:H$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K$e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,X$e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Q$e=Un({opSnippet:K$e,packedOpSnippet:X$e,dtype:"int32"}),Y$e={kernelName:Yh,backendName:"webgl",kernelFunc:Q$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J$e{constructor(e){this.variableNames=["A"];const n=ys(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z$e{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=ys(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e2e={kernelName:zw,backendName:"webgl",kernelFunc:t2e};let ac,nT=U().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function t2e(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],c=[u,l],h=[u,l,i];if(a||o){const m=U().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(ac==null||m!==nT)&&(nT=m,ac=document.createElement("canvas").getContext("2d",{willReadFrequently:nT})),ac.canvas.width=l,ac.canvas.height=u,ac.drawImage(r,0,0,l,u),r=ac.canvas}const d=n.makeTensorInfo(c,"int32");n.texData.get(d.dataId).usage=hr.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),r);const f=U().getBool("WEBGL_PACK")?new Z$e(h):new J$e(h),p=n.runWebGLProgram(f,[d],"int32");return n.disposeData(d.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=s,m=Vo(c),g=bn(r.shape,i.shape,l,h,u,d,!1,m);let y;const w=[],x=o!=null,v=a!=null,b=f==="leakyrelu",S=()=>{const _=[r,i],E=(N,$)=>{if($==="NCHW"&&N.shape.length===1&&N.shape[0]!==1){const A=ae({inputs:{x:N},backend:n,attrs:{shape:[N.shape[0],1,1]}});return w.push(A),A}return N};if(x&&_.push(E(o,c)),v&&_.push(E(a,c)),b){const N=n.makeTensorInfo([],"float32",Lo(p,"float32"));_.push(N),w.push(N)}return _};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))y=j6({x:r,filter:i,convInfo:g,backend:n,bias:o,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else if(g.strideWidth<=2&&m==="channelsLast"&&U().getBool("WEBGL_EXP_CONV")){const _=f?rm(f,!0):null,E=new W6(g,x,_,v,b),N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],$=S();y=n.runWebGLProgram(E,$,"float32",N)}else if(U().getBool("WEBGL_CONV_IM2COL"))y=G6({x:r,filter:i,convInfo:g,backend:n,bias:o,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else{const _=f?rm(f,!1):null,E=new U6(g,x,_,v,b),N=S();y=n.runWebGLProgram(E,N,"float32")}const T=ae({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return w.push(y),w.forEach(_=>n.disposeIntermediateTensorInfo(_)),T}const s2e={kernelName:Wp,backendName:"webgl",kernelFunc:n2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:h,activation:d,leakyreluAlpha:f}=s,p=[];let m=c;m==null&&(m=[1,1]),C(Vn(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const g=bn(r.shape,i.shape,l,m,u,h,!0),y=U().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,w=d?rm(d,y):null,x=[r,i],v=o!=null,b=a!=null,S=d==="leakyrelu";if(v&&x.push(o),b&&x.push(a),S){const N=n.makeTensorInfo([],"float32",Lo(f,"float32"));x.push(N),p.push(N)}let T;y?T=new K6(g,v,w,b,S):T=new q6(g,v,w,b,S);const _=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],E=n.runWebGLProgram(T,x,"float32",_);return p.forEach(N=>n.disposeIntermediateTensorInfo(N)),E}const i2e={kernelName:jp,backendName:"webgl",kernelFunc:r2e};class o2e{constructor(e,n,s,r){this.sliceDim=e,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=ut(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a2e(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=G(s.shape),[l,u,c,h]=cb(s,r),d=ae({inputs:{x:r},backend:n,attrs:{shape:[u,o]}}),f=ae({inputs:{x:s},backend:n,attrs:{shape:[G(s.shape)/c,c]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=n.readSync(r.dataId),w=n.bufferSync(s),x=cCe(y,w,s.dtype,u,o,c,h,s.shape,a);return n.makeTensorInfo(l,s.dtype,x.values)}const p=new o2e(o,h,[u,c],s.shape),m=n.runWebGLProgram(p,[f,d],f.dtype),g=ae({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const l2e={kernelName:Wx,backendName:"webgl",kernelFunc:a2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u2e{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=ut(this.rank),r=c2e(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function c2e(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<t.length;r++)r===2?s.push("index"):s.push(`${n[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=Be(o,r.shape)[0];if(U().get("DEBUG")){const w=n.readSync(i.dataId),x=r.shape[l];for(let v=0;v<w.length;++v){const b=w[v];C(b<=x-1&&b>=0,()=>`GatherV2: the index value ${b} is not in [0, ${x-1}]`)}}const u=l$(r,i,l,a),c=G(i.shape),h=[],d=ae({inputs:{x:r},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),f=ae({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});h.push(d),h.push(f);const p=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const w=n.bufferSync(f),x=n.bufferSync(d),v=hCe(x,w,p);return h.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.makeTensorInfo(u.outputShape,v.dtype,v.values)}const m=new u2e(d.shape,p),g=n.runWebGLProgram(m,[d,f],d.dtype);h.push(g);const y=ae({inputs:{x:g},backend:n,attrs:{shape:u.outputShape}});return h.forEach(w=>n.disposeIntermediateTensorInfo(w)),y}const h2e={kernelName:eg,backendName:"webgl",kernelFunc:Y6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d2e="return float(a > b);",f2e=`
  return vec4(greaterThan(a, b));
`,p2e=Un({opSnippet:d2e,packedOpSnippet:f2e,cpuKernelImpl:dCe,dtype:"bool"}),m2e={kernelName:tg,backendName:"webgl",kernelFunc:p2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g2e="return float(a >= b);",y2e=`
  return vec4(greaterThanEqual(a, b));
`,w2e=Un({opSnippet:g2e,packedOpSnippet:y2e,dtype:"bool",cpuKernelImpl:fCe}),v2e={kernelName:Jh,backendName:"webgl",kernelFunc:w2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x2e(t){const{inputs:e,backend:n}=t,{input:s}=e;return Q6(s,!0,n)}const b2e={kernelName:jx,backendName:"webgl",kernelFunc:x2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I2e="return float(!isnan(x) && !isinf(x));",T2e=Ye({opSnippet:I2e,dtype:"bool"}),S2e={kernelName:ed,backendName:"webgl",kernelFunc:T2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _2e="return float(isinf(x));",C2e=Ye({opSnippet:_2e,dtype:"bool"}),E2e={kernelName:td,backendName:"webgl",kernelFunc:C2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k2e="return float(isnan(x));",N2e=Ye({opSnippet:k2e,dtype:"bool"}),$2e={kernelName:nd,backendName:"webgl",kernelFunc:N2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A2e="return float(a < b);",R2e=`
  return vec4(lessThan(a, b));
`,D2e=Un({opSnippet:A2e,packedOpSnippet:R2e,cpuKernelImpl:pCe,dtype:"bool"}),O2e={kernelName:sg,backendName:"webgl",kernelFunc:D2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P2e="return float(a <= b);",F2e=`
  return vec4(lessThanEqual(a, b));
`,L2e=Un({opSnippet:P2e,packedOpSnippet:F2e,cpuKernelImpl:mCe,dtype:"bool"}),M2e={kernelName:rg,backendName:"webgl",kernelFunc:L2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V2e(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=gCe(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const z2e={kernelName:Hx,backendName:"webgl",kernelFunc:V2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B2e=Kd+`
  return x < 0.0 ? 0./0. : log(x);
`,U2e=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,W2e=Ye({opSnippet:B2e,packedOpSnippet:U2e,cpuKernelImpl:yCe}),j2e={kernelName:sd,backendName:"webgl",kernelFunc:W2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G2e=Kd+`
  return log(1.0 + x);
`,H2e=Ye({opSnippet:G2e}),q2e={kernelName:rd,backendName:"webgl",kernelFunc:H2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K2e="return float(a >= 1.0 && b >= 1.0);",X2e=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Q2e=Un({opSnippet:K2e,packedOpSnippet:X2e,dtype:"bool"}),Y2e={kernelName:ig,backendName:"webgl",kernelFunc:Q2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J2e="return float(!(x >= 1.0));",Z2e=Ye({opSnippet:J2e}),eAe={kernelName:og,backendName:"webgl",kernelFunc:Z2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tAe="return float(a >= 1.0 || b >= 1.0);",nAe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,sAe=Un({opSnippet:tAe,packedOpSnippet:nAe,dtype:"bool"}),rAe={kernelName:ag,backendName:"webgl",kernelFunc:sAe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iAe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oAe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aAe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,u=U().getBool("WEBGL_PACK_NORMALIZATION")?new oAe(r.shape,i,o,a,l):new iAe(r.shape,i,o,a,l);return n.runWebGLProgram(u,[r],r.dtype)},lAe={kernelName:lg,backendName:"webgl",kernelFunc:aAe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uAe{constructor(e,n,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cAe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=s,h=new uAe(r.shape,a,l,u,c);return n.runWebGLProgram(h,[r,i,o],r.dtype)},hAe={kernelName:qx,backendName:"webgl",kernelFunc:cAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dAe(t,e,n,s){const r=G(e),o=G(t.shape)/r,a=ae({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=nc(a,t.dtype,"max",s),u=ae({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J6(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=Be(i,r.shape);let u=l;const c=Dt(u,a),h=c!=null,d=n.shouldExecuteOnCPU([r]);let f=r;if(h){if(d){const x=n.texData.get(f.dataId).values,v=new Array(a);for(let T=0;T<v.length;T++)v[T]=r.shape[c[T]];const b=bA(x,r.shape,r.dtype,c,v);f=n.makeTensorInfo(v,r.dtype);const S=n.texData.get(f.dataId);S.values=b}else f=Mb(r,c,n);u=Gt(u.length,a)}zn("max",u,a);const[p,m]=In(f.shape,u);let g=p;o&&(g=jt(p,l));let y;if(d){const x=n.texData.get(f.dataId).values,v=wCe(x,G(m),g,r.dtype);y=n.makeTensorInfo(g,r.dtype);const b=n.texData.get(y.dataId);b.values=v}else y=dAe(f,m,g,n);return h&&n.disposeIntermediateTensorInfo(f),y}const fAe={kernelName:ug,backendName:"webgl",kernelFunc:J6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pAe=IA+`
  return max(a, b);
`,mAe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+tc+`
  return result;
`,gAe=Un({opSnippet:pAe,packedOpSnippet:mAe,cpuKernelImpl:vCe}),yAe={kernelName:id,backendName:"webgl",kernelFunc:gAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wAe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Ud(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;C(Vn(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=Ur(r.shape,i,o,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&We(c.inShape,c.outShape))return Zs({inputs:{x:r},backend:n});const h=new im(c,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const vAe={kernelName:cg,backendName:"webgl",kernelFunc:wAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xAe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=s,c=[1,1,1],h=Mo(r.shape,i,o,c,a,u,l),d=new SA(h,"max",!1);return n.runWebGLProgram(d,[r],r.dtype)}const bAe={kernelName:hg,backendName:"webgl",kernelFunc:xAe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IAe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class TAe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,h=l-1-e.padInfo.front,d=u-1-e.padInfo.top,f=c-1-e.padInfo.left,p=l*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${d}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SAe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,h=[1,1,1],d=Mo(o.shape,a,l,h,u,c),f=new SA(d,"max",!0),p=n.runWebGLProgram(f,[o],o.dtype),m=new TAe(d),g=n.runWebGLProgram(m,[r,p],o.dtype);return n.disposeIntermediateTensorInfo(p),g}const _Ae={kernelName:Xx,backendName:"webgl",kernelFunc:SAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CAe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;Ud([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=s,d=Ur(a.shape,l,u,1,c,h),f=!0,p=new im(d,"max",f),m=n.runWebGLProgram(p,[a],a.dtype),g=new IAe(d),y=n.runWebGLProgram(g,[r,m],a.dtype);return n.disposeIntermediateTensorInfo(m),y}const EAe={kernelName:Kx,backendName:"webgl",kernelFunc:CAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kAe(t,e,n,s){let r=new im(n,"max",!1);const i=s.runWebGLProgram(r,[t],"float32");r=new im(n,"max",!0,!0,e);const o=s.runWebGLProgram(r,[t],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NAe={kernelName:Qx,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;C(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];C(Vn(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=Ur(s.shape,r,i,u,o),[h,d]=kAe(s,a,c,l);return[h,d]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ae(t,e,n,s){const r=G(e),o=G(t.shape)/r,a=ae({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=nc(a,"float32","mean",s),u=ae({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AAe={kernelName:dg,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:r,axis:i}=e,o=n,a=s.shape.length,l=Be(i,s.shape);let u=l;const c=Dt(u,a),h=c!=null,d=o.shouldExecuteOnCPU([s]),f=[];let p=s;if(h){if(d){const v=o.texData.get(p.dataId).values,b=new Array(a);for(let _=0;_<b.length;_++)b[_]=s.shape[c[_]];const S=bA(v,s.shape,s.dtype,c,b);p=o.makeTensorInfo(b,s.dtype);const T=o.texData.get(p.dataId);T.values=S}else p=Mb(s,c,o);f.push(p),u=Gt(u.length,a)}zn("sum",u,a);const[m,g]=In(p.shape,u);let y=m;r&&(y=jt(m,l));const w=$Ae(p,g,y,o);for(const x of f)o.disposeIntermediateTensorInfo(x);return w}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RAe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Be(i,r.shape);let u=l;const c=Dt(u,a);let h=r;c!=null&&(h=ps({inputs:{x:r},backend:n,attrs:{perm:c}}),u=Gt(u.length,r.shape.length)),zn("min",u,a);const[d,f]=In(h.shape,u),p=G(f),m=ae({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),g=nc(m,m.dtype,"min",n);let y;if(o){const w=jt(d,l);y=ae({inputs:{x:g},backend:n,attrs:{shape:w}})}else y=ae({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),c!=null&&n.disposeIntermediateTensorInfo(h),y}const DAe={kernelName:fg,backendName:"webgl",kernelFunc:RAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OAe=IA+`
  return min(a, b);
`,PAe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+tc+`
  return result;
`,FAe=Un({opSnippet:OAe,packedOpSnippet:PAe,cpuKernelImpl:xCe}),LAe={kernelName:od,backendName:"webgl",kernelFunc:FAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MAe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((c,h)=>c[0]+e[h]+c[1]);const r=e.length,i=ut(r),o=n.map(c=>c[0]).join(","),a=n.map((c,h)=>c[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VAe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,m)=>p[0]+e[m]+p[1]);const r=e.length,i=ut(r),o=n.map(p=>p[0]).join(","),a=n.map((p,m)=>p[0]+e[m]).join(","),l=ls("rc",r),u=ls("source",r),c=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${u.slice(-2).join()})`,d=s==="reflect"?0:1;let f="";if(r===1){const p=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${d};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${d};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[r-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
      `}else{const p=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${d}) +
                gte * ((end - 1) * 2 - source + ${d});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[r-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${p}
          result[2] = getChannel(getX(${u.join()}), ${h});
          ${l[r-1]} += 1;
          if(${c}) {
            ${p}
            result[3] = getChannel(getX(${u.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zAe=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:r,mode:i}=n,o=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new VAe(s.shape,r,i):new MAe(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},BAe={kernelName:pg,backendName:"webgl",kernelFunc:zAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UAe=`if (b == 0.0) return NAN;
  return mod(a, b);`,WAe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+tc+`
  return result;
`,jAe=Un({opSnippet:UAe,packedOpSnippet:WAe}),GAe={kernelName:ad,backendName:"webgl",kernelFunc:jAe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HAe{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qAe=`
if (a == b) {
  return 1.0;
};
return a / b;`,KAe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,Z6=Un({opSnippet:qAe,packedOpSnippet:KAe,checkOutOfBounds:!0}),XAe={kernelName:Gh,backendName:"webgl",kernelFunc:Z6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bF="return a - b;",eq=Un({opSnippet:bF,packedOpSnippet:bF,supportsComplex:!0,cpuKernelImpl:BCe}),QAe={kernelName:Td,backendName:"webgl",kernelFunc:eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tq(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=Be([i],r.shape),a=J6({inputs:{x:r},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=jt(a.shape,o),u=ae({inputs:{x:a},backend:n,attrs:{shape:l}}),c=eq({inputs:{a:r,b:u},backend:n}),h=X6({inputs:{x:c},backend:n}),d=Vb({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),f=ae({inputs:{x:d},backend:n,attrs:{shape:l}}),p=Z6({inputs:{a:h,b:f},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),p}const YAe={kernelName:Rg,backendName:"webgl",kernelFunc:tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JAe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:tq({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),u=l.shape[0],c=l.shape[1],h=new HAe(u,c,i),d=[[o]],f=n.runWebGLProgram(h,[l],"int32",d);return a||n.disposeIntermediateTensorInfo(l),f}const ZAe={kernelName:Yx,backendName:"webgl",kernelFunc:JAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eRe=jr+`
  return -x;
`,tRe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function nRe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const i=n.texData.get(s.dataId),[o,a]=ICe(i.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,o)}let r;return U().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ga(s.shape,tRe):r=new Di(s.shape,eRe),n.runWebGLProgram(r,[s],s.dtype)}const sRe={kernelName:mg,backendName:"webgl",kernelFunc:nRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rRe=ob;function iRe(t){ir("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,u=n.readSync(r.dataId),c=n.readSync(i.dataId),{selectedIndices:h}=rRe(u,c,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const oRe={kernelName:Jx,backendName:"webgl",kernelFunc:iRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aRe=ab;function lRe(t){ir("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,c=n.readSync(r.dataId),h=n.readSync(i.dataId),{selectedIndices:d,validOutputs:f}=aRe(c,h,o,a,l,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const uRe={kernelName:Zx,backendName:"webgl",kernelFunc:lRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cRe=lb;function hRe(t){ir("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,c=n.readSync(r.dataId),h=n.readSync(i.dataId),d=o,f=a,p=l,m=u,{selectedIndices:g,selectedScores:y}=cRe(c,h,d,f,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const dRe={kernelName:e1,backendName:"webgl",kernelFunc:hRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fRe{constructor(e,n,s,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pRe=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,u=G(r.shape),c=new fRe(u,o,a,l),h=ae({inputs:{x:r},backend:n,attrs:{shape:[u]}}),d=n.runWebGLProgram(c,[h],i);n.disposeIntermediateTensorInfo(h);const f=[...r.shape,o],p=ae({inputs:{x:d},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(d),p},mRe={kernelName:wg,backendName:"webgl",kernelFunc:pRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dv(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const r=xy({inputs:{input:s},backend:n}),i=dv({inputs:{x:r},backend:n}),o=zb({inputs:{input:s},backend:n}),a=dv({inputs:{x:o},backend:n}),l=hl({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return by({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const gRe={kernelName:Fg,backendName:"webgl",kernelFunc:dv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nq(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=xy({inputs:{input:s},backend:n}),i=nq({inputs:{x:r},backend:n}),o=zb({inputs:{input:s},backend:n}),a=dv({inputs:{x:o},backend:n}),l=hl({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return by({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const yRe={kernelName:yg,backendName:"webgl",kernelFunc:nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wRe(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return $_({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(c=>{Mn(i,c.shape,"All tensors passed to stack must have matching shapes"),C(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const h=$_({inputs:{input:c},backend:n,attrs:{dim:r}});return a.push(h),h}),u=B6({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const vRe={kernelName:vg,backendName:"webgl",kernelFunc:wRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xRe{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((u,c)=>u[0]+e[c]+u[1]);const r=e.length,i=ut(r),o=n.map(u=>u[0]).join(","),a=n.map((u,c)=>u[0]+e[c]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bRe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,g)=>m[0]+e[g]+m[1]);const r=e.length,i=ut(r),o=n.map(m=>m[0]).join(","),a=n.map((m,g)=>m[0]+e[g]).join(","),l=ls("rc",r),u=ls("source",r),c=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${u.slice(-2).join()})`,d=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${c}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${c}) {`],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,g=r===1?2:4;m<g;m++)p+=`
        ${d[m]}
        if (${f}) {
          result[${m}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${m}] = getChannel(getX(${u.join()}), ${h});
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sq=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;if(G(r.shape)===0){const u=i.map((c,h)=>c[0]+r.shape[h]+c[1]);return by({backend:n,attrs:{shape:u,value:o,dtype:r.dtype}})}const a=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new bRe(r.shape,i,o):new xRe(r.shape,i,o),l=[[o]];return n.runWebGLProgram(a,[r],r.dtype,l)},IRe={kernelName:xg,backendName:"webgl",kernelFunc:sq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TRe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,SRe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+tc+`
  return result;
`,_Re=Un({opSnippet:TRe,packedOpSnippet:SRe}),CRe={kernelName:ud,backendName:"webgl",kernelFunc:_Re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ERe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],u=Be(i,r.shape);let c=u;const h=Dt(c,a);let d=r;h!=null&&(d=ps({inputs:{x:r},backend:n,attrs:{perm:h}}),c=Gt(c.length,a),l.push(d)),zn("prod",c,a);let f;if(n.shouldExecuteOnCPU([d])){const p=n.texData.get(d.dataId).values,{outVals:m,outShape:g,outDtype:y}=SCe(d.shape,d.dtype,p,c);f=n.makeTensorInfo(g,y,m)}else{const[p,m]=In(d.shape,c),g=G(m),y=ae({inputs:{x:d},backend:n,attrs:{shape:[-1,g]}}),w=C1(r.dtype),x=nc(y,w,"prod",n);f=ae({inputs:{x},backend:n,attrs:{shape:p}}),l.push(y),l.push(x)}if(o){l.push(f);const p=jt(f.shape,u);f=ae({inputs:{x:f},backend:n,attrs:{shape:p}})}return l.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const kRe={kernelName:Ig,backendName:"webgl",kernelFunc:ERe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NRe(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(y=>n.readSync(y.dataId)),u=r.map(y=>y.shape),c=n.readSync(i.dataId),h=n.readSync(o.dataId),[d,f,p]=_Ce(l,u,c,i.shape,i.dtype,h,o.shape,a),m=d.map(y=>n.makeTensorInfo([y.length],"int32",y)),g=n.makeTensorInfo(p,i.dtype,f);return m.concat([g])}const $Re={kernelName:t1,backendName:"webgl",kernelFunc:NRe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ARe(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:i}=e,o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[u,c]=CCe(o,s.shape,s.dtype,a,r.shape,l,i.shape),h=n.makeTensorInfo([u.length],"int32",u),d=n.makeTensorInfo([c.length],s.dtype,c);return[h,d]}const RRe={kernelName:n1,backendName:"webgl",kernelFunc:ARe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DRe(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.readSync(r.dataId),c=n.readSync(i.dataId),h=n.readSync(o.dataId),d=a.map(g=>n.readSync(g.dataId)),f=a.map(g=>g.shape),[p,m]=ECe(u,r.shape,c,i.shape,i.dtype,h,o.shape,d,f,l);return n.makeTensorInfo(p,i.dtype,m)}const ORe={kernelName:s1,backendName:"webgl",kernelFunc:DRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rq=t=>{const{backend:e,attrs:n}=t,{start:s,stop:r,step:i,dtype:o}=n,a=kCe(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},PRe={kernelName:r1,backendName:"webgl",kernelFunc:rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FRe="return 1.0 / x;",LRe=Ye({opSnippet:FRe}),MRe={kernelName:cd,backendName:"webgl",kernelFunc:LRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VRe=jr+`
  return (x < 0.0) ? 0.0 : x;
`,zRe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,BRe=Ye({opSnippet:VRe,packedOpSnippet:zRe}),URe={kernelName:hd,backendName:"webgl",kernelFunc:BRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WRe=jr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,jRe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,GRe=Ye({opSnippet:WRe,packedOpSnippet:jRe}),HRe={kernelName:dd,backendName:"webgl",kernelFunc:GRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qRe{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s];let d;i?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KRe{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s];let d;i?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XRe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,c=U().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new KRe(r.shape,l,u,i,o):new qRe(r.shape,l,u,i,o);return n.runWebGLProgram(c,[r],"float32")}const QRe={kernelName:_g,backendName:"webgl",kernelFunc:XRe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YRe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],c=l[0]/u[0],h=l[1]/u[1],d=1/c,f=1/h,p=Math.ceil(d)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JRe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new YRe(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const ZRe={kernelName:a1,backendName:"webgl",kernelFunc:JRe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eDe{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s],d=r?"0.5":"0.0";let f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tDe{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s],d=r?"0.5":"0.0";let f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nDe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,c=U().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tDe(r.shape,l,u,i,o):new eDe(r.shape,l,u,i,o);return n.runWebGLProgram(c,[r],r.dtype)}const sDe={kernelName:Sg,backendName:"webgl",kernelFunc:nDe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rDe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],c=l[0]/u[0],h=l[1]/u[1],d=1/c,f=1/h,p=Math.ceil(d)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iDe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new rDe(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const oDe={kernelName:o1,backendName:"webgl",kernelFunc:iDe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aDe{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=ut(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lDe{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=ls("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=ut(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${u(r.slice())};
          }
          if(${o}) {
            result.b = ${c(r.slice())};
            if(${i}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(p){return d(p)}function u(p){return p[s-1]="("+p[s-1]+" + 1)",d(p)}function c(p){return p[s-2]="("+p[s-2]+" + 1)",d(p)}function h(p){return p[s-1]="("+p[s-1]+" + 1)",p[s-2]="("+p[s-2]+" + 1)",d(p)}function d(p){const m=e.map((w,x)=>f(x,p)),g=m.join(","),y=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${y}))`}function f(p,m){return n.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uDe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s,o=r.shape.length,a=Be(i,r.shape);if(o===0)return Zs({inputs:{x:r},backend:n});const l=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lDe(r.shape,a):new aDe(r.shape,a);return n.runWebGLProgram(l,[r],r.dtype)}const cDe={kernelName:Cg,backendName:"webgl",kernelFunc:uDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hDe{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof n=="number"?i=`float outputValue = ${n.toFixed(2)};`:i=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dDe={kernelName:S1,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=new hDe(s.shape,i),[u,c]=HN(o,s.shape[1],s.shape[2]),h=[[u,c,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fDe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,pDe=Ye({opSnippet:fDe}),mDe={kernelName:fd,backendName:"webgl",kernelFunc:pDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gDe="return inversesqrt(x);",yDe=Ye({opSnippet:gDe,cpuKernelImpl:NCe}),wDe={kernelName:pd,backendName:"webgl",kernelFunc:yDe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _A{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=ut(i.length),c=ut(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const d=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,y=n>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vDe{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=ut(i.length),c=ut(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const d=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,y=n>1?"strides[j]":"strides",w=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${d});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${w};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xDe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=ul(i,r,o),d=[h/u,u];if(h===0)return n.makeTensorInfo(o,r.dtype);const f=ae({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),p=ae({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;U().getBool("WEBGL_PACK")?g=new vDe(l,a,f.shape.length,p.shape.length,c,d):g=new _A(l,a,f.shape.length,p.shape.length,c,d);const y=n.runWebGLProgram(g,[p,f,m],p.dtype),w=ae({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),w}const bDe={kernelName:l1,backendName:"webgl",kernelFunc:xDe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IDe{constructor(e,n,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=U().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TDe(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=new IDe(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return n.runWebGLProgram(a,[r,i],"int32",l)}const SDe={kernelName:c1,backendName:"webgl",kernelFunc:TDe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _De{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let c=0;c<n.length;c++)u.push(`${a[c]}`),c<e&&l.push(`${a[c]}`);r=l.join(),i=u.join()}const o=ut(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CDe(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e,o=new _De(s.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(o,[s,r,i],_s(r.dtype,i.dtype))}const EDe={kernelName:Eg,backendName:"webgl",kernelFunc:CDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kDe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${fb};
  float scale = ${pb};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,NDe=Ye({opSnippet:kDe}),$De={kernelName:md,backendName:"webgl",kernelFunc:NDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ADe=Kd+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,RDe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,DDe=Ye({opSnippet:ADe,packedOpSnippet:RDe,cpuKernelImpl:ACe}),ODe={kernelName:vd,backendName:"webgl",kernelFunc:DDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PDe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,FDe=Ye({opSnippet:PDe}),LDe={kernelName:wd,backendName:"webgl",kernelFunc:FDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MDe=Kd+`
  return sin(x);
`,VDe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${tc}
  return result;
`,zDe=Ye({opSnippet:MDe,packedOpSnippet:VDe}),BDe={kernelName:gd,backendName:"webgl",kernelFunc:zDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UDe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,WDe=Ye({opSnippet:UDe}),jDe={kernelName:yd,backendName:"webgl",kernelFunc:WDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GDe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,HDe=Ye({opSnippet:GDe}),qDe={kernelName:xd,backendName:"webgl",kernelFunc:HDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KDe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;C(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((y,w)=>y*w),l=[[0,0]];l.push(...o);for(let y=1+i.length;y<r.shape.length;++y)l.push([0,0]);const u=[],c=sq({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),h=sy(c.shape,i,a,!1),d=ry(h.length,i.length,!1),f=iy(c.shape,i,a,!1),p=ae({inputs:{x:c},backend:n,attrs:{shape:h}}),m=ps({inputs:{x:p},backend:n,attrs:{perm:d}}),g=ae({inputs:{x:m},backend:n,attrs:{shape:f}});return u.push(c),u.push(p),u.push(m),u.forEach(y=>n.disposeIntermediateTensorInfo(y)),g},XDe={kernelName:$g,backendName:"webgl",kernelFunc:KDe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QDe(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(r.dataId),u=n.readSync(i.dataId),c=n.readSync(o.dataId)[0],[h,d,f,p,m]=DCe(a,s.shape,s.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(d,s.dtype,h),n.makeTensorInfo([d[0]],r.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const YDe={kernelName:h1,backendName:"webgl",kernelFunc:QDe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JDe(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.readSync(r.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(i.dataId)),[u,c,h]=OCe(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(c,s.dtype,u),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const ZDe={kernelName:d1,backendName:"webgl",kernelFunc:JDe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eOe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[u,c]=C6(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(c,s.dtype,u)}const tOe={kernelName:f1,backendName:"webgl",kernelFunc:eOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nOe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[u,c]=C6(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(c,s.dtype,u)}const sOe={kernelName:p1,backendName:"webgl",kernelFunc:nOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rOe(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=ul(i,r,a),f=!1;if(i.dtype==="string"){const y=n.bufferSync(r),w=n.bufferSync(i),x=ko(n.readSync(o.dataId)[0]),v=$Ce(y,w,a,d,c,u,l,h,x,f);return n.makeTensorInfo(a,v.dtype,v.values)}const p=new _A(u,l,r.shape.length,i.shape.length,h,[d,1],f),m=n.runWebGLProgram(p,[i,r,o],i.dtype),g=ae({inputs:{x:m},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(m),g}const iOe={kernelName:m1,backendName:"webgl",kernelFunc:rOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oOe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=Be(o,r.shape)[0],l=a$(r,i,a),u=r.shape.length,c=new Array(u).fill(0),h=r.shape.slice();return l.map(d=>{const f=[...h];f[a]=d;const p=Xd({inputs:{x:r},backend:n,attrs:{begin:c,size:f}});return c[a]+=d,p})}const aOe={kernelName:Ag,backendName:"webgl",kernelFunc:oOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IF="return sqrt(x);",lOe=Ye({opSnippet:IF,packedOpSnippet:IF,cpuKernelImpl:PCe}),uOe={kernelName:bd,backendName:"webgl",kernelFunc:lOe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cOe="return x * x;",hOe=Ye({opSnippet:cOe}),dOe={kernelName:g1,backendName:"webgl",kernelFunc:hOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TF="return (a - b) * (a - b);",fOe=Un({opSnippet:TF,packedOpSnippet:TF}),pOe={kernelName:Id,backendName:"webgl",kernelFunc:fOe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mOe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=n.readSync(r.dataId),o=Oo(i),a=FCe(o,"string",s);return n.makeTensorInfo(r.shape,"string",a)}const gOe={kernelName:Dg,backendName:"webgl",kernelFunc:mOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yOe({inputs:t,attrs:e,backend:n}){const{x:s}=t,r=jr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new Di(s.shape,r);return n.runWebGLProgram(i,[s],s.dtype)}const wOe={kernelName:Ed,backendName:"webgl",kernelFunc:yOe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vOe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=ut(s.length),o=ut(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,c)=>(l++,s.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${l-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xOe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=s,{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:w,end:x,strides:v}=UN(r.shape,i,o,a,l,u,c,h,d);let b;if(m)b=ae({inputs:{x:r},backend:n,attrs:{shape:p}});else if(g||y){C(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const T=VN(w,x,v),_=Xd({inputs:{x:r},backend:n,attrs:{begin:w,size:T}});b=ae({inputs:{x:_},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(_)}else if(n.shouldExecuteOnCPU([r])){const _=n.readSync(r.dataId),E=Fe(r.shape,r.dtype,_),N=LCe(f,E,v,w);b=n.makeTensorInfo(p,r.dtype,N.values)}else{const _=new vOe(w,v,f);b=n.runWebGLProgram(_,[r],r.dtype)}const S=ae({inputs:{x:b},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(b),S}const bOe={kernelName:y1,backendName:"webgl",kernelFunc:xOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IOe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:c,dataSplits:h}=e,d=n.readSync(c.dataId),f=n.readSync(h.dataId),[p,m]=MCe(d,f,r,i,o,a,l,u);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",m)]}const TOe={kernelName:w1,backendName:"webgl",kernelFunc:IOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SOe(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],[u,c,h]=VCe(a,l,r),d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const _Oe={kernelName:v1,backendName:"webgl",kernelFunc:SOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function COe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(i.dataId),a=zCe(o,r);return n.makeTensorInfo(i.shape,"int32",a)}const EOe={kernelName:x1,backendName:"webgl",kernelFunc:COe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kOe="return tan(x);",NOe=Ye({opSnippet:kOe}),$Oe={kernelName:Sd,backendName:"webgl",kernelFunc:NOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AOe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,ROe=Ye({opSnippet:AOe}),DOe={kernelName:_d,backendName:"webgl",kernelFunc:ROe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OOe(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=ul(o,i,r.shape),d=[h/u,u];if(h===0)return n.makeTensorInfo(r.shape,i.dtype);const f=ae({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),p=ae({inputs:{x:o},backend:n,attrs:{shape:[l,u]}}),m=ae({inputs:{x:r},backend:n,attrs:{shape:d}}),g=new _A(l,a,f.shape.length,p.shape.length,c,d,!1,!0),y=n.runWebGLProgram(g,[p,f,m],m.dtype),w=ae({inputs:{x:y},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),w}const POe={kernelName:u1,backendName:"webgl",kernelFunc:OOe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FOe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*n[o];this.outputShape=s,this.rank=s.length;const r=ut(this.rank),i=LOe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function LOe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<t.length;r++)s.push(`imod(${n[r]}, ${t[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=n.readSync(r.dataId),u=r.dtype==="string"?l.map(d=>ko(d)):l,c=Fe(r.shape,r.dtype,u),h=UCe(c,i);return n.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new FOe(r.shape,i);return n.runWebGLProgram(o,[r],r.dtype)}const MOe={kernelName:Cd,backendName:"webgl",kernelFunc:iq};class VOe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class zOe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pl(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function SF(t){let e=1;for(;e<t;)e*=2;return e}function BOe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s,a=U().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=U().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,c=u[u.length-1];if(n.shouldExecuteOnCPU([r])||c<a||i>l){const N=n.readSync(r.dataId),[$,A]=WCe(N,u,r.dtype,i,o);return[n.makeTensorInfo($.shape,$.dtype,$.values),n.makeTensorInfo(A.shape,A.dtype,A.values)]}if(i===0)return u[u.length-1]=0,[n.makeTensorInfo(u,r.dtype,[]),n.makeTensorInfo(u,"int32",[])];if(c===1)return[r,by({attrs:{shape:u,dtype:"int32",value:0},backend:n})];const h=n.texData.get(r.dataId),d=h!==null&&h.isPacked,f=d?n.unpackTensor(r):r,m=G(u)/c,g=ae({inputs:{x:f},attrs:{shape:[m,c]},backend:n});d&&pl(n,f);const y=SF(i),w=SF(c);let x=null;const v=()=>x===null?[g,g]:[g,x],b=(N,$,A)=>{const D=v(),F=new VOe(A),z=[[c],[x===null?1:0],[Number.NEGATIVE_INFINITY],[N],[$]],H=x;x=n.runWebGLProgram(F,D,"int32",z),pl(n,H)};for(let N=1;N<y;N*=2){const $=N*2;for(let A=N;A>=1;A/=2)b($,A,[m,w])}for(let N=w;N>y;N/=2){const $=v(),A=new zOe([m,N/2]),F=[[c],[x===null?1:0],[y]],B=x;x=n.runWebGLProgram(A,$,"int32",F),pl(n,B);const z=y/2,H=z*2;for(let M=z;M>=1;M/=2)b(H,M,x.shape)}let S=x;x=Xd({inputs:{x},backend:n,attrs:{begin:0,size:[m,i]}}),pl(n,S);let T=Y6({inputs:{x:g,indices:x},backend:n,attrs:{axis:1,batchDims:1}});pl(n,g);const _=u.slice(0,-1);_.push(i),S=x,x=ae({inputs:{x},attrs:{shape:_},backend:n}),pl(n,S);const E=T;return T=ae({inputs:{x:T},attrs:{shape:_},backend:n}),pl(n,E),[T,x]}const UOe={kernelName:b1,backendName:"webgl",kernelFunc:BOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WOe{constructor(e,n,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jOe(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=s,[c,h,d,f]=r.shape,[p,m]=u??[h,d],g=[c,p,m,f],y=new WOe(h,d,o,a,l,g);return n.runWebGLProgram(y,[r,i],"float32")}const GOe={kernelName:I1,backendName:"webgl",kernelFunc:jOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HOe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:i}=e;Ud(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=jCe(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const qOe={kernelName:T1,backendName:"webgl",kernelFunc:HOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KOe(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],u=new Array(a-1);let c=0;for(let m=0;m<a;m++)m!==i&&(u[c++]=o.shape[m]);const h=[],d=new Array(a).fill(0),f=o.shape.slice();f[i]=1;const p=new Array(l);for(let m=0;m<p.length;m++){d[i]=m;const g=Xd({inputs:{x:o},backend:n,attrs:{begin:d,size:f}}),y=ae({inputs:{x:g},backend:n,attrs:{shape:u}});p[m]=y,h.push(g)}return h.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const XOe={kernelName:Og,backendName:"webgl",kernelFunc:KOe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QOe{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",u="sumValue",c=Math.floor(s/4)*4,h=s%4,d=`
        sumValue += dot(values, segFilter);
    `;let f="";i%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${d}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${d}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${d}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YOe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let u=0;const c=Dt([u],a);let h=r;c!=null&&(h=ps({inputs:{x:r},backend:n,attrs:{perm:c}}),l.push(h),u=Gt(1,a)[0]);const d=PW(h.shape,u,o),f=G([h.shape[u]]),p=ae({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}});l.push(p);const m=C1(r.dtype),g=(v,b,S,T,_)=>{const E=v.shape[0],N=v.shape[1],$=OW(N,_),A={windowSize:$,inSize:N,batchSize:E,numSegments:_},D=new QOe(A,b),F=n.compileAndRun(D,[v,S],T);if(l.push(F),F.shape[1]===_)return F;const B=rq({backend:n,attrs:{start:0,stop:_,step:1,dtype:"float32"}}),z=iq({inputs:{x:B},backend:n,attrs:{reps:[N/$]}});return l.push(B),l.push(z),g(F,b,z,T,_)},y=g(p,"unsortedSegmentSum",i,m,o),w=ae({inputs:{x:y},backend:n,attrs:{shape:d}});let x=w;if(c!=null){l.push(w);const v=il(c);x=ps({inputs:{x},backend:n,attrs:{perm:v}})}return l.forEach(v=>n.disposeIntermediateTensorInfo(v)),x}const JOe={kernelName:Pg,backendName:"webgl",kernelFunc:YOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZOe=[FEe,MEe,BEe,jEe,HEe,XEe,YEe,ZEe,ske,ike,lke,hke,pke,wke,bke,Tke,_ke,Nke,Ake,Dke,Lke,jke,Hke,Qke,Jke,rNe,oNe,cNe,vEe,fNe,wNe,INe,kNe,ANe,DNe,PNe,LNe,BNe,jNe,qNe,XNe,YNe,ZNe,n$e,r$e,l$e,c$e,f$e,g$e,w$e,I$e,C$e,$$e,D$e,F$e,L$e,V$e,B$e,W$e,G$e,q$e,Y$e,e2e,s2e,i2e,l2e,h2e,m2e,v2e,wEe,b2e,gNe,S2e,E2e,$2e,bEe,O2e,M2e,z2e,j2e,q2e,Y2e,eAe,rAe,lAe,hAe,fAe,yAe,vAe,bAe,_Ae,EAe,NAe,AAe,DAe,LAe,BAe,GAe,ZAe,SEe,sRe,oRe,uRe,dRe,eNe,mRe,yRe,vRe,IRe,CRe,TEe,kRe,$Re,RRe,ORe,PRe,tNe,XAe,MRe,URe,HRe,CEe,QRe,ZRe,sDe,oDe,cDe,dDe,mDe,wDe,bDe,SDe,EDe,$De,ODe,LDe,BDe,jDe,Uke,YAe,qDe,XDe,YDe,ZDe,tOe,sOe,iOe,aOe,uOe,dOe,pOe,gOe,wOe,bOe,TOe,_Oe,EOe,QAe,DEe,$Oe,DOe,POe,MOe,UOe,GOe,OEe,qOe,XOe,JOe,gRe];for(const t of ZOe)_1(t);/** @license See the LICENSE file. */const ePe="4.17.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tPe={"tfjs-core":hW,"tfjs-backend-cpu":pH,"tfjs-backend-webgl":N6,"tfjs-data":wG,"tfjs-layers":Eb,"tfjs-converter":eG,tfjs:ePe},nPe=Object.freeze(Object.defineProperty({__proto__:null,Abs:Om,Acos:Dh,Acosh:Oh,AdadeltaOptimizer:NN,AdagradOptimizer:$N,AdamOptimizer:AN,AdamaxOptimizer:RN,Add:Bu,AddN:Pm,All:xx,Any:bx,ArgMax:Fm,ArgMin:Lm,Asin:Ph,Asinh:Fh,Atan:Lh,Atan2:Vh,Atanh:Mh,AvgPool:Mm,AvgPool3D:Vm,AvgPool3DGrad:Tx,AvgPoolGrad:Ix,BatchMatMul:zm,BatchToSpaceND:Bm,Bincount:Sx,BitwiseAnd:Um,BroadcastArgs:_x,BroadcastTo:o4,Callback:Xj,CallbackList:ej,Cast:zh,Ceil:Bh,ClipByValue:Uh,Complex:Cx,ComplexAbs:Wm,Concat:jm,Conv2D:Gm,Conv2DBackpropFilter:Ex,Conv2DBackpropInput:Hm,Conv3D:qm,Conv3DBackpropFilterV2:kx,Conv3DBackpropInputV2:Nx,Cos:Wh,Cosh:jh,CropAndResize:Ax,Cumprod:$x,Cumsum:Km,CustomCallback:nj,DataStorage:JE,DenseBincount:Rx,DepthToSpace:Dx,DepthwiseConv2dNative:Xm,DepthwiseConv2dNativeBackpropFilter:Ox,DepthwiseConv2dNativeBackpropInput:Px,Diag:Fx,Dilation2D:Qm,Dilation2DBackpropFilter:Vw,Dilation2DBackpropInput:Mw,Draw:Lx,get ENV(){return sk},EarlyStopping:Qj,Einsum:Mx,Elu:Hh,EluGrad:Vx,Environment:r4,Equal:Ym,Erf:qh,Exp:Kh,ExpandDims:Jm,Expm1:Xh,FFT:zx,Fill:Bx,FlipLeftRight:Ux,Floor:Qh,FloorDiv:Yh,FromPixels:zw,FusedBatchNorm:Zm,FusedConv2D:Wp,FusedDepthwiseConv2D:jp,GPGPUContext:z0,GatherNd:Wx,GatherV2:eg,GraphModel:V2,Greater:tg,GreaterEqual:Jh,History:tj,IFFT:jx,Identity:Zh,Imag:Gx,InputSpec:Yt,IsFinite:ed,IsInf:td,IsNan:nd,KernelBackend:yx,LRN:lg,LRNGrad:qx,LayerVariable:QW,LayersModel:vo,LeakyRelu:ng,Less:sg,LessEqual:rg,LinSpace:Hx,Log:sd,Log1p:rd,LogSoftmax:a4,LogicalAnd:ig,LogicalNot:og,LogicalOr:ag,LogicalXor:wse,LowerBound:vse,MathBackendCPU:my,MathBackendWebGL:vy,MatrixBandPart:xse,Max:ug,MaxPool:cg,MaxPool3D:hg,MaxPool3DGrad:Xx,MaxPoolGrad:Kx,MaxPoolWithArgmax:Qx,Maximum:id,Mean:dg,Min:fg,Minimum:od,MirrorPad:pg,Mod:ad,MomentumOptimizer:DN,Multinomial:Yx,Multiply:ld,Neg:mg,NonMaxSuppressionV3:Jx,NonMaxSuppressionV4:Zx,NonMaxSuppressionV5:e1,NotEqual:gg,OP_SCOPE_SUFFIX:uk,OneHot:wg,OnesLike:yg,Optimizer:Wo,OptimizerConstructors:dW,Pack:vg,PadV2:xg,Pool:bse,Pow:ud,Prelu:bg,Prod:Ig,RMSPropOptimizer:ON,RNN:Ii,RaggedGather:t1,RaggedRange:n1,RaggedTensorToTensor:s1,Range:r1,get Rank(){return VS},Real:i1,RealDiv:Gh,Reciprocal:cd,get Reduction(){return as},Relu:hd,Relu6:dd,Reshape:Tg,ResizeBilinear:_g,ResizeBilinearGrad:a1,ResizeNearestNeighbor:Sg,ResizeNearestNeighborGrad:o1,Reverse:Cg,RotateWithOffset:S1,Round:fd,Rsqrt:pd,SGDOptimizer:ub,ScatterNd:l1,SearchSorted:c1,Select:Eg,Selu:md,Sequential:bu,Sigmoid:vd,Sign:wd,Sin:gd,Sinh:yd,Slice:kg,Softmax:Rg,Softplus:xd,SpaceToBatchND:$g,SparseFillEmptyRows:h1,SparseReshape:d1,SparseSegmentMean:f1,SparseSegmentSum:p1,SparseToDense:m1,SplitV:Ag,Sqrt:bd,Square:g1,SquaredDifference:Id,StaticRegexReplace:Dg,Step:Ed,StridedSlice:y1,StringNGrams:w1,StringSplit:v1,StringToHashBucketFast:x1,Sub:Td,Sum:Ng,SymbolicTensor:gi,Tan:Sd,Tanh:_d,Tensor:Qe,TensorBuffer:Jt,TensorScatterUpdate:u1,Tile:Cd,TopK:b1,Transform:I1,Transpose:Gl,Unique:T1,Unpack:Og,UnsortedSegmentSum:Pg,UpperBound:Ise,Variable:qp,ZerosLike:Fg,_FusedMatMul:Up,abs:Kt,acos:yk,acosh:wk,add:Y,addN:B4,all:N1,any:Xp,argMax:fu,argMin:vk,asin:xk,asinh:bk,atan:Ik,atan2:Tk,atanh:Sk,avgPool:zg,avgPool3d:Ck,backend:hk,backend_util:LW,basicLSTMCell:U4,batchNorm:kd,batchNorm2d:Ek,batchNorm3d:kk,batchNorm4d:Nk,batchToSpaceND:Bg,bincount:$k,bitwiseAnd:W4,booleanMaskAsync:kU,broadcastArgs:j4,broadcastTo:Hl,broadcast_util:Zie,browser:phe,buffer:Fe,callbacks:Nye,cast:re,ceil:Ak,clipByValue:Es,clone:Ui,complex:$o,concat:Bt,concat1d:Rk,concat2d:Dk,concat3d:Ok,concat4d:Pk,constraints:gpe,conv1d:$1,conv2d:Ao,conv2dTranspose:A1,conv3d:Lk,conv3dTranspose:Mk,copyRegisteredKernels:Cse,cos:Ug,cosh:R1,cosineWindow:tb,cumprod:Jp,cumsum:D1,customGrad:Qi,data:tve,denseBincount:Gw,deprecationWarn:sre,depthToSpace:Vk,depthwiseConv2d:Nd,deregisterOp:Rye,device_util:Yse,diag:H4,dilation2d:zk,disableDeprecationWarnings:nre,dispose:$e,disposeVariables:rre,div:be,divNoNan:Bk,dot:Uk,dropout:SN,einsum:Il,elu:$d,enableDebugMode:tre,enableProdMode:ere,enclosingPowerOfTwo:_N,engine:Qr,ensureShape:q4,env:U,equal:Qs,erf:Wk,euclideanNorm:Gk,exp:ks,expandDims:En,expm1:Hk,eye:O1,fft:ty,fill:Wu,findBackend:cre,findBackendFactory:hre,floor:Rd,floorDiv:k1,forceHalfFloat:$6,fused:LU,gather:Dd,gatherND:RU,gather_util:mhe,getBackend:E4,getGradient:FS,getKernel:Hp,getKernelsForBackend:Bw,gpgpu_util:J_e,grad:Foe,grads:Loe,greater:gs,greaterEqual:zo,ifft:fh,imag:Wg,image:Or,inTopKAsync:DU,initializers:Rpe,input:gj,io:LN,irfft:X1,isFinite:qk,isInf:Kk,isNaN:Xk,keep:on,kernel_impls:She,layers:oye,leakyRelu:jg,less:uh,lessEqual:ol,linalg:kN,linspace:Q4,loadGraphModel:swe,loadGraphModelSync:rwe,loadLayersModel:bme,localResponseNormalization:Qk,log:Ys,log1p:Gg,logSigmoid:Yk,logSoftmax:F1,logSumExp:Hg,logicalAnd:zr,logicalNot:qg,logicalOr:L1,logicalXor:Jk,losses:jU,lowerBound:J4,matMul:ze,math:ihe,max:gr,maxPool:Kg,maxPool3d:Zk,maxPoolWithArgmax:Z4,maximum:Ji,mean:$t,memory:Ww,meshgrid:eU,metrics:Iye,min:lh,minimum:Ba,mirrorPad:eN,mod:tN,model:Sme,models:Tye,moments:Xg,movingAverage:NU,mul:P,multiRNNCell:tU,multinomial:nU,neg:pt,nextFrame:WN,norm:Ad,notEqual:yu,oneHot:ch,ones:Is,onesLike:Js,op:O,outerProduct:sU,pad:Bo,pad1d:rU,pad2d:iU,pad3d:oU,pad4d:aU,pool:nN,pow:Ro,prelu:Yg,print:gk,prod:sN,profile:ire,raggedGather:lU,raggedRange:uU,raggedTensorToTensor:cU,rand:hU,randomGamma:mU,randomNormal:z1,randomStandardNormal:gU,randomUniform:al,randomUniformInt:yU,range:wu,ready:lre,real:hh,reciprocal:pN,registerBackend:ck,registerCallbackConstructor:Cme,registerGradient:l4,registerKernel:_1,registerOp:Aye,regularizers:Eye,relu:xi,relu6:B1,removeBackend:ure,reshape:L,reverse:vr,reverse1d:wU,reverse2d:vU,reverse3d:xU,reverse4d:bU,rfft:ny,round:U1,rsqrt:W1,scalar:Te,scatterND:$U,scatter_util:Mle,searchSorted:M1,selu:j1,separableConv2d:G1,sequential:_me,serialization:Vce,setBackend:are,setPlatform:dre,setWebGLContext:RH,setdiff1dAsync:IU,shared:fH,sigmoid:oi,sign:mN,signal:WU,sin:H1,sinh:q1,slice:Ge,slice1d:Jg,slice2d:K1,slice3d:Zg,slice4d:dh,slice_util:cW,softmax:ey,softplus:ju,spaceToBatchND:Qg,sparse:GU,sparseToDense:AU,spectral:UU,split:Ss,sqrt:Pn,square:ot,squaredDifference:Q1,squeeze:ll,stack:fs,step:Hu,stridedSlice:gN,string:HU,sub:pe,sum:ge,sumOutType:C1,tan:yN,tanh:mu,tensor:Xs,tensor1d:$n,tensor2d:Na,tensor3d:wN,tensor4d:TU,tensor5d:SU,tensor6d:_U,tensorScatterUpdate:CU,tensor_util:Hse,test_util:Yae,tidy:W,tile:cr,time:ore,topk:xN,train:vl,transpose:je,truncatedNormal:J1,unique:bN,unregisterGradient:_se,unregisterKernel:Sse,unsortedSegmentSum:Z1,unstack:xr,upcastType:_s,upperBound:EU,util:Ose,valueAndGrad:Moe,valueAndGrads:Voe,variable:IN,variableGrads:Y4,version:tPe,version_converter:eG,version_core:hW,version_cpu:pH,version_layers:Eb,version_webgl:N6,webgl:yEe,webgl_util:r_e,where:wn,whereAsync:TN,zeros:Qt,zerosLike:He},Symbol.toStringTag,{value:"Module"})),am=A_(nPe);var ku={};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(ku,"__esModule",{value:!0});ku.cropTensor=ku.capture=void 0;var Ll=am;function sPe(t,e){return Ll.tidy(function(){var n=Ll.browser.fromPixels(t),s=oq(n,e),r=s.expandDims(0);return r.toFloat().div(Ll.scalar(127)).sub(Ll.scalar(1))})}ku.capture=sPe;function oq(t,e,n){var s=Math.min(t.shape[0],t.shape[1]),r=t.shape[0]/2,i=r-s/2,o=t.shape[1]/2,a=o-s/2;if(e&&!n){var l=t.slice([i,a,0],[s,s,3]);l=l.reshape([s*s,1,3]);var u=[.2989,.587,.114];return l=Ll.mul(l,u),l=l.reshape([s,s,3]),l=Ll.sum(l,-1),l=Ll.expandDims(l,-1),l}return t.slice([i,a,0],[s,s,3])}ku.cropTensor=oq;var ti={};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(ti,"__esModule",{value:!0});ti.cropTo=ti.resizeMinTo=ti.resizeMaxTo=ti.resize=void 0;var Bb=function(){return document.createElement("canvas")};function CA(t,e,n){n===void 0&&(n=Bb()),n.width=t.width*e,n.height=t.height*e;var s=n.getContext("2d");return s.drawImage(t,0,0,n.width,n.height),n}ti.resize=CA;function rPe(t,e,n){n===void 0&&(n=Bb());var s=Math.max(t.width,t.height);return CA(t,e/s,n)}ti.resizeMaxTo=rPe;function iPe(t,e,n){n===void 0&&(n=Bb());var s=Math.min(t.width,t.height);return CA(t,e/s,n)}ti.resizeMinTo=iPe;function oPe(t,e,n,s){n===void 0&&(n=!1),s===void 0&&(s=Bb());var r=t.width,i=t.height;t instanceof HTMLVideoElement&&(r=t.videoWidth,i=t.videoHeight);var o=Math.min(r,i),a=e/o,l=Math.ceil(r*a),u=Math.ceil(i*a),c=l-e,h=u-e;s.width=s.height=e;var d=s.getContext("2d");return d.drawImage(t,~~(c/2)*-1,~~(h/2)*-1,l,u),n&&(d.scale(-1,1),d.drawImage(s,e*-1,0)),s}ti.cropTo=oPe;var Iy={};/** @license See the LICENSE file. */Object.defineProperty(Iy,"__esModule",{value:!0});Iy.version=void 0;var aPe="0.8.4-alpha2";Iy.version=aPe;(function(t){/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var e=Pe&&Pe.__awaiter||function(T,_,E,N){function $(A){return A instanceof E?A:new E(function(D){D(A)})}return new(E||(E=Promise))(function(A,D){function F(H){try{z(N.next(H))}catch(M){D(M)}}function B(H){try{z(N.throw(H))}catch(M){D(M)}}function z(H){H.done?A(H.value):$(H.value).then(F,B)}z((N=N.apply(T,_||[])).next())})},n=Pe&&Pe.__generator||function(T,_){var E={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},N,$,A,D;return D={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(D[Symbol.iterator]=function(){return this}),D;function F(z){return function(H){return B([z,H])}}function B(z){if(N)throw new TypeError("Generator is already executing.");for(;E;)try{if(N=1,$&&(A=z[0]&2?$.return:z[0]?$.throw||((A=$.return)&&A.call($),0):$.next)&&!(A=A.call($,z[1])).done)return A;switch($=0,A&&(z=[z[0]&2,A.value]),z[0]){case 0:case 1:A=z;break;case 4:return E.label++,{value:z[1],done:!1};case 5:E.label++,$=z[1],z=[0];continue;case 7:z=E.ops.pop(),E.trys.pop();continue;default:if(A=E.trys,!(A=A.length>0&&A[A.length-1])&&(z[0]===6||z[0]===2)){E=0;continue}if(z[0]===3&&(!A||z[1]>A[0]&&z[1]<A[3])){E.label=z[1];break}if(z[0]===6&&E.label<A[1]){E.label=A[1],A=z;break}if(A&&E.label<A[2]){E.label=A[2],E.ops.push(z);break}A[2]&&E.ops.pop(),E.trys.pop();continue}z=_.call(T,E)}catch(H){z=[6,H],$=0}finally{N=A=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.loadFromFiles=t.load=t.loadTruncatedMobileNet=t.CustomMobileNet=t.getTopKClasses=t.IMAGE_SIZE=void 0;var s=am,r=am,i=ku,o=ti,a=Iy,l=1,u="conv_pw_13_relu",c="out_relu",h=.25,d=.35;t.IMAGE_SIZE=224;var f=function(T){return T.packageVersion=T.packageVersion||a.version,T.packageName=T.packageName||"@teachablemachine/image",T.timeStamp=T.timeStamp||new Date().toISOString(),T.userMetadata=T.userMetadata||{},T.modelName=T.modelName||"untitled",T.labels=T.labels||[],T.imageSize=T.imageSize||t.IMAGE_SIZE,T},p=function(T){return!!T&&Array.isArray(T.labels)},m=function(T,_){if(T===1){if(_!==.25&&_!==.5&&_!==.75&&_!==1)return console.warn("Invalid alpha. Options are: 0.25, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",h.toFixed(2)),h}else if(_!==.35&&_!==.5&&_!==.75&&_!==1)return console.warn("Invalid alpha. Options are: 0.35, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",d.toFixed(2)),d;return _},g=function(T){if(T=T||{},T.checkpointUrl&&T.trainingLayer)return(T.alpha||T.version)&&console.warn("Checkpoint URL passed to modelOptions, alpha options are ignored"),[T.checkpointUrl,T.trainingLayer];if(T.version=T.version||l,T.version===1){T.alpha=T.alpha||h,T.alpha=m(T.version,T.alpha),console.log("Loading mobilenet "+T.version+" and alpha "+T.alpha);var _=T.alpha.toFixed(2);return _==="1.00"&&(_="1.0"),["https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_"+_+"_"+t.IMAGE_SIZE+"/model.json",u]}else{if(T.version===2)return T.alpha=T.alpha||d,T.alpha=m(T.version,T.alpha),console.log("Loading mobilenet "+T.version+" and alpha "+T.alpha),["https://storage.googleapis.com/teachable-machine-models/mobilenet_v2_weights_tf_dim_ordering_tf_kernels_"+T.alpha.toFixed(2)+"_"+t.IMAGE_SIZE+"_no_top/model.json",c];throw new Error("MobileNet V"+T.version+" doesn't exist")}},y=function(T){return e(void 0,void 0,void 0,function(){var _,E;return n(this,function(N){switch(N.label){case 0:return typeof T!="string"?[3,3]:[4,fetch(T)];case 1:return E=N.sent(),[4,E.json()];case 2:return _=N.sent(),[3,4];case 3:if(p(T))_=T;else throw new Error("Invalid Metadata provided");N.label=4;case 4:return[2,f(_)]}})})};function w(T,_,E){return E===void 0&&(E=3),e(this,void 0,void 0,function(){var N;return n(this,function($){switch($.label){case 0:return[4,_.data()];case 1:return N=$.sent(),[2,s.tidy(function(){E=Math.min(E,N.length);for(var A=[],D=0;D<N.length;D++)A.push({value:N[D],index:D});A.sort(function(H,M){return M.value-H.value});for(var F=new Float32Array(E),B=new Int32Array(E),D=0;D<E;D++)F[D]=A[D].value,B[D]=A[D].index;for(var z=[],D=0;D<B.length;D++)z.push({className:T[B[D]],probability:F[D]});return z})]}})})}t.getTopKClasses=w;var x=function(){function T(_,E){this.model=_,this._metadata=f(E)}return Object.defineProperty(T,"EXPECTED_IMAGE_SIZE",{get:function(){return t.IMAGE_SIZE},enumerable:!1,configurable:!0}),T.prototype.getMetadata=function(){return this._metadata},T.prototype.getTotalClasses=function(){var _=this.model.output,E=_.shape[1];return E},T.prototype.getClassLabels=function(){return this._metadata.labels},T.prototype.predictTopK=function(_,E,N){return E===void 0&&(E=10),N===void 0&&(N=!1),e(this,void 0,void 0,function(){var $,A,D,F=this;return n(this,function(B){switch(B.label){case 0:return $=o.cropTo(_,this._metadata.imageSize,N),A=s.tidy(function(){var z=i.capture($,F._metadata.grayscale);return F.model.predict(z)}),[4,w(this._metadata.labels,A,E)];case 1:return D=B.sent(),r.dispose(A),[2,D]}})})},T.prototype.predict=function(_,E){return E===void 0&&(E=!1),e(this,void 0,void 0,function(){var N,$,A,D,F,B=this;return n(this,function(z){switch(z.label){case 0:return N=o.cropTo(_,this._metadata.imageSize,E),$=s.tidy(function(){var H=i.capture(N,B._metadata.grayscale);return B.model.predict(H)}),[4,$.data()];case 1:for(A=z.sent(),D=[],F=0;F<A.length;F++)D.push({className:this._metadata.labels[F],probability:A[F]});return r.dispose($),[2,D]}})})},T.prototype.dispose=function(){this.truncatedModel.dispose()},T}();t.CustomMobileNet=x;function v(T){return e(this,void 0,void 0,function(){var _,E,N,$,A,D,F,A,D,F;return n(this,function(B){switch(B.label){case 0:return _=g(T),E=_[0],N=_[1],[4,s.loadLayersModel(E)];case 1:return $=B.sent(),T&&T.version===1?(A=$.getLayer(N),D=s.model({inputs:$.inputs,outputs:A.output}),F=s.sequential(),F.add(D),F.add(s.layers.flatten()),[2,F]):(A=$.getLayer(N),D=s.model({inputs:$.inputs,outputs:A.output}),F=s.sequential(),F.add(D),F.add(s.layers.globalAveragePooling2d({})),[2,F])}})})}t.loadTruncatedMobileNet=v;function b(T,_){return e(this,void 0,void 0,function(){var E,N,$;return n(this,function(A){switch(A.label){case 0:return[4,s.loadLayersModel(T)];case 1:return E=A.sent(),_?[4,y(_)]:[3,3];case 2:return $=A.sent(),[3,4];case 3:$=null,A.label=4;case 4:return N=$,[2,new x(E,N)]}})})}t.load=b;function S(T,_,E){return e(this,void 0,void 0,function(){var N,$,A,D;return n(this,function(F){switch(F.label){case 0:return[4,s.loadLayersModel(s.io.browserFiles([T,_]))];case 1:return N=F.sent(),[4,new Response(E).json()];case 2:return $=F.sent(),E?[4,y($)]:[3,4];case 3:return D=F.sent(),[3,5];case 4:D=null,F.label=5;case 5:return A=D,[2,new x(N,A)]}})})}t.loadFromFiles=S})(YE);var xh={},EA={exports:{}};EA.exports;(function(t){(function(e,n,s){function r(l){var u=this,c=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var c=new r(l),h=u&&u.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,c),d.state=function(){return i(c,{})}),d}function a(){var l=4022871197,u=function(c){c=c.toString();for(var h=0;h<c.length;h++){l+=c.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.alea=o})(Pe,t,!1)})(EA);var lPe=EA.exports,kA={exports:{}};kA.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xor128=o})(Pe,t,!1)})(kA);var uPe=kA.exports,NA={exports:{}};NA.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xorwow=o})(Pe,t,!1)})(NA);var cPe=NA.exports,$A={exports:{}};$A.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.x,h=l.i,d,f;return d=c[h],d^=d>>>7,f=d^d<<24,d=c[h+1&7],f^=d^d>>>10,d=c[h+3&7],f^=d^d>>>3,d=c[h+4&7],f^=d^d<<7,d=c[h+7&7],d=d^d<<13,f^=d^d<<9,c[h]=f,l.i=h+1&7,f};function u(c,h){var d,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[d&7]=f[d&7]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xorshift7=o})(Pe,t,!1)})($A);var hPe=$A.exports,AA={exports:{}};AA.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.w,h=l.X,d=l.i,f,p;return l.w=c=c+1640531527|0,p=h[d+34&127],f=h[d=d+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=h[d]=p^f,l.i=d,p+(c^c>>>16)|0};function u(c,h){var d,f,p,m,g,y=[],w=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,w=Math.max(w,h.length)),p=0,m=-32;m<w;++m)h&&(f^=h.charCodeAt((m+32)%h.length)),m===0&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(g=g+1640531527|0,d=y[m&127]^=f+g,p=d==0?p+1:0);for(p>=128&&(y[(h&&h.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=y[p+34&127],d=y[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,y[p]=f^d;c.w=g,c.X=y,c.i=p}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xor4096=o})(Pe,t,!1)})(AA);var dPe=AA.exports,RA={exports:{}};RA.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.b,d=l.c,f=l.d,p=l.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-f|0,l.d=f<<16^d>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.tychei=o})(Pe,t,!1)})(RA);var fPe=RA.exports,aq={exports:{}};(function(t){(function(e,n){var s=(0,eval)("this"),r=256,i=6,o=52,a="random",l=n.pow(r,i),u=n.pow(2,o),c=u*2,h=r-1,d;function f(v,b,S){var T=[];b=b==!0?{entropy:!0}:b||{};var _=y(g(b.entropy?[v,x(e)]:v??w(),3),T),E=new p(T),N=function(){for(var $=E.g(i),A=l,D=0;$<u;)$=($+D)*r,A*=r,D=E.g(1);for(;$>=c;)$/=2,A/=2,D>>>=1;return($+D)/A};return N.int32=function(){return E.g(4)|0},N.quick=function(){return E.g(4)/4294967296},N.double=N,y(x(E.S),e),(b.pass||S||function($,A,D,F){return F&&(F.S&&m(F,E),$.state=function(){return m(E,{})}),D?(n[a]=$,A):$})(N,_,"global"in b?b.global:this==n,b.state)}n["seed"+a]=f;function p(v){var b,S=v.length,T=this,_=0,E=T.i=T.j=0,N=T.S=[];for(S||(v=[S++]);_<r;)N[_]=_++;for(_=0;_<r;_++)N[_]=N[E=h&E+v[_%S]+(b=N[_])],N[E]=b;(T.g=function($){for(var A,D=0,F=T.i,B=T.j,z=T.S;$--;)A=z[F=h&F+1],D=D*r+z[h&(z[F]=z[B=h&B+A])+(z[B]=A)];return T.i=F,T.j=B,D})(r)}function m(v,b){return b.i=v.i,b.j=v.j,b.S=v.S.slice(),b}function g(v,b){var S=[],T=typeof v,_;if(b&&T=="object")for(_ in v)try{S.push(g(v[_],b-1))}catch{}return S.length?S:T=="string"?v:v+"\0"}function y(v,b){for(var S=v+"",T,_=0;_<S.length;)b[h&_]=h&(T^=b[h&_]*19)+S.charCodeAt(_++);return x(b)}function w(){try{var v;return d&&(v=d.randomBytes)?v=v(r):(v=new Uint8Array(r),(s.crypto||s.msCrypto).getRandomValues(v)),x(v)}catch{var b=s.navigator,S=b&&b.plugins;return[+new Date,s,S,s.screen,x(e)]}}function x(v){return String.fromCharCode.apply(0,v)}if(y(n.random(),e),t.exports){t.exports=f;try{d=V1}catch{}}})([],Math)})(aq);var pPe=aq.exports,mPe=lPe,gPe=uPe,yPe=cPe,wPe=hPe,vPe=dPe,xPe=fPe,sc=pPe;sc.alea=mPe;sc.xor128=gPe;sc.xorwow=yPe;sc.xorshift7=wPe;sc.xor4096=vPe;sc.tychei=xPe;var bPe=sc;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var IPe=Pe&&Pe.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var i in r)r.hasOwnProperty(i)&&(s[i]=r[i])},t(e,n)};return function(e,n){t(e,n);function s(){this.constructor=e}e.prototype=n===null?Object.create(n):(s.prototype=n.prototype,new s)}}(),no=Pe&&Pe.__awaiter||function(t,e,n,s){function r(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):r(c.value).then(a,l)}u((s=s.apply(t,e||[])).next())})},so=Pe&&Pe.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,r,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(s)throw new TypeError("Generator is already executing.");for(;n;)try{if(s=1,r&&(i=u[0]&2?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,r=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(c){u=[6,c],r=0}finally{s=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(xh,"__esModule",{value:!0});xh.createTeachable=xh.TeachableMobileNet=void 0;var Wn=am,TPe=am,SPe=ku,lq=YE,_Pe=bPe,CPe=.15,EPe=function(t){return typeof t.dataId=="object"&&typeof t.shape=="object"};function kPe(t,e){var n=new Array(e).fill(0);return n[t]=1,n}function sT(t,e){for(var n,s=t.length,r=t.slice(),i=s-1;i>0;i-=1){var o=void 0;e?o=Math.floor(e()*(i+1)):o=Math.floor(Math.random()*(i+1)),n=[r[o],r[i]],r[i]=n[0],r[o]=n[1]}return r}var uq=function(t){IPe(e,t);function e(n,s){var r=t.call(this,Wn.sequential(),s)||this;return r.totalSamples=0,r.examples=[],r.truncatedModel=n,r}return Object.defineProperty(e.prototype,"asSequentialModel",{get:function(){return this.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isTrained",{get:function(){return!!this.model&&this.model.layers&&this.model.layers.length>2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPrepared",{get:function(){return!!this.trainDataset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numClasses",{get:function(){return this._metadata.labels.length},enumerable:!1,configurable:!0}),e.prototype.addExample=function(n,s){return no(this,void 0,void 0,function(){var r,i,o;return so(this,function(a){return r=EPe(s)?s:SPe.capture(s,this._metadata.grayscale),i=this.truncatedModel.predict(r),o=i.dataSync(),r.dispose(),i.dispose(),this.examples[n].push(o),this.totalSamples++,[2]})})},e.prototype.predict=function(n,s){return s===void 0&&(s=!1),no(this,void 0,void 0,function(){return so(this,function(r){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,t.prototype.predict.call(this,n,s)]})})},e.prototype.predictTopK=function(n,s,r){return s===void 0&&(s=10),r===void 0&&(r=!1),no(this,void 0,void 0,function(){return so(this,function(i){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,t.prototype.predictTopK.call(this,n,s,r)]})})},e.prototype.prepare=function(){for(var n in this.examples)if(n.length===0)throw new Error("Add some examples before training");var s=this.convertToTfDataset();this.trainDataset=s.trainDataset,this.validationDataset=s.validationDataset},e.prototype.convertToTfDataset=function(){for(var n=0;n<this.examples.length;n++)this.examples[n]=sT(this.examples[n],this.seed);for(var s=[],r=[],i=function(h){var d=kPe(h,o.numClasses),f=o.examples[h].length,p=Math.ceil(CPe*f),m=f-p,g=o.examples[h].slice(0,m).map(function(w){return{data:w,label:d}}),y=o.examples[h].slice(m).map(function(w){return{data:w,label:d}});s=s.concat(g),r=r.concat(y)},o=this,n=0;n<this.examples.length;n++)i(n);s=sT(s,this.seed),r=sT(r,this.seed);var a=Wn.data.array(s.map(function(h){return h.data})),l=Wn.data.array(r.map(function(h){return h.data})),u=Wn.data.array(s.map(function(h){return h.label})),c=Wn.data.array(r.map(function(h){return h.label}));return{trainDataset:Wn.data.zip({xs:a,ys:u}),validationDataset:Wn.data.zip({xs:l,ys:c})}},e.prototype.save=function(n,s){return no(this,void 0,void 0,function(){return so(this,function(r){return[2,this.model.save(n,s)]})})},e.prototype.train=function(n,s){return s===void 0&&(s={}),no(this,void 0,void 0,function(){var r,i,o,a,l,u,c,h,d,f=this;return so(this,function(p){switch(p.label){case 0:if(r=s.onTrainEnd||function(){},s.onTrainEnd=function(m){f.__stopTrainingResolve&&(f.__stopTrainingResolve(),f.__stopTrainingResolve=null),r(m)},this.isPrepared||this.prepare(),i=this.getLabels().length,TPe.util.assert(i===this.numClasses,function(){return"Can not train, has "+i+" labels and "+f.numClasses+" classes"}),o=this.truncatedModel.outputs[0].shape.slice(1),a=Wn.util.sizeFromShape(o),this.seed?l=Wn.initializers.varianceScaling({seed:3.14}):l=Wn.initializers.varianceScaling({}),this.trainingModel=Wn.sequential({layers:[Wn.layers.dense({inputShape:[a],units:n.denseUnits,activation:"relu",kernelInitializer:l,useBias:!0}),Wn.layers.dense({kernelInitializer:l,useBias:!1,activation:"softmax",units:this.numClasses})]}),u=Wn.train.adam(n.learningRate),this.trainingModel.compile({optimizer:u,loss:"categoricalCrossentropy",metrics:["accuracy"]}),!(n.batchSize>0))throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction");return c=this.trainDataset.batch(n.batchSize),h=this.validationDataset.batch(n.batchSize),[4,this.trainingModel.fitDataset(c,{epochs:n.epochs,validationData:h,callbacks:s})];case 1:return p.sent(),d=Wn.sequential(),d.add(this.truncatedModel),d.add(this.trainingModel),this.model=d,u.dispose(),[2,this.model]}})})},e.prototype.prepareDataset=function(){for(var n=0;n<this.numClasses;n++)this.examples[n]=[]},e.prototype.setLabel=function(n,s){this._metadata.labels[n]=s},e.prototype.setLabels=function(n){this._metadata.labels=n,this.prepareDataset()},e.prototype.getLabel=function(n){return this._metadata.labels[n]},e.prototype.getLabels=function(){return this._metadata.labels},e.prototype.setName=function(n){this._metadata.modelName=n},e.prototype.getName=function(){return this._metadata.modelName},e.prototype.stopTraining=function(){var n=this,s=new Promise(function(r,i){n.trainingModel.stopTraining=!0,n.__stopTrainingResolve=r});return s},e.prototype.dispose=function(){this.trainingModel.dispose(),t.prototype.dispose.call(this)},e.prototype.calculateAccuracyPerClass=function(){return no(this,void 0,void 0,function(){var n,s,r,i,o,a,l,u,c,h,x,d,f,p,m,g,y,w,x,v=this;return so(this,function(b){switch(b.label){case 0:return n=this.validationDataset.mapAsync(function(S){return no(v,void 0,void 0,function(){return so(this,function(T){return[2,S.xs]})})}),s=this.validationDataset.mapAsync(function(S){return no(v,void 0,void 0,function(){return so(this,function(T){return[2,S.ys]})})}),r=Math.min(s.size,32),i=Math.ceil(s.size/r),o=n.batch(r),a=s.batch(r),[4,o.iterator()];case 1:return l=b.sent(),[4,a.iterator()];case 2:u=b.sent(),c=[],h=[],x=0,b.label=3;case 3:return x<i?[4,l.next()]:[3,7];case 4:return d=b.sent(),f=this.trainingModel.predict(d.value),p=f.argMax(1),c.push(p),[4,u.next()];case 5:m=b.sent(),g=m.value.argMax(1),h.push(g),d.value.dispose(),f.dispose(),m.value.dispose(),b.label=6;case 6:return x++,[3,3];case 7:if(y=Wn.concat(h),w=Wn.concat(c),i!==1)for(x=0;x<c.length;x++)c[x].dispose(),h[x].dispose();return[2,{reference:y,predictions:w}]}})})},e.prototype.setSeed=function(n){this.seed=_Pe(n)},e}(lq.CustomMobileNet);xh.TeachableMobileNet=uq;function NPe(t,e){return no(this,void 0,void 0,function(){var n;return so(this,function(s){switch(s.label){case 0:return[4,lq.loadTruncatedMobileNet(e)];case 1:return n=s.sent(),[2,new uq(n,t)]}})})}xh.createTeachable=NPe;var Ub={};function U0(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?U0=function(n){return typeof n}:U0=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},U0(t)}function DA(t,e,n){var s=n.value;if(typeof s!="function")throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(U0(s)));var r=!1;return{configurable:!0,get:function(){if(r||this===t.prototype||this.hasOwnProperty(e)||typeof s!="function")return s;var o=s.bind(this);return r=!0,Object.defineProperty(this,e,{configurable:!0,get:function(){return o},set:function(l){s=l,delete this[e]}}),r=!1,o},set:function(o){s=o}}}function cq(t){var e;return typeof Reflect<"u"&&typeof Reflect.ownKeys=="function"?e=Reflect.ownKeys(t.prototype):(e=Object.getOwnPropertyNames(t.prototype),typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(t.prototype)))),e.forEach(function(n){if(n!=="constructor"){var s=Object.getOwnPropertyDescriptor(t.prototype,n);typeof s.value=="function"&&Object.defineProperty(t.prototype,n,DA(t,n,s))}}),t}function $Pe(){return arguments.length===1?cq.apply(void 0,arguments):DA.apply(void 0,arguments)}const APe=Object.freeze(Object.defineProperty({__proto__:null,boundClass:cq,boundMethod:DA,default:$Pe},Symbol.toStringTag,{value:"Module"})),RPe=A_(APe);/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Yo=Pe&&Pe.__decorate||function(t,e,n,s){var r=arguments.length,i=r<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,n):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(i=(r<3?o(i):r>3?o(e,n,i):o(e,n))||i);return r>3&&i&&Object.defineProperty(e,n,i),i},DPe=Pe&&Pe.__awaiter||function(t,e,n,s){function r(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):r(c.value).then(a,l)}u((s=s.apply(t,e||[])).next())})},OPe=Pe&&Pe.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,r,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(s)throw new TypeError("Generator is already executing.");for(;n;)try{if(s=1,r&&(i=u[0]&2?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,r=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(c){u=[6,c],r=0}finally{s=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(Ub,"__esModule",{value:!0});Ub.Webcam=void 0;var Jo=RPe,PPe=ti,rT={facingMode:"user",frameRate:24},FPe=function(t){return t.facingMode=t.facingMode||rT.facingMode,t.frameRate=t.frameRate||rT.frameRate,t.aspectRatio=t.aspectRatio||rT.aspectRatio,t},LPe=function(){function t(e,n,s){e===void 0&&(e=400),n===void 0&&(n=400),s===void 0&&(s=!1),this.width=e,this.height=n,this.flip=s}return t.prototype.getWebcam=function(e){if(e===void 0&&(e={}),!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia)return Promise.reject("Your browser does not support WebRTC. Please try another one.");e.width=640;var n=FPe(e),s=document.createElement("video");return window.navigator.mediaDevices.getUserMedia({video:n}).then(function(r){return s.srcObject=r,s.addEventListener("loadedmetadata",function(i){var o=s.videoWidth,a=s.videoHeight;s.width=o,s.height=a}),s},function(){return Promise.reject("Could not open your camera. You may have denied access.")})},t.prototype.setup=function(e){return e===void 0&&(e={}),DPe(this,void 0,void 0,function(){var n;return OPe(this,function(s){switch(s.label){case 0:return this.webcam?[3,2]:(n=this,[4,this.getWebcam(e)]);case 1:n.webcam=s.sent(),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height),s.label=2;case 2:return[2]}})})},t.prototype.play=function(){var e=this.webcam.play();return e},t.prototype.pause=function(){this.webcam.pause()},t.prototype.stop=function(){this.stopStreamedVideo(this.webcam)},t.prototype.update=function(){this.renderCameraToCanvas()},t.prototype.stopStreamedVideo=function(e){var n=e.srcObject,s=n.getTracks();s.forEach(function(r){r.stop()}),e.srcObject=null},t.prototype.renderCameraToCanvas=function(){if(this.canvas&&this.webcam){var e=this.canvas.getContext("2d");if(this.webcam.videoWidth!==0){var n=PPe.cropTo(this.webcam,this.width,this.flip);e.drawImage(n,0,0)}}},Yo([Jo.default],t.prototype,"getWebcam",null),Yo([Jo.default],t.prototype,"setup",null),Yo([Jo.default],t.prototype,"play",null),Yo([Jo.default],t.prototype,"pause",null),Yo([Jo.default],t.prototype,"stop",null),Yo([Jo.default],t.prototype,"update",null),Yo([Jo.default],t.prototype,"stopStreamedVideo",null),Yo([Jo.default],t.prototype,"renderCameraToCanvas",null),t}();Ub.Webcam=LPe;(function(t){/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(t,"__esModule",{value:!0});var e=YE;Object.defineProperty(t,"IMAGE_SIZE",{enumerable:!0,get:function(){return e.IMAGE_SIZE}}),Object.defineProperty(t,"CustomMobileNet",{enumerable:!0,get:function(){return e.CustomMobileNet}}),Object.defineProperty(t,"load",{enumerable:!0,get:function(){return e.load}}),Object.defineProperty(t,"loadFromFiles",{enumerable:!0,get:function(){return e.loadFromFiles}}),Object.defineProperty(t,"loadTruncatedMobileNet",{enumerable:!0,get:function(){return e.loadTruncatedMobileNet}});var n=xh;Object.defineProperty(t,"TeachableMobileNet",{enumerable:!0,get:function(){return n.TeachableMobileNet}}),Object.defineProperty(t,"createTeachable",{enumerable:!0,get:function(){return n.createTeachable}});var s=Ub;Object.defineProperty(t,"Webcam",{enumerable:!0,get:function(){return s.Webcam}});var r=Iy;Object.defineProperty(t,"version",{enumerable:!0,get:function(){return r.version}})})(XB);const MPe=({imagePath:t,model:e})=>{const[n,s]=oe.useState([]);return oe.useEffect(()=>{const r=async()=>{if(console.log("Predicting...",t,"Model: ",e),!e||!t)return;const i=new Image;i.src=t,i.crossOrigin="anonymous",console.log("ELEMENT "+i.src),console.log("Model Status:",e);const o=new Promise((a,l)=>{i.onload=()=>{console.log("Image loaded successfully"),a()},i.onerror=u=>{console.error("Error loading image:",u),l(u)}});try{await o;const a=await e.predict(i);s(a),console.log("Predictions: ",n)}catch(a){console.error("Error during prediction:",a)}finally{i.remove()}};console.log("INSIDE PRED:",t,e),e&&t&&r()},[t]),he.jsxs("div",{className:"mt-4",children:[he.jsx("p",{className:"font-semibold",children:"Prediction:"}),he.jsx("div",{className:"flex flex-col gap-2 mt-2",children:n.length===0?he.jsx("p",{children:"Loading..."}):n.map((r,i)=>he.jsxs("div",{className:"flex justify-between items-center",children:[he.jsxs("p",{children:[r.className,":"]}),he.jsx("p",{children:r.probability.toFixed(2)})]},i))})]})},VPe=({can:t,onDelete:e,onEdit:n})=>{const[s,r]=oe.useState(t.image),[i,o]=oe.useState(t.image),[a,l]=oe.useState(t.image),[u,c]=oe.useState(null),[h,d]=oe.useState(!1);oe.useEffect(()=>{(async()=>{const m="https://teachablemachine.withgoogle.com/models/CUU-5erFK/",g=m+"model.json",y=m+"metadata.json";console.log("loading Model: ",g,y);try{const w=await XB.load(g,y);c(w),console.log("Model Loaded Successfully"),d(!0)}catch(w){console.error("Error loading model:",w)}})()},[]),oe.useEffect(()=>{(async()=>{try{const m=AD(AO,t.image),g=await $D(m);r(g)}catch(m){console.log("Error fetching image:",m)}})()},[t.image]),oe.useEffect(()=>{const p=one(Mp(Ec,"waterCans",t.id),m=>{const g=m.data();g&&o(g.image)});return()=>p()},[t.id]);const f=async()=>{try{const p=AD(AO,i);try{const m=await $D(p),g=Mp(Ec,"waterCans",t.id);await DB(g,{image:i}),r(m),l(i)}catch(m){alert("Error fetching image. Check the Path."),o(a),console.log("Error fetching image:",m)}console.log("Image path updated successfully in Firestore"),console.log("New Image Path: ",s)}catch(p){console.error("Error updating image path in Firestore:",p)}};return he.jsxs("div",{className:"w-84 h-94 bg-gray-800 rounded-lg shadow-md p-6 relative text-gray-200 transform transition-transform hover:-translate-y-1 hover:shadow-xl",children:[he.jsx("h2",{className:"text-lg font-semibold mb-2",children:t.title}),he.jsxs("p",{className:"text-gray-400 mb-2",children:["Location: ",t.location]}),he.jsxs("p",{className:"text-gray-400 mb-4",children:["Phone: ",t.phoneNumber]}),he.jsxs("p",{className:"text-gray-400 mb-4",children:["Fetch Interval: ",t.fetchInterval," Minutes"]}),he.jsx("input",{type:"text",value:i,onChange:p=>o(p.target.value),className:"mb-2 bg-gray-700 text-gray-200 rounded-md px-3 py-1 focus:outline-none",placeholder:"Enter Image URL"}),he.jsx("button",{onClick:f,className:"mb-2 bg-gray-700 text-gray-200 rounded-md px-4 py-2 hover:bg-gray-600 focus:outline-none",children:"Get Image"}),he.jsx("img",{src:s,alt:"Water Can",className:"w-full h-80 mb-2 rounded-md"}),he.jsxs("p",{className:"text-gray-400 mb-4",children:["Last Updated: ",t.timestampField]}),h?he.jsx(MPe,{imagePath:s,model:u}):he.jsx("p",{children:"Loading..."}),he.jsx("br",{}),he.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2",onClick:()=>n(t),children:"Edit"}),he.jsx("button",{className:"bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:()=>e(t.id),children:"X"})]})},zPe=()=>{const{dispatch:t}=oe.useContext(gx),e=()=>{t({type:"LOGOUT"})};return he.jsx("button",{onClick:e,className:"bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Logout"})},_F=()=>{const[t,e]=oe.useState([]),[n,s]=oe.useState(!1),[r,i]=oe.useState(null),o=async()=>{try{const d=EO(Ec,"waterCans"),p=(await sne(Jte(d,Zte("timestampField")))).docs.map(m=>({id:m.id,...m.data()}));e(p)}catch(d){console.error("Error fetching water cans:",d)}};oe.useEffect(()=>{o()},[]);const a=d=>{i(d),s(!0)},l=async d=>{const f=Mp(Ec,"waterCans",d.id);await DB(f,d),o(),s(!1)},u=async()=>{await ine(EO(Ec,"waterCans"),{title:`Water Can ${t.length+1}`,location:"Location 1",phoneNumber:"123-456-7890",image:"data/screenshot.png",fetchInterval:30,timestampField:lne()}),o()},c=async d=>{await rne(Mp(Ec,"waterCans",d)),o()},h=()=>{s(!1),i(null)};return oe.useEffect(()=>{console.log("Editing Can:",r)},[r]),he.jsxs("div",{className:"bg-gray-200 min-h-screen p-8",children:[he.jsx("h1",{className:"text-3xl font-semibold mb-8 text-center",children:"Smart Water Can Management Dashboard"}),he.jsxs("div",{className:"flex justify-between mb-4",children:[he.jsx("button",{className:"bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:u,children:"Add Water Can"}),he.jsx(zPe,{})]}),he.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:t.map(d=>he.jsx(VPe,{can:d,onDelete:c,onEdit:a},d.id))}),n&&he.jsx(rse,{isOpen:n,onClose:h,onSave:l,can:r})]})};function BPe(){const{currentUser:t}=oe.useContext(gx);return console.log(t),he.jsx(he.Fragment,{children:he.jsx(tse,{children:he.jsxs(Jne,{children:[he.jsx(Cf,{path:"/",element:t?he.jsx(BI,{to:"/dashboard"}):he.jsx(zO,{})}),he.jsx(Cf,{path:"/login",element:t?he.jsx(BI,{to:"/dashboard"}):he.jsx(zO,{})}),he.jsx(Cf,{path:"/dashboard",element:t?he.jsx(_F,{}):he.jsx(BI,{to:"/login"})}),he.jsx(Cf,{path:"/dashboard",element:he.jsx(_F,{})})]})})})}iT.createRoot(document.getElementById("root")).render(he.jsx(sse,{children:he.jsx(BPe,{})}));
